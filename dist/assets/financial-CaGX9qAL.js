import{w as b,bI as Q,j as e,aN as k,y as W,I as p,dB as _,bK as z,bL as I,e as B,r as u,S as R,bO as g,D as Y,dE as V,er as G,dN as J,ed as U,p as w,aH as $,B as X,dD as Z,dO as y,dM as f,dP as S,eh as ee,H as te,C as ae}from"./index-CZcV1F_p.js";import{u as se,E as re}from"./error-block-Dw3l6JuN.js";import{C as oe}from"./custom-breadcrumbs-CbtQHK8e.js";import{u as ne,g as ie,r as le,T as de,a as ce,e as me}from"./table-selected-action-CboGdCqh.js";import{T as ue}from"./table-no-data-CVXJF7AK.js";import{T as pe,a as he,b as xe,c as ge}from"./table-head-custom-Cs1cDsOq.js";import{T as je}from"./table-pagination-custom-CQDZANoi.js";import{C as be}from"./confirm-dialog-CFSR5CRi.js";import{T as j}from"./TableCell-C1nm99o0.js";import{T as ye}from"./TextField-D7n2_qXr.js";import{I as fe}from"./InputAdornment-DsfHwWIs.js";import{z as Ce,u as De,t as Fe,F as Pe}from"./form-provider-Bx2WBj5v.js";import{F as T}from"./fields-hbdK3Trc.js";import"./image-DzsMNwzu.js";import"./editor-DaVZ1Z83.js";import{s as E}from"./schema-helper-CcrSI3-3.js";import{a as Se,b as Te,D as Ee}from"./DialogContent-BM8q5mKd.js";import{D as ve}from"./DialogTitle-DLTxRMh7.js";import{L as we}from"./LoadingButton-C_R2hpVD.js";import{u as v}from"./useMutation-RCoCYUsr.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-B9Q7SrE_.js";import"./empty-content-CpfMP5Ra.js";import"./TablePagination-CPW6B5yR.js";import"./LastPage-CSCREIen.js";import"./Select-DLGgW76C.js";import"./Menu-Biq0K9Dc.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-De2NihOG.js";import"./FormControlLabel-BJNlLSWJ.js";import"./FormControl-3TPlxton.js";import"./InputLabel-h10-06k3.js";import"./FormLabel-CRn0_UJR.js";import"./FormHelperText-BnZQySOl.js";import"./index-BQhbB6Ru.js";import"./countries-DSLisFCy.js";import"./Rating-DVTNlvpL.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-B7KCQCsS.js";import"./RadioGroup-r2gxq8lN.js";import"./FormGroup-BdZDUz2q.js";import"./Autocomplete-3PR52KH6.js";import"./Chip-C3BxFZTA.js";import"./country-select-C2iLpbAw.js";import"./upload-avatar-1D7Vf-s3.js";import"./format-number-_ePrRxix.js";import"./DatePicker-omkT4XAu.js";import"./ListItem-cuOSimek.js";import"./MobileDateTimePicker-SOESVVJ9.js";import"./index-DHVWpqoh.js";import"./CircularProgress-Dtq66Llh.js";const Be=({row:t,selected:a,onDeleteRow:n,onEditRow:o})=>{const i=b(),s=Q(),d=e.jsxs(pe,{hover:!0,selected:a,children:[e.jsx(j,{children:t==null?void 0:t.year}),e.jsx(j,{children:k(t==null?void 0:t.startDate)}),e.jsx(j,{children:k(t==null?void 0:t.endDate)}),e.jsx(j,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(W,{color:s.open?"inherit":"default",onClick:s.onOpen,children:e.jsx(p,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[d,e.jsx(_,{open:s.open,anchorEl:s.anchorEl,onClose:s.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(z,{children:[e.jsxs(I,{onClick:()=>{o(),s.onClose()},children:[e.jsx(p,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(I,{onClick:()=>{i.onTrue(),s.onClose()},sx:{color:"error.main"},children:[e.jsx(p,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),e.jsx(be,{open:i.value,onClose:i.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(B,{variant:"contained",color:"error",onClick:n,children:"Delete"})})]})};function Re({filters:t,onResetPage:a,options:n}){const o=u.useCallback(i=>{a(),t.setState({name:i.target.value})},[t,a]);return e.jsx(R,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(ye,{sx:{width:420},value:t.state.name,onChange:o,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(fe,{position:"start",children:e.jsx(p,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}const ke=Ce.object({year:E.date({message:{required_error:"Year is required!"}}),startDate:E.date({message:{required_error:"Start date is required!"}}),endDate:E.date({message:{required_error:"End date is required!"}})}),q=({financial:t,open:a,onClose:n,handler:o})=>{const i={year:(t==null?void 0:t.year)||g(),startDate:(t==null?void 0:t.startDate)||g(),endDate:(t==null?void 0:t.endDate)||g()};u.useEffect(()=>{t&&h(i)},[t]);const[s,d]=u.useState(""),l=De({resolver:Fe(ke),defaultValues:i}),{reset:h,handleSubmit:m,formState:{isSubmitting:x}}=l,C=m(async D=>{try{const c={...D};c.year=g(c.year).format("YYYY"),t?await o({id:t.id,payload:c}):await o(c),h()}catch(c){console.log(c),d(c instanceof Error?c.message:c)}});return e.jsxs(Se,{fullWidth:!0,open:a,onClose:n,children:[e.jsx(ve,{children:"Add Financial"}),e.jsx(Y,{}),!!s&&e.jsx(Alert,{severity:"error",sx:{mb:3},children:s}),e.jsxs(Pe,{methods:l,onSubmit:C,children:[e.jsx(Te,{children:e.jsxs(R,{spacing:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(1, 1fr)",lg:"repeat1, 1fr)"},children:[e.jsx(T.DatePicker,{views:["year"],format:"YYYY",label:"Year",name:"year",sx:{mt:2}}),e.jsx(T.DatePicker,{fullWidth:!0,label:"Start Date",name:"startDate",sx:{mt:2}}),e.jsx(T.DatePicker,{fullWidth:!0,label:"End Date",name:"endDate",sx:{mt:2}})]})}),e.jsx(Y,{sx:{pt:1,mt:1}}),e.jsxs(Ee,{children:[e.jsx(we,{type:"submit",variant:"contained",children:t?"Save Changes":"Save"}),e.jsx(B,{color:"inherit",variant:"outlined",onClick:n,children:"Cancel"})]})]})]})},Ie=({financial:t,open:a,onClose:n,handler:o})=>e.jsx(q,{financial:t,open:a,onClose:n,handler:o}),Ye=[{id:"year",label:"Year",width:140},{id:"startDate",label:"Start Date"},{id:"endDate",label:"End Date"},{id:"",width:88}];function qe({financialYears:t}){const a=ne({defaultOrderBy:"orderNumber"}),n=b(),o=b(),i=b(),[s,d]=u.useState(t),l=V({name:""}),h=G(l.state.startDate,l.state.endDate);u.useEffect(()=>{d(t)},[t]);const m=Ae({inputData:s,comparator:ie(a.order,a.orderBy),filters:l.state}),x=le(m,a.page,a.rowsPerPage),C=!!l.state.name||l.state.status!=="all"||!!l.state.startDate&&!!l.state.endDate,D=!m.length&&C||!m.length,c=u.useCallback(r=>{M(r)},[x.length,a,s]),[A,L]=u.useState(),H=u.useCallback(r=>{L(r),o.onToggle()},[x.length,a,s]),F=J(),{mutate:M}=v({mutationFn:r=>y.delete(f.financial.delete+r),onSuccess:async r=>{const P=s.filter(K=>K.id!==r);S.success("Delete success!"),d(P),a.onUpdatePageDeleteRow(x.length),i.onFalse()},onSettled:async()=>{await F.invalidateQueries({queryKey:["financial-year"]}),i.onFalse()},onError:()=>{}}),{mutate:N}=v({mutationFn:r=>y.post(f.financial.create,r),onSuccess:async()=>{S.success("New Financial Year Has Been Created!")},onSettled:async()=>{await F.invalidateQueries({queryKey:["financial-year"]}),n.onFalse()},onError:r=>{console.log(r)}}),{mutate:O}=v({mutationFn:({id:r,payload:P})=>y.patch(f.financial.edit+r,P),onSuccess:async()=>{S.success("Financial Year Has Been Modified!")},onSettled:async()=>{await F.invalidateQueries({queryKey:["financial-year"]}),o.onFalse()},onError:r=>{console.log(r)}});return e.jsxs(U,{children:[e.jsxs(R,{spacing:3,children:[e.jsx(oe,{links:[{name:"Dashboard",href:w.dashboard.root},{name:"Tools",href:w.dashboard.tools.root},{name:"Financial Year"}],sx:{mb:{xs:3,md:5}},action:e.jsx(B,{onClick:()=>n.onToggle(),variant:"contained",startIcon:e.jsx(p,{icon:"mingcute:add-line"}),children:"Add Financial Year"})}),e.jsxs($,{children:[e.jsx(Re,{filters:l,onResetPage:a.onResetPage,dateError:h}),e.jsxs(X,{sx:{position:"relative"},children:[e.jsx(de,{dense:a.dense,numSelected:a.selected.length,rowCount:m.length}),e.jsx(Z,{sx:{minHeight:444},children:e.jsxs(he,{size:a.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(xe,{order:a.order,orderBy:a.orderBy,headLabel:Ye,rowCount:m.length}),e.jsxs(ge,{children:[m.slice(a.page*a.rowsPerPage,a.page*a.rowsPerPage+a.rowsPerPage).map(r=>e.jsx(Be,{row:r,selected:a.selected.includes(r.id),onEditRow:()=>H(r),onDeleteRow:()=>c(r.id)},r.id)),e.jsx(ce,{height:a.dense?56:76,emptyRows:me(a.page,a.rowsPerPage,m.length)}),e.jsx(ue,{notFound:D})]})]})})]}),e.jsx(je,{page:a.page,dense:a.dense,count:m.length,rowsPerPage:a.rowsPerPage,onPageChange:a.onChangePage,onChangeDense:a.onChangeDense,onRowsPerPageChange:a.onChangeRowsPerPage})]})]}),e.jsx(q,{open:n.value,onClose:n.onFalse,handler:N}),e.jsx(Ie,{financial:A,open:o.value,onClose:o.onFalse,handler:O})]})}function Ae({inputData:t,comparator:a,filters:n}){const{name:o}=n,i=t.map((s,d)=>[s,d]);return i.sort((s,d)=>{const l=a(s[0],d[0]);return l!==0?l:s[1]-d[1]}),t=i.map(s=>s[0]),o&&(t=t.filter(s=>s.year.toLowerCase().indexOf(o.toLowerCase())!==-1)),t}const Le={title:`Tools | Dashboard - ${ae.site.name}`};function Ht(){const t=se({queryKey:["financial-year"],queryFn:async()=>{const{data:a}=await y.get(f.financial.list);return a}});return t.isPending||t.isLoading?e.jsx(ee,{}):t.isError?e.jsx(re,{route:w.dashboard.tools.root}):e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsxs("title",{children:[" ",Le.title]})}),e.jsx(qe,{financialYears:t.data})]})}export{Ht as default};

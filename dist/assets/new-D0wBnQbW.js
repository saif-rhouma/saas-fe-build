import{dn as L,Y as w,r as s,W as ye,ab as Pe,dp as be,dq as C,dm as f,dr as A,p as D,j as t,cY as B,S as l,B as a,I as N,C as H,v as we,ea as De,e8 as Ie,e as F,cV as T,dQ as Fe,dU as Te,H as Se}from"./index-88qAwG8P.js";import{u as S,E as Oe}from"./error-block-BTff90qR.js";import{C as qe}from"./custom-breadcrumbs-x7W5GMPl.js";import{u as R}from"./useMutation-Bjm4Nnvr.js";import{b as O}from"./format-number-B8FPsWIV.js";import{u as ke}from"./use-table-BYPgfP9k.js";import{C as Ve,O as Ee,a as Ye,I as Ae}from"./order-discount-product-dialog-DO9bIDGV.js";import{P as Be}from"./product-Item-button-Ci8ZBUz0.js";import{C as Ne}from"./component-pagination-custom-QKi9Y21H.js";import{O as Re}from"./order-product-table-01y8OgeE.js";import{O as ve}from"./order-customer-create-dialog-Dyn7Y3RP.js";import{T as v}from"./TextField-CQpihH7F.js";import{I as Le}from"./InputAdornment-Bg-m_z4_.js";import{F as He}from"./FormControl-BXGEHd-f.js";import{F as Ke}from"./FormHelperText-DA7jizKd.js";import{D as Qe}from"./DatePicker-C1aTSbY2.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./DialogContent-F9o-_CVT.js";import"./DialogTitle-CvyYkdF0.js";import"./Autocomplete-Du1dNHWZ.js";import"./Select-DFC-Q2QB.js";import"./Menu-BDUaDfAf.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-DD8qHu7J.js";import"./Chip-yDeOg34u.js";import"./form-provider-DSldc_Gv.js";import"./Rating-4WKJ8FeG.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-DKQnkQYm.js";import"./index-DZ-uLlaR.js";import"./Slider-Cdch2KEI.js";import"./FormLabel-Ck5_RgM9.js";import"./RadioGroup-DZvtDFL6.js";import"./FormGroup-B0QesIKW.js";import"./FormControlLabel-ts_MkIWE.js";import"./utils-BDEKF9xP.js";import"./index-CySZofTa.js";import"./countries-DSLisFCy.js";import"./country-select-B-6neUw6.js";import"./InputLabel-B0kOUcWA.js";import"./Checkbox-Cpc8f1GH.js";import"./upload-avatar-CSIBlxGF.js";import"./image-CkDsegDa.js";import"./MobileDateTimePicker-pEp8pQrB.js";import"./Tabs-gBKEx7yr.js";import"./KeyboardArrowRight-fE7_2VJ7.js";import"./TablePagination-CrnuwEMO.js";import"./LastPage-B6xWbdc0.js";import"./TableCell-Cl8UZGxf.js";import"./table-head-custom-g2OgtrHv.js";import"./incrementer-button-BYzmwBWa.js";import"./schema-helper-_nyXaTEe.js";import"./LoadingButton-CM47tPre.js";import"./CircularProgress-DIm-Ts9z.js";import"./ListItem-Bt-kWpW8.js";function Me({products:i,customers:p,taxPercentage:c}){const o=ke({defaultRowsPerPage:6}),{t:d}=L("orders"),j=w(),y=w(),P=w(),q=w(),[K,Q]=s.useState(""),[M,$]=s.useState(""),G=ye(),[W,J]=s.useState(),[x,U]=s.useState(0),[z,X]=s.useState(0),[k,h]=s.useState(!1),[Z,_]=s.useState(),[b,ee]=s.useState("Customer"),[V,te]=s.useState(Pe(new Date)),[n,u]=s.useState([]),[E,Y]=s.useState(i),I=be(),re=(e,r)=>{X(r),_(e),P.onToggle()},se=e=>{U(e),y.onFalse()},oe=(e,r)=>{u(m=>(m[e].price=r,[...m])),P.onFalse()},{mutate:ae}=R({mutationFn:e=>C.post(f.order.create,e),onSuccess:async()=>{A.success("New Order Has Been Created!"),await I.invalidateQueries({queryKey:["orders"]}),await I.invalidateQueries({queryKey:["orders","analytics"]})},onSettled:async()=>{G.push(D.dashboard.order.root)},onError:e=>{console.error(e)}}),ne=s.useCallback(e=>{J(e.target.value)},[]),ie=s.useCallback(e=>{ee(e),h(!e)},[]),ce=s.useCallback(e=>{u(r=>{const m=r.findIndex(je=>je.id===e.id);return m>=0?r[m].quantity+=1:(e.quantity=1,e.discount=0,r.push(e)),[...r]})},[]),le=s.useCallback(e=>{const r=e.target.value;r&&Y(i.filter(m=>m.name.toLowerCase().indexOf(r)!==-1)),(r==null||r==="")&&Y(i)},[]),de=s.useCallback(e=>{u(r=>(r[e].quantity-=1,r[e].quantity===0&&r.splice(e,1),[...r]))},[n]),ue=s.useCallback(e=>{u(r=>(r[e].discount>0&&(r[e].discount-=1),[...r]))},[]),me=s.useCallback(e=>{u(r=>(r[e].discount<100&&(r[e].discount+=1),[...r]))},[]),pe=s.useCallback(e=>{u(r=>(r[e].quantity+=1,[...r]))},[n]),xe=s.useCallback(e=>{u(r=>(r.splice(e,1),[...r]))},[n]),g=s.useCallback(()=>n.reduce((e,r)=>e+r.price*r.quantity,0),[n]);s.useCallback(()=>n.reduce((e,r)=>e+r.price*(r.discount/100)*r.quantity,0),[n]);const{mutate:he}=R({mutationFn:e=>C.post(f.customers.create,e),onSuccess:async()=>{A.success("New Customer Has Been Created!")},onSettled:async()=>{await I.invalidateQueries({queryKey:["customers"]}),j.onFalse()},onError:e=>{console.log(e)}}),ge=t.jsx(B,{children:t.jsxs(l,{children:[t.jsx(a,{sx:{p:3},children:t.jsx(v,{color:"success",fullWidth:!0,maxWidth:"xs",placeholder:d("createView.productsList.searchPlaceholder"),InputProps:{startAdornment:t.jsx(Le,{position:"start",children:t.jsx(N,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},onChange:le})}),t.jsx(a,{sx:{pl:3,pr:3},gap:1,display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:E.slice(o.page*o.rowsPerPage,o.page*o.rowsPerPage+o.rowsPerPage).map(e=>t.jsx(Be,{payload:e,handleClick:ce,productName:e==null?void 0:e.name,image:H.site.serverFileHost+(e==null?void 0:e.image)},e==null?void 0:e.id))}),t.jsx(Ne,{page:o.page,count:E.length,rowsPerPage:6,defaultRowsPerPage:6,onPageChange:o.onChangePage,onRowsPerPageChange:o.onChangeRowsPerPage})]})}),Ce=t.jsxs(l,{spacing:2,alignItems:"flex-end",sx:{p:2,textAlign:"right",typography:"body2"},children:[t.jsxs(l,{direction:"row",children:[t.jsx(a,{sx:{color:"text.secondary"},children:d("createView.createForm.extra.subTotal")}),t.jsx(a,{sx:{width:160,typography:"subtitle2"},children:O(g())||"-"})]}),t.jsxs(l,{direction:"row",alignItems:"center",children:[t.jsx(a,{sx:{color:"text.secondary"},children:d("createView.createForm.extra.discount")}),t.jsx(a,{sx:{width:160},children:t.jsx(a,{sx:{pl:4,mr:-.5},children:t.jsxs(l,{onClick:()=>{y.onToggle()},sx:{cursor:"pointer",p:.5,color:"error.main",borderRadius:1,typography:"subtitle2",border:e=>`solid 1px ${we(e.vars.palette.grey["500Channel"],.2)}`},children:[x,"%"]})})})]}),t.jsxs(l,{direction:"row",children:[t.jsxs(a,{sx:{color:"text.secondary"},children:[d("createView.createForm.extra.tax")," (",c||"0","%)"]}),t.jsx(a,{sx:{width:160},children:c?O(De(g()-g()*(x/100),c)):"-"})]}),t.jsxs(l,{direction:"row",sx:{typography:"subtitle1"},children:[t.jsxs("div",{children:[d("createView.createForm.extra.total"),":"]}),t.jsx(a,{sx:{width:160},children:O(Ie(g()-g()*(x/100),c))||"-"})]})]}),fe=t.jsx(B,{children:t.jsxs(l,{spacing:2,sx:{p:3},children:[t.jsxs(a,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[t.jsxs(He,{error:k&&!b,children:[t.jsx(Ve,{customers:p,onChange:ie}),k&&t.jsx(Ke,{error:!0,children:"Customer is required!"})]}),t.jsx(a,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:t.jsx(F,{variant:"contained",startIcon:t.jsx(N,{icon:"mingcute:add-line"}),onClick:()=>j.onToggle(),children:d("createView.createForm.buttons.addCustomer")})}),t.jsx(v,{label:"Order ID",placeholder:"This Could Be Generated Automatically",value:W,disabled:!0,InputLabelProps:{shrink:!0},onChange:ne,sx:{mt:2}}),t.jsx(Qe,{label:d("createView.createForm.fields.date.label"),sx:{mt:2},format:"DD/MM/YYYY",value:V,onChange:e=>{te(e)}})]}),t.jsx(Re,{products:n,onDecrease:de,onIncrease:pe,onDecreaseDiscount:ue,onIncreaseDiscount:me,handleDiscountDialog:re,removeItem:xe}),t.jsxs(a,{display:"flex",flexDirection:"column",alignItems:"flex-end",justifyContent:"center",children:[Ce,t.jsxs(a,{display:"flex",gap:2,height:50,children:[t.jsx(F,{variant:"contained",onClick:()=>{if(isNaN(parseInt(b))){h(!0);return}if(h(!1),!n.length){Q("Something went wrong. Product(s) are required!"),$("You need to add at least one product to this order. Please select a product from the list on the right."),q.onToggle();return}if(!isNaN(parseInt(b))&&n.length){h(!1);const e={discount:parseInt(x,10),orderDate:V.format("YYYY-MM-DD"),products:n.map(r=>({id:r.id,snapshotProductPrice:r.price,quantity:r.quantity})),customer:b};ae(e)}},children:d("createView.createForm.buttons.saveAndContinue")}),t.jsx(F,{variant:"outlined",onClick:()=>u([]),children:d("createView.createForm.buttons.clearAll")})]})]})]})});return t.jsxs(T,{container:!0,spacing:3,children:[t.jsx(T,{xs:12,md:3,children:t.jsx(l,{children:ge})}),t.jsx(T,{xs:12,md:9,children:t.jsx(l,{children:fe})}),t.jsx(ve,{open:j.value,onClose:j.onFalse,handler:he}),t.jsx(Ee,{discount:x,open:y.value,onClose:y.onFalse,handler:se}),t.jsx(Ye,{product:Z,discount:z,open:P.value,onClose:P.onFalse,handler:oe}),t.jsx(Ae,{dialog:q,title:K,contentText:M})]})}function $e({products:i,customers:p,taxPercentage:c}){const{t:o}=L("orders");return t.jsxs(Fe,{children:[t.jsx(qe,{heading:o("createView.pageTitle"),links:[{name:o("createView.breadCrumbsPageRootTitle"),href:D.dashboard.root},{name:`${o("createView.breadCrumbsParentPageTitle")}`,href:D.dashboard.order.root},{name:`${o("createView.breadCrumbsPageTitle")}`}],sx:{mb:{xs:3,md:5}}}),t.jsx(Me,{products:i,customers:p,taxPercentage:c})]})}const Ge={title:`Create a new Order | Dashboard - ${H.site.name}`};function Xt(){const i=S({queryKey:["products"],queryFn:async()=>(await C.get(f.products.list)).data}),p=S({queryKey:["customers"],queryFn:async()=>(await C.get(f.customers.list)).data}),c=S({queryKey:["account-application"],queryFn:async()=>{const{data:o}=await C.get(f.auth.application);return o}});return c.isLoading||i.isLoading||p.isLoading?t.jsx(Te,{}):c.isError||i.isError||i.isError?t.jsx(Oe,{route:D.dashboard.order.root}):t.jsxs(t.Fragment,{children:[t.jsx(Se,{children:t.jsxs("title",{children:[" ",Ge.title]})}),t.jsx($e,{products:i.data,customers:p.data,taxPercentage:c.data.taxPercentage})]})}export{Xt as default};

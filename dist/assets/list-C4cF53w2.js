import{Y as H,dn as V,a3 as W,j as e,d0 as F,d7 as D,em as w,e as f,I as g,en as I,$ as J,db as z,a6 as _,a7 as j,e4 as y,r as p,S as U,W as G,de as Y,e3 as X,p as C,dp as Z,dQ as ee,cV as b,cY as te,B as se,dd as ae,ed as ie,dq as k,dm as P,dr as oe,dU as L,H as re,C as le}from"./index-88qAwG8P.js";import{u as E,E as ne}from"./error-block-BTff90qR.js";import{u as de}from"./useMutation-Bjm4Nnvr.js";import{d as ce}from"./download-file-CuMwnLeo.js";import{C as me}from"./custom-breadcrumbs-x7W5GMPl.js";import{P as S}from"./permission-access-controller-BVvbpBzt.js";import{g as pe,r as ue,e as he}from"./utils-MBUcMVfY.js";import{u as xe}from"./use-table-BYPgfP9k.js";import{T as be}from"./table-no-data-wFoKraSE.js";import{T as ge}from"./table-empty-rows-6krMqYw2.js";import{T as je,a as Ce,b as we,c as Te}from"./table-head-custom-g2OgtrHv.js";import{T as fe}from"./table-selected-action-DnALz1xy.js";import{T as ye}from"./table-pagination-custom-Ds9-Dw8y.js";import{A as T}from"./app-widget-summary-DYEf84-y.js";import{C as ke}from"./confirm-dialog-BdxUyq-O.js";import{T as x}from"./TableCell-Cl8UZGxf.js";import{T as Pe}from"./tickets-create-dialog-C70zFhcK.js";import{T as Se}from"./TextField-CQpihH7F.js";import{I as Ve}from"./InputAdornment-Bg-m_z4_.js";import{S as ve}from"./Select-DFC-Q2QB.js";import{F as Re,a as Fe,c as De}from"./filters-result-B0DfRGbW.js";import{C as Ie}from"./Chip-yDeOg34u.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-vgDCQT8r.js";import"./Checkbox-Cpc8f1GH.js";import"./TablePagination-CrnuwEMO.js";import"./KeyboardArrowRight-fE7_2VJ7.js";import"./LastPage-B6xWbdc0.js";import"./InputBase-DD8qHu7J.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-ts_MkIWE.js";import"./format-number-B8FPsWIV.js";import"./use-chart-CQlJjdjJ.js";import"./chart-legends-Cmehhq5p.js";import"./index-CySZofTa.js";import"./DialogContent-F9o-_CVT.js";import"./DialogTitle-CvyYkdF0.js";import"./form-provider-DSldc_Gv.js";import"./FormHelperText-DA7jizKd.js";import"./Rating-4WKJ8FeG.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-DKQnkQYm.js";import"./Menu-BDUaDfAf.js";import"./index-DZ-uLlaR.js";import"./Slider-Cdch2KEI.js";import"./FormControl-BXGEHd-f.js";import"./FormLabel-Ck5_RgM9.js";import"./RadioGroup-DZvtDFL6.js";import"./FormGroup-B0QesIKW.js";import"./utils-BDEKF9xP.js";import"./countries-DSLisFCy.js";import"./Autocomplete-Du1dNHWZ.js";import"./country-select-B-6neUw6.js";import"./InputLabel-B0kOUcWA.js";import"./upload-avatar-CSIBlxGF.js";import"./image-CkDsegDa.js";import"./DatePicker-C1aTSbY2.js";import"./ListItem-Bt-kWpW8.js";import"./MobileDateTimePicker-pEp8pQrB.js";import"./Tabs-gBKEx7yr.js";import"./upload-box-ad-BK5SyPw0.js";import"./LoadingButton-CM47tPre.js";import"./CircularProgress-DIm-Ts9z.js";const Ee=({row:t,index:o,selected:s,onViewRow:i,onViewFileRow:l,onDeleteRow:d,onViewQuotationRow:u})=>{const c=H(),{t:n}=V("tickets"),a=W(),h=e.jsxs(je,{hover:!0,selected:s,children:[e.jsx(x,{children:o||t.id}),e.jsx(x,{children:F(t.createTime)}),e.jsx(x,{children:t.topic}),e.jsx(x,{children:e.jsxs(D,{variant:"soft",color:t.priority==="Low"&&"success"||t.priority==="Medium"&&"warning"||t.priority==="Hight"&&"error"||"default",children:[t.priority===w.Hight&&n("listView.table.tableHeader.hight"),t.priority===w.Low&&n("listView.table.tableHeader.low"),t.priority===w.Medium&&n("listView.table.tableHeader.medium")]})}),e.jsx(x,{children:F(t.updateTime)}),e.jsx(x,{children:JSON.parse(t.quotation).ref?e.jsxs(f,{variant:"contained",size:"small",startIcon:e.jsx(g,{icon:"heroicons-outline:external-link"}),onClick:()=>{JSON.parse(t.quotation).id&&u(JSON.parse(t.quotation).id)},children:["#",JSON.parse(t.quotation).ref]}):"-"}),e.jsx(x,{children:e.jsxs(D,{variant:"soft",color:t.status==="Open"&&"info"||t.status==="Closed"&&"default"||"default",children:[t.status===I.Open&&n("listView.table.tableHeader.open"),t.status===I.Closed&&n("listView.table.tableHeader.closed")]})}),e.jsx(x,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(J,{color:a.open?"inherit":"default",onClick:a.onOpen,children:e.jsx(g,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[h,e.jsx(z,{open:a.open,anchorEl:a.anchorEl,onClose:a.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(_,{children:[(t==null?void 0:t.file)&&e.jsxs(j,{onClick:()=>{l(),a.onClose()},children:[e.jsx(g,{icon:"solar:cloud-download-bold"}),n("listView.table.tableActions.download")]}),e.jsxs(j,{onClick:()=>{i(),a.onClose()},children:[e.jsx(g,{icon:"solar:eye-bold"}),n("listView.table.tableActions.view")]}),e.jsx(S,{permission:y.DELETE_TICKET,children:e.jsxs(j,{onClick:()=>{c.onTrue(),a.onClose()},sx:{color:"error.main"},children:[e.jsx(g,{icon:"solar:trash-bin-trash-bold"}),n("listView.table.tableActions.delete")]})})]})}),e.jsx(ke,{open:c.value,onClose:c.onFalse,title:n("listView.messages.dialogDelete.title"),content:n("listView.messages.dialogDelete.text"),action:e.jsx(f,{variant:"contained",color:"error",onClick:d,children:n("listView.table.tableActions.delete")})})]})};function He({filters:t,onResetPage:o}){const[s,i]=p.useState("all"),{t:l}=V("tickets"),d=p.useCallback(c=>{o(),t.setState({name:c.target.value})},[t,o]),u=p.useCallback(c=>{o(),t.setState({status:c.target.value}),i(c.target.value)},[t,o]);return e.jsxs(U,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(Se,{sx:{width:420},value:t.state.name,onChange:d,placeholder:l("listView.table.tableToolbar.searchPlaceholder"),InputProps:{startAdornment:e.jsx(Ve,{position:"start",children:e.jsx(g,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(ve,{sx:{width:420,textTransform:"capitalize"},value:s,onChange:u,children:[e.jsx(j,{value:"all",children:l("listView.table.tableToolbar.selectMenu.allTickets")}),e.jsx(j,{value:"Open",children:l("listView.table.tableToolbar.selectMenu.openTickets")}),e.jsx(j,{value:"Closed",children:l("listView.table.tableToolbar.selectMenu.closedTickets")})]})]})}function Le({filters:t,totalResults:o,onResetPage:s,sx:i}){const l=p.useCallback(()=>{s(),t.setState({name:""})},[t,s]),d=p.useCallback(()=>{s(),t.onResetState()},[t,s]);return e.jsx(Re,{totalResults:o,onReset:d,sx:i,children:e.jsx(Fe,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(Ie,{...De,label:t.state.name,onDelete:l})})})}const Ae=({tickets:t,analytics:o})=>{const s=xe({defaultOrderBy:"orderNumber"}),{t:i}=V("tickets"),l=G(),d=H(),[u,c]=p.useState(t),n=[{id:"ticketId",label:"#",width:140},{id:"date",label:`${i("listView.table.tableHeader.date")}`,width:280},{id:"topic",label:`${i("listView.table.tableHeader.topic")}`},{id:"priority",label:`${i("listView.table.tableHeader.priority")}`},{id:"lastUpdate",label:`${i("listView.table.tableHeader.lastUpdate")}`},{id:"related",label:`${i("listView.table.tableHeader.related")}`},{id:"status",label:`${i("listView.table.tableHeader.status")}`},{id:"",width:88}],a=Y({name:"",status:"all",startDate:null,endDate:null});p.useEffect(()=>{c(t)},[t]);const h=X(a.state.startDate,a.state.endDate),m=Be({inputData:u,comparator:pe(s.order,s.orderBy),filters:a.state,dateError:h}),A=ue(m,s.page,s.rowsPerPage),v=!!a.state.name||a.state.status!=="all"||!!a.state.startDate&&!!a.state.endDate,B=!m.length&&v||!m.length,O=p.useCallback(r=>{M(r)},[A.length,s,u]),q=p.useCallback(r=>{l.push(C.dashboard.tickets.details(r))},[l]),$=p.useCallback(r=>{l.push(C.dashboard.quotation.details(r))},[l]),R=Z(),K=r=>{ce(r)},{mutate:M}=de({mutationFn:r=>k.delete(P.tickets.delete+r),onSuccess:async()=>{oe.success(i("listView.messages.toastMessages.deleteSuccess")),await R.invalidateQueries({queryKey:["tickets"]}),await R.invalidateQueries({queryKey:["tickets","analytics"]})},onSettled:async()=>{},onError:r=>{}}),N=()=>o.isPending||o.isLoading?e.jsx(b,{xs:12,md:12,children:e.jsx(L,{})}):e.jsxs(e.Fragment,{children:[e.jsx(b,{xs:12,md:4,children:e.jsx(T,{title:i("listView.statisticsWidgets.allTickets"),total:t.length,chart:{}})}),e.jsx(b,{xs:12,md:4,children:e.jsx(T,{title:i("listView.statisticsWidgets.openTickets"),total:o.data.analytics.Open,chart:{}})}),e.jsx(b,{xs:12,md:4,children:e.jsx(T,{title:i("listView.statisticsWidgets.closedTickets"),total:o.data.analytics.Closed,chart:{}})})]});return e.jsxs(e.Fragment,{children:[e.jsx(ee,{maxWidth:"xl",children:e.jsxs(b,{container:!0,spacing:3,children:[e.jsx(b,{xs:12,md:12,children:e.jsx(me,{links:[{name:`${i("listView.breadCrumbsPageRootTitle")}`,href:C.dashboard.root},{name:`${i("listView.breadCrumbsParentPageTitle")}`,href:C.dashboard.tickets.root},{name:`${i("listView.breadCrumbsPageTitle")}`}],action:e.jsx(S,{permission:y.ADD_TICKET,children:e.jsx(f,{onClick:()=>d.onToggle(),variant:"contained",startIcon:e.jsx(g,{icon:"mingcute:add-line"}),children:i("listView.addNewTicket")})})})}),e.jsxs(S,{permission:y.TICKET_LIST,children:[N(),e.jsx(b,{xs:12,md:12,children:e.jsxs(te,{children:[e.jsx(He,{filters:a,onResetPage:s.onResetPage,dateError:h}),v&&e.jsx(Le,{filters:a,totalResults:m.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(se,{sx:{position:"relative"},children:[e.jsx(fe,{dense:s.dense,numSelected:s.selected.length,rowCount:m.length}),e.jsx(ae,{sx:{minHeight:444},children:e.jsxs(Ce,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(we,{order:s.order,orderBy:s.orderBy,headLabel:n,rowCount:m.length}),e.jsxs(Te,{children:[m.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map((r,Q)=>e.jsx(Ee,{row:r,index:s.page*s.rowsPerPage+Q+1,selected:s.selected.includes(r.id),onSelectRow:()=>s.onSelectRow(r.id),onDeleteRow:()=>O(r.id),onViewRow:()=>q(r.id),onViewFileRow:()=>K(r.file),onViewQuotationRow:$},r.id)),e.jsx(ge,{height:s.dense?56:76,emptyRows:he(s.page,s.rowsPerPage,m.length)}),e.jsx(be,{notFound:B})]})]})})]}),e.jsx(ye,{page:s.page,dense:s.dense,count:m.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})]})]})}),e.jsx(Pe,{open:d.value,onClose:d.onFalse})]})};function Be({inputData:t,comparator:o,filters:s,dateError:i}){const{status:l,name:d,startDate:u,endDate:c}=s,n=t.map((a,h)=>[a,h]);return n.sort((a,h)=>{const m=o(a[0],h[0]);return m!==0?m:a[1]-h[1]}),t=n.map(a=>a[0]),d&&(t=t.filter(a=>a.id.toString().indexOf(d.toLowerCase())!==-1||a.topic.toLowerCase().indexOf(d.toLowerCase())!==-1||a.priority.toLowerCase().indexOf(d.toLowerCase())!==-1)),l!=="all"&&(t=t.filter(a=>a.status===l)),i||u&&c&&(t=t.filter(a=>ie(a.createdAt,u,c))),t}const Oe={title:`Tickets list | Dashboard - ${le.site.name}`};function Yt(){const t=E({queryKey:["tickets"],queryFn:async()=>{const{data:s}=await k.get(P.tickets.list);return s}}),o=E({queryKey:["tickets","analytics"],queryFn:async()=>{const{data:s}=await k.get(P.tickets.analytics);return s}});return o.isLoading||t.isLoading?e.jsx(L,{}):t.isError||o.isError?e.jsx(ne,{route:C.dashboard.tickets.root}):e.jsxs(e.Fragment,{children:[e.jsx(re,{children:e.jsxs("title",{children:[" ",Oe.title]})}),e.jsx(Ae,{tickets:t.data,analytics:o})]})}export{Yt as default};

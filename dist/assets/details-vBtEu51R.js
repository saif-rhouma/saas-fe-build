import{j as e,B as n,T as K,ek as H,d7 as E,S as l,e3 as b,e as y,I as L,cY as I,h as $,e9 as W,e2 as G,d0 as P,el as V,r as p,i as O,dn as Y,ea as _,em as S,dP as M,p as C,cV as D,dp as j,dm as f,dq as v,dT as J,H as X,C as z}from"./index-7x0Jzu-K.js";import{u as U,E as Z}from"./error-block-D00Vx1n_.js";import{u as ee}from"./use-params-DPBrKddI.js";import"./chart-legends-iUQdd2VW.js";import{l as te}from"./index-BGpau22_.js";import{u as w}from"./useMutation-Dv_B02Gt.js";import{C as se}from"./confirm-dialog-BHj6qF5m.js";import{C as ie}from"./custom-breadcrumbs-D7fqN-ij.js";import{b as g}from"./format-number-BYwLqIh3.js";import{P as T}from"./permission-access-controller-rKmHX9Pj.js";import{T as ne,t as ae,a as re,b as oe,c as le,d as ce,e as de}from"./TimelineSeparator-DcrPCcK1.js";import{C as B}from"./CardHeader-CM70btIT.js";import{O as pe}from"./order-product-table-DwZLQ20v.js";import{O as xe}from"./order-payment-details-dialog-cIwDeKsy.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./index-BCeO1QHE.js";import"./DialogContent-DR8-NI-y.js";import"./DialogTitle-DqsJD2XR.js";import"./table-head-custom-GbSIW9-C.js";import"./TableCell-CE_O9heW.js";import"./Checkbox-4dEQ1AxH.js";import"./incrementer-button-CtjoRD9w.js";import"./form-provider-L4HXF3hb.js";import"./TextField-DM-8f0BQ.js";import"./FormControl-CwgFqIpY.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-CJ9sg_Jr.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-ChZcLmvt.js";import"./Select-BZc5REn1.js";import"./Menu-B1dt3wvU.js";import"./InputBase-Bf6dB4gm.js";import"./FormHelperText-DXUXEoCg.js";import"./Rating-DCB2jqoU.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-Bx-A_rYM.js";import"./index-DNxFhLTH.js";import"./Slider-CmH7wyJF.js";import"./RadioGroup-Be2nemTL.js";import"./FormGroup-dOY1iFws.js";import"./FormControlLabel-BkxrN50L.js";import"./utils-BKVZXmx9.js";import"./countries-DSLisFCy.js";import"./InputAdornment-Cy6JkpYJ.js";import"./Autocomplete-Y9_S23We.js";import"./Chip-BqIxCVbz.js";import"./country-select-CiBbKvWF.js";import"./upload-avatar-Cx6DIh4F.js";import"./image-CdiR8fRs.js";import"./DatePicker-DNImynf8.js";import"./ListItem-Bl8LEqBl.js";import"./MobileDateTimePicker-C1e3BYNb.js";import"./Tabs-DBbaXAIS.js";import"./KeyboardArrowRight-BVBZSuVb.js";import"./schema-helper-Jf_nWAk5.js";import"./LoadingButton-D4yaP3jf.js";import"./CircularProgress-BU2etINY.js";const me=({order:t,payments:s,dialog:r,handleApproveOrder:a,handlePrint:x})=>{const d=e.jsxs(n,{sx:{pr:4,pl:4,pb:4,pt:2},children:[e.jsx(ne,{sx:{p:0,m:0,[`& .${ae.root}:before`]:{flex:0,padding:0}},children:s==null?void 0:s.map((o,c)=>{const m=c===0,h=c===s.length-1;return e.jsxs(re,{children:[e.jsxs(oe,{children:[e.jsx(le,{color:m&&"primary"||"grey"}),h?null:e.jsx(ce,{})]}),e.jsx(de,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsx(K,{variant:"subtitle2",children:g(o.amount)}),e.jsx(n,{sx:{color:"text.disabled",typography:"caption",mt:.5},children:H(o.paymentDate)})]}),e.jsx(E,{color:"success",children:o.paymentType})]})})]},o.id)})}),e.jsxs(l,{justifyContent:"flex-end",spacing:1.5,sx:{marginTop:2},children:[(t==null?void 0:t.status)!=="Draft"&&(t==null?void 0:t.status)!=="Canceled"&&e.jsx(T,{permission:b.ADD_PAYMENT,children:e.jsx(y,{variant:"contained",onClick:()=>r.onTrue(),children:"Add Payment"})}),e.jsx(T,{permission:b.APPROVE_ORDER,children:(t==null?void 0:t.status)==="Draft"&&e.jsx(y,{variant:"outlined",onClick:()=>{a(t.id)},children:"Approve"})}),e.jsx(T,{permission:b.PRINT_ORDER,children:e.jsxs(y,{variant:"outlined",color:"info",onClick:()=>x(),children:[e.jsx(L,{icon:"solar:printer-minimalistic-bold"}),e.jsx("span",{style:{margin:4},children:"Print Order"})]})})]})]});return e.jsxs(I,{children:[(s==null?void 0:s.length)>0&&e.jsx(B,{title:"Payments"}),d]})};function he({order:t,discount:s,customer:r,totalAmount:a}){const{user:x}=$(),d=e.jsxs(l,{spacing:2,alignItems:"flex-end",sx:{p:3,textAlign:"right",typography:"body2"},children:[e.jsxs(l,{direction:"row",children:[e.jsx(n,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(n,{sx:{width:160,typography:"subtitle2"},children:g(a)||"-"})]}),e.jsxs(l,{direction:"row",children:[e.jsx(n,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(n,{sx:{width:160,...s&&{color:"error.main"}},children:s?`- ${s}%`:"-"})]}),e.jsxs(l,{direction:"row",children:[e.jsxs(n,{sx:{color:"text.secondary"},children:["Tax (",(t==null?void 0:t.snapshotTaxPercentage)||"0","%)"]}),e.jsx(n,{sx:{width:160},children:t!=null&&t.snapshotTaxPercentage?g(W(a-a*(s/100),t==null?void 0:t.snapshotTaxPercentage)):"-"})]}),e.jsxs(l,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:"Gross Total"}),e.jsx(n,{sx:{width:160},children:g(G(a-a*(s/100),t==null?void 0:t.snapshotTaxPercentage))||"-"})]})]});return e.jsxs(I,{children:[e.jsx(l,{justifyContent:"center",alignItems:"center",children:e.jsxs("h1",{className:"print-title",children:["Order REF: #",t.ref]})}),e.jsx("style",{jsx:!0,children:`
        .print-title {
          display: none; /* Hide on screen */
        }

        @media print {
          .print-title {
            display: block; /* Show only when printing */
          }
          .print-hide {
            display: none; /* Hide on screen */
          }
          html,
          body {
            height: initial !important;
            overflow: initial !important;
          }

          .scrollableDiv {
            width: 100%;
            height: 100% !important;
            overflow: visible;
          }
        }
      `}),e.jsx(B,{className:"print-hide",title:"Details"}),e.jsxs(l,{direction:"row",justifyContent:"space-between",sx:{p:3,typography:"body2"},children:[e.jsxs(n,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[e.jsx(l,{direction:"row",sx:{typography:"subtitle2",marginBottom:1},children:e.jsx("div",{children:"Order Details"})}),e.jsxs(n,{sx:{color:"text.secondary"},children:["ORDER ID: #",t.ref]}),e.jsxs(n,{sx:{color:"text.secondary"},children:["Order Date: ",P(t.orderDate)]}),e.jsxs(n,{sx:{color:"text.secondary"},children:["Delivery Date: ",t.deliveryDate?P(t.deliveryDate):e.jsx("span",{children:" - "})]})]}),e.jsxs(n,{flexDirection:"column",gap:.5,sx:{display:"flex",width:"100%",p:1,borderRight:o=>`dashed 2px ${o.vars.palette.background.neutral}`,borderLeft:o=>`dashed 2px ${o.vars.palette.background.neutral}`},children:[e.jsx(l,{display:"flex",justifyContent:"center",alignItems:"center",sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:e.jsx("div",{children:V(x)})}),e.jsxs(n,{sx:{color:"text.secondary"},children:["Status :"," ",e.jsx(E,{variant:"soft",color:(t==null?void 0:t.status)==="Ready"&&"info"||(t==null?void 0:t.status)==="InProcess"&&"warning"||(t==null?void 0:t.status)==="Delivered"&&"success"||"default",children:t==null?void 0:t.status})]}),e.jsxs(n,{sx:{color:"text.secondary"},children:["TAX: ",r==null?void 0:r.taxNumber]})]}),e.jsxs(n,{flexDirection:"column",alignItems:"center",sx:{p:1,display:"flex",width:"100%"},children:[e.jsx(l,{display:"flex",alignItems:"center",gap:1,sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:e.jsx("div",{children:"Order To"})}),e.jsx(n,{sx:{color:"text.secondary"},children:r==null?void 0:r.name}),e.jsxs(n,{sx:{color:"text.secondary"},children:["Tel: ",r==null?void 0:r.phoneNumber]})]})]}),e.jsx(n,{fullWidth:!0,alignItems:"center",sx:{p:3,borderBottom:o=>`dashed 2px ${o.vars.palette.background.neutral}`},children:e.jsx(pe,{products:t.productToOrder,isDetail:!0})}),d,(t==null?void 0:t.notes)&&e.jsx(l,{justifyContent:"space-between",sx:{p:3,typography:"body2"},children:e.jsxs(n,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[e.jsx(l,{sx:{typography:"subtitle2",marginBottom:1},children:e.jsx("div",{children:"Notes:"})}),e.jsx(n,{sx:{color:"text.secondary"},children:t==null?void 0:t.notes})]})})]})}function ue({currentOrder:t}){const[s,r]=p.useState(t),[a,x]=p.useState(),d=p.useRef(),o=O(),c=Y(),[m,h]=p.useState([]),u=O(),k=_();p.useEffect(()=>{r(t)},[t]),p.useEffect(()=>{const i=S(s==null?void 0:s.payments,"paymentDate");h(i)},[s==null?void 0:s.payments]);const{mutate:R}=w({mutationFn:i=>j.post(f.payments.create,i),onSuccess:async i=>{v.success("New Payment Has Been Created!");const{data:Q}=i,N=S([...m,Q],"paymentDate");h(N)},onSettled:async()=>{await c.invalidateQueries({queryKey:["payments"]});const{id:i}=s;await c.invalidateQueries({queryKey:["order",i]}),o.onFalse()},onError:i=>{console.log(i)}}),{mutate:A}=w({mutationFn:i=>j.get(f.order.approve+i),onSuccess:async({data:i})=>{i!=null&&i.length?(u.onTrue(),x(i)):(v.success("Order Has Been Approved!"),r(i))},onSettled:async()=>{const{id:i}=s;await c.invalidateQueries({queryKey:["orders"]}),await c.invalidateQueries({queryKey:["orders","analytics"]}),await c.invalidateQueries({queryKey:["order",i]})},onError:i=>{console.log(i)}}),{mutate:F}=w({mutationFn:i=>j.post(f.order.createPlans,i),onSuccess:async({data:i})=>{v.success("Order Has Been Approved!"),r(i),u.onFalse()},onSettled:async()=>{const{id:i}=s;await c.invalidateQueries({queryKey:["orders"]}),await c.invalidateQueries({queryKey:["orders","analytics"]}),await c.invalidateQueries({queryKey:["order",i]})},onError:i=>{console.log(i)}}),q=te.useReactToPrint({content:()=>d.current});return e.jsxs(e.Fragment,{children:[e.jsxs(M,{children:[e.jsx(ie,{links:[{name:"Dashboard",href:C.dashboard.root},{name:"Order",href:C.dashboard.order.root},{name:"Order Details"}],sx:{mb:{xs:3,md:5}}}),e.jsxs(D,{container:!0,spacing:3,children:[e.jsx(D,{xs:12,md:9,children:e.jsx(l,{ref:d,spacing:3,direction:{xs:"column-reverse",md:"column"},children:e.jsx(he,{order:s,customer:s==null?void 0:s.customer,discount:s==null?void 0:s.discount,totalAmount:s==null?void 0:s.totalOrderAmount})})}),e.jsx(D,{xs:12,md:3,children:e.jsx(me,{order:s,payments:m,dialog:o,handleApproveOrder:A,handlePrint:q})})]}),e.jsx(xe,{order:s,open:o.value,onClose:o.onFalse,handler:R})]}),e.jsx(se,{open:u.value,onClose:u.onFalse,title:"Out of Stock",content:e.jsxs(e.Fragment,{children:[e.jsx(n,{children:"Products are out of Stock! do you want to create plans?"}),e.jsxs(n,{sx:{mt:1,mb:1},children:["You need to create ",e.jsx("span",{style:{fontWeight:"bold"},children:a==null?void 0:a.length})," :"]}),a==null?void 0:a.map(i=>e.jsxs(n,{children:["Plan for ",e.jsx("span",{style:{fontWeight:"bold"},children:i.product.name})," because is missing"," ",e.jsx("span",{style:{fontWeight:"bold",color:`${k.vars.palette.error.light}`},children:i.missingQuantity}),"."]}))]}),action:e.jsx(y,{variant:"contained",color:"error",onClick:()=>{F(a)},children:(a==null?void 0:a.length)>1?"Create Plans":"Create Plan"})})]})}const ye={title:`Order details | Dashboard - ${z.site.name}`};function vt(){const{id:t=""}=ee(),s=U({queryKey:["order",t],queryFn:async()=>{const{data:r}=await j.get(f.order.details+t);return r}});return s.isPending||s.isLoading?e.jsx(J,{}):s.isError?e.jsx(Z,{route:C.dashboard.order.root}):e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsxs("title",{children:[" ",ye.title]})}),e.jsx(ue,{currentOrder:s.data})]})}export{vt as default};

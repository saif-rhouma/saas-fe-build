import{o as j,bO as O,j as e,aJ as B,w as z,I as b,dw as W,bQ as J,em as v,bR as U,e as R,bU as x,r as p,D as k,x as V,S as Y,dz as G,eo as $,dI as X,e8 as Z,p as I,aD as ee,B as te,dy as ae,dJ as y,dH as f,dK as S,ec as se,H as re,C as oe}from"./index-DCM0dqKu.js";import{u as ne,E as ie}from"./error-block-DeCjSF4t.js";import{u as T}from"./useMutation-D2La3F2r.js";import{C as le}from"./custom-breadcrumbs-IetWuDPQ.js";import{P as A}from"./permission-access-controller-BgXcwVE8.js";import{u as de,g as ce,r as me,T as pe,a as ue,e as he}from"./table-selected-action-7WjA_XRC.js";import{T as xe}from"./table-no-data-DG1YJIcm.js";import{T as ge,a as je,b as ye,c as fe}from"./table-head-custom-BoFwl8d4.js";import{T as be}from"./table-pagination-custom-COA0RpS-.js";import{C as Ce}from"./confirm-dialog-BBBRv5VF.js";import{T as g}from"./TableCell-COeTtVrZ.js";import{z as De,u as Fe,t as Pe,a as Se,F as E}from"./form-provider-CsXzZQi6.js";import"./image-DskMD1i2.js";import"./editor-DskST7D0.js";import{s as w}from"./schema-helper-Bjct6y-B.js";import{a as Te,b as Ee,D as we}from"./DialogContent-BFR1QZgD.js";import{D as ve}from"./DialogTitle-DthX4Z2k.js";import{L as Ie}from"./LoadingButton-CNUTqo8f.js";import{T as Ae}from"./TextField-n063yImk.js";import{I as Re}from"./InputAdornment-DO0FXlwx.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-bK399IpG.js";import"./empty-content-CBh9MUbL.js";import"./TablePagination-DnPqO4b4.js";import"./KeyboardArrowRight-CIlbmAZJ.js";import"./LastPage-DhTfx2BG.js";import"./Select-BfBEUDqV.js";import"./Menu-DUao5Yoh.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-DTC7mqIN.js";import"./FormControlLabel-DzI7o2_A.js";import"./FormHelperText-DqZjaKA5.js";import"./Rating-bGgbH5MB.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-DbZp1IuP.js";import"./FormControl-CzeO_UtU.js";import"./FormLabel-sPKOeIzp.js";import"./RadioGroup-Dwnhy8-J.js";import"./FormGroup-B2wxUdmP.js";import"./index-BdcQkSNX.js";import"./countries-DSLisFCy.js";import"./Autocomplete-B8SRK5t2.js";import"./Chip-B7AXZfmm.js";import"./country-select-D81VscAm.js";import"./InputLabel-D4P0yivD.js";import"./upload-avatar-QqSqRao9.js";import"./format-number-BQ7t0qkw.js";import"./DatePicker-BHh4WHnP.js";import"./ListItem-BlYb29G3.js";import"./MobileDateTimePicker-B4xWrI2C.js";import"./Tabs-D0Tq82TW.js";import"./index-BWYPRE2-.js";import"./CircularProgress-CObVdEvj.js";const Ye=({row:t,selected:a,onDeleteRow:n,onEditRow:o})=>{const l=j(),s=O(),d=e.jsxs(ge,{hover:!0,selected:a,children:[e.jsx(g,{children:t==null?void 0:t.year}),e.jsx(g,{children:B(t==null?void 0:t.startDate)}),e.jsx(g,{children:B(t==null?void 0:t.endDate)}),e.jsx(g,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(z,{color:s.open?"inherit":"default",onClick:s.onOpen,children:e.jsx(b,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[d,e.jsx(W,{open:s.open,anchorEl:s.anchorEl,onClose:s.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsx(J,{children:e.jsx(A,{permission:v.EDIT_FINANCIAL_YEAR,children:e.jsxs(U,{onClick:()=>{o(),s.onClose()},children:[e.jsx(b,{icon:"solar:pen-bold"}),"Edit"]})})})}),e.jsx(Ce,{open:l.value,onClose:l.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(R,{variant:"contained",color:"error",onClick:n,children:"Delete"})})]})},Be=De.object({year:w.date({message:{required_error:"Year is required!"}}),startDate:w.date({message:{required_error:"Start date is required!"}}),endDate:w.date({message:{required_error:"End date is required!"}})}),L=({financial:t,open:a,onClose:n,handler:o})=>{const l={year:(t==null?void 0:t.year)||x(),startDate:(t==null?void 0:t.startDate)||x(),endDate:(t==null?void 0:t.endDate)||x()};p.useEffect(()=>{t&&u(l)},[t]);const[s,d]=p.useState(""),i=Fe({resolver:Pe(Be),defaultValues:l}),{reset:u,handleSubmit:m,formState:{isSubmitting:h}}=i,C=m(async D=>{try{const c={...D};c.year=x(c.year).format("YYYY"),t?await o({id:t.id,payload:c}):await o(c),u()}catch(c){console.log(c),d(c instanceof Error?c.message:c)}});return e.jsxs(Te,{fullWidth:!0,open:a,onClose:n,children:[e.jsx(ve,{children:"Add Financial"}),e.jsx(k,{}),!!s&&e.jsx(V,{severity:"error",sx:{mb:3},children:s}),e.jsxs(Se,{methods:i,onSubmit:C,children:[e.jsx(Ee,{children:e.jsxs(Y,{spacing:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(1, 1fr)",lg:"repeat1, 1fr)"},children:[e.jsx(E.DatePicker,{views:["year"],format:"YYYY",label:"Year",name:"year",sx:{mt:2}}),e.jsx(E.DatePicker,{fullWidth:!0,label:"Start Date",name:"startDate",sx:{mt:2}}),e.jsx(E.DatePicker,{fullWidth:!0,label:"End Date",name:"endDate",sx:{mt:2}})]})}),e.jsx(k,{sx:{pt:1,mt:1}}),e.jsxs(we,{children:[e.jsx(Ie,{type:"submit",variant:"contained",children:t?"Save Changes":"Save"}),e.jsx(R,{color:"inherit",variant:"outlined",onClick:n,children:"Cancel"})]})]})]})},ke=({financial:t,open:a,onClose:n,handler:o})=>e.jsx(L,{financial:t,open:a,onClose:n,handler:o});function Le({filters:t,onResetPage:a,options:n}){const o=p.useCallback(l=>{a(),t.setState({name:l.target.value})},[t,a]);return e.jsx(Y,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(Ae,{sx:{width:420},value:t.state.name,onChange:o,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(Re,{position:"start",children:e.jsx(b,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}const qe=[{id:"year",label:"Year",width:140},{id:"startDate",label:"Start Date"},{id:"endDate",label:"End Date"},{id:"",width:88}];function Ne({financialYears:t}){const a=de({defaultOrderBy:"orderNumber"}),n=j(),o=j(),l=j(),[s,d]=p.useState(t),i=G({name:""}),u=$(i.state.startDate,i.state.endDate);p.useEffect(()=>{d(t)},[t]);const m=He({inputData:s,comparator:ce(a.order,a.orderBy),filters:i.state}),h=me(m,a.page,a.rowsPerPage),C=!!i.state.name||i.state.status!=="all"||!!i.state.startDate&&!!i.state.endDate,D=!m.length&&C||!m.length,c=p.useCallback(r=>{_(r)},[h.length,a,s]),[q,N]=p.useState(),H=p.useCallback(r=>{N(r),o.onToggle()},[h.length,a,s]),F=X(),{mutate:_}=T({mutationFn:r=>y.delete(f.financial.delete+r),onSuccess:async r=>{const P=s.filter(K=>K.id!==r);S.success("Delete success!"),d(P),a.onUpdatePageDeleteRow(h.length),l.onFalse()},onSettled:async()=>{await F.invalidateQueries({queryKey:["financial-year"]}),l.onFalse()},onError:()=>{}}),{mutate:M}=T({mutationFn:r=>y.post(f.financial.create,r),onSuccess:async()=>{S.success("New Financial Year Has Been Created!")},onSettled:async()=>{await F.invalidateQueries({queryKey:["financial-year"]}),n.onFalse()},onError:r=>{console.log(r)}}),{mutate:Q}=T({mutationFn:({id:r,payload:P})=>y.patch(f.financial.edit+r,P),onSuccess:async()=>{S.success("Financial Year Has Been Modified!")},onSettled:async()=>{await F.invalidateQueries({queryKey:["financial-year"]}),o.onFalse()},onError:r=>{console.log(r)}});return e.jsxs(Z,{children:[e.jsxs(Y,{spacing:3,children:[e.jsx(le,{links:[{name:"Dashboard",href:I.dashboard.root},{name:"Tools",href:I.dashboard.tools.root},{name:"Financial Year"}],sx:{mb:{xs:3,md:5}},action:e.jsx(A,{permission:v.ADD_FINANCIAL_YEAR,children:e.jsx(R,{onClick:()=>n.onToggle(),variant:"contained",startIcon:e.jsx(b,{icon:"mingcute:add-line"}),children:"Add Financial Year"})})}),e.jsx(A,{permission:v.FINANCIAL_LIST,children:e.jsxs(ee,{children:[e.jsx(Le,{filters:i,onResetPage:a.onResetPage,dateError:u}),e.jsxs(te,{sx:{position:"relative"},children:[e.jsx(pe,{dense:a.dense,numSelected:a.selected.length,rowCount:m.length}),e.jsx(ae,{sx:{minHeight:444},children:e.jsxs(je,{size:a.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(ye,{order:a.order,orderBy:a.orderBy,headLabel:qe,rowCount:m.length}),e.jsxs(fe,{children:[m.slice(a.page*a.rowsPerPage,a.page*a.rowsPerPage+a.rowsPerPage).map(r=>e.jsx(Ye,{row:r,selected:a.selected.includes(r.id),onEditRow:()=>H(r),onDeleteRow:()=>c(r.id)},r.id)),e.jsx(ue,{height:a.dense?56:76,emptyRows:he(a.page,a.rowsPerPage,m.length)}),e.jsx(xe,{notFound:D})]})]})})]}),e.jsx(be,{page:a.page,dense:a.dense,count:m.length,rowsPerPage:a.rowsPerPage,onPageChange:a.onChangePage,onChangeDense:a.onChangeDense,onRowsPerPageChange:a.onChangeRowsPerPage})]})})]}),e.jsx(L,{open:n.value,onClose:n.onFalse,handler:M}),e.jsx(ke,{financial:q,open:o.value,onClose:o.onFalse,handler:Q})]})}function He({inputData:t,comparator:a,filters:n}){const{name:o}=n,l=t.map((s,d)=>[s,d]);return l.sort((s,d)=>{const i=a(s[0],d[0]);return i!==0?i:s[1]-d[1]}),t=l.map(s=>s[0]),o&&(t=t.filter(s=>s.year.toLowerCase().indexOf(o.toLowerCase())!==-1)),t}const _e={title:`Tools | Dashboard - ${oe.site.name}`};function Kt(){const t=ne({queryKey:["financial-year"],queryFn:async()=>{const{data:a}=await y.get(f.financial.list);return a}});return t.isPending||t.isLoading?e.jsx(se,{}):t.isError?e.jsx(ie,{route:I.dashboard.tools.root}):e.jsxs(e.Fragment,{children:[e.jsx(re,{children:e.jsxs("title",{children:[" ",_e.title]})}),e.jsx(Ne,{financialYears:t.data})]})}export{Kt as default};

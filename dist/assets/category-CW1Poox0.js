import{Y as A,br as B,a3 as Z,j as e,S as L,A as X,C as G,B as _,$ as K,I as C,dc as ee,a6 as te,e4 as T,a7 as H,e as W,r as x,dq as D,dn as E,a5 as Q,a0 as se,T as ae,df as oe,e3 as re,dp as ne,W as ie,p as I,dQ as le,cW as O,cZ as ce,bq as de,de as me,ed as pe,dr as $,dU as ge,H as ue}from"./index-BqQARj70.js";import{u as he,E as xe}from"./error-block-Cvsq6LVS.js";import{u as V}from"./useMutation-D9b-SBJX.js";import{C as be}from"./custom-breadcrumbs-ryDpeVg5.js";import{P as S}from"./permission-access-controller-Q9flSCkz.js";import{g as fe,r as je,e as Ce}from"./utils-MBUcMVfY.js";import{u as ye}from"./use-table-CIIi1yXP.js";import{T as we}from"./table-no-data-LwGQxgtX.js";import{T as Pe}from"./table-empty-rows-BLwUQgoE.js";import{T as Te,a as De,b as Ee,c as Se}from"./table-head-custom-BsfRnN01.js";import{T as ve}from"./table-selected-action-U-C6vBuE.js";import{T as Fe}from"./table-pagination-custom-B8jkTEOc.js";import{C as Re}from"./confirm-dialog-D-kAfeIE.js";import{T as P}from"./TableCell-BYUYO2qG.js";import{z as q,u as Ae,t as Ie,a as Ve,F as Y}from"./form-provider-ccfU2XUN.js";import{b as Le}from"./upload-avatar-rmFzksOv.js";import"./image-D-bc4Fg4.js";import"./editor-QJd8noTi.js";import{a as Be,b as ke,D as He}from"./DialogContent-Bu9AzrBB.js";import{D as Oe}from"./DialogTitle-rK5KahkH.js";import{L as $e}from"./LoadingButton-F-RhBSUA.js";import{T as qe}from"./TextField-Ddc-2_B3.js";import{I as Ge}from"./InputAdornment-BfS4czl_.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-BECezeOK.js";import"./Checkbox-Bhx6CUcB.js";import"./TablePagination-Dx3_2Y4O.js";import"./KeyboardArrowRight-CBFHahxG.js";import"./LastPage-B8ZhtlKX.js";import"./Select-BcNE4CY6.js";import"./Menu-CyG4g8V9.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-ByUog9Qa.js";import"./FormControlLabel-DYa7_yhu.js";import"./FormHelperText-D7zaUcMu.js";import"./Rating-CRHSMtZR.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-CY1kJa8b.js";import"./FormControl-C8LIfacH.js";import"./FormLabel-Dza6C49E.js";import"./RadioGroup-ChlGooHA.js";import"./FormGroup-CXDpwB7j.js";import"./utils-BkGDLkaZ.js";import"./index-ALNGUIW9.js";import"./countries-DSLisFCy.js";import"./Autocomplete-mVzVA2ZY.js";import"./Chip-DPBTbqGw.js";import"./country-select-BdT_Z9O2.js";import"./InputLabel-Cypnw6Fi.js";import"./DatePicker-Ce3HVs4j.js";import"./ListItem-D-3kOQEW.js";import"./MobileDateTimePicker-huLGYsGv.js";import"./Tabs-CmqXMWlF.js";import"./format-number-BvEweN_e.js";import"./index-3on3wy4W.js";import"./CircularProgress-CnEecEq8.js";const We=({row:t,index:d,selected:n,onDeleteRow:i,onEditRow:r,onViewRow:m})=>{const g=A(),{t:l}=B("products"),s=Z(),o=e.jsxs(Te,{hover:!0,selected:n,children:[e.jsx(P,{children:d||(t==null?void 0:t.id)}),e.jsx(P,{children:e.jsxs(L,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(X,{alt:t==null?void 0:t.name,src:G.site.serverFileHost+((t==null?void 0:t.image)||G.site.defaultImgPlaceHolder)}),e.jsx(_,{component:"span",children:t==null?void 0:t.name})]})}),e.jsx(P,{children:t.description}),e.jsx(P,{children:t.products.length}),e.jsx(P,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(K,{color:s.open?"inherit":"default",onClick:s.onOpen,children:e.jsx(C,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[o,e.jsx(ee,{open:s.open,anchorEl:s.anchorEl,onClose:s.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(te,{children:[e.jsx(S,{permission:T.VIEW_CATEGORY,children:e.jsxs(H,{onClick:()=>{m(),s.onClose()},children:[e.jsx(C,{icon:"solar:eye-bold"}),l("categoryView.table.tableActions.view")]})}),e.jsx(S,{permission:T.EDIT_CATEGORY,children:e.jsxs(H,{onClick:()=>{r(t.id),s.onClose()},children:[e.jsx(C,{icon:"solar:pen-bold"}),l("categoryView.table.tableActions.edit")]})}),e.jsx(S,{permission:T.DELETE_CATEGORY,children:e.jsxs(H,{onClick:()=>{g.onTrue(),s.onClose()},sx:{color:"error.main"},children:[e.jsx(C,{icon:"solar:trash-bin-trash-bold"}),l("categoryView.table.tableActions.delete")]})})]})}),e.jsx(Re,{open:g.value,onClose:g.onFalse,title:l("categoryView.messages.dialogDelete.title"),content:l("categoryView.messages.dialogDelete.text"),action:e.jsx(W,{variant:"contained",color:"error",onClick:i,children:l("categoryView.table.tableActions.delete")})})]})},Me=q.object({name:q.string().min(1,{message:"Name is required!"}),description:q.string()}),U=({productCategory:t,open:d,onClose:n,handler:i})=>{const{t:r}=B("products"),m={name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||"",image:t==null?void 0:t.image},g=x.useRef(t),[l,s]=x.useState(),o=x.useCallback(h=>{const c=h[0];s(()=>c)},[]),b=()=>{s(null)},p={headers:{"content-type":"multipart/form-data"}},{mutate:v}=V({mutationFn:h=>D.post(E.files.upload,h,p),onSuccess:async({data:h})=>{const{name:c}=h;if(c){const{current:f}=g;f.image=c,t?await i({id:t.id,payload:f}):await i(f)}return h},onSettled:async()=>{s(null),g.current={}},onError:h=>{console.log(h)}});x.useEffect(()=>{t&&R(m)},[t]);const[u,y]=x.useState(""),F=Ae({resolver:Ie(Me),defaultValues:m}),{reset:R,handleSubmit:w,formState:{isSubmitting:M}}=F,k=w(async h=>{try{const c={...h};if(l){g.current={...c};const f=new FormData;f.append("file",l),f.append("category","Category"),await v(f)}else t?await i({id:t.id,payload:c}):await i(c);R()}catch(c){console.log(c),y(c instanceof Error?c.message:c)}});return e.jsxs(Be,{fullWidth:!0,open:d,onClose:n,children:[e.jsx(Oe,{children:r(t?"categoryCreateEditDialog.editTitle":"categoryCreateEditDialog.createTitle")}),e.jsx(Q,{}),!!u&&e.jsx(se,{severity:"error",sx:{mb:3},children:u}),e.jsxs(Ve,{methods:F,onSubmit:k,children:[e.jsxs(ke,{children:[e.jsxs(L,{spacing:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(1, 1fr)",lg:"repeat(1, 1fr)"},children:[e.jsx(Y.Text,{fullWidth:!0,label:r("categoryCreateEditDialog.nameLabel"),name:"name",sx:{mt:2}}),e.jsx(Y.Text,{label:r("categoryCreateEditDialog.descriptionLabel"),name:"description",multiline:!0,rows:3,inputProps:{maxLength:250},sx:{mt:2}})]}),e.jsxs(L,{spacing:1.5,sx:{mt:2},children:[e.jsx(ae,{variant:"subtitle2",children:r("categoryCreateEditDialog.attachmentsLabel")}),e.jsx(Le,{value:l,onDrop:o,onDelete:b})]})]}),e.jsx(Q,{sx:{pt:1,mt:1}}),e.jsxs(He,{children:[e.jsx($e,{type:"submit",variant:"contained",children:r(t?"categoryCreateEditDialog.saveChanges":"categoryCreateEditDialog.save")}),e.jsx(W,{color:"inherit",variant:"outlined",onClick:n,children:r("categoryCreateEditDialog.cancel")})]})]})]})},Ne=({category:t,open:d,onClose:n,handler:i})=>e.jsx(U,{productCategory:t,open:d,onClose:n,handler:i});function Qe({filters:t,onResetPage:d,options:n}){const{t:i}=B("products"),r=x.useCallback(m=>{d(),t.setState({name:m.target.value})},[t,d]);return e.jsx(L,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(qe,{sx:{width:420},value:t.state.name,onChange:r,placeholder:i("categoryView.table.tableToolbar.searchPlaceholder"),InputProps:{startAdornment:e.jsx(Ge,{position:"start",children:e.jsx(C,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}const Ye=({categories:t})=>{const d=A(),{t:n}=B("products"),i=A(),r=A(),[m,g]=x.useState(),l=[{id:"id",label:`${n("categoryView.table.tableHeader.no")}`,width:80},{id:"name",label:`${n("categoryView.table.tableHeader.name")}`,width:300},{id:"desc",label:`${n("categoryView.table.tableHeader.description")}`},{id:"status",label:`${n("categoryView.table.tableHeader.productCount")}`,width:200},{id:"",width:88}],s=ye({defaultOrderBy:"planId"}),[o,b]=x.useState(t),p=oe({name:"",status:"all",startDate:null,endDate:null});x.useEffect(()=>{b(t)},[t]);const v=re(p.state.startDate,p.state.endDate),u=_e({inputData:o,comparator:fe(s.order,s.orderBy),filters:p.state,dateError:v}),y=je(u,s.page,s.rowsPerPage),F=!!p.state.name||p.state.status!=="all"||!!p.state.startDate&&!!p.state.endDate,R=!u.length&&F||!u.length,w=ne(),{mutate:M}=V({mutationFn:a=>D.delete(E.productCategories.delete+a),onSuccess:async a=>{const j=o.filter(J=>J.id!==a);$.success("Delete success!"),b(j),s.onUpdatePageDeleteRow(y.length),await w.invalidateQueries({queryKey:["product-categories"]})},onError:a=>{console.log(a)}}),k=x.useCallback(a=>{M(a)},[y.length,s,o]),h=x.useCallback(a=>{g(a),r.onToggle()},[y.length,s,o]),{mutate:c}=V({mutationFn:a=>D.post(E.productCategories.create,a),onSuccess:async()=>{$.success("New Category Has Been Created!"),await w.invalidateQueries({queryKey:["product-categories"]})},onSettled:async()=>{i.onFalse()},onError:a=>{console.log(a)}}),{mutate:f}=V({mutationFn:({id:a,payload:j})=>D.patch(E.productCategories.edit+a,j),onSuccess:async()=>{$.success("Category Has Been Modified!"),await w.invalidateQueries({queryKey:["product-categories"]})},onSettled:async()=>{r.onFalse()},onError:a=>{console.log(a)}}),N=ie(),z=x.useCallback(a=>{N.push(I.dashboard.product.categoryDetails(a))},[N]);return e.jsxs(e.Fragment,{children:[e.jsx(le,{maxWidth:"xl",children:e.jsxs(O,{container:!0,spacing:3,children:[e.jsx(O,{xs:12,md:12,children:e.jsx(be,{links:[{name:`${n("categoryView.breadCrumbsPageRootTitle")}`,href:I.dashboard.root},{name:`${n("categoryView.breadCrumbsParentPageTitle")}`,href:I.dashboard.product.root},{name:`${n("categoryView.breadCrumbsPageTitle")}`}],action:e.jsx(S,{permission:T.ADD_CATEGORY,children:e.jsx(W,{onClick:()=>i.onToggle(),variant:"contained",startIcon:e.jsx(C,{icon:"mingcute:add-line"}),children:n("categoryView.addNewCategory")})})})}),e.jsx(O,{xs:12,md:12,children:e.jsx(S,{permission:T.CATEGORY_LIST,children:e.jsxs(ce,{children:[e.jsx(Qe,{filters:p,onResetPage:s.onResetPage,dateError:v}),e.jsxs(_,{sx:{position:"relative"},children:[e.jsx(ve,{dense:s.dense,numSelected:s.selected.length,rowCount:u.length,onSelectAllRows:a=>s.onSelectAllRows(a,u.map(j=>j.id)),action:e.jsx(de,{title:"Delete",children:e.jsx(K,{color:"primary",onClick:d.onTrue,children:e.jsx(C,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(me,{sx:{minHeight:444},children:e.jsxs(De,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Ee,{order:s.order,orderBy:s.orderBy,headLabel:l,rowCount:u.length,numSelected:s.selected.length,onSort:s.onSort}),e.jsxs(Se,{children:[u.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map((a,j)=>e.jsx(We,{row:a,index:s.page*s.rowsPerPage+j+1,selected:s.selected.includes(a.id),onEditRow:()=>h(a),onViewRow:()=>z(a.id),onDeleteRow:()=>k(a.id)},a.id)),e.jsx(Pe,{height:s.dense?56:76,emptyRows:Ce(s.page,s.rowsPerPage,u.length)}),e.jsx(we,{notFound:R})]})]})})]}),e.jsx(Fe,{page:s.page,dense:s.dense,count:u.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})})]})}),e.jsx(U,{handler:c,open:i.value,onClose:i.onFalse}),e.jsx(Ne,{handler:f,open:r.value,onClose:r.onFalse,category:m})]})};function _e({inputData:t,comparator:d,filters:n,dateError:i}){const{status:r,name:m,startDate:g,endDate:l}=n,s=t.map((o,b)=>[o,b]);return s.sort((o,b)=>{const p=d(o[0],b[0]);return p!==0?p:o[1]-b[1]}),t=s.map(o=>o[0]),m&&(t=t.filter(o=>o.id.toString().toLowerCase().indexOf(m.toLowerCase())!==-1||o.name.toLowerCase().indexOf(m.toLowerCase())!==-1||o.description.toLowerCase().indexOf(m.toLowerCase())!==-1)),r!=="all"&&(t=t.filter(o=>o.status===r)),i||g&&l&&(t=t.filter(o=>pe(o.createdAt,g,l))),t}const Ke={title:`Product Addons | Dashboard - ${G.site.name}`};function es(){const t=he({queryKey:["product-categories"],queryFn:async()=>{const{data:d}=await D.get(E.productCategories.list);return d}});return t.isPending||t.isLoading?e.jsx(ge,{}):t.isError?e.jsx(xe,{route:I.dashboard.product.root}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{children:e.jsxs("title",{children:[" ",Ke.title]})}),e.jsx(Ye,{categories:t.data})]})}export{es as default};

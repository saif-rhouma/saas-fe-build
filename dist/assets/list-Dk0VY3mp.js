import{i as le,aN as Ie,j as e,L as Le,S as g,A as xe,I as y,B as d,aR as ue,d0 as ce,aJ as Ee,c7 as H,C as he,e8 as ie,d7 as de,ef as w,l as A,cQ as Be,bP as Fe,db as $e,aP as qe,e4 as V,aQ as v,e as J,r as h,de as me,e3 as pe,ed as je,eb as Me,dn as ge,dp as E,dm as B,dq as ye,g as fe,p as L,ea as He,am as _,cY as be,v as te,dU as Ce,ec as Ve,dP as Ne,b as Qe,dQ as Ke,cV as R,R as We,dT as G,dd as ze,H as _e}from"./index-CC8ZOXtA.js";import{u as Y,E as Pe}from"./error-block-ClcTD9po.js";import{u as we}from"./useMutation-DdAIUrKi.js";import{C as Ge}from"./custom-breadcrumbs-Bl5OnNTu.js";import{P as N}from"./permission-access-controller-CWt3Qm2o.js";import{g as ve,r as Te,e as Ue}from"./utils-MBUcMVfY.js";import{u as Se}from"./use-table-BFN1iUju.js";import{T as Je}from"./table-no-data-Cj9_XApF.js";import{T as Ye}from"./table-empty-rows-C8apdTaI.js";import{T as oe,a as De,b as Re,c as Ae}from"./table-head-custom-DVdNqcUm.js";import{T as Xe}from"./table-selected-action-B1Y2vnXu.js";import{T as ke}from"./table-pagination-custom-BLNPouAz.js";import{A as U}from"./app-widget-summary-CC1tV4e_.js";import{b as F}from"./format-number-pdBITjLa.js";import{C as Ze}from"./confirm-dialog-MYD50ozi.js";import{T as P}from"./TableCell-Lyd9zWIr.js";import{A as et}from"./AvatarGroup-D5MeQNj0.js";import{u as tt}from"./use-tabs-CGkZ84Is.js";import{S as Oe}from"./Select-aQYZH3TH.js";import{P as st,O as at}from"./order-status-dialog-CydM4mpC.js";import{Q as nt}from"./quotation-product-table-xyecvmY5.js";import{T as rt,a as lt}from"./Tabs-D2MBqKqb.js";import{C as it}from"./CardHeader-D47k68P3.js";import{C as ot}from"./CircularProgress-DBXL2oaw.js";import{T as ct}from"./TextField-C3GBty_k.js";import{I as dt}from"./InputAdornment-CZqtpVU7.js";import{F as xt,a as se,c as ae}from"./filters-result-B96qldBN.js";import{C as ne}from"./Chip-Bqn7aPqU.js";import"./index-D4yFGiDZ.js";import"./incrementer-button-C2nyBf6u.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-CE7ZD1Zt.js";import"./Checkbox-Dv9DB-8I.js";import"./TablePagination-ByyUZnM0.js";import"./KeyboardArrowRight-C_h4tT89.js";import"./LastPage-KfqZ9eBe.js";import"./InputBase-Lx9oX8L4.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-DSmn4eUx.js";import"./use-chart-Cf9G45Kr.js";import"./chart-legends-BNfxg7FD.js";import"./index-B2RZm-di.js";import"./DialogContent-CB7Unwzu.js";import"./DialogTitle-CUFjdCkA.js";import"./Menu-eKJMgiWE.js";import"./form-provider-DAJmH35K.js";import"./FormHelperText-Bsh-3BCg.js";import"./Rating-CFU91EQa.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-CaGL4rG0.js";import"./index-l4VxMZSv.js";import"./Slider-Loskhemd.js";import"./FormControl-CAeI9VZ6.js";import"./FormLabel-Co2KdlDF.js";import"./RadioGroup-Dewy7eJk.js";import"./FormGroup-BEHuPMNZ.js";import"./utils-Be64QJhR.js";import"./countries-DSLisFCy.js";import"./Autocomplete-UYjoJm2K.js";import"./country-select-BHdsHhaW.js";import"./InputLabel-C4WXc4Lp.js";import"./upload-avatar-DBJlPSVT.js";import"./image-BlOEV0mO.js";import"./DatePicker-DL9s210N.js";import"./ListItem-DjRfQpUp.js";import"./MobileDateTimePicker-UNDcqYl2.js";import"./upload-box-ad-SVVPU0VR.js";import"./schema-helper-BulHfCPD.js";import"./LoadingButton-DsnjjvCJ.js";function ut({row:s,index:n,selected:l,onViewRow:j,onDeleteRow:t,onClickRow:u,isFullDisplay:o}){var T,S,k;const p=le(),m=le(),r=Ie(),i=e.jsxs(oe,{hover:!0,selected:l,children:[e.jsx(P,{onClick:u,children:e.jsx(Le,{color:"inherit",onClick:j,underline:"always",sx:{cursor:"pointer"},children:(s==null?void 0:s.ref)||n||(s==null?void 0:s.id)})}),e.jsx(P,{onClick:u,children:e.jsxs(g,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(xe,{sx:{bgcolor:"#00AB55"},alt:s.name,src:s.customer.avatar,children:e.jsx(y,{color:"white",icon:"fluent:person-20-filled",width:24})}),e.jsxs(g,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsx(d,{component:"span",sx:{textTransform:"capitalize"},children:s.customer.name}),e.jsx(d,{component:"span",sx:{color:"text.disabled"},children:s.customer.email})]})]})}),!o&&e.jsx(P,{onClick:u,children:e.jsx(ue,{primary:ce(s.orderDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(P,{align:"center",onClick:u,children:e.jsx(et,{sx:{[`& .${Ee.avatar}`]:{width:24,height:24}},children:(T=s==null?void 0:s.productToOrder)==null?void 0:T.map(c=>{var C,b,O,D;return e.jsx(H,{title:`${(C=c==null?void 0:c.product)==null?void 0:C.name} | Quantity : ${c.quantity}`,children:e.jsx(xe,{alt:(b=c==null?void 0:c.product)==null?void 0:b.name,src:`${he.site.serverFileHost}${(O=c==null?void 0:c.product)==null?void 0:O.image}`},c==null?void 0:c.id)},(D=c==null?void 0:c.product)==null?void 0:D.id)})})}),e.jsx(P,{onClick:u,children:F(ie(s.totalOrderAmount-s.totalOrderAmount*(s.discount/100),s.snapshotTaxPercentage))||"-"}),!o&&e.jsxs(P,{onClick:u,children:[(S=s.createdBy)==null?void 0:S.firstName," ",(k=s.createdBy)==null?void 0:k.lastName]}),!o&&e.jsx(P,{onClick:u,children:e.jsx(de,{variant:"soft",color:s.status===w.Ready&&"info"||s.status===w.InProcess&&"warning"||s.status===w.Delivered&&"success"||s.status===w.Canceled&&"error"||"default",children:s.status})}),!o&&e.jsxs(P,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(A,{color:m.value?"inherit":"default",onClick:m.onToggle,sx:{...m.value&&{bgcolor:"action.hover"}},children:e.jsx(y,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(A,{color:r.open?"inherit":"default",onClick:r.onOpen,children:e.jsx(y,{icon:"eva:more-vertical-fill"})})]})]}),f=e.jsx(oe,{children:e.jsx(P,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(Be,{in:m.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(Fe,{sx:{m:1.5},children:s.productToOrder.map(c=>e.jsxs(g,{direction:"row",alignItems:"center",sx:{p:C=>C.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:C=>`solid 2px ${C.vars.palette.background.neutral}`}},children:[e.jsx(ue,{primary:c.product.name,secondary:c.sku,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs("div",{children:[c.quantity," "]}),e.jsx(d,{sx:{width:110,textAlign:"right"},children:F(c.snapshotProductPrice)})]},c.id))})})})});return e.jsxs(e.Fragment,{children:[i,f,e.jsx($e,{open:r.open,anchorEl:r.anchorEl,onClose:r.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(qe,{children:[e.jsx(N,{permission:V.VIEW_ORDER,children:e.jsxs(v,{onClick:()=>{j(),r.onClose()},children:[e.jsx(y,{icon:"solar:eye-bold"}),"View"]})}),s.status!==w.Canceled&&e.jsx(N,{permission:V.DELETE_ORDER,children:e.jsxs(v,{onClick:()=>{p.onTrue(),r.onClose()},sx:{color:"warning.main"},children:[e.jsx(y,{icon:"solar:trash-bin-trash-bold"}),"Cancel"]})})]})}),e.jsx(Ze,{open:p.value,onClose:p.onFalse,title:"Cancel Order",content:"Are you sure want to cancel this order?",action:e.jsx(J,{variant:"contained",color:"warning",onClick:()=>{t(),p.onFalse()},children:"Confirm Canceling"})})]})}const ht=[{id:"orderNumber",label:"#",width:40,align:"center"},{id:"date",label:"Date"},{id:"status",label:"Payment Type",width:200,align:"center"},{id:"totalAmount",label:"	Paid Amount",width:200,align:"center"}],mt=({payments:s})=>{const n=Se({defaultOrderBy:"orderId",defaultRowsPerPage:5}),[l,j]=h.useState(s),t=me({name:"",status:"all",startDate:null,endDate:null});h.useEffect(()=>{j(s)},[s]);const u=pe(t.state.startDate,t.state.endDate),o=pt({inputData:l,comparator:ve(n.order,n.orderBy),filters:t.state,dateError:u});Te(o,n.page,n.rowsPerPage),t.state.name||t.state.status!=="all"||t.state.startDate&&t.state.endDate;const[p,m]=h.useState("all");h.useCallback(i=>{n.onResetPage(),t.setState({name:i.target.value})},[t,n]);const r=h.useCallback(i=>{n.onResetPage(),t.setState({status:i.target.value}),m(i.target.value)},[t,n]);return e.jsxs(d,{display:"flex",flexDirection:"column",alignItems:"center",sx:{borderRadius:1,height:1,width:1,overflow:"hidden",border:i=>`solid 1px ${i.vars.palette.divider}`},children:[e.jsx(g,{spacing:2,justifyContent:{xs:"flex-end"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:1,width:1},children:e.jsxs(Oe,{size:"small",sx:{width:200,textTransform:"capitalize"},value:p,onChange:r,children:[e.jsx(v,{value:"all",children:"All Payments"}),e.jsx(v,{value:"Cash",children:"Cash"}),e.jsx(v,{value:"Card",children:"Card"}),e.jsx(v,{value:"Transfer",children:"Transfer"})]})}),e.jsx(d,{sx:{flex:1,width:1},children:e.jsxs(De,{size:"small",children:[e.jsx(Re,{headLabel:ht}),e.jsx(Ae,{children:o.slice(n.page*n.rowsPerPage,n.page*n.rowsPerPage+n.rowsPerPage).map((i,f)=>e.jsxs(oe,{children:[e.jsxs(P,{align:"center",children:[" ",f+1||i.id," "]}),e.jsx(P,{children:ce(i.paymentDate)}),e.jsx(P,{align:"center",children:e.jsx(de,{variant:"soft",color:i.paymentType==="Cash"&&"info"||i.paymentType==="Card"&&"success"||i.paymentType==="Transfer"&&"default"||"default",children:i.paymentType})}),e.jsx(P,{align:"center",children:F(i==null?void 0:i.amount)})]},`${i.id}`))})]})}),e.jsx(ke,{sx:{width:1},page:n.page,dense:!0,count:o.length,rowsPerPage:n.rowsPerPage,onPageChange:n.onChangePage,onRowsPerPageChange:n.onChangeRowsPerPage})]})};function pt({inputData:s,comparator:n,filters:l,dateError:j}){const{status:t,name:u,startDate:o,endDate:p}=l,m=s.map((r,i)=>[r,i]);return m.sort((r,i)=>{const f=n(r[0],i[0]);return f!==0?f:r[1]-i[1]}),s=m.map(r=>r[0]),t!=="all"&&(s=s.filter(r=>r.paymentType===t)),j||o&&p&&(s=s.filter(r=>je(r.createdAt,o,p))),s}const re=[{value:"details",icon:e.jsx(y,{icon:"solar:eye-bold",width:24}),label:"Details"},{value:"payments",icon:e.jsx(y,{icon:"solar:case-minimalistic-bold",width:24}),label:"Payments"}],jt=({selectedOrder:s,handleResize:n,handleClose:l,onViewOrder:j})=>{var q,K,W,z,a,I;const[t,u]=h.useState(s),o=tt("details"),[p,m]=h.useState(re),r=Me();h.useEffect(()=>{s.id!==t.id&&u(s)},[t.id,s]),h.useEffect(()=>{const x=(s==null?void 0:s.status)!==w.Draft&&(s==null?void 0:s.status)!==w.Canceled?re:re.filter(ee=>!["payments"].includes(ee.value));m(x)},[s]);const i=le(),f=ge(),{mutate:T}=we({mutationFn:x=>E.post(B.payments.create,x),onSuccess:async x=>{ye.success("New Payment Has Been Created!"),i.onFalse()},onSettled:async()=>{await f.invalidateQueries({queryKey:["payments"]}),await f.invalidateQueries({queryKey:["order",t.id]})},onError:x=>{console.log(x)}}),S=fe(),k=h.useCallback(x=>{S.replace(L.dashboard.quotation.details(x))},[S]),[c,C]=h.useState(!1),b=()=>{C(!0)},{isLoading:O}=Y({queryKey:["download-order",t.id],queryFn:async()=>{const x=await E.get(B.order.downloadPdf+t.id,{responseType:"blob"}),ee=window.URL.createObjectURL(new Blob([x.data])),M=document.createElement("a");return M.href=ee,M.setAttribute("download",`Order-${t.ref}.pdf`),document.body.appendChild(M),M.click(),document.body.removeChild(M),C(!1),x.data},enabled:c,onSuccess:()=>{C(!1)},onError:x=>{console.error("Download failed:",x)}}),D=e.jsx(H,{title:"Download Pdf",children:e.jsx(A,{onClick:b,children:O?e.jsx(ot,{size:24,color:"inherit"}):e.jsx(y,{icon:"eva:cloud-download-fill",color:"error.main"})})}),X=e.jsxs(g,{alignItems:"flex-end",sx:{p:1,textAlign:"right",typography:"body2"},children:[e.jsxs(g,{direction:"row",children:[e.jsx(d,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(d,{sx:{width:160,typography:"subtitle2"},children:F(t==null?void 0:t.totalOrderAmount)||"-"})]}),e.jsxs(g,{direction:"row",children:[e.jsx(d,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(d,{sx:{width:160,...(t==null?void 0:t.discount)&&{color:"error.main"}},children:t!=null&&t.discount?`- ${t==null?void 0:t.discount}%`:"-"})]}),e.jsxs(g,{direction:"row",children:[e.jsxs(d,{sx:{color:"text.secondary"},children:["Tax (",(t==null?void 0:t.snapshotTaxPercentage)||"0","%)"]}),e.jsx(d,{sx:{width:160},children:t!=null&&t.snapshotTaxPercentage?F(He((t==null?void 0:t.totalOrderAmount)-(t==null?void 0:t.totalOrderAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage)):"-"})]}),e.jsxs(g,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:"Total"}),e.jsx(d,{sx:{width:160},children:F(ie((t==null?void 0:t.totalOrderAmount)-(t==null?void 0:t.totalOrderAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage))||"-"})]})]}),$=e.jsxs(g,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsxs(d,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",m:1},children:[e.jsxs(d,{flexDirection:"column",sx:{display:"flex"},children:[e.jsxs(d,{sx:{color:"text.secondary"},children:["Order Ref: #",t==null?void 0:t.ref]}),e.jsxs(d,{sx:{color:"text.secondary"},children:["Order Date: ",ce(t==null?void 0:t.orderDate)]})]}),e.jsx(d,{sx:{mr:2},children:e.jsxs(d,{sx:{color:"text.secondary"},children:["Status:"," ",e.jsx(de,{variant:"soft",color:(t==null?void 0:t.status)===w.Ready&&"info"||(t==null?void 0:t.status)===w.InProcess&&"warning"||(t==null?void 0:t.status)===w.Delivered&&"success"||(t==null?void 0:t.status)===w.Canceled&&"error"||"default",children:t==null?void 0:t.status})]})}),((q=t==null?void 0:t.order)==null?void 0:q.id)&&e.jsx(d,{sx:{color:"text.secondary"},className:"print-hide",children:e.jsxs(J,{variant:"contained",size:"small",startIcon:e.jsx(y,{icon:"heroicons-outline:external-link"}),onClick:()=>{t==null||t.quotation},children:["Related to Quotation: #",(K=t==null?void 0:t.quotation)==null?void 0:K.ref]})})]}),e.jsxs(d,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsx(nt,{products:t==null?void 0:t.productToOrder,defaultRowsPerPage:t!=null&&t.notes?5:10}),e.jsx(_,{sx:{mt:1}})]}),X,(t==null?void 0:t.notes)&&e.jsxs(d,{children:[e.jsx(_,{}),e.jsx(g,{sx:{typography:"body2"},children:e.jsx(d,{sx:{p:1},children:e.jsxs(g,{sx:{typography:"subtitle2"},children:[e.jsx("div",{children:"Notes:"}),e.jsx(d,{sx:{color:"text.secondary"},children:t==null?void 0:t.notes})]})})})]})]}),Q=Y({queryKey:["order",t.id],queryFn:async()=>{const{data:x}=await E.get(B.order.details+t.id);return u(x),x}}),Z=x=>x.isPending||x.isLoading?e.jsx(Ce,{}):x.isError?e.jsx(Pe,{}):e.jsxs(g,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[(t==null?void 0:t.status)!==w.Draft&&(t==null?void 0:t.status)!==w.Canceled&&Math.round(ie(t.totalOrderAmount-t.totalOrderAmount*(t.discount/100),t==null?void 0:t.snapshotTaxPercentage)-t.orderPaymentAmount)>0&&e.jsxs(e.Fragment,{children:[e.jsx(d,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(d,{children:e.jsx(N,{permission:V.ADD_PAYMENT,children:e.jsx(J,{onClick:()=>i.onToggle(),variant:"contained",startIcon:e.jsx(y,{icon:"mingcute:add-line"}),children:"New Payment"})})})}),e.jsx(_,{})]}),e.jsx(d,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(mt,{payments:Q.data.payments})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(be,{sx:{height:1,display:"flex",flexDirection:"column",width:1,transition:"all 2s ease-in-out"},children:[e.jsxs(rt,{className:"print-hide ",value:o.value,onChange:o.onChange,sx:{px:3,boxShadow:x=>`inset 0 -2px 0 0 ${te(x.vars.palette.grey["500Channel"],.08)}`},children:[p.map(x=>e.jsx(lt,{icon:x.icon,value:x.value,label:x.label},x.value)),e.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${te(r.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(A,{sx:{ml:1},onClick:n,children:e.jsx(y,{icon:"solar:full-screen-bold",width:24})})}),e.jsx(d,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${te(r.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(A,{sx:{ml:1},onClick:l,children:e.jsx(y,{icon:"solar:close-square-outline",width:24})})})]}),e.jsxs(d,{className:"print-top-margin print-padding",sx:{display:"flex",flexDirection:"column",position:"relative",flex:1},children:[e.jsx(it,{sx:{pt:1},title:`Order Reference: ${t==null?void 0:t.ref}`,subheader:`Created By : ${(W=t.createdBy)==null?void 0:W.firstName} ${(z=t.createdBy)==null?void 0:z.lastName}`,action:e.jsx(g,{spacing:3,direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"},sx:{mb:{xs:3,md:5}},children:e.jsxs(g,{direction:"row",spacing:1,alignItems:"center",flexGrow:1,sx:{width:1},children:[e.jsx(H,{title:"View",children:e.jsx(A,{onClick:()=>{j(t.id)},children:e.jsx(y,{icon:"solar:eye-bold",color:"primary.main"})})}),((a=t==null?void 0:t.quotation)==null?void 0:a.id)&&e.jsx(H,{title:`Related to Quotation: #${(I=t==null?void 0:t.quotation)==null?void 0:I.ref}`,children:e.jsx(A,{onClick:()=>{var x;k((x=t==null?void 0:t.quotation)==null?void 0:x.id)},children:e.jsx(y,{icon:"heroicons-outline:external-link"})})}),D,e.jsx(H,{title:"Print",children:e.jsx(st,{order:t})})]})})}),e.jsx(_,{}),o.value==="details"&&$,o.value==="payments"&&Z(Q)]})]}),e.jsx(at,{order:t,open:i.value,onClose:i.onFalse,handler:T})]})};function gt({filters:s,onResetPage:n}){const[l,j]=h.useState("all"),t=h.useCallback(o=>{n(),s.setState({name:o.target.value})},[s,n]),u=h.useCallback(o=>{n(),s.setState({status:o.target.value}),j(o.target.value)},[s,n]);return e.jsxs(g,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(ct,{sx:{width:420},value:s.state.name,onChange:t,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(dt,{position:"start",children:e.jsx(y,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(Oe,{sx:{width:420,textTransform:"capitalize"},value:l,onChange:u,children:[e.jsx(v,{value:"all",children:"All Orders"}),e.jsx(v,{value:"Draft",children:"Draft"}),e.jsx(v,{value:"Canceled",children:"Canceled"}),e.jsx(v,{value:"InProcess",children:"Processing"}),e.jsx(v,{value:"Ready",children:"Ready To Deliver"}),e.jsx(v,{value:"Delivered",children:"Delivered"})]})]})}function yt({filters:s,totalResults:n,onResetPage:l,sx:j}){const t=h.useCallback(()=>{l(),s.setState({name:""})},[s,l]),u=h.useCallback(()=>{l(),s.setState({status:"all"})},[s,l]),o=h.useCallback(()=>{l(),s.setState({startDate:null,endDate:null})},[s,l]),p=h.useCallback(()=>{l(),s.onResetState()},[s,l]);return e.jsxs(xt,{totalResults:n,onReset:p,sx:j,children:[e.jsx(se,{label:"Status:",isShow:s.state.status!=="all",children:e.jsx(ne,{...ae,label:s.state.status,onDelete:u,sx:{textTransform:"capitalize"}})}),e.jsx(se,{label:"Date:",isShow:!!(s.state.startDate&&s.state.endDate),children:e.jsx(ne,{...ae,label:Ve(s.state.startDate,s.state.endDate),onDelete:o})}),e.jsx(se,{label:"Keyword:",isShow:!!s.state.name,children:e.jsx(ne,{...ae,label:s.state.name,onDelete:t})})]})}function ft({orders:s,analytics:n}){const{t:l}=Ne("orders"),j=[{id:"orderNumber",label:"#",width:88},{id:"name",label:l("listView.table.tableHeader.customer")},{id:"createdAt",label:l("listView.table.tableHeader.date"),width:140},{id:"totalQuantity",label:l("listView.table.tableHeader.items"),width:120,align:"center"},{id:"totalAmount",label:l("listView.table.tableHeader.price"),width:140},{id:"createdBy",label:l("listView.table.tableHeader.createdBy"),width:200},{id:"status",label:l("listView.table.tableHeader.status"),width:110},{id:"",width:88}],t=Se({defaultOrderBy:"orderId",defaultRowsPerPage:5}),u=fe(),[o,p]=h.useState(),[m,r]=h.useState(!1),[i,f]=h.useState(j),T=Qe(),[S,k]=h.useState(()=>s),c=me({name:"",status:"all",startDate:null,endDate:null});h.useEffect(()=>{if(r(!1),k(s),o){const a=s.find(I=>I.id===o.id);p(a)}},[s]),h.useEffect(()=>{const a=o?j.filter(I=>!["createdAt","createdBy","status",""].includes(I.id)):j;f(a)},[o]);const C=pe(c.state.startDate,c.state.endDate),b=bt({inputData:S,comparator:ve(t.order,t.orderBy),filters:c.state,dateError:C}),O=Te(b,t.page,t.rowsPerPage),D=!!c.state.name||c.state.status!=="all"||!!c.state.startDate&&!!c.state.endDate,X=!b.length&&D||!b.length,$=ge(),{mutate:Q}=we({mutationFn:a=>E.delete(B.order.delete+a),onSuccess:async()=>{ye.success("Order Has Been Canceled!")},onSettled:async()=>{await $.invalidateQueries({queryKey:["orders"]}),await $.invalidateQueries({queryKey:["orders-status"]}),await $.invalidateQueries({queryKey:["orders","analytics"]})},onError:()=>{}}),Z=h.useCallback(a=>{Q(a)},[O.length,t,S]),q=h.useCallback(a=>{u.replace(L.dashboard.order.details(a))},[u]),K=()=>{r(!m)},W=()=>{p(null),r(!1)},z=a=>{p(a)};return e.jsx(Ke,{maxWidth:"xl",children:e.jsxs(R,{container:!0,spacing:3,children:[e.jsx(R,{xs:12,md:12,children:e.jsx(Ge,{links:[{name:`${l("listView.breadCrumbsPageRootTitle")}`,href:L.dashboard.root},{name:`${l("listView.breadCrumbsParentPageTitle")}`,href:L.dashboard.order.root},{name:`${l("listView.breadCrumbsPageTitle")}`}],action:e.jsx(N,{permission:V.ADD_ORDER,children:e.jsx(J,{component:We,href:L.dashboard.order.new,variant:"contained",startIcon:e.jsx(y,{icon:"mingcute:add-line"}),children:`${l("listView.addNewOrder")}`})})})}),e.jsxs(N,{permission:V.LIST_ORDER,children:[e.jsx(R,{xs:12,md:3,children:e.jsx(U,{title:`${l("listView.statisticsWidgets.allOrders")}`,total:s.length,chart:{categories:n.data.lastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:n.data.lastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(R,{xs:12,md:3,children:e.jsx(U,{title:`${l("listView.statisticsWidgets.processingOrder")}`,total:n.data.analytics.InProcess,chart:{colors:[T.vars.palette.warning.light],categories:n.data.inProcessLastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:n.data.inProcessLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(R,{xs:12,md:3,children:e.jsx(U,{title:`${l("listView.statisticsWidgets.readyToDeliver")}`,total:n.data.analytics.Ready,chart:{colors:[T.vars.palette.info.main],categories:n.data.readyLastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:n.data.readyLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(R,{xs:12,md:3,children:e.jsx(U,{title:`${l("listView.statisticsWidgets.delivered")}`,total:n.data.analytics.Delivered,chart:{colors:[T.vars.palette.success.main],categories:n.data.deliveredLastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:n.data.deliveredLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),!m&&e.jsx(R,{xs:12,md:o?5:12,children:e.jsxs(be,{children:[e.jsx(gt,{filters:c,onResetPage:t.onResetPage,dateError:C}),D&&e.jsx(yt,{filters:c,totalResults:b.length,onResetPage:t.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(d,{sx:{position:"relative"},children:[e.jsx(Xe,{dense:t.dense,numSelected:t.selected.length,rowCount:b.length}),e.jsx(ze,{sx:{minHeight:444},children:e.jsxs(De,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Re,{order:t.order,orderBy:t.orderBy,headLabel:i,rowCount:b.length}),e.jsxs(Ae,{children:[b.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage).map(a=>e.jsx(ut,{row:a,selected:t.selected.includes(a.id),onSelectRow:()=>t.onSelectRow(a.id),onDeleteRow:()=>Z(a.id),onViewRow:()=>q(a.id),onClickRow:()=>z(a),isFullDisplay:o},a.id)),e.jsx(Ye,{height:t.dense?56:76,emptyRows:Ue(t.page,t.rowsPerPage,b.length)}),e.jsx(Je,{notFound:X})]})]})})]}),e.jsx(ke,{page:t.page,dense:t.dense,count:b.length,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onChangeDense:t.onChangeDense,onRowsPerPageChange:t.onChangeRowsPerPage})]})}),o&&e.jsx(d,{sx:{display:"flex",flex:1,p:1.5,transition:"all 2s ease-in-out"},children:e.jsx(jt,{selectedOrder:o,handleResize:K,handleClose:W,onViewOrder:q})})]})]})})}function bt({inputData:s,comparator:n,filters:l,dateError:j}){const{status:t,name:u,startDate:o,endDate:p}=l,m=s==null?void 0:s.map((r,i)=>[r,i]);return m==null||m.sort((r,i)=>{const f=n(r[0],i[0]);return f!==0?f:r[1]-i[1]}),s=m==null?void 0:m.map(r=>r[0]),u&&(s=s.filter(r=>r.id.toString().toLowerCase().indexOf(u.toLowerCase())!==-1||r.customer.name.toLowerCase().indexOf(u.toLowerCase())!==-1||r.status.toLowerCase().indexOf(u.toLowerCase())!==-1||r.customer.email.toLowerCase().indexOf(u.toLowerCase())!==-1)),t!=="all"&&(s=s.filter(r=>r.status===t)),j||o&&p&&(s=s.filter(r=>je(r.createTime,o,p))),s}const Ct={title:`Order list | Dashboard - ${he.site.name}`};function Hs(){const s=Y({queryKey:["orders"],queryFn:async()=>{const{data:l}=await E.get(B.order.list);return l}}),n=Y({queryKey:["orders","analytics"],queryFn:async()=>{const{data:l}=await E.get(B.order.analytics);return l}});return n.isLoading||s.isLoading?e.jsx(Ce,{}):s.isError||n.isError?e.jsx(Pe,{route:L.dashboard.order.root}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{children:e.jsxs("title",{children:[" ",Ct.title]})}),e.jsx(ft,{orders:s.data,analytics:n})]})}export{Hs as default};

import{W as H,r as t,ab as j,dp as Q,dq as y,dn as I,dr as b,p as w,j as s,cZ as D,S as d,I as G,B as u,C as K,cW as m,e as S}from"./index-3kUlxXkm.js";import{u as q}from"./useMutation-DWyFExRk.js";import{u as L}from"./use-table-9MzCtmNE.js";import{P as J}from"./product-Item-button-aUsvkzkp.js";import{C as Z}from"./component-pagination-custom-DLnjI_Fh.js";import{P as z}from"./plan-product-table-Dh3muF1P.js";import{T as k}from"./TextField-Ff9PgcBD.js";import{I as U}from"./InputAdornment-Ug97Thua.js";import{D as V}from"./DatePicker-vbOob6Xb.js";function ie({products:l,plan:n}){const r=L({defaultRowsPerPage:6}),h=H(),[F,x]=t.useState(),[g,f]=t.useState(j(new Date)),[i,o]=t.useState([]),[P,p]=t.useState(l),C=Q();t.useEffect(()=>{n&&(n.product.quantity=n.quantity,o([n.product]),x(n.id),f(j(n.planDate)))},[n]);const{mutate:R}=q({mutationFn:e=>y.post(I.plan.create,e),onSuccess:async()=>{b.success("New Plan Has Been Created!")},onSettled:async()=>{await C.invalidateQueries({queryKey:["plans"]}),h.push(w.dashboard.plan.root)},onError:()=>{}}),{mutate:B}=q({mutationFn:({id:e,payload:a})=>y.patch(I.plan.edit+e,a),onSuccess:async()=>{b.success("Plan Has Been Modified!")},onSettled:async()=>{await C.invalidateQueries({queryKey:["plans"]}),h.push(w.dashboard.plan.root)},onError:e=>{console.log(e)}}),E=t.useCallback(e=>{x(e.target.value)},[]),O=t.useCallback(e=>{const a=e.target.value;a&&p(l.filter(c=>c.name.toLowerCase().indexOf(a)!==-1)),(a==null||a==="")&&p(l)},[l]),T=t.useCallback(e=>{o(a=>{const c=a.findIndex(Y=>Y.id===e.id);return c>=0?a[c].quantity+=1:a.length===0&&(e.quantity=1,a.push(e)),[...a]})},[i]),v=t.useCallback(e=>{o(a=>(a[e].quantity-=1,a[e].quantity===0&&a.splice(e,1),[...a]))},[i]),A=t.useCallback(e=>{o(a=>(a[e].quantity+=1,[...a]))},[i]),M=t.useCallback(e=>{o(a=>(a.splice(e,1),[...a]))},[i]),N=s.jsx(D,{children:s.jsxs(d,{spacing:4,sx:{p:3},children:[s.jsx(k,{fullWidth:!0,maxWidth:"xs",placeholder:"Search customer or order number...",InputProps:{startAdornment:s.jsx(U,{position:"start",children:s.jsx(G,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},onChange:O}),s.jsx(u,{spacing:2,gap:3,display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:P.slice(r.page*r.rowsPerPage,r.page*r.rowsPerPage+r.rowsPerPage).map(e=>s.jsx(J,{payload:e,handleClick:T,productName:e==null?void 0:e.name,image:K.site.serverFileHost+(e==null?void 0:e.image)},e==null?void 0:e.id))}),s.jsx(Z,{page:r.page,count:P.length,rowsPerPage:6,defaultRowsPerPage:6,onPageChange:r.onChangePage,onRowsPerPageChange:r.onChangeRowsPerPage})]})}),W=s.jsx(D,{children:s.jsxs(d,{spacing:2,sx:{p:3},children:[s.jsxs(u,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[s.jsx(k,{label:"Plan ID",value:F,onChange:E,sx:{mt:2}}),s.jsx(V,{label:"Date",sx:{mt:2},value:g,onChange:e=>{f(e)}})]}),s.jsx(z,{products:i,onDecrease:v,onIncrease:A,removeItem:M}),s.jsx(u,{display:"flex",flexDirection:"column",alignItems:"flex-end",justifyContent:"center",children:s.jsxs(u,{display:"flex",gap:2,height:50,children:[s.jsx(S,{variant:"contained",onClick:()=>{if(i.length){const e={planDate:g.format("YYYY-MM-DD"),productId:i[0].id,quantity:i[0].quantity};n?B({id:n.id,payload:e}):R(e)}},children:n?"Save Changes":"Save"}),s.jsx(S,{variant:"outlined",onClick:()=>o([]),children:"Clear All"})]})})]})});return s.jsxs(m,{container:!0,spacing:3,children:[s.jsx(m,{xs:12,md:4,children:s.jsx(d,{children:N})}),s.jsx(m,{xs:12,md:8,children:s.jsx(d,{children:W})})]})}export{ie as P};

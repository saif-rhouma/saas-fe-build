import{i as ne,aP as Se,j as e,L as De,S as f,A as re,I as y,B as c,aT as ie,d0 as se,aL as Re,c9 as B,C as le,e8 as oe,d7 as ae,el as T,l as I,cQ as Ae,bR as Ie,db as Le,aR as ke,e3 as $,aS as v,e as Q,r as h,de as ce,e2 as de,ed as xe,eb as Oe,g as ue,p as O,e1 as Ee,ea as Be,am as N,dp as W,dm as z,cY as he,v as G,dT as me,ec as $e,e7 as Fe,b as qe,dn as Me,dP as Ne,cV as A,R as Ve,dS as V,dd as He,dq as Qe,H as We}from"./index-KK-mXlr9.js";import{u as ee,E as pe}from"./error-block-B2eVBtgw.js";import{u as ze}from"./useMutation-BLbhE-7U.js";import{C as Ke}from"./custom-breadcrumbs-DxZer26t.js";import{P as F}from"./permission-access-controller-Dezxnjzz.js";import{g as je,r as ge,e as _e}from"./utils-MBUcMVfY.js";import{u as fe}from"./use-table-B6oWWgzy.js";import{T as Ge}from"./table-no-data-Dy6eTwfo.js";import{T as Ye}from"./table-empty-rows-1jmvOb91.js";import{T as te,a as ye,b as be,c as Ce}from"./table-head-custom-DO9V045A.js";import{T as Je}from"./table-selected-action-Dpba9ipe.js";import{T as Pe}from"./table-pagination-custom-CnZ-ZQmD.js";import{A as H}from"./app-widget-summary-BltmF8bR.js";import{b as E}from"./format-number-BAsKNL1v.js";import{C as Ue}from"./confirm-dialog-BOguUpkK.js";import{T as P}from"./TableCell-BoMvUy-h.js";import{A as Xe}from"./AvatarGroup-YLmu1og-.js";import{P as Ze}from"./react-pdf.browser-DLZ7fuBr.js";import{u as et}from"./use-tabs-oJQJsRmI.js";import{P as tt,a as st}from"./order-payment-details-dialog-CQKZC0Ip.js";import{S as ve}from"./Select-DUjNe6cS.js";import{Q as at}from"./quotation-product-table-Ccw66nsx.js";import{C as nt}from"./CircularProgress-DFKDx2V0.js";import{T as rt,a as it}from"./Tabs-DOkZQpLE.js";import{C as lt}from"./CardHeader-BeQF9g9f.js";import{T as ot}from"./TextField-Cv5b071d.js";import{I as ct}from"./InputAdornment-CkFhR2Z0.js";import{F as dt,a as Y,c as J}from"./filters-result-CvaJNQbZ.js";import{C as U}from"./Chip-J5thaA7V.js";import"./index-CdIWY4PN.js";import"./incrementer-button-_5Nx_vV_.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-wJX0dBLP.js";import"./Checkbox-DQkBQbxP.js";import"./TablePagination-BrNWYPHq.js";import"./KeyboardArrowRight-DtI30r1M.js";import"./LastPage-B2fmRZ1z.js";import"./InputBase-DeC6BCyF.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-CMZe9nOT.js";import"./use-chart-PJFetV5N.js";import"./chart-legends-rLfMRLcD.js";import"./index-gGE07ddn.js";import"./DialogContent-DEOZCbff.js";import"./DialogTitle-BbIsmimy.js";import"./___vite-browser-external_commonjs-proxy-BLmSr3RG.js";import"./form-provider-B-2G1ur0.js";import"./FormHelperText-VfwKXgxg.js";import"./Rating-2QPvBMCZ.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-BLpnXJL9.js";import"./Menu-B-p6693m.js";import"./index-D5UcuDVo.js";import"./Slider-B9AmoN5c.js";import"./FormControl-AgI2w8yW.js";import"./FormLabel-DOuw4Lsg.js";import"./RadioGroup-CK1QAQNA.js";import"./FormGroup-C0dPVyoc.js";import"./utils-CYj1Qi6H.js";import"./countries-DSLisFCy.js";import"./Autocomplete-BFfRVC-e.js";import"./country-select-FMhE8ykL.js";import"./InputLabel-DszYUtyH.js";import"./upload-avatar-DWVWcCXJ.js";import"./image-DBvfg_3r.js";import"./DatePicker-Ff6PJeP3.js";import"./ListItem-B93uRZH_.js";import"./MobileDateTimePicker-COWMR2G3.js";import"./schema-helper-ZDfKx4k_.js";import"./LoadingButton-C_dnO_6P.js";function xt({row:s,index:r,selected:a,onViewRow:m,onDeleteRow:t,onClickRow:o,isFullDisplay:d}){var S,L,C;const j=ne(),p=ne(),i=Se(),l=e.jsxs(te,{hover:!0,selected:a,children:[e.jsx(P,{onClick:o,children:e.jsx(De,{color:"inherit",onClick:m,underline:"always",sx:{cursor:"pointer"},children:(s==null?void 0:s.ref)||r||(s==null?void 0:s.id)})}),e.jsx(P,{onClick:o,children:e.jsxs(f,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(re,{sx:{bgcolor:"#00AB55"},alt:s.name,src:s.customer.avatar,children:e.jsx(y,{color:"white",icon:"fluent:person-20-filled",width:24})}),e.jsxs(f,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsx(c,{component:"span",sx:{textTransform:"capitalize"},children:s.customer.name}),e.jsx(c,{component:"span",sx:{color:"text.disabled"},children:s.customer.email})]})]})}),!d&&e.jsx(P,{onClick:o,children:e.jsx(ie,{primary:se(s.orderDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(P,{align:"center",onClick:o,children:e.jsx(Xe,{sx:{[`& .${Re.avatar}`]:{width:24,height:24}},children:(S=s==null?void 0:s.productToOrder)==null?void 0:S.map(x=>{var g,D,w,R;return e.jsx(B,{title:`${(g=x==null?void 0:x.product)==null?void 0:g.name} | Quantity : ${x.quantity}`,children:e.jsx(re,{alt:(D=x==null?void 0:x.product)==null?void 0:D.name,src:`${le.site.serverFileHost}${(w=x==null?void 0:x.product)==null?void 0:w.image}`},x==null?void 0:x.id)},(R=x==null?void 0:x.product)==null?void 0:R.id)})})}),e.jsx(P,{onClick:o,children:E(oe(s.totalOrderAmount-s.totalOrderAmount*(s.discount/100),s.snapshotTaxPercentage))||"-"}),!d&&e.jsxs(P,{onClick:o,children:[(L=s.createdBy)==null?void 0:L.firstName," ",(C=s.createdBy)==null?void 0:C.lastName]}),!d&&e.jsx(P,{onClick:o,children:e.jsx(ae,{variant:"soft",color:s.status===T.Ready&&"info"||s.status===T.InProcess&&"warning"||s.status===T.Delivered&&"success"||s.status===T.Canceled&&"error"||"default",children:s.status})}),!d&&e.jsxs(P,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(I,{color:p.value?"inherit":"default",onClick:p.onToggle,sx:{...p.value&&{bgcolor:"action.hover"}},children:e.jsx(y,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(I,{color:i.open?"inherit":"default",onClick:i.onOpen,children:e.jsx(y,{icon:"eva:more-vertical-fill"})})]})]}),b=e.jsx(te,{children:e.jsx(P,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(Ae,{in:p.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(Ie,{sx:{m:1.5},children:s.productToOrder.map(x=>e.jsxs(f,{direction:"row",alignItems:"center",sx:{p:g=>g.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:g=>`solid 2px ${g.vars.palette.background.neutral}`}},children:[e.jsx(ie,{primary:x.product.name,secondary:x.sku,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs("div",{children:[x.quantity," "]}),e.jsx(c,{sx:{width:110,textAlign:"right"},children:E(x.snapshotProductPrice)})]},x.id))})})})});return e.jsxs(e.Fragment,{children:[l,b,e.jsx(Le,{open:i.open,anchorEl:i.anchorEl,onClose:i.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(ke,{children:[e.jsx(F,{permission:$.VIEW_ORDER,children:e.jsxs(v,{onClick:()=>{m(),i.onClose()},children:[e.jsx(y,{icon:"solar:eye-bold"}),"View"]})}),s.status!==T.Canceled&&e.jsx(F,{permission:$.DELETE_ORDER,children:e.jsxs(v,{onClick:()=>{j.onTrue(),i.onClose()},sx:{color:"warning.main"},children:[e.jsx(y,{icon:"solar:trash-bin-trash-bold"}),"Cancel"]})})]})}),e.jsx(Ue,{open:j.value,onClose:j.onFalse,title:"Cancel Order",content:"Are you sure want to cancel this order?",action:e.jsx(Q,{variant:"contained",color:"warning",onClick:()=>{t(),j.onFalse()},children:"Confirm Canceling"})})]})}const ut=[{id:"orderNumber",label:"#",width:40,align:"center"},{id:"date",label:"Date"},{id:"status",label:"Payment Type",width:200,align:"center"},{id:"totalAmount",label:"	Paid Amount",width:200,align:"center"}],ht=({payments:s})=>{const r=fe({defaultOrderBy:"orderId",defaultRowsPerPage:5}),[a,m]=h.useState(s),t=ce({name:"",status:"all",startDate:null,endDate:null});h.useEffect(()=>{m(s)},[s]);const o=de(t.state.startDate,t.state.endDate),d=mt({inputData:a,comparator:je(r.order,r.orderBy),filters:t.state,dateError:o});ge(d,r.page,r.rowsPerPage),t.state.name||t.state.status!=="all"||t.state.startDate&&t.state.endDate;const[j,p]=h.useState("all");h.useCallback(l=>{r.onResetPage(),t.setState({name:l.target.value})},[t,r]);const i=h.useCallback(l=>{r.onResetPage(),t.setState({status:l.target.value}),p(l.target.value)},[t,r]);return e.jsxs(c,{display:"flex",flexDirection:"column",alignItems:"center",sx:{borderRadius:1,height:1,width:1,overflow:"hidden",border:l=>`solid 1px ${l.vars.palette.divider}`},children:[e.jsx(f,{spacing:2,justifyContent:{xs:"flex-end"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:1,width:1},children:e.jsxs(ve,{size:"small",sx:{width:200,textTransform:"capitalize"},value:j,onChange:i,children:[e.jsx(v,{value:"all",children:"All Payments"}),e.jsx(v,{value:"Cash",children:"Cash"}),e.jsx(v,{value:"Card",children:"Card"}),e.jsx(v,{value:"Transfer",children:"Transfer"})]})}),e.jsx(c,{sx:{flex:1,width:1},children:e.jsxs(ye,{size:"medium",children:[e.jsx(be,{headLabel:ut}),e.jsx(Ce,{children:d.slice(r.page*r.rowsPerPage,r.page*r.rowsPerPage+r.rowsPerPage).map((l,b)=>e.jsxs(te,{children:[e.jsxs(P,{align:"center",children:[" ",b+1||l.id," "]}),e.jsx(P,{children:se(l.paymentDate)}),e.jsx(P,{align:"center",children:e.jsx(ae,{variant:"soft",color:l.paymentType==="Cash"&&"info"||l.paymentType==="Card"&&"success"||l.paymentType==="Transfer"&&"default"||"default",children:l.paymentType})}),e.jsx(P,{align:"center",children:E(l==null?void 0:l.amount)})]},`${l.id}`))})]})}),e.jsx(Pe,{sx:{width:1},page:r.page,dense:!0,count:d.length,rowsPerPage:r.rowsPerPage,onPageChange:r.onChangePage,onRowsPerPageChange:r.onChangeRowsPerPage})]})};function mt({inputData:s,comparator:r,filters:a,dateError:m}){const{status:t,name:o,startDate:d,endDate:j}=a,p=s.map((i,l)=>[i,l]);return p.sort((i,l)=>{const b=r(i[0],l[0]);return b!==0?b:i[1]-l[1]}),s=p.map(i=>i[0]),t!=="all"&&(s=s.filter(i=>i.paymentType===t)),m||d&&j&&(s=s.filter(i=>xe(i.createdAt,d,j))),s}const X=[{value:"details",icon:e.jsx(y,{icon:"solar:eye-bold",width:24}),label:"Details"},{value:"payments",icon:e.jsx(y,{icon:"solar:case-minimalistic-bold",width:24}),label:"Payments"}],pt=({selectedOrder:s,handleResize:r,handleClose:a,onViewOrder:m})=>{var D,w,R,k,q,M;const[t,o]=h.useState(s),d=et("details"),[j,p]=h.useState(X),i=Oe();h.useEffect(()=>{s.id!==t.id&&o(s)},[t.id,s]),h.useEffect(()=>{const u=(s==null?void 0:s.status)!==T.Draft&&(s==null?void 0:s.status)!==T.Canceled?X:X.filter(K=>!["payments"].includes(K.value));p(u)},[s]);const l=ue(),b=h.useCallback(u=>{l.replace(O.dashboard.quotation.details(u))},[l]),S=e.jsx(Ee,{children:e.jsx(Ze,{document:t?e.jsx(tt,{order:t}):e.jsx("span",{}),fileName:t==null?void 0:t.ref,style:{textDecoration:"none"},children:({loading:u})=>e.jsx(B,{title:"Download Pdf",children:e.jsx(I,{children:u?e.jsx(nt,{size:24,color:"inherit"}):e.jsx(y,{icon:"eva:cloud-download-fill"})})})})}),L=e.jsxs(f,{alignItems:"flex-end",sx:{p:1,textAlign:"right",typography:"body2"},children:[e.jsxs(f,{direction:"row",children:[e.jsx(c,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(c,{sx:{width:160,typography:"subtitle2"},children:E(t==null?void 0:t.totalOrderAmount)||"-"})]}),e.jsxs(f,{direction:"row",children:[e.jsx(c,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(c,{sx:{width:160,...(t==null?void 0:t.discount)&&{color:"error.main"}},children:t!=null&&t.discount?`- ${t==null?void 0:t.discount}%`:"-"})]}),e.jsxs(f,{direction:"row",children:[e.jsxs(c,{sx:{color:"text.secondary"},children:["Tax (",(t==null?void 0:t.snapshotTaxPercentage)||"0","%)"]}),e.jsx(c,{sx:{width:160},children:t!=null&&t.snapshotTaxPercentage?E(Be((t==null?void 0:t.totalOrderAmount)-(t==null?void 0:t.totalOrderAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage)):"-"})]}),e.jsxs(f,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:"Total"}),e.jsx(c,{sx:{width:160},children:E(oe((t==null?void 0:t.totalOrderAmount)-(t==null?void 0:t.totalOrderAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage))||"-"})]})]}),C=e.jsxs(f,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsxs(c,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",m:1},children:[e.jsxs(c,{flexDirection:"column",sx:{display:"flex"},children:[e.jsxs(c,{sx:{color:"text.secondary"},children:["Order Ref: #",t==null?void 0:t.ref]}),e.jsxs(c,{sx:{color:"text.secondary"},children:["Order Date: ",se(t==null?void 0:t.orderDate)]})]}),e.jsx(c,{sx:{mr:2},children:e.jsxs(c,{sx:{color:"text.secondary"},children:["Status:"," ",e.jsx(ae,{variant:"soft",color:(t==null?void 0:t.status)===T.Ready&&"info"||(t==null?void 0:t.status)===T.InProcess&&"warning"||(t==null?void 0:t.status)===T.Delivered&&"success"||(t==null?void 0:t.status)===T.Canceled&&"error"||"default",children:t==null?void 0:t.status})]})}),((D=t==null?void 0:t.order)==null?void 0:D.id)&&e.jsx(c,{sx:{color:"text.secondary"},className:"print-hide",children:e.jsxs(Q,{variant:"contained",size:"small",startIcon:e.jsx(y,{icon:"heroicons-outline:external-link"}),onClick:()=>{t==null||t.quotation},children:["Related to Quotation: #",(w=t==null?void 0:t.quotation)==null?void 0:w.ref]})})]}),e.jsxs(c,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsx(at,{products:t==null?void 0:t.productToOrder,defaultRowsPerPage:t!=null&&t.notes?5:10}),e.jsx(N,{sx:{mt:1}})]}),L,(t==null?void 0:t.notes)&&e.jsxs(c,{children:[e.jsx(N,{}),e.jsx(f,{sx:{typography:"body2"},children:e.jsx(c,{sx:{p:1},children:e.jsxs(f,{sx:{typography:"subtitle2"},children:[e.jsx("div",{children:"Notes:"}),e.jsx(c,{sx:{color:"text.secondary"},children:t==null?void 0:t.notes})]})})})]})]}),x=ee({queryKey:["quotation",t.id],queryFn:async()=>{const{data:u}=await W.get(z.order.details+t.id);return o(u),u}}),g=u=>u.isPending||u.isLoading?e.jsx(me,{}):u.isError?e.jsx(pe,{}):e.jsxs(f,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsx(c,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(c,{children:e.jsx(F,{permission:$.ADD_PAYMENT,children:e.jsx(Q,{variant:"outlined",startIcon:e.jsx(y,{icon:"mingcute:add-line"}),children:"New Payment"})})})}),e.jsx(N,{}),e.jsx(c,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(ht,{payments:x.data.payments})})]});return e.jsxs(he,{sx:{height:1,display:"flex",flexDirection:"column",width:1,transition:"all 2s ease-in-out"},children:[e.jsxs(rt,{className:"print-hide ",value:d.value,onChange:d.onChange,sx:{px:3,boxShadow:u=>`inset 0 -2px 0 0 ${G(u.vars.palette.grey["500Channel"],.08)}`},children:[j.map(u=>e.jsx(it,{icon:u.icon,value:u.value,label:u.label},u.value)),e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${G(i.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(I,{sx:{ml:1},onClick:r,children:e.jsx(y,{icon:"solar:full-screen-bold",width:24})})}),e.jsx(c,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${G(i.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(I,{sx:{ml:1},onClick:a,children:e.jsx(y,{icon:"solar:close-square-outline",width:24})})})]}),e.jsxs(c,{className:"print-top-margin print-padding",sx:{display:"flex",flexDirection:"column",position:"relative",flex:1},children:[e.jsx(lt,{sx:{pt:1},title:`Order Reference: ${t==null?void 0:t.ref}`,subheader:`Created By : ${(R=t.createdBy)==null?void 0:R.firstName} ${(k=t.createdBy)==null?void 0:k.lastName}`,action:e.jsx(f,{spacing:3,direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"},sx:{mb:{xs:3,md:5}},children:e.jsxs(f,{direction:"row",spacing:1,alignItems:"center",flexGrow:1,sx:{width:1},children:[e.jsx(B,{title:"View",children:e.jsx(I,{onClick:()=>{m(t.id)},children:e.jsx(y,{icon:"solar:eye-bold"})})}),((q=t==null?void 0:t.quotation)==null?void 0:q.id)&&e.jsx(B,{title:`Related to Quotation: #${(M=t==null?void 0:t.quotation)==null?void 0:M.ref}`,children:e.jsx(I,{onClick:()=>{var u;b((u=t==null?void 0:t.quotation)==null?void 0:u.id)},children:e.jsx(y,{icon:"heroicons-outline:external-link"})})}),S,e.jsx(B,{title:"Print",children:e.jsx(st,{order:t})})]})})}),e.jsx(N,{}),d.value==="details"&&C,d.value==="payments"&&g(x)]})]})};function jt({filters:s,onResetPage:r}){const[a,m]=h.useState("all"),t=h.useCallback(d=>{r(),s.setState({name:d.target.value})},[s,r]),o=h.useCallback(d=>{r(),s.setState({status:d.target.value}),m(d.target.value)},[s,r]);return e.jsxs(f,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(ot,{sx:{width:420},value:s.state.name,onChange:t,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(ct,{position:"start",children:e.jsx(y,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(ve,{sx:{width:420,textTransform:"capitalize"},value:a,onChange:o,children:[e.jsx(v,{value:"all",children:"All Orders"}),e.jsx(v,{value:"Draft",children:"Draft"}),e.jsx(v,{value:"Canceled",children:"Canceled"}),e.jsx(v,{value:"InProcess",children:"Processing"}),e.jsx(v,{value:"Ready",children:"Ready To Deliver"}),e.jsx(v,{value:"Delivered",children:"Delivered"})]})]})}function gt({filters:s,totalResults:r,onResetPage:a,sx:m}){const t=h.useCallback(()=>{a(),s.setState({name:""})},[s,a]),o=h.useCallback(()=>{a(),s.setState({status:"all"})},[s,a]),d=h.useCallback(()=>{a(),s.setState({startDate:null,endDate:null})},[s,a]),j=h.useCallback(()=>{a(),s.onResetState()},[s,a]);return e.jsxs(dt,{totalResults:r,onReset:j,sx:m,children:[e.jsx(Y,{label:"Status:",isShow:s.state.status!=="all",children:e.jsx(U,{...J,label:s.state.status,onDelete:o,sx:{textTransform:"capitalize"}})}),e.jsx(Y,{label:"Date:",isShow:!!(s.state.startDate&&s.state.endDate),children:e.jsx(U,{...J,label:$e(s.state.startDate,s.state.endDate),onDelete:d})}),e.jsx(Y,{label:"Keyword:",isShow:!!s.state.name,children:e.jsx(U,{...J,label:s.state.name,onDelete:t})})]})}const Z=[{id:"orderNumber",label:"#",width:88},{id:"name",label:"Customer"},{id:"createdAt",label:"Date",width:140},{id:"totalQuantity",label:"Items",width:120,align:"center"},{id:"totalAmount",label:"Price",width:140},{id:"createdBy",label:"Created By",width:200},{id:"status",label:"Status",width:110},{id:"",width:88}];function ft({orders:s,analytics:r}){const a=fe({defaultOrderBy:"orderId"}),{t:m}=Fe("orders"),t=ue(),[o,d]=h.useState(),[j,p]=h.useState(!1),[i,l]=h.useState(Z),b=qe(),[S,L]=h.useState(()=>s),C=ce({name:"",status:"all",startDate:null,endDate:null});h.useEffect(()=>{if(p(!1),L(s),o){const n=s.find(_=>_.id===o.id);d(n)}},[s]),h.useEffect(()=>{const n=o?Z.filter(_=>!["createdAt","createdBy","status",""].includes(_.id)):Z;l(n)},[o]);const x=de(C.state.startDate,C.state.endDate),g=yt({inputData:S,comparator:je(a.order,a.orderBy),filters:C.state,dateError:x}),D=ge(g,a.page,a.rowsPerPage),w=!!C.state.name||C.state.status!=="all"||!!C.state.startDate&&!!C.state.endDate,R=!g.length&&w||!g.length,k=Me(),{mutate:q}=ze({mutationFn:n=>W.delete(z.order.delete+n),onSuccess:async()=>{Qe.success("Order Has Been Canceled!")},onSettled:async()=>{await k.invalidateQueries({queryKey:["orders"]}),await k.invalidateQueries({queryKey:["orders-status"]}),await k.invalidateQueries({queryKey:["orders","analytics"]})},onError:()=>{}}),M=h.useCallback(n=>{q(n)},[D.length,a,S]),u=h.useCallback(n=>{t.replace(O.dashboard.order.details(n))},[t]),K=()=>{p(!j)},Te=()=>{d(null),p(!1)},we=n=>{d(n)};return e.jsx(Ne,{maxWidth:"xl",children:e.jsxs(A,{container:!0,spacing:3,children:[e.jsx(A,{xs:12,md:12,children:e.jsx(Ke,{links:[{name:`${m("listView.breadCrumbsPageRootTitle")}`,href:O.dashboard.root},{name:`${m("listView.breadCrumbsParentPageTitle")}`,href:O.dashboard.order.root},{name:`${m("listView.breadCrumbsPageTitle")}`}],action:e.jsx(F,{permission:$.ADD_ORDER,children:e.jsx(Q,{component:Ve,href:O.dashboard.order.new,variant:"contained",startIcon:e.jsx(y,{icon:"mingcute:add-line"}),children:`${m("listView.addNewOrder")}`})})})}),e.jsxs(F,{permission:$.LIST_ORDER,children:[e.jsx(A,{xs:12,md:3,children:e.jsx(H,{title:`${m("listView.statisticsWidgets.allOrders")}`,total:s.length,chart:{categories:r.data.lastSixMonth.map(n=>V(n==null?void 0:n.inMonth)),series:r.data.lastSixMonth.map(n=>n==null?void 0:n.ClaimsPerMonth)}})}),e.jsx(A,{xs:12,md:3,children:e.jsx(H,{title:`${m("listView.statisticsWidgets.processingOrder")}`,total:r.data.analytics.InProcess,chart:{colors:[b.vars.palette.warning.light],categories:r.data.inProcessLastSixMonth.map(n=>V(n==null?void 0:n.inMonth)),series:r.data.inProcessLastSixMonth.map(n=>n==null?void 0:n.ClaimsPerMonth)}})}),e.jsx(A,{xs:12,md:3,children:e.jsx(H,{title:`${m("listView.statisticsWidgets.readyToDeliver")}`,total:r.data.analytics.Ready,chart:{colors:[b.vars.palette.info.main],categories:r.data.readyLastSixMonth.map(n=>V(n==null?void 0:n.inMonth)),series:r.data.readyLastSixMonth.map(n=>n==null?void 0:n.ClaimsPerMonth)}})}),e.jsx(A,{xs:12,md:3,children:e.jsx(H,{title:`${m("listView.statisticsWidgets.delivered")}`,total:r.data.analytics.Delivered,chart:{colors:[b.vars.palette.success.main],categories:r.data.deliveredLastSixMonth.map(n=>V(n==null?void 0:n.inMonth)),series:r.data.deliveredLastSixMonth.map(n=>n==null?void 0:n.ClaimsPerMonth)}})}),!j&&e.jsx(A,{xs:12,md:o?5:12,children:e.jsxs(he,{children:[e.jsx(jt,{filters:C,onResetPage:a.onResetPage,dateError:x}),w&&e.jsx(gt,{filters:C,totalResults:g.length,onResetPage:a.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(c,{sx:{position:"relative"},children:[e.jsx(Je,{dense:a.dense,numSelected:a.selected.length,rowCount:g.length}),e.jsx(He,{sx:{minHeight:444},children:e.jsxs(ye,{size:a.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(be,{order:a.order,orderBy:a.orderBy,headLabel:i,rowCount:g.length}),e.jsxs(Ce,{children:[g.slice(a.page*a.rowsPerPage,a.page*a.rowsPerPage+a.rowsPerPage).map(n=>e.jsx(xt,{row:n,selected:a.selected.includes(n.id),onSelectRow:()=>a.onSelectRow(n.id),onDeleteRow:()=>M(n.id),onViewRow:()=>u(n.id),onClickRow:()=>we(n),isFullDisplay:o},n.id)),e.jsx(Ye,{height:a.dense?56:76,emptyRows:_e(a.page,a.rowsPerPage,g.length)}),e.jsx(Ge,{notFound:R})]})]})})]}),e.jsx(Pe,{page:a.page,dense:a.dense,count:g.length,rowsPerPage:a.rowsPerPage,onPageChange:a.onChangePage,onChangeDense:a.onChangeDense,onRowsPerPageChange:a.onChangeRowsPerPage})]})}),o&&e.jsx(c,{sx:{display:"flex",flex:1,p:1.5,transition:"all 2s ease-in-out"},children:e.jsx(pt,{selectedOrder:o,handleResize:K,handleClose:Te,onViewOrder:u})})]})]})})}function yt({inputData:s,comparator:r,filters:a,dateError:m}){const{status:t,name:o,startDate:d,endDate:j}=a,p=s==null?void 0:s.map((i,l)=>[i,l]);return p==null||p.sort((i,l)=>{const b=r(i[0],l[0]);return b!==0?b:i[1]-l[1]}),s=p==null?void 0:p.map(i=>i[0]),o&&(s=s.filter(i=>i.id.toString().toLowerCase().indexOf(o.toLowerCase())!==-1||i.customer.name.toLowerCase().indexOf(o.toLowerCase())!==-1||i.status.toLowerCase().indexOf(o.toLowerCase())!==-1||i.customer.email.toLowerCase().indexOf(o.toLowerCase())!==-1)),t!=="all"&&(s=s.filter(i=>i.status===t)),m||d&&j&&(s=s.filter(i=>xe(i.createTime,d,j))),s}const bt={title:`Order list | Dashboard - ${le.site.name}`};function Ns(){const s=ee({queryKey:["orders"],queryFn:async()=>{const{data:a}=await W.get(z.order.list);return a}}),r=ee({queryKey:["orders","analytics"],queryFn:async()=>{const{data:a}=await W.get(z.order.analytics);return a}});return r.isLoading||s.isLoading?e.jsx(me,{}):s.isError||r.isError?e.jsx(pe,{route:O.dashboard.order.root}):e.jsxs(e.Fragment,{children:[e.jsx(We,{children:e.jsxs("title",{children:[" ",bt.title]})}),e.jsx(ft,{orders:s.data,analytics:r})]})}export{Ns as default};

import{r as s,j as e,D as F,e as x,o as T,l as se,bU as ae,dI as oe,dJ as h,dH as j,dK as A,p as y,aD as P,S as l,I as B,B as o,C as N,v as ne,ev as ie,ew as le,bR as E,G as v,e8 as de,ec as ce,H as ue}from"./index-Cq03K-HC.js";import{u as O,E as me}from"./error-block-CBMWt84f.js";import{C as pe}from"./custom-breadcrumbs-C_F-6vOC.js";import{u as K}from"./useMutation-Dp0rVztm.js";import{b as C}from"./format-number-DITXUPMN.js";import{P as xe}from"./product-Item-button-9ZeFIKBl.js";import{O as he}from"./order-product-table-tV_9mJ_a.js";import{a as je,b as ge,D as Ce}from"./DialogContent-D0WbZEYR.js";import{D as ye}from"./DialogTitle-CLKmH_im.js";import{T as S}from"./TextField-BNZ3YpVQ.js";import{O as fe}from"./order-customer-create-dialog-Dn0FM8vI.js";import{I as be}from"./InputAdornment-B7jHbOut.js";import{S as De}from"./Select-BJK6Q71-.js";import{D as Ie}from"./DatePicker-C0kjDQAX.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./table-head-custom-xPqHms_A.js";import"./TableCell-BY4odiRW.js";import"./Checkbox-B5P4NoLN.js";import"./incrementer-button-D87DqIoS.js";import"./FormControl-DUlfZx4z.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-D6SX5sCR.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-Bx5V1G4l.js";import"./FormHelperText-BdgqWWO0.js";import"./form-provider-DGoPfYCb.js";import"./Rating-C9YzUf05.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-D16lNrfB.js";import"./Menu-B_EWYTTU.js";import"./index-BOf1bnN2.js";import"./Slider-ic8LVZXa.js";import"./RadioGroup-CqyyD7XC.js";import"./FormGroup-ByRTQQuh.js";import"./FormControlLabel-CS2mv3Te.js";import"./index-DqNxVOmH.js";import"./countries-DSLisFCy.js";import"./Autocomplete-CidbBtOC.js";import"./Chip-x2W7r02e.js";import"./country-select-D9zKFD0C.js";import"./upload-avatar-CoRpPeQR.js";import"./image-DitvMElQ.js";import"./MobileDateTimePicker-DgPLkewz.js";import"./Tabs-Bg2egs3q.js";import"./KeyboardArrowRight-yBnSCV6-.js";import"./schema-helper-DkKalxt7.js";import"./LoadingButton-3T23lww4.js";import"./CircularProgress-sp-m8OZh.js";import"./InputBase-CPtucf_J.js";import"./ListItem-Dwol_2rN.js";const we=({discount:n,open:c,onClose:a,handler:i})=>{const[u,f]=s.useState(n);return e.jsxs(je,{fullWidth:!0,open:c,onClose:a,children:[e.jsx(ye,{children:"Discount"}),e.jsx(F,{}),e.jsx(ge,{sx:{pt:1,mt:1},children:e.jsx(S,{fullWidth:!0,label:"Discount Amount",type:"number",value:u,onChange:b=>{f(b.target.value)}})}),e.jsx(F,{sx:{pt:1,mt:1}}),e.jsxs(Ce,{children:[e.jsx(x,{type:"submit",variant:"contained",onClick:()=>i(u),children:"Confirm"}),e.jsx(x,{color:"inherit",variant:"outlined",onClick:a,children:"Cancel"})]})]})};function ve({products:n,customers:c,taxPercentage:a}){const i=T(),u=T(),f=se(),[b,H]=s.useState(),[g,L]=s.useState(0),[D,G]=s.useState("Customer"),[k,Q]=s.useState(ae(new Date)),[d,p]=s.useState([]),[R,q]=s.useState(n),I=oe(),W=t=>{L(t),u.onFalse()},{mutate:M}=K({mutationFn:t=>h.post(j.order.create,t),onSuccess:async()=>{A.success("New Order Has Been Created!")},onSettled:async()=>{await I.invalidateQueries({queryKey:["orders"]}),await I.invalidateQueries({queryKey:["orders","analytics"]}),f.push(y.dashboard.order.root)},onError:()=>{}}),Y=s.useCallback(t=>{H(t.target.value)},[]),J=s.useCallback(t=>{G(t.target.value)},[]),$=s.useCallback(t=>{p(r=>{const m=r.findIndex(re=>re.id===t.id);return m>=0?r[m].quantity+=1:(t.quantity=1,r.push(t)),[...r]})},[d]),z=s.useCallback(t=>{const r=t.target.value;r&&q(n.filter(m=>m.name.toLowerCase().indexOf(r)!==-1)),(r==null||r==="")&&q(n)},[]),U=s.useCallback(t=>{p(r=>(r[t].quantity-=1,r[t].quantity===0&&r.splice(t,1),[...r]))},[d]),V=s.useCallback(t=>{p(r=>(r[t].quantity+=1,[...r]))},[d]),X=s.useCallback(t=>{p(r=>(r.splice(t,1),[...r]))},[d]),w=s.useCallback(()=>d.reduce((t,r)=>t+r.price*r.quantity,0),[d]),Z=e.jsx(P,{children:e.jsxs(l,{spacing:4,sx:{p:3},children:[e.jsx(S,{fullWidth:!0,maxWidth:"xs",placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(B,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},onChange:z}),e.jsx(o,{spacing:2,gap:3,display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:R.map(t=>e.jsx(xe,{payload:t,handleClick:$,productName:t==null?void 0:t.name,image:N.site.serverFileHost+(t==null?void 0:t.image)},t==null?void 0:t.id))})]})}),_=e.jsxs(l,{spacing:2,alignItems:"flex-end",sx:{p:2,textAlign:"right",typography:"body2"},children:[e.jsxs(l,{direction:"row",children:[e.jsx(o,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(o,{sx:{width:160,typography:"subtitle2"},children:C(w())||"-"})]}),e.jsxs(l,{direction:"row",alignItems:"center",children:[e.jsx(o,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(o,{sx:{width:160},children:e.jsx(o,{sx:{pl:4,mr:-.5},children:e.jsx(l,{onClick:()=>{u.onToggle()},sx:{cursor:"pointer",p:.5,color:"error.main",borderRadius:1,typography:"subtitle2",border:t=>`solid 1px ${ne(t.vars.palette.grey["500Channel"],.2)}`},children:C(g)})})})]}),e.jsxs(l,{direction:"row",children:[e.jsxs(o,{sx:{color:"text.secondary"},children:["Tax (",a||"0","%)"]}),e.jsx(o,{sx:{width:160},children:a?C(ie(w(),a)):"-"})]}),e.jsxs(l,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:"Gross Total:"}),e.jsx(o,{sx:{width:160},children:C(le(w()-g,a))||"-"})]})]}),{mutate:ee}=K({mutationFn:t=>h.post(j.customers.create,t),onSuccess:async()=>{A.success("New Customer Has Been Created!")},onSettled:async()=>{await I.invalidateQueries({queryKey:["customers"]}),i.onFalse()},onError:t=>{console.log(t)}}),te=e.jsx(P,{children:e.jsxs(l,{spacing:2,sx:{p:3},children:[e.jsxs(o,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[e.jsxs(De,{sx:{maxWidth:420,textTransform:"capitalize"},value:D,onChange:J,children:[e.jsx(E,{value:"Customer",children:"Customer"}),c.map(t=>e.jsx(E,{value:t.id,children:t.name},t.id))]}),e.jsx(o,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:e.jsx(x,{variant:"contained",startIcon:e.jsx(B,{icon:"mingcute:add-line"}),onClick:()=>i.onToggle(),children:"Add Customer"})}),e.jsx(S,{label:"Order ID",placeholder:"This Could Be Generated Automaticly",value:b,onChange:Y,sx:{mt:2}}),e.jsx(Ie,{label:"Date",sx:{mt:2},value:k,onChange:t=>{Q(t)}})]}),e.jsx(he,{products:d,onDecrease:U,onIncrease:V,removeItem:X}),e.jsxs(o,{display:"flex",flexDirection:"column",alignItems:"flex-end",justifyContent:"center",children:[_,e.jsxs(o,{display:"flex",gap:2,height:50,children:[e.jsx(x,{variant:"contained",onClick:()=>{if(!isNaN(parseInt(D))&&d.length){const t={discount:parseInt(g,10),orderDate:k.format("YYYY-MM-DD"),products:d.map(r=>({id:r.id,quantity:r.quantity})),customer:D};M(t)}},children:"Save and Continue"}),e.jsx(x,{variant:"outlined",onClick:()=>p([]),children:"Clear All"})]})]})]})});return e.jsxs(v,{container:!0,spacing:3,children:[e.jsx(v,{xs:12,md:4,children:e.jsx(l,{children:Z})}),e.jsx(v,{xs:12,md:8,children:e.jsx(l,{children:te})}),e.jsx(fe,{open:i.value,onClose:i.onFalse,handler:ee}),e.jsx(we,{discount:g,open:u.value,onClose:u.onFalse,handler:W})]})}function Oe({products:n,customers:c,taxPercentage:a}){return e.jsxs(de,{children:[e.jsx(pe,{heading:"Create a new Order",links:[{name:"Dashboard",href:y.dashboard.root},{name:"Order",href:y.dashboard.order.root},{name:"Add Order"}],sx:{mb:{xs:3,md:5}}}),e.jsx(ve,{products:n,customers:c,taxPercentage:a})]})}const Se={title:`Create a new Order | Dashboard - ${N.site.name}`};function St(){const n=O({queryKey:["products"],queryFn:async()=>(await h.get(j.products.list)).data}),c=O({queryKey:["customers"],queryFn:async()=>(await h.get(j.customers.list)).data}),a=O({queryKey:["account-application"],queryFn:async()=>{const{data:i}=await h.get(j.auth.application);return i}});return a.isLoading||n.isLoading||c.isLoading?e.jsx(ce,{}):a.isError||n.isError||n.isError?e.jsx(me,{route:y.dashboard.order.root}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{children:e.jsxs("title",{children:[" ",Se.title]})}),e.jsx(Oe,{products:n.data,customers:c.data,taxPercentage:a.data.taxPercentage})]})}export{St as default};

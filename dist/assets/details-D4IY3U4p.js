import{r as l,i as D,j as s,S as t,B as r,ee as _,e8 as G,d0 as $,d7 as K,e as h,I as n,am as I,g as U,p as d,dn as z,dP as J,cV as P,cY as M,e3 as j,c9 as u,l as f,v as Y,dp as Q,dm as O,dq as W,dT as X,H as Z,C as q}from"./index-DSZ8-SnN.js";import{u as ee,E as se}from"./error-block-Bfei_nF0.js";import{u as re}from"./use-params-aZJqSZ4x.js";import{l as ie}from"./index-DpRp3FVL.js";import{u as te}from"./useMutation-DusrxMaX.js";import{u as ne}from"./use-tabs-C6J8aMs6.js";import{b as y}from"./format-number-Cz1FSQLM.js";import{C as ae}from"./custom-breadcrumbs-D_ovYyL8.js";import{P as b}from"./permission-access-controller-BdKtae4H.js";import{T as oe}from"./tickets-create-dialog-ChRsEcq2.js";import{R as le}from"./reminder-create-dialog-C9VroThh.js";import{Q as de,a as ce,b as xe}from"./quotation-reminder-table-DhOwqQTC.js";import{C as pe}from"./CardHeader-anFXzk9d.js";import{T as me,a as he}from"./Tabs-CZeN0YJj.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./form-provider-Cfa9nJ2G.js";import"./TextField-DXnGVnKc.js";import"./FormControl-DVwuE-Z3.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-Dt93HXfK.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-D8PgMfa3.js";import"./Select-bvm1T7cr.js";import"./Menu-WNpJDxC0.js";import"./InputBase-DUSf-v3M.js";import"./FormHelperText-CAtOlLkP.js";import"./Rating-CJRd3C9A.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-C8mFRUZ0.js";import"./index-ClfPQVwT.js";import"./Slider-DvPw8R3F.js";import"./RadioGroup-B-VQ3Ex7.js";import"./FormGroup-BoA-oXkm.js";import"./FormControlLabel-DcdZLABF.js";import"./utils-DfMGJYQ4.js";import"./index-CHAbpX0m.js";import"./countries-DSLisFCy.js";import"./InputAdornment-DQTsYq75.js";import"./Autocomplete-Ke2RMla7.js";import"./Chip-BxDt4Lxe.js";import"./country-select-0bcGB8RG.js";import"./Checkbox-DIewUcg3.js";import"./upload-avatar-BRDUoqCR.js";import"./image-CnfTgJRa.js";import"./DatePicker-CHiyzFIc.js";import"./DialogContent-9Yn0EsJP.js";import"./ListItem-CKvXkhKm.js";import"./MobileDateTimePicker-BLXY58Hs.js";import"./DialogTitle-kOHEE1rt.js";import"./LoadingButton-Dx3EK8-Y.js";import"./CircularProgress-MhlsCNnq.js";import"./schema-helper-hhXgycyC.js";import"./utils-MBUcMVfY.js";import"./use-table-CxMdT4pf.js";import"./table-head-custom-YWIPj6NO.js";import"./TableCell-DSOEY65A.js";import"./table-pagination-custom-DI2JWg0p.js";import"./TablePagination-DMx1QqWY.js";import"./KeyboardArrowRight-ySj1HR2l.js";import"./LastPage-DNd_MO8z.js";import"./AvatarGroup-DxaOTv1q.js";import"./table-empty-rows-BaAfroyB.js";const je=[{value:"details",icon:s.jsx(n,{icon:"solar:eye-bold",width:24}),label:"Details"},{value:"tickets",icon:s.jsx(n,{icon:"solar:case-minimalistic-bold",width:24}),label:"Tickets"},{value:"reminders",icon:s.jsx(n,{icon:"solar:calendar-bold",width:24}),label:"Reminders"}];function ue({currentQuotation:o}){var C,w,v,k;const[e,x]=l.useState(o),a=ne("details"),g=l.useRef();l.useEffect(()=>{x(o)},[o]);const R=ie.useReactToPrint({content:()=>g.current}),p=D(),m=D(),A=s.jsxs(t,{alignItems:"flex-end",sx:{pr:3,pl:3,pb:3,textAlign:"right",typography:"body2"},children:[s.jsxs(t,{direction:"row",children:[s.jsx(r,{sx:{color:"text.secondary"},children:"Subtotal"}),s.jsx(r,{sx:{width:160,typography:"subtitle2"},children:y(e==null?void 0:e.totalAmount)||"-"})]}),s.jsxs(t,{direction:"row",children:[s.jsx(r,{sx:{color:"text.secondary"},children:"Discount"}),s.jsx(r,{sx:{width:160,...(e==null?void 0:e.discount)&&{color:"error.main"}},children:e!=null&&e.discount?`- ${e==null?void 0:e.discount}%`:"-"})]}),s.jsxs(t,{direction:"row",children:[s.jsxs(r,{sx:{color:"text.secondary"},children:["Tax (",(e==null?void 0:e.snapshotTaxPercentage)||"0","%)"]}),s.jsx(r,{sx:{width:160},children:e!=null&&e.snapshotTaxPercentage?y(_((e==null?void 0:e.totalAmount)-(e==null?void 0:e.totalAmount)*((e==null?void 0:e.discount)/100),e==null?void 0:e.snapshotTaxPercentage)):"-"})]}),s.jsxs(t,{direction:"row",sx:{typography:"subtitle1"},children:[s.jsx("div",{children:"Gross Total"}),s.jsx(r,{sx:{width:160},children:y(G((e==null?void 0:e.totalAmount)-(e==null?void 0:e.totalAmount)*((e==null?void 0:e.discount)/100),e==null?void 0:e.snapshotTaxPercentage))||"-"})]})]}),E=s.jsxs(t,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[s.jsxs(r,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",m:1},children:[s.jsxs(r,{flexDirection:"column",sx:{display:"flex"},children:[s.jsxs(r,{sx:{color:"text.secondary"},children:["Quotation Ref: #",e==null?void 0:e.ref]}),s.jsxs(r,{sx:{color:"text.secondary"},children:["Quotation Date: ",$(e==null?void 0:e.quotationDate)]})]}),s.jsx(r,{sx:{mr:2},children:s.jsxs(r,{sx:{color:"text.secondary"},children:["Status:"," ",s.jsx(K,{variant:"soft",color:(e==null?void 0:e.status)==="InProcess"&&"warning"||(e==null?void 0:e.status)==="Confirmed"&&"success"||(e==null?void 0:e.status)==="Canceled"&&"error"||"default",children:e==null?void 0:e.status})]})}),((C=e==null?void 0:e.order)==null?void 0:C.id)&&s.jsx(r,{sx:{color:"text.secondary"},className:"print-hide",children:s.jsxs(h,{variant:"contained",size:"small",startIcon:s.jsx(n,{icon:"heroicons-outline:external-link"}),onClick:()=>{const{id:i}=e==null?void 0:e.order;i&&H(i)},children:["Related to Order: #",(w=e==null?void 0:e.order)==null?void 0:w.ref]})})]}),(e==null?void 0:e.notes)&&s.jsxs(r,{children:[s.jsx(I,{}),s.jsx(t,{sx:{typography:"body2"},children:s.jsx(r,{sx:{p:1},children:s.jsxs(t,{sx:{typography:"subtitle2"},children:[s.jsx("div",{children:"Notes:"}),s.jsx(r,{sx:{color:"text.secondary"},children:e==null?void 0:e.notes})]})})})]})]}),N=s.jsxs(s.Fragment,{children:[s.jsx(r,{sx:{pr:3,pl:3,mb:3,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:s.jsx(de,{products:e==null?void 0:e.productToQuotation,defaultRowsPerPage:10})}),A]}),S=s.jsx(t,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:s.jsx(r,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:s.jsx(ce,{tickets:e.tickets})})}),B=s.jsx(t,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:s.jsx(r,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:s.jsx(xe,{reminders:e==null?void 0:e.reminders})})}),c=U(),F=l.useCallback(i=>{c.push(d.dashboard.quotation.edit(i))},[c]),H=l.useCallback(i=>{c.push(d.dashboard.order.details(i))},[c]),T=z(),{mutate:L}=te({mutationFn:i=>Q.post(O.quotation.createOrder,i),onSuccess:async({data:i})=>{W.success("Order Has Been Created!");const{id:V}=e;await T.invalidateQueries({queryKey:["quotations"]}),await T.invalidateQueries({queryKey:["quotation",V]})},onError:i=>{console.log(i)}});return s.jsxs(J,{children:[s.jsx(ae,{links:[{name:"Dashboard",href:d.dashboard.root},{name:"Quotation",href:d.dashboard.quotation.root},{name:"Quotation Details"}],sx:{mb:{xs:3,md:5}}}),s.jsx(P,{container:!0,spacing:3,children:s.jsx(P,{xs:12,md:12,children:s.jsxs(M,{ref:g,children:[s.jsx("style",{jsx:!0,children:`
              .print-title {
                display: none; /* Hide on screen */
              }

              @media print {
                html,
                body {
                  height: initial !important;
                  overflow: initial !important;
                }
                .print-title {
                  display: block; /* Show only when printing */
                }
                .print-hide {
                  display: none; /* Hide on screen */
                }
                .print-padding {
                  padding: 5px;
                }
                .print-top-margin {
                  margin-top: 40px;
                }
              }
            `}),s.jsxs(t,{direction:{md:"column",p:3},className:"print-top-margin print-padding",children:[s.jsx(pe,{sx:{pt:1},title:e==null?void 0:e.name,subheader:`Quotation for Customer : ${(v=e==null?void 0:e.customer)==null?void 0:v.name}`,action:s.jsx(t,{className:"print-hide",spacing:3,direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"},sx:{mb:{xs:3,md:5}},children:s.jsxs(t,{direction:"row",spacing:1,flexGrow:1,sx:{width:1},children:[s.jsx(b,{permission:j.EDIT_QUOTATION,children:(e==null?void 0:e.status)==="Draft"&&s.jsx(u,{title:"Edit",children:s.jsx(f,{onClick:()=>{F(e==null?void 0:e.id)},children:s.jsx(n,{icon:"solar:pen-bold"})})})}),s.jsx(b,{permission:j.CONVERT_QUOTATION_TO_ORDER,children:!((k=e==null?void 0:e.order)!=null&&k.id)&&(e==null?void 0:e.status)==="Draft"&&s.jsx(u,{title:"Convert to Order",children:s.jsx(f,{onClick:()=>{L({quotationId:e==null?void 0:e.id})},children:s.jsx(n,{icon:"solar:restart-circle-bold"})})})}),s.jsx(b,{permission:j.PRINT_QUOTATION,children:s.jsx(u,{title:"Print",children:s.jsx(f,{onClick:()=>{a.setValue("details"),R()},children:s.jsx(n,{icon:"solar:printer-minimalistic-bold"})})})})]})})}),E,s.jsx(I,{sx:{mt:3}}),s.jsxs(me,{value:a.value,className:"print-hide",onChange:a.onChange,sx:{px:3,mb:3,boxShadow:i=>`inset 0 -2px 0 0 ${Y(i.vars.palette.grey["500Channel"],.08)}`},children:[je.map(i=>s.jsx(he,{icon:i.icon,value:i.value,label:i.label},i.value)),a.value==="tickets"&&s.jsx(r,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx(h,{onClick:()=>p.onToggle(),variant:"outlined",startIcon:s.jsx(n,{icon:"mingcute:add-line"}),children:"New Ticket"})}),a.value==="reminders"&&s.jsx(r,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx(h,{onClick:()=>m.onToggle(),variant:"outlined",startIcon:s.jsx(n,{icon:"mingcute:add-line"}),children:"New Reminder"})})]}),a.value==="details"&&N,a.value==="tickets"&&S,a.value==="reminders"&&B]})]})})}),s.jsx(oe,{open:p.value,onClose:p.onFalse,quotation:e}),s.jsx(le,{open:m.value,onClose:m.onFalse,quotation:e})]})}const fe={title:`Quotation details | Dashboard - ${q.site.name}`};function Ps(){const{id:o=""}=re(),e=ee({queryKey:["quotation",o],queryFn:async()=>{const{data:x}=await Q.get(O.quotation.details+o);return x}});return e.isPending||e.isLoading?s.jsx(X,{}):e.isError?s.jsx(se,{route:d.dashboard.order.root}):s.jsxs(s.Fragment,{children:[s.jsx(Z,{children:s.jsxs("title",{children:[" ",fe.title]})}),s.jsx(ue,{currentQuotation:e.data})]})}export{Ps as default};

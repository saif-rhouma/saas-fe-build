import{w as F,bI as X,j as e,aN as K,y as Y,I as w,dB as Z,bK as ee,bL as D,e as M,r as f,dN as z,dO as k,dM as L,bO as se,D as y,S as b,B as l,T as t,o as oe,dE as te,er as re,ed as ne,p as q,aH as ae,dD as ie,es as le,dP as V,eh as de,H as ce,C as xe}from"./index-DxrsDIwY.js";import{u as me,E as he}from"./error-block-Cg6RpAZK.js";import{u as H}from"./useMutation-f5nVFG-s.js";import{C as ue}from"./custom-breadcrumbs-Dd3lNCwD.js";import{u as pe,g as je,r as fe,T as ge,a as be,e as ye}from"./table-selected-action-DOkqk6zb.js";import{T as Pe}from"./table-no-data-DzXXEfeL.js";import{T as Ce,a as ve,b as De,c as Te}from"./table-head-custom-w-4MLJlt.js";import{T as we}from"./table-pagination-custom-BDQuCrzU.js";import{C as Se}from"./confirm-dialog-tDH-oZWO.js";import{T as v}from"./TableCell-CJNt5t20.js";import{z as G,u as Fe,t as Ae,F as Ee}from"./form-provider-DzAJAZLb.js";import{b as P}from"./format-number-DtiborQ_.js";import{b as Re}from"./upload-avatar-4NlzUb0f.js";import"./image-yj0A9F1D.js";import{F as I}from"./fields-Dsl2Pqgx.js";import"./editor-Dqkfe7Lc.js";import{s as Oe}from"./schema-helper-Dd4Kd2WC.js";import{a as U,b as _,D as $}from"./DialogContent-262oYdAn.js";import{D as J}from"./DialogTitle-C_65wNCI.js";import{L as Be}from"./LoadingButton-BPYHnDdd.js";import{T as Ge}from"./TextField-C2VP4uls.js";import{I as Ie}from"./InputAdornment-D2FMqto9.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-ylG2wecL.js";import"./empty-content-Der9frKm.js";import"./TablePagination-Bol3AgoD.js";import"./LastPage-Ct_4tubK.js";import"./Select-eQVewVvt.js";import"./Menu-C6l2dIf8.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-B9Lf9cs-.js";import"./FormControlLabel-DKxiCaQc.js";import"./index-wGJ5bMai.js";import"./countries-DSLisFCy.js";import"./FormHelperText-DMsDqsw2.js";import"./Rating-FZfLYAhV.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-R3UsSTxo.js";import"./FormControl-CC-u2HkW.js";import"./FormLabel-EgLeF9WB.js";import"./RadioGroup-IW7zsT63.js";import"./FormGroup-69w0Ctto.js";import"./Autocomplete-DQd8H5I4.js";import"./Chip-Bq-6ExUD.js";import"./country-select-6tMU1vH_.js";import"./InputLabel-CQVMsmZY.js";import"./DatePicker-CHBP34D3.js";import"./ListItem-Cbx-5wAg.js";import"./MobileDateTimePicker-UWVv-JJA.js";import"./index-BNV8Ha3a.js";import"./CircularProgress-CRSD6Bm4.js";const ke=({row:s,selected:o,onViewRow:m,onDeleteRow:h,onEditRow:d})=>{var p,a;const i=F();F();const r=X(),u=e.jsxs(Ce,{hover:!0,selected:o,children:[e.jsx(v,{children:s==null?void 0:s.id}),e.jsx(v,{children:K(s==null?void 0:s.paymentDate)}),e.jsx(v,{children:(p=s==null?void 0:s.customer)==null?void 0:p.name}),e.jsxs(v,{children:["ORD-",(a=s==null?void 0:s.order)==null?void 0:a.id]}),e.jsx(v,{children:s==null?void 0:s.amount}),e.jsx(v,{children:s==null?void 0:s.paymentType}),e.jsx(v,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(Y,{color:r.open?"inherit":"default",onClick:r.onOpen,children:e.jsx(w,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[u,e.jsx(Z,{open:r.open,anchorEl:r.anchorEl,onClose:r.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(ee,{children:[(s==null?void 0:s.attachments)&&e.jsxs(D,{onClick:()=>{m(),r.onClose()},children:[e.jsx(w,{icon:"solar:cloud-download-bold"}),"Download"]}),e.jsxs(D,{onClick:()=>{m(),r.onClose()},children:[e.jsx(w,{icon:"solar:eye-bold"}),"View"]}),e.jsxs(D,{onClick:()=>{d(),r.onClose()},children:[e.jsx(w,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(D,{onClick:()=>{i.onTrue(),r.onClose()},sx:{color:"error.main"},children:[e.jsx(w,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),e.jsx(Se,{open:i.value,onClose:i.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(M,{variant:"contained",color:"error",onClick:h,children:"Delete"})})]})},Le=G.object({amount:G.number().min(1,{message:"Amount is required!"}),paymentDate:Oe.date({message:{required_error:"Start date is required!"}}),paymentType:G.string().min(1,{message:"Payment Type is required!"}),description:G.string()}),Ne=({payment:s,open:o,onClose:m,handler:h})=>{var E,R,O,B,n;const d=f.useRef(s);//! Upload Logic START
const[i,r]=f.useState(),u=f.useCallback(x=>{const j=x[0];r(()=>j)},[]),p=()=>{r(null)},a=z(),c={headers:{"content-type":"multipart/form-data"}},{mutate:C}=H({mutationFn:x=>k.post(L.files.upload,x,c),onSuccess:async({data:x})=>{const{name:j}=x;if(j){const{current:W}=d;W.attachments=j,await h({id:s.id,payload:W})}return x},onSettled:async()=>{r(null),d.current={},await a.invalidateQueries({queryKey:["payments-images"]})},onError:x=>{console.log(x)}});//! Upload Logic END
f.useEffect(()=>{s&&A(g)},[s]);const g=f.useMemo(()=>({amount:(s==null?void 0:s.amount)||0,paymentType:(s==null?void 0:s.paymentType)||"",paymentDate:(s==null?void 0:s.paymentDate)||se(),description:(s==null?void 0:s.description)||""}),[s]),T=Fe({resolver:Ae(Le),defaultValues:g}),{reset:A,handleSubmit:N,formState:{isSubmitting:Q}}=T,S=N(async x=>{try{if(i){d.current={...x};const j=new FormData;j.append("file",i),j.append("category","Payment"),await C(j)}else await h({id:s.id,payload:x});A()}catch(j){console.log(j)}});return e.jsxs(U,{fullWidth:!0,maxWidth:"lg",open:o,onClose:m,children:[e.jsx(J,{children:"Edit Payment"}),e.jsxs(Ee,{methods:T,onSubmit:S,children:[e.jsxs(_,{children:[e.jsx(y,{}),e.jsxs(b,{spacing:1,sx:{pt:1,pb:1},children:[e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Customer Name:"}),e.jsx(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:(E=s==null?void 0:s.customer)==null?void 0:E.name})]}),e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Order ID:"}),e.jsxs(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:["ORD-",s==null?void 0:s.id]})]}),e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Payment Date:"}),e.jsx(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:K(s==null?void 0:s.paymentDate)})]}),e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Payment Type:"}),e.jsx(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:s==null?void 0:s.paymentType})]}),e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Payment Amount:"}),e.jsx(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:P(s==null?void 0:s.amount)||"-"})]})]}),e.jsx(y,{}),e.jsxs(b,{spacing:1,sx:{pt:1,pb:1},children:[e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Order Amount:"}),e.jsx(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:P((R=s==null?void 0:s.order)==null?void 0:R.totalOrderAmount)||"-"})]}),e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Paid Amount:"}),e.jsx(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:P((O=s==null?void 0:s.order)==null?void 0:O.orderPaymentAmount)||"-"})]})]}),e.jsx(y,{}),e.jsx(b,{spacing:1,sx:{pt:2,pb:2},children:e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"subtitle1",sx:{flexGrow:1},children:"Balance:"}),e.jsx(t,{component:"span",variant:"subtitle1",children:P(((B=s==null?void 0:s.order)==null?void 0:B.totalOrderAmount)-((n=s==null?void 0:s.order)==null?void 0:n.orderPaymentAmount))})]})}),e.jsx(y,{}),e.jsxs(b,{spacing:2,sx:{pt:4,pb:1},children:[e.jsxs(l,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(3, 1fr)",lg:"repeat(3, 1fr)"},children:[e.jsx(I.Text,{type:"number",name:"amount",label:"Paid Amount",sx:{flexGrow:1}}),e.jsxs(I.Select,{name:"paymentType",label:"Payment Type",children:[e.jsx(D,{value:"Cash",children:"Cash"}),e.jsx(D,{value:"Transfer",children:"Transfer"}),e.jsx(D,{value:"Card",children:"Card"})]}),e.jsx(I.DatePicker,{name:"paymentDate",label:"Date",sx:{flexGrow:1}})]}),e.jsxs(l,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[e.jsxs(b,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Notes / Remarks"}),e.jsx(I.Text,{name:"description",multiline:!0,rows:3})]}),e.jsxs(b,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Attachments"}),e.jsx(Re,{value:i,onDrop:u,onDelete:p})]})]})]})]}),e.jsxs($,{children:[e.jsx(Be,{type:"submit",variant:"contained",children:s?"Save Changes":"Save"}),e.jsx(M,{color:"inherit",variant:"outlined",onClick:m,children:"Cancel"})]})]})]})},qe=({payment:s,open:o,onClose:m})=>{var h,d,i,r,u;return e.jsxs(U,{fullWidth:!0,maxWidth:"md",open:o,onClose:m,children:[e.jsx(J,{children:"Payment Details"}),e.jsxs(_,{children:[e.jsx(y,{}),e.jsxs(b,{spacing:1,sx:{pt:1,pb:1},children:[e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Customer Name:"}),e.jsx(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:(h=s==null?void 0:s.customer)==null?void 0:h.name})]}),e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Order ID:"}),e.jsxs(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:["ORD-",s==null?void 0:s.id]})]}),e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Payment Date:"}),e.jsx(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:K(s==null?void 0:s.paymentDate)})]}),e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Payment Type:"}),e.jsx(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:s==null?void 0:s.paymentType})]}),e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Payment Amount:"}),e.jsx(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:P(s==null?void 0:s.amount)||"-"})]})]}),e.jsx(y,{}),e.jsxs(b,{spacing:1,sx:{pt:1,pb:1},children:[e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Order Amount:"}),e.jsx(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:P((d=s==null?void 0:s.order)==null?void 0:d.totalOrderAmount)||"-"})]}),e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Paid Amount:"}),e.jsx(t,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:P((i=s==null?void 0:s.order)==null?void 0:i.orderPaymentAmount)||"-"})]})]}),e.jsx(y,{}),e.jsx(b,{spacing:1,sx:{pt:2,pb:2},children:e.jsxs(l,{display:"flex",children:[e.jsx(t,{component:"span",variant:"subtitle1",sx:{flexGrow:1},children:"Balance:"}),e.jsx(t,{component:"span",variant:"subtitle1",children:P(((r=s==null?void 0:s.order)==null?void 0:r.totalOrderAmount)-((u=s==null?void 0:s.order)==null?void 0:u.orderPaymentAmount))})]})}),e.jsx(y,{})]}),e.jsx($,{children:e.jsx(M,{color:"inherit",variant:"outlined",onClick:m,children:"Close"})})]})};function He({filters:s,onResetPage:o,options:m}){const h=f.useCallback(d=>{o(),s.setState({name:d.target.value})},[s,o]);return e.jsx(b,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(Ge,{sx:{width:420},value:s.state.name,onChange:h,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(Ie,{position:"start",children:e.jsx(w,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}const Ke=[{id:"paymentId",label:"#",width:88},{id:"date",label:"Date",width:220},{id:"customerName",label:"Customer Name",width:220},{id:"orderId",label:"Order No",width:120},{id:"paidAmount",label:"Paid Amount",width:120},{id:"paymentType",label:"Payment Type",width:120},{id:"",width:88}],Me=({payments:s})=>{const o=pe({defaultOrderBy:"orderNumber"}),[m,h]=f.useState(),d=oe(),i=F(),r=F(),u=F(),[p,a]=f.useState(s),c=te({name:"",status:"all",startDate:null,endDate:null});f.useEffect(()=>{a(s)},[s]);const C=re(c.state.startDate,c.state.endDate),g=We({inputData:p,comparator:je(o.order,o.orderBy),filters:c.state,dateError:C}),T=fe(g,o.page,o.rowsPerPage),A=!!c.state.name||c.state.status!=="all"||!!c.state.startDate&&!!c.state.endDate,N=!g.length&&A||!g.length,Q=f.useCallback(n=>{E(n);const x=p.filter(j=>j.id!==n);a(x),o.onUpdatePageDeleteRow(T.length)},[T.length,o,p]),S=z(),{mutate:E}=H({mutationFn:n=>{k.delete(L.payments.delete+n)},onSuccess:()=>{V.success("Delete success!"),u.onFalse()},onSettled:async()=>{await S.invalidateQueries({queryKey:["payments"]}),u.onFalse()},onError:n=>{console.log(n)}}),R=f.useCallback(n=>{h(n),i.onToggle()},[d]),O=f.useCallback(n=>{h(n),r.onToggle()},[T.length,o,p]),{mutate:B}=H({mutationFn:({id:n,payload:x})=>k.patch(L.payments.edit+n,x),onSuccess:async()=>{V.success("New Payment Has Been Modified!")},onSettled:async()=>{await S.invalidateQueries({queryKey:["payments"]}),await S.invalidateQueries({queryKey:["orders"]}),r.onFalse()},onError:n=>{console.log(n)}});return e.jsxs(e.Fragment,{children:[e.jsx(ne,{maxWidth:"xl",children:e.jsxs(b,{spacing:3,children:[e.jsx(ue,{links:[{name:"Dashboard",href:q.dashboard.root},{name:"Payments",href:q.dashboard.payments.root}]}),e.jsxs(ae,{children:[e.jsx(He,{filters:c,onResetPage:o.onResetPage,dateError:C}),e.jsxs(l,{sx:{position:"relative"},children:[e.jsx(ge,{dense:o.dense,numSelected:o.selected.length,rowCount:g.length}),e.jsx(ie,{sx:{minHeight:444},children:e.jsxs(ve,{size:o.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(De,{order:o.order,orderBy:o.orderBy,headLabel:Ke,rowCount:g.length}),e.jsxs(Te,{children:[g.slice(o.page*o.rowsPerPage,o.page*o.rowsPerPage+o.rowsPerPage).map(n=>e.jsx(ke,{row:n,selected:o.selected.includes(n.id),onEditRow:()=>O(n),onDeleteRow:()=>Q(n.id),onViewRow:()=>R(n)},n.id)),e.jsx(be,{height:o.dense?56:76,emptyRows:ye(o.page,o.rowsPerPage,g.length)}),e.jsx(Pe,{notFound:N})]})]})})]}),e.jsx(we,{page:o.page,dense:o.dense,count:g.length,rowsPerPage:o.rowsPerPage,onPageChange:o.onChangePage,onChangeDense:o.onChangeDense,onRowsPerPageChange:o.onChangeRowsPerPage})]})]})}),e.jsx(qe,{payment:m,open:i.value,onClose:i.onFalse}),e.jsx(Ne,{payment:m,open:r.value,onClose:r.onFalse,handler:B})]})},Qe=Me;function We({inputData:s,comparator:o,filters:m,dateError:h}){const{status:d,name:i,startDate:r,endDate:u}=m,p=s.map((a,c)=>[a,c]);return p.sort((a,c)=>{const C=o(a[0],c[0]);return C!==0?C:a[1]-c[1]}),s=p.map(a=>a[0]),i&&(s=s.filter(a=>a.orderNumber.toLowerCase().indexOf(i.toLowerCase())!==-1||a.customer.name.toLowerCase().indexOf(i.toLowerCase())!==-1||a.customer.email.toLowerCase().indexOf(i.toLowerCase())!==-1)),d!=="all"&&(s=s.filter(a=>a.status===d)),h||r&&u&&(s=s.filter(a=>le(a.createdAt,r,u))),s}const Ve={title:`Payments | Dashboard - ${xe.site.name}`};function zs(){const s=me({queryKey:["payments"],queryFn:async()=>{const{data:o}=await k.get(L.payments.list);return o}});return s.isPending||s.isLoading?e.jsx(de,{}):s.isError?e.jsx(he,{route:q.dashboard.payments.root}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{children:e.jsxs("title",{children:[" ",Ve.title]})}),e.jsx(Qe,{payments:s.data})]})}export{zs as default};

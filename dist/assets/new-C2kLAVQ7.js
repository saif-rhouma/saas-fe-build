import{dn as v,Y as D,r,W as Pe,ab as M,dp as we,dq as f,dm as C,dr as Q,p as b,j as t,cY as R,S as d,B as a,I as B,C as K,v as De,ea as be,e8 as Fe,e as F,cV as q,dQ as qe,dU as Ie,H as Se}from"./index-88qAwG8P.js";import{u as I,E as Te}from"./error-block-BTff90qR.js";import{C as ke}from"./custom-breadcrumbs-x7W5GMPl.js";import{u as L}from"./useMutation-Bjm4Nnvr.js";import{b as S}from"./format-number-B8FPsWIV.js";import{u as Ye}from"./use-table-BYPgfP9k.js";import{C as Ve,O as Oe,a as Ee,I as Ae}from"./order-discount-product-dialog-DO9bIDGV.js";import{P as Me}from"./product-Item-button-Ci8ZBUz0.js";import{C as Qe}from"./component-pagination-custom-QKi9Y21H.js";import{O as Re}from"./order-product-table-01y8OgeE.js";import{O as Be}from"./order-customer-create-dialog-Dyn7Y3RP.js";import{T as Le}from"./TextField-CQpihH7F.js";import{I as Ne}from"./InputAdornment-Bg-m_z4_.js";import{F as ve}from"./FormControl-BXGEHd-f.js";import{F as Ke}from"./FormHelperText-DA7jizKd.js";import{D as N}from"./DatePicker-C1aTSbY2.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./DialogContent-F9o-_CVT.js";import"./DialogTitle-CvyYkdF0.js";import"./Autocomplete-Du1dNHWZ.js";import"./Select-DFC-Q2QB.js";import"./Menu-BDUaDfAf.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-DD8qHu7J.js";import"./Chip-yDeOg34u.js";import"./form-provider-DSldc_Gv.js";import"./Rating-4WKJ8FeG.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-DKQnkQYm.js";import"./index-DZ-uLlaR.js";import"./Slider-Cdch2KEI.js";import"./FormLabel-Ck5_RgM9.js";import"./RadioGroup-DZvtDFL6.js";import"./FormGroup-B0QesIKW.js";import"./FormControlLabel-ts_MkIWE.js";import"./utils-BDEKF9xP.js";import"./index-CySZofTa.js";import"./countries-DSLisFCy.js";import"./country-select-B-6neUw6.js";import"./InputLabel-B0kOUcWA.js";import"./Checkbox-Cpc8f1GH.js";import"./upload-avatar-CSIBlxGF.js";import"./image-CkDsegDa.js";import"./MobileDateTimePicker-pEp8pQrB.js";import"./Tabs-gBKEx7yr.js";import"./KeyboardArrowRight-fE7_2VJ7.js";import"./TablePagination-CrnuwEMO.js";import"./LastPage-B6xWbdc0.js";import"./TableCell-Cl8UZGxf.js";import"./table-head-custom-g2OgtrHv.js";import"./incrementer-button-BYzmwBWa.js";import"./schema-helper-_nyXaTEe.js";import"./LoadingButton-CM47tPre.js";import"./CircularProgress-DIm-Ts9z.js";import"./ListItem-Bt-kWpW8.js";function $e({products:c,customers:p,taxPercentage:l}){const o=Ye({defaultRowsPerPage:6}),{t:n}=v("quotations"),j=D(),y=D(),P=D(),T=D(),[$,H]=r.useState(""),[W,G]=r.useState(""),J=Pe(),[U,Ge]=r.useState(),[x,z]=r.useState(0),[X,Z]=r.useState(0),[k,h]=r.useState(!1),[_,ee]=r.useState(),[w,te]=r.useState("Customer"),[Y,se]=r.useState(M(new Date)),[V,re]=r.useState(M(new Date).add(1,"day")),[i,u]=r.useState([]),[O,E]=r.useState(c),A=we(),oe=(e,s)=>{Z(s),ee(e),P.onToggle()},ae=e=>{z(e),y.onFalse()},ne=(e,s)=>{u(m=>(m[e].price=s,[...m])),P.onFalse()},{mutate:ie}=L({mutationFn:e=>f.post(C.quotation.create,e),onSuccess:async()=>{Q.success(n("createView.messages.createSuccess")),await A.invalidateQueries({queryKey:["quotations"]})},onSettled:async()=>{J.push(b.dashboard.quotation.root)},onError:e=>{console.error(e)}}),ce=r.useCallback(e=>{te(e),h(!e)},[]),le=r.useCallback(e=>{u(s=>{const m=s.findIndex(ye=>ye.id===e.id);return m>=0?s[m].quantity+=1:(e.quantity=1,e.discount=0,s.push(e)),[...s]})},[]),de=r.useCallback(e=>{const s=e.target.value;s&&E(c.filter(m=>m.name.toLowerCase().indexOf(s)!==-1)),(s==null||s==="")&&E(c)},[]),ue=r.useCallback(e=>{u(s=>(s[e].quantity-=1,s[e].quantity===0&&s.splice(e,1),[...s]))},[i]),me=r.useCallback(e=>{u(s=>(s[e].discount>0&&(s[e].discount-=1),[...s]))},[]),pe=r.useCallback(e=>{u(s=>(s[e].discount<100&&(s[e].discount+=1),[...s]))},[]),xe=r.useCallback(e=>{u(s=>(s[e].quantity+=1,[...s]))},[i]),he=r.useCallback(e=>{u(s=>(s.splice(e,1),[...s]))},[i]),g=r.useCallback(()=>i.reduce((e,s)=>e+s.price*s.quantity,0),[i]);r.useCallback(()=>i.reduce((e,s)=>e+s.price*(s.discount/100)*s.quantity,0),[i]);const{mutate:ge}=L({mutationFn:e=>f.post(C.customers.create,e),onSuccess:async()=>{Q.success(n("createView.messages.editSuccess")),await A.invalidateQueries({queryKey:["customers"]})},onSettled:async()=>{j.onFalse()},onError:e=>{console.log(e)}}),fe=t.jsx(R,{children:t.jsxs(d,{children:[t.jsx(a,{sx:{p:3},children:t.jsx(Le,{color:"success",fullWidth:!0,maxWidth:"xs",placeholder:n("createView.productsList.searchPlaceholder"),InputProps:{startAdornment:t.jsx(Ne,{position:"start",children:t.jsx(B,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},onChange:de})}),t.jsx(a,{sx:{pl:3,pr:3},gap:1,display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:O.slice(o.page*o.rowsPerPage,o.page*o.rowsPerPage+o.rowsPerPage).map(e=>t.jsx(Me,{payload:e,handleClick:le,productName:e==null?void 0:e.name,image:K.site.serverFileHost+(e==null?void 0:e.image)},e==null?void 0:e.id))}),t.jsx(Qe,{page:o.page,count:O.length,rowsPerPage:6,defaultRowsPerPage:6,onPageChange:o.onChangePage,onRowsPerPageChange:o.onChangeRowsPerPage})]})}),Ce=t.jsxs(d,{spacing:2,alignItems:"flex-end",sx:{p:2,textAlign:"right",typography:"body2"},children:[t.jsxs(d,{direction:"row",children:[t.jsx(a,{sx:{color:"text.secondary"},children:n("createView.createForm.extra.subTotal")}),t.jsx(a,{sx:{width:160,typography:"subtitle2"},children:S(g())||"-"})]}),t.jsxs(d,{direction:"row",alignItems:"center",children:[t.jsx(a,{sx:{color:"text.secondary"},children:n("createView.createForm.extra.discount")}),t.jsx(a,{sx:{width:160},children:t.jsx(a,{sx:{pl:4,mr:-.5},children:t.jsxs(d,{onClick:()=>{y.onToggle()},sx:{cursor:"pointer",p:.5,color:"error.main",borderRadius:1,typography:"subtitle2",border:e=>`solid 1px ${De(e.vars.palette.grey["500Channel"],.2)}`},children:[x,"%"]})})})]}),t.jsxs(d,{direction:"row",children:[t.jsxs(a,{sx:{color:"text.secondary"},children:[n("createView.createForm.extra.tax")," (",l||"0","%)"]}),t.jsx(a,{sx:{width:160},children:l?S(be(g()-g()*(x/100),l)):"-"})]}),t.jsxs(d,{direction:"row",sx:{typography:"subtitle1"},children:[t.jsxs("div",{children:[n("createView.createForm.extra.grossTotal"),":"]}),t.jsx(a,{sx:{width:160},children:S(Fe(g()-g()*(x/100),l))||"-"})]})]}),je=t.jsx(R,{children:t.jsxs(d,{spacing:2,sx:{p:3},children:[t.jsxs(a,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[t.jsxs(ve,{sx:{m:1,minWidth:120},error:k&&!w,children:[t.jsx(Ve,{customers:p,onChange:ce}),k&&t.jsx(Ke,{error:!0,children:"Customer is required!"})]}),t.jsx(a,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:t.jsx(F,{variant:"contained",startIcon:t.jsx(B,{icon:"mingcute:add-line"}),onClick:()=>j.onToggle(),children:n("createView.createForm.buttons.addCustomer")})}),t.jsx(N,{label:n("createView.createForm.fields.date.label"),sx:{mt:2},format:"DD/MM/YYYY",value:Y,onChange:e=>{se(e)}}),t.jsx(N,{label:n("createView.createForm.fields.expiry.label"),format:"DD/MM/YYYY",sx:{mt:2},value:V,onChange:e=>{re(e)}})]}),t.jsx(Re,{products:i,onDecrease:ue,onIncrease:xe,onDecreaseDiscount:me,onIncreaseDiscount:pe,handleDiscountDialog:oe,removeItem:he}),t.jsxs(a,{display:"flex",flexDirection:"column",alignItems:"flex-end",justifyContent:"center",children:[Ce,t.jsxs(a,{display:"flex",gap:2,height:50,children:[t.jsx(F,{variant:"contained",onClick:()=>{if(isNaN(parseInt(w))){h(!0);return}if(h(!1),!i.length){H("Something went wrong. Product(s) are required!"),G("You need to add at least one product to this quotation. Please select a product from the list on the right."),T.onToggle();return}if(!isNaN(parseInt(w))&&i.length){h(!1);const e={discount:parseInt(x,10),name:U,quotationDate:Y.format("YYYY-MM-DD"),expiredDate:V.format("YYYY-MM-DD"),products:i.map(s=>({id:s.id,snapshotProductPrice:s.price,quantity:s.quantity})),customer:w};ie(e)}},children:n("createView.createForm.buttons.saveAndContinue")}),t.jsx(F,{variant:"outlined",onClick:()=>u([]),children:n("createView.createForm.buttons.clearAll")})]})]})]})});return t.jsxs(q,{container:!0,spacing:3,children:[t.jsx(q,{xs:12,md:3,children:t.jsx(d,{children:fe})}),t.jsx(q,{xs:12,md:9,children:t.jsx(d,{children:je})}),t.jsx(Be,{open:j.value,onClose:j.onFalse,handler:ge}),t.jsx(Oe,{discount:x,open:y.value,onClose:y.onFalse,handler:ae}),t.jsx(Ee,{product:_,discount:X,open:P.value,onClose:P.onFalse,handler:ne}),t.jsx(Ae,{dialog:T,title:$,contentText:W})]})}function He({products:c,customers:p,taxPercentage:l}){const{t:o}=v("quotations");return t.jsxs(qe,{children:[t.jsx(ke,{heading:o("createView.pageTitle"),links:[{name:`${o("createView.breadCrumbsPageRootTitle")}`,href:b.dashboard.root},{name:`${o("createView.breadCrumbsParentPageTitle")}`,href:b.dashboard.quotation.root},{name:`${o("createView.breadCrumbsPageTitle")}`}],sx:{mb:{xs:3,md:5}}}),t.jsx($e,{products:c,customers:p,taxPercentage:l})]})}const We={title:`Create a new Quotation | Dashboard - ${K.site.name}`};function Zt(){const c=I({queryKey:["products"],queryFn:async()=>(await f.get(C.products.list)).data}),p=I({queryKey:["customers"],queryFn:async()=>(await f.get(C.customers.list)).data}),l=I({queryKey:["account-application"],queryFn:async()=>{const{data:o}=await f.get(C.auth.application);return o}});return l.isLoading||c.isLoading||p.isLoading?t.jsx(Ie,{}):l.isError||c.isError||c.isError?t.jsx(Te,{route:b.dashboard.order.root}):t.jsxs(t.Fragment,{children:[t.jsx(Se,{children:t.jsxs("title",{children:[" ",We.title]})}),t.jsx(He,{products:c.data,customers:p.data,taxPercentage:l.data.taxPercentage})]})}export{Zt as default};

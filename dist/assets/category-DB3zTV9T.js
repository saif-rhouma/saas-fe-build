import{o as w,bO as G,j as e,S as v,A as U,C as L,B as Q,w as K,I as b,dw as J,bQ as V,bR as q,e as H,r as h,dJ as P,dH as D,D as M,x as _,T as $,dz as X,eo as Y,dI as Z,e8 as ee,G as I,p as k,aD as te,cM as se,dy as ae,ep as oe,dK as A,ec as ne,H as re}from"./index-yGbCRgTb.js";import{u as ie,E as le}from"./error-block-DTJA4qog.js";import{u as T}from"./useMutation-By1q-eS7.js";import{C as ce}from"./custom-breadcrumbs-BVoeLH7h.js";import{g as de,r as me,T as pe,a as ue,e as he}from"./table-selected-action-ouhBymae.js";import{u as ge}from"./use-table-CKTXv-Z5.js";import{T as xe}from"./table-no-data-CAqPvp_P.js";import{T as fe,a as je,b as Ce,c as be}from"./table-head-custom-Dmu61VxH.js";import{T as ye}from"./table-pagination-custom-D_SwmGih.js";import{C as Pe}from"./confirm-dialog-Ko2N1QmH.js";import{T as y}from"./TableCell-kQtrcvwO.js";import{T as De}from"./TextField-HI4be0gE.js";import{I as Se}from"./InputAdornment-CcIxSkvC.js";import{z as B,u as we,t as Te,a as ve,F as O}from"./form-provider-DYU4Aza6.js";import{b as Fe}from"./upload-avatar-C2G_2g_c.js";import"./image-DcD9e3NU.js";import"./editor-DVBR6pSL.js";import{a as Ee,b as Re,D as Ie}from"./DialogContent-DMTZhSCC.js";import{D as Ae}from"./DialogTitle-Dtm0x3W5.js";import{L as Be}from"./LoadingButton-DkWrtn4w.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-CLReM-9f.js";import"./empty-content-DuekPASb.js";import"./TablePagination--mxkDLnZ.js";import"./KeyboardArrowRight-gA8WWooR.js";import"./LastPage-Bpf9jdMv.js";import"./Select-q90WBvXR.js";import"./Menu-BP741PyP.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-DgymrakP.js";import"./FormControlLabel-C9PyVvR2.js";import"./FormControl-BZpoYGsF.js";import"./InputLabel-DnqBfGRt.js";import"./FormLabel-CZqAmIUK.js";import"./FormHelperText-Dnev79N5.js";import"./Rating-3onsWGCC.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-CzzVUG04.js";import"./RadioGroup-81h_beeC.js";import"./FormGroup-ClqLJ3mg.js";import"./index-R0SYIoas.js";import"./countries-DSLisFCy.js";import"./Autocomplete-C25PC4l8.js";import"./Chip-Di1iaus5.js";import"./country-select-CxHEhT0K.js";import"./DatePicker-5fPzc3RP.js";import"./ListItem-CzWKnPSR.js";import"./MobileDateTimePicker-BclKweyT.js";import"./Tabs-CyyRymLB.js";import"./format-number-CldpmeB4.js";import"./index-CCt0SICN.js";import"./CircularProgress-B5oTQZ22.js";const Le=({row:t,index:i,selected:l,onDeleteRow:n,onEditRow:u})=>{const c=w(),s=G(),m=e.jsxs(fe,{hover:!0,selected:l,children:[e.jsx(y,{children:i||(t==null?void 0:t.id)}),e.jsx(y,{children:e.jsxs(v,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(U,{alt:t==null?void 0:t.name,src:L.site.serverFileHost+((t==null?void 0:t.image)||L.site.defaultImgPlaceHolder)}),e.jsx(Q,{component:"span",children:t==null?void 0:t.name})]})}),e.jsx(y,{children:t.description}),e.jsx(y,{children:t.products.length}),e.jsx(y,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(K,{color:s.open?"inherit":"default",onClick:s.onOpen,children:e.jsx(b,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[m,e.jsxs(J,{open:s.open,anchorEl:s.anchorEl,onClose:s.onClose,slotProps:{arrow:{placement:"right-top"}},children:[e.jsx(V,{children:e.jsxs(q,{onClick:()=>{u(t.id),s.onClose()},children:[e.jsx(b,{icon:"solar:pen-bold"}),"Edit"]})}),e.jsxs(q,{onClick:()=>{c.onTrue(),s.onClose()},sx:{color:"error.main"},children:[e.jsx(b,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]}),e.jsx(Pe,{open:c.value,onClose:c.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(H,{variant:"contained",color:"error",onClick:n,children:"Delete"})})]})};function ke({filters:t,onResetPage:i,options:l}){const n=h.useCallback(u=>{i(),t.setState({name:u.target.value})},[t,i]);return e.jsx(v,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(De,{sx:{width:420},value:t.state.name,onChange:n,placeholder:"Search by Category Name",InputProps:{startAdornment:e.jsx(Se,{position:"start",children:e.jsx(b,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}const He=B.object({name:B.string().min(1,{message:"Name is required!"}),description:B.string()}),z=({productCategory:t,open:i,onClose:l,handler:n})=>{const u={name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||"",image:t==null?void 0:t.image},c=h.useRef(t),[s,m]=h.useState(),x=h.useCallback(p=>{const r=p[0];m(()=>r)},[]),o=()=>{m(null)},g={headers:{"content-type":"multipart/form-data"}},{mutate:d}=T({mutationFn:p=>P.post(D.files.upload,p,g),onSuccess:async({data:p})=>{const{name:r}=p;if(r){const{current:a}=c;a.image=r,t?await n({id:t.id,payload:a}):await n(a)}return p},onSettled:async()=>{m(null),c.current={}},onError:p=>{console.log(p)}});h.useEffect(()=>{t&&C(u)},[t]);const[j,F]=h.useState(""),S=we({resolver:Te(He),defaultValues:u}),{reset:C,handleSubmit:E,formState:{isSubmitting:N}}=S,R=E(async p=>{try{const r={...p};if(s){c.current={...r};const a=new FormData;a.append("file",s),a.append("category","Category"),await d(a)}else t?await n({id:t.id,payload:r}):await n(r);C()}catch(r){console.log(r),F(r instanceof Error?r.message:r)}});return e.jsxs(Ee,{fullWidth:!0,open:i,onClose:l,children:[e.jsx(Ae,{children:"Add Category"}),e.jsx(M,{}),!!j&&e.jsx(_,{severity:"error",sx:{mb:3},children:j}),e.jsxs(ve,{methods:S,onSubmit:R,children:[e.jsxs(Re,{children:[e.jsxs(v,{spacing:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(1, 1fr)",lg:"repeat(1, 1fr)"},children:[e.jsx(O.Text,{fullWidth:!0,label:"Category Name",name:"name",sx:{mt:2}}),e.jsx(O.Text,{label:"Description",name:"description",multiline:!0,rows:3,inputProps:{maxLength:250},sx:{mt:2}})]}),e.jsxs(v,{spacing:1.5,sx:{mt:2},children:[e.jsx($,{variant:"subtitle2",children:"Attachments"}),e.jsx(Fe,{value:s,onDrop:x,onDelete:o})]})]}),e.jsx(M,{sx:{pt:1,mt:1}}),e.jsxs(Ie,{children:[e.jsx(Be,{type:"submit",variant:"contained",children:t?"Save Changes":"Save"}),e.jsx(H,{color:"inherit",variant:"outlined",onClick:l,children:"Cancel"})]})]})]})},Ne=({category:t,open:i,onClose:l,handler:n})=>e.jsx(z,{productCategory:t,open:i,onClose:l,handler:n}),qe=[{id:"id",label:"No.",width:80},{id:"name",label:"Category Name",width:300},{id:"desc",label:"Description"},{id:"status",label:"Product Count",width:200},{id:"",width:88}],Me=({categories:t})=>{const i=w(),l=w(),n=w(),[u,c]=h.useState(),s=ge({defaultOrderBy:"planId"}),[m,x]=h.useState(t),o=X({name:"",status:"all",startDate:null,endDate:null});h.useEffect(()=>{x(t)},[t]);const g=Y(o.state.startDate,o.state.endDate),d=Oe({inputData:m,comparator:de(s.order,s.orderBy),filters:o.state,dateError:g}),j=me(d,s.page,s.rowsPerPage),F=!!o.state.name||o.state.status!=="all"||!!o.state.startDate&&!!o.state.endDate,S=!d.length&&F||!d.length,C=Z(),{mutate:E}=T({mutationFn:a=>P.delete(D.productCategories.delete+a),onSuccess:async a=>{const f=m.filter(W=>W.id!==a);A.success("Delete success!"),x(f),s.onUpdatePageDeleteRow(j.length),await C.invalidateQueries({queryKey:["product-categories"]})},onError:a=>{console.log(a)}}),N=h.useCallback(a=>{E(a)},[j.length,s,m]),R=h.useCallback(a=>{c(a),n.onToggle()},[j.length,s,m]),{mutate:p}=T({mutationFn:a=>P.post(D.productCategories.create,a),onSuccess:async()=>{A.success("New Category Has Been Created!"),await C.invalidateQueries({queryKey:["product-categories"]})},onSettled:async()=>{l.onFalse()},onError:a=>{console.log(a)}}),{mutate:r}=T({mutationFn:({id:a,payload:f})=>P.patch(D.productCategories.edit+a,f),onSuccess:async()=>{A.success("Category Has Been Modified!"),await C.invalidateQueries({queryKey:["product-categories"]})},onSettled:async()=>{n.onFalse()},onError:a=>{console.log(a)}});return e.jsxs(e.Fragment,{children:[e.jsx(ee,{maxWidth:"xl",children:e.jsxs(I,{container:!0,spacing:3,children:[e.jsx(I,{xs:12,md:12,children:e.jsx(ce,{links:[{name:"Dashboard",href:k.dashboard.root},{name:"Product",href:k.dashboard.plan.root},{name:"Categories List"}],action:e.jsx(H,{onClick:()=>l.onToggle(),variant:"contained",startIcon:e.jsx(b,{icon:"mingcute:add-line"}),children:"Add New Category"})})}),e.jsx(I,{xs:12,md:12,children:e.jsxs(te,{children:[e.jsx(ke,{filters:o,onResetPage:s.onResetPage,dateError:g}),e.jsxs(Q,{sx:{position:"relative"},children:[e.jsx(pe,{dense:s.dense,numSelected:s.selected.length,rowCount:d.length,onSelectAllRows:a=>s.onSelectAllRows(a,d.map(f=>f.id)),action:e.jsx(se,{title:"Delete",children:e.jsx(K,{color:"primary",onClick:i.onTrue,children:e.jsx(b,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(ae,{sx:{minHeight:444},children:e.jsxs(je,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Ce,{order:s.order,orderBy:s.orderBy,headLabel:qe,rowCount:d.length,numSelected:s.selected.length,onSort:s.onSort}),e.jsxs(be,{children:[d.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map((a,f)=>e.jsx(Le,{row:a,index:s.page*s.rowsPerPage+f+1,selected:s.selected.includes(a.id),onEditRow:()=>R(a),onDeleteRow:()=>N(a.id)},a.id)),e.jsx(ue,{height:s.dense?56:76,emptyRows:he(s.page,s.rowsPerPage,d.length)}),e.jsx(xe,{notFound:S})]})]})})]}),e.jsx(ye,{page:s.page,dense:s.dense,count:d.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})]})}),e.jsx(z,{handler:p,open:l.value,onClose:l.onFalse}),e.jsx(Ne,{handler:r,open:n.value,onClose:n.onFalse,category:u})]})};function Oe({inputData:t,comparator:i,filters:l,dateError:n}){const{status:u,name:c,startDate:s,endDate:m}=l,x=t.map((o,g)=>[o,g]);return x.sort((o,g)=>{const d=i(o[0],g[0]);return d!==0?d:o[1]-g[1]}),t=x.map(o=>o[0]),c&&(t=t.filter(o=>o.id.toString().toLowerCase().indexOf(c.toLowerCase())!==-1||o.name.toLowerCase().indexOf(c.toLowerCase())!==-1||o.description.toLowerCase().indexOf(c.toLowerCase())!==-1)),u!=="all"&&(t=t.filter(o=>o.status===u)),n||s&&m&&(t=t.filter(o=>oe(o.createdAt,s,m))),t}const Qe={title:`Product Addons | Dashboard - ${L.site.name}`};function zt(){const t=ie({queryKey:["product-categories"],queryFn:async()=>{const{data:i}=await P.get(D.productCategories.list);return i}});return t.isPending||t.isLoading?e.jsx(ne,{}):t.isError?e.jsx(le,{route:k.dashboard.product.root}):e.jsxs(e.Fragment,{children:[e.jsx(re,{children:e.jsxs("title",{children:[" ",Qe.title]})}),e.jsx(Me,{categories:t.data})]})}export{zt as default};

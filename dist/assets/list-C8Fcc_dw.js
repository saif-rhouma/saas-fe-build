import{i as J,e7 as re,aP as fe,j as e,L as ge,S as g,A as le,I as x,B as r,aT as oe,d0 as ce,aL as ye,c9 as k,C as xe,e8 as me,d7 as he,e9 as b,l as P,cQ as Ce,bR as Te,db as ve,aR as we,e3 as I,aS as R,e as H,r as m,dp as L,dm as F,dn as ue,dq as W,e1 as Pe,ea as Se,am as N,eb as De,g as pe,p as Q,cY as je,v as Z,dT as ae,ec as ke,de as Qe,e2 as Ie,dP as Ae,cV as q,R as Re,dd as Ee,ed as $e,H as Oe}from"./index-KK-mXlr9.js";import{u as be,E as ne}from"./error-block-B2eVBtgw.js";import{u as z}from"./useMutation-BLbhE-7U.js";import{C as Ve}from"./custom-breadcrumbs-DxZer26t.js";import{P as A}from"./permission-access-controller-Dezxnjzz.js";import{g as Le,r as Fe,e as Be}from"./utils-MBUcMVfY.js";import{u as Ne}from"./use-table-B6oWWgzy.js";import{T as He}from"./table-no-data-Dy6eTwfo.js";import{T as Me}from"./table-empty-rows-1jmvOb91.js";import{T as de,a as _e,b as Ke,c as Ue}from"./table-head-custom-DO9V045A.js";import{T as Ge}from"./table-selected-action-Dpba9ipe.js";import{T as We}from"./table-pagination-custom-CnZ-ZQmD.js";import{b as M}from"./format-number-BAsKNL1v.js";import{C as ze}from"./confirm-dialog-BOguUpkK.js";import{T as D}from"./TableCell-BoMvUy-h.js";import{A as Je}from"./AvatarGroup-YLmu1og-.js";import{l as Ye}from"./index-CdIWY4PN.js";import{P as Xe}from"./react-pdf.browser-DLZ7fuBr.js";import{u as Ze}from"./use-tabs-oJQJsRmI.js";import{P as qe,a as es,Q as ss,b as ts}from"./print-quotation-details-template-CcDC-q9m.js";import{Q as as}from"./quotation-product-table-Ccw66nsx.js";import{T as ns}from"./tickets-create-dialog-DFPGNmv6.js";import{R as rs}from"./reminder-create-dialog-DdIgisj4.js";import{C as is}from"./CircularProgress-DFKDx2V0.js";import{T as ls,a as os}from"./Tabs-DOkZQpLE.js";import{C as ds}from"./CardHeader-BeQF9g9f.js";import{T as cs}from"./TextField-Cv5b071d.js";import{I as xs}from"./InputAdornment-CkFhR2Z0.js";import{S as ms}from"./Select-DUjNe6cS.js";import{F as hs,a as ee,c as se}from"./filters-result-CvaJNQbZ.js";import{C as te}from"./Chip-J5thaA7V.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-wJX0dBLP.js";import"./Checkbox-DQkBQbxP.js";import"./TablePagination-BrNWYPHq.js";import"./KeyboardArrowRight-DtI30r1M.js";import"./LastPage-B2fmRZ1z.js";import"./InputBase-DeC6BCyF.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-CMZe9nOT.js";import"./DialogContent-DEOZCbff.js";import"./DialogTitle-BbIsmimy.js";import"./___vite-browser-external_commonjs-proxy-BLmSr3RG.js";import"./form-provider-B-2G1ur0.js";import"./FormHelperText-VfwKXgxg.js";import"./Rating-2QPvBMCZ.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-BLpnXJL9.js";import"./Menu-B-p6693m.js";import"./index-D5UcuDVo.js";import"./Slider-B9AmoN5c.js";import"./FormControl-AgI2w8yW.js";import"./FormLabel-DOuw4Lsg.js";import"./RadioGroup-CK1QAQNA.js";import"./FormGroup-C0dPVyoc.js";import"./utils-CYj1Qi6H.js";import"./index-gGE07ddn.js";import"./countries-DSLisFCy.js";import"./Autocomplete-BFfRVC-e.js";import"./country-select-FMhE8ykL.js";import"./InputLabel-DszYUtyH.js";import"./upload-avatar-DWVWcCXJ.js";import"./image-DBvfg_3r.js";import"./DatePicker-Ff6PJeP3.js";import"./ListItem-B93uRZH_.js";import"./MobileDateTimePicker-COWMR2G3.js";import"./upload-box-ad-DRmpCmoQ.js";import"./LoadingButton-C_dnO_6P.js";import"./schema-helper-ZDfKx4k_.js";function us({row:t,index:n,selected:i,onViewRow:s,onClickRow:d,onEditRow:u,onDeleteRow:j,isFullDisplay:p}){var S,T,$;const y=J(),{t:l}=re("quotations"),h=J(),f=fe(),B=e.jsxs(de,{hover:!0,selected:i,children:[e.jsx(D,{onClick:d,children:e.jsx(ge,{color:"inherit",onClick:s,underline:"always",sx:{cursor:"pointer"},children:(t==null?void 0:t.ref)||n||(t==null?void 0:t.id)})}),e.jsx(D,{onClick:d,children:e.jsxs(g,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(le,{sx:{bgcolor:"#00AB55"},alt:t.name,src:t.customer.avatar,children:e.jsx(x,{color:"white",icon:"fluent:person-20-filled",width:24})}),e.jsxs(g,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsx(r,{component:"span",children:t.name}),e.jsx(r,{component:"span",sx:{color:"text.disabled"},children:t.customer.name})]})]})}),e.jsx(D,{onClick:d,children:e.jsx(oe,{primary:ce(t.quotationDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(D,{align:"center",onClick:d,children:e.jsx(Je,{sx:{[`& .${ye.avatar}`]:{width:24,height:24}},children:(S=t==null?void 0:t.productToQuotation)==null?void 0:S.map(o=>{var v,w,E,O;return e.jsx(k,{title:`${(v=o==null?void 0:o.product)==null?void 0:v.name} | Quantity : ${o.quantity}`,children:e.jsx(le,{alt:(w=o==null?void 0:o.product)==null?void 0:w.name,src:`${xe.site.serverFileHost}${(E=o==null?void 0:o.product)==null?void 0:E.image}`},o==null?void 0:o.id)},(O=o==null?void 0:o.product)==null?void 0:O.id)})})}),e.jsxs(D,{onClick:d,children:[M(me((t==null?void 0:t.totalAmount)-(t==null?void 0:t.totalAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage))||"-"," "]}),!p&&e.jsxs(D,{onClick:d,children:[(T=t.createdBy)==null?void 0:T.firstName," ",($=t.createdBy)==null?void 0:$.lastName]}),!p&&e.jsx(D,{onClick:d,children:e.jsxs(he,{variant:"soft",color:t.status===b.Confirmed&&"info"||t.status===b.Converted&&"success"||t.status===b.Canceled&&"error"||"default",children:[t.status===b.Created&&`${l("listView.table.tableToolbar.selectMenu.created")}`,t.status===b.Confirmed&&`${l("listView.table.tableToolbar.selectMenu.confirmed")}`,t.status===b.Converted&&`${l("listView.table.tableToolbar.selectMenu.converted")}`,t.status===b.Canceled&&`${l("listView.table.tableToolbar.selectMenu.canceled")}`]})}),!p&&e.jsxs(D,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(P,{color:h.value?"inherit":"default",onClick:h.onToggle,sx:{...h.value&&{bgcolor:"action.hover"}},children:e.jsx(x,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(P,{color:f.open?"inherit":"default",onClick:f.onOpen,children:e.jsx(x,{icon:"eva:more-vertical-fill"})})]})]}),C=e.jsx(de,{children:e.jsx(D,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(Ce,{in:h.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(Te,{sx:{m:1.5},children:t.productToQuotation.map(o=>e.jsxs(g,{direction:"row",alignItems:"center",sx:{p:v=>v.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:v=>`solid 2px ${v.vars.palette.background.neutral}`}},children:[e.jsx(oe,{primary:o.product.name,secondary:o.sku,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs("div",{children:[o.quantity," "]}),e.jsx(r,{sx:{width:110,textAlign:"right"},children:M(o.snapshotProductPrice)})]},o.id))})})})});return e.jsxs(e.Fragment,{children:[B,C,e.jsx(ve,{open:f.open,anchorEl:f.anchorEl,onClose:f.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(we,{children:[e.jsx(A,{permission:I.VIEW_QUOTATION,children:e.jsxs(R,{onClick:()=>{s(),f.onClose()},children:[e.jsx(x,{icon:"solar:eye-bold"}),`${l("listView.table.tableActions.view")}`]})}),(t==null?void 0:t.status)===b.Created&&e.jsx(A,{permission:I.EDIT_QUOTATION,children:e.jsxs(R,{onClick:()=>{u(),f.onClose()},children:[e.jsx(x,{icon:"solar:pen-bold"}),`${l("listView.table.tableActions.edit")}`]})}),t.status!==b.Canceled&&e.jsx(A,{permission:I.DELETE_QUOTATION,children:e.jsxs(R,{onClick:()=>{y.onTrue(),f.onClose()},sx:{color:"warning.main"},children:[e.jsx(x,{icon:"solar:trash-bin-trash-bold"}),`${l("listView.table.tableActions.cancel")}`]})})]})}),e.jsx(ze,{open:y.value,onClose:y.onFalse,title:"Cancel Quotation",content:"Are you sure want to cancel this quotation?",action:e.jsx(H,{variant:"contained",color:"warning",onClick:()=>{j(),y.onFalse()},children:"Confirm Canceling"})})]})}const ps=[{value:"details",icon:e.jsx(x,{icon:"solar:eye-bold",width:24}),label:"Details"},{value:"tickets",icon:e.jsx(x,{icon:"solar:case-minimalistic-bold",width:24}),label:"Tickets"},{value:"reminders",icon:e.jsx(x,{icon:"solar:calendar-bold",width:24}),label:"Reminders"}],js=({selectedQuotation:t,handleResize:n,handleClose:i})=>{var K,U,G,c,V,ie;const[s,d]=m.useState(t),u=be({queryKey:["quotation",s.id],queryFn:async()=>{const{data:a}=await L.get(F.quotation.details+s.id);return d(a),a}});m.useEffect(()=>{t.id!==s.id&&d(t)},[s.id,t]);const j=ue(),{mutate:p}=z({mutationFn:a=>L.post(F.quotation.createOrder,a),onSuccess:async({data:a})=>{W.success("Order Has Been Created!");const{id:X}=s;await j.invalidateQueries({queryKey:["quotations"]}),await j.invalidateQueries({queryKey:["quotation",X]})},onError:a=>{console.log(a)}}),{mutate:y}=z({mutationFn:a=>L.post(F.quotation.share,a),onSuccess:async({data:a})=>{W.success("Quotation has been sended to the customer.")},onError:a=>{console.log(a)}}),{mutate:l}=z({mutationFn:a=>L.patch(F.quotation.editStatus+a,{status:b.Confirmed}),onSuccess:async({data:a})=>{W.success("Quotation Has Been Confirmed!");const{id:X}=s;await j.invalidateQueries({queryKey:["quotations"]}),await j.invalidateQueries({queryKey:["quotation",X]})},onError:a=>{console.log(a)}}),h=Ze("details"),f=e.jsx(Pe,{children:e.jsx(Xe,{document:s?e.jsx(qe,{quotation:s}):e.jsx("span",{}),fileName:s==null?void 0:s.ref,style:{textDecoration:"none"},children:({loading:a})=>e.jsx(k,{title:"Download Pdf",children:e.jsx(P,{children:a?e.jsx(is,{size:24,color:"inherit"}):e.jsx(x,{icon:"eva:cloud-download-fill"})})})})}),B=e.jsxs(g,{alignItems:"flex-end",sx:{p:1,textAlign:"right",typography:"body2"},children:[e.jsxs(g,{direction:"row",children:[e.jsx(r,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(r,{sx:{width:160,typography:"subtitle2"},children:M(s==null?void 0:s.totalAmount)||"-"})]}),e.jsxs(g,{direction:"row",children:[e.jsx(r,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(r,{sx:{width:160,...(s==null?void 0:s.discount)&&{color:"error.main"}},children:s!=null&&s.discount?`- ${s==null?void 0:s.discount}%`:"-"})]}),e.jsxs(g,{direction:"row",children:[e.jsxs(r,{sx:{color:"text.secondary"},children:["Tax (",(s==null?void 0:s.snapshotTaxPercentage)||"0","%)"]}),e.jsx(r,{sx:{width:160},children:s!=null&&s.snapshotTaxPercentage?M(Se((s==null?void 0:s.totalAmount)-(s==null?void 0:s.totalAmount)*((s==null?void 0:s.discount)/100),s==null?void 0:s.snapshotTaxPercentage)):"-"})]}),e.jsxs(g,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:"Total"}),e.jsx(r,{sx:{width:160},children:M(me((s==null?void 0:s.totalAmount)-(s==null?void 0:s.totalAmount)*((s==null?void 0:s.discount)/100),s==null?void 0:s.snapshotTaxPercentage))||"-"})]})]}),C=J(),S=J(),T=e.jsxs(g,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsxs(r,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",m:1},children:[e.jsxs(r,{flexDirection:"column",sx:{display:"flex"},children:[e.jsxs(r,{sx:{color:"text.secondary"},children:["Quotation Ref: #",s==null?void 0:s.ref]}),e.jsxs(r,{sx:{color:"text.secondary"},children:["Quotation Date: ",ce(s==null?void 0:s.quotationDate)]})]}),e.jsx(r,{sx:{mr:2},children:e.jsxs(r,{sx:{color:"text.secondary"},children:["Status:",e.jsx(he,{variant:"soft",color:(s==null?void 0:s.status)===b.Confirmed&&"info"||(s==null?void 0:s.status)===b.Converted&&"success"||(s==null?void 0:s.status)===b.Canceled&&"error"||"default",children:s==null?void 0:s.status})]})}),((K=s==null?void 0:s.order)==null?void 0:K.id)&&e.jsx(r,{sx:{color:"text.secondary"},className:"print-hide",children:e.jsxs(H,{variant:"contained",size:"small",startIcon:e.jsx(x,{icon:"heroicons-outline:external-link"}),onClick:()=>{const{id:a}=s==null?void 0:s.order;a&&E(a)},children:["Related to Order: #",(U=s==null?void 0:s.order)==null?void 0:U.ref]})})]}),e.jsxs(r,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsx(as,{products:s==null?void 0:s.productToQuotation,defaultRowsPerPage:s!=null&&s.notes?5:10}),e.jsx(N,{sx:{mt:1}})]}),B,(s==null?void 0:s.notes)&&e.jsxs(r,{children:[e.jsx(N,{}),e.jsx(g,{sx:{typography:"body2"},children:e.jsx(r,{sx:{p:1},children:e.jsxs(g,{sx:{typography:"subtitle2"},children:[e.jsx("div",{children:"Notes:"}),e.jsx(r,{sx:{color:"text.secondary"},children:s==null?void 0:s.notes})]})})})]})]}),$=a=>a.isPending||a.isLoading?e.jsx(ae,{}):a.isError?e.jsx(ne,{}):e.jsxs(g,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsx(r,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(r,{children:e.jsx(A,{permission:I.ADD_TICKET,children:e.jsx(H,{onClick:()=>C.onToggle(),variant:"outlined",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),children:"New Ticket"})})})}),e.jsx(N,{}),e.jsx(r,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(ss,{tickets:u.data.tickets})})]}),o=a=>a.isPending||a.isLoading?e.jsx(ae,{}):a.isError?e.jsx(ne,{}):e.jsxs(g,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsx(r,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(r,{children:e.jsx(A,{permission:I.ADD_REMINDER,children:e.jsx(H,{onClick:()=>S.onToggle(),variant:"outlined",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),children:"New Reminder"})})})}),e.jsx(N,{}),e.jsx(r,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(ts,{reminders:u.data.reminders})})]}),v=De(),w=pe(),E=m.useCallback(a=>{w.push(Q.dashboard.order.details(a))},[w]),O=m.useCallback(a=>{w.push(Q.dashboard.quotation.details(a))},[w]),Y=m.useCallback(a=>{w.push(Q.dashboard.quotation.edit(a))},[w]),_=m.useRef();return Ye.useReactToPrint({content:()=>_.current}),e.jsxs(e.Fragment,{children:[e.jsxs(je,{ref:_,sx:{height:1,display:"flex",flexDirection:"column",width:1,transition:"all 2s ease-in-out"},children:[e.jsx("style",{jsx:!0,children:`
          .print-title {
            display: none; /* Hide on screen */
          }

          @media print {
            html,
            body {
              height: initial !important;
              overflow: initial !important;
            }
            .print-title {
              display: block; /* Show only when printing */
            }
            .print-hide {
              display: none; /* Hide on screen */
            }
            .print-padding {
              padding: 5px;
            }
            .print-top-margin {
              margin-top: 40px;
            }
          }
        `}),e.jsxs(ls,{className:"print-hide ",value:h.value,onChange:h.onChange,sx:{px:3,boxShadow:a=>`inset 0 -2px 0 0 ${Z(a.vars.palette.grey["500Channel"],.08)}`},children:[ps.map(a=>e.jsx(os,{icon:a.icon,value:a.value,label:a.label},a.value)),e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${Z(v.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(P,{sx:{ml:1},onClick:n,children:e.jsx(x,{icon:"solar:full-screen-bold",width:24})})}),e.jsx(r,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${Z(v.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(P,{sx:{ml:1},onClick:i,children:e.jsx(x,{icon:"solar:close-square-outline",width:24})})})]}),e.jsxs(r,{className:"print-top-margin print-padding",sx:{display:"flex",flexDirection:"column",position:"relative",flex:1},children:[e.jsx(ds,{sx:{pt:1},title:s==null?void 0:s.name,subheader:`Quotation for Customer : ${(G=s==null?void 0:s.customer)==null?void 0:G.name}`,action:e.jsx(g,{spacing:3,className:"print-hide",direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"},sx:{mb:{xs:3,md:5}},children:e.jsxs(g,{direction:"row",spacing:1,flexGrow:1,sx:{width:1},children:[e.jsx(k,{title:"View",children:e.jsx(P,{onClick:()=>{O(s==null?void 0:s.id)},children:e.jsx(x,{icon:"solar:eye-bold"})})}),(s==null?void 0:s.status)===b.Created&&e.jsx(k,{title:"Edit",children:e.jsx(P,{onClick:()=>{Y(s==null?void 0:s.id)},children:e.jsx(x,{icon:"solar:pen-bold"})})}),(s==null?void 0:s.status)===b.Created&&e.jsx(k,{title:"Confirm",children:e.jsx(P,{onClick:()=>{l(s==null?void 0:s.id)},children:e.jsx(x,{icon:"line-md:confirm-circle-filled"})})}),e.jsx(A,{permission:I.CONVERT_QUOTATION_TO_ORDER,children:!((c=s==null?void 0:s.order)!=null&&c.id)&&((s==null?void 0:s.status)===b.Created||(s==null?void 0:s.status)===b.Confirmed)&&e.jsx(k,{title:"Convert to Order",children:e.jsx(P,{onClick:()=>{p({quotationId:s==null?void 0:s.id})},children:e.jsx(x,{icon:"solar:restart-circle-bold"})})})}),((V=s==null?void 0:s.order)==null?void 0:V.id)&&e.jsx(k,{title:`Related to Order: #${(ie=s==null?void 0:s.order)==null?void 0:ie.ref}`,children:e.jsx(P,{onClick:()=>{var a;E((a=s==null?void 0:s.order)==null?void 0:a.id)},children:e.jsx(x,{icon:"heroicons-outline:external-link"})})}),f,e.jsx(A,{permission:I.PRINT_QUOTATION,children:e.jsx(k,{title:"Print",children:e.jsx(es,{quotation:s})})}),e.jsx(k,{title:"Send To the Customer",children:e.jsx(P,{onClick:()=>{y({id:s.id})},children:e.jsx(x,{icon:"iconamoon:send-fill"})})})]})})}),e.jsx(N,{}),h.value==="details"&&T,h.value==="tickets"&&$(u),h.value==="reminders"&&o(u)]})]}),e.jsx(ns,{open:C.value,onClose:C.onFalse,quotation:s}),e.jsx(rs,{open:S.value,onClose:S.onFalse,quotation:s})]})};function bs({filters:t,onResetPage:n}){const[i,s]=m.useState("all"),{t:d}=re("quotations"),u=m.useCallback(p=>{n(),t.setState({name:p.target.value})},[t,n]),j=m.useCallback(p=>{n(),t.setState({status:p.target.value}),s(p.target.value)},[t,n]);return e.jsxs(g,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(cs,{sx:{width:420},value:t.state.name,onChange:u,placeholder:`${d("listView.table.tableToolbar.searchPlaceholder")}`,InputProps:{startAdornment:e.jsx(xs,{position:"start",children:e.jsx(x,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(ms,{sx:{width:420,textTransform:"capitalize"},value:i,onChange:j,children:[e.jsx(R,{value:"all",children:`${d("listView.table.tableToolbar.selectMenu.allQuotations")}`}),e.jsx(R,{value:"Created",children:`${d("listView.table.tableToolbar.selectMenu.created")}`}),e.jsx(R,{value:"Confirmed",children:`${d("listView.table.tableToolbar.selectMenu.confirmed")}`}),e.jsx(R,{value:"Canceled",children:`${d("listView.table.tableToolbar.selectMenu.canceled")}`}),e.jsx(R,{value:"Converted",children:`${d("listView.table.tableToolbar.selectMenu.converted")}`})]})]})}function fs({filters:t,totalResults:n,onResetPage:i,sx:s}){const d=m.useCallback(()=>{i(),t.setState({name:""})},[t,i]),u=m.useCallback(()=>{i(),t.setState({status:"all"})},[t,i]),j=m.useCallback(()=>{i(),t.setState({startDate:null,endDate:null})},[t,i]),p=m.useCallback(()=>{i(),t.onResetState()},[t,i]);return e.jsxs(hs,{totalResults:n,onReset:p,sx:s,children:[e.jsx(ee,{label:"Status:",isShow:t.state.status!=="all",children:e.jsx(te,{...se,label:t.state.status,onDelete:u,sx:{textTransform:"capitalize"}})}),e.jsx(ee,{label:"Date:",isShow:!!(t.state.startDate&&t.state.endDate),children:e.jsx(te,{...se,label:ke(t.state.startDate,t.state.endDate),onDelete:j})}),e.jsx(ee,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(te,{...se,label:t.state.name,onDelete:d})})]})}function gs({quotations:t}){const n=Ne({defaultOrderBy:"orderId",defaultRowsPerPage:5}),{t:i}=re("quotations"),[s,d]=m.useState(),[u,j]=m.useState(!1),p=[{id:"ref",label:"#",width:88},{id:"details",label:`${i("listView.table.tableHeader.details")}`},{id:"createdAt",label:`${i("listView.table.tableHeader.date")}`,width:140},{id:"totalQuantity",label:`${i("listView.table.tableHeader.items")}`,width:120,align:"center"},{id:"totalAmount",label:`${i("listView.table.tableHeader.price")}`,width:140},{id:"createdBy",label:`${i("listView.table.tableHeader.createdBy")}`,width:200},{id:"status",label:`${i("listView.table.tableHeader.status")}`,width:110},{id:"",width:88}],[y,l]=m.useState(p),h=pe(),[f,B]=m.useState(()=>t),C=Qe({name:"",status:"all",startDate:null,endDate:null});m.useEffect(()=>{if(j(!1),B(t),s){const c=t.find(V=>V.id===s.id);d(c)}},[t]),m.useEffect(()=>{const c=s?p.filter(V=>!["createdBy","status",""].includes(V.id)):p;l(c)},[s]);const S=Ie(C.state.startDate,C.state.endDate),T=ys({inputData:f,comparator:Le(n.order,n.orderBy),filters:C.state,dateError:S}),$=Fe(T,n.page,n.rowsPerPage),o=!!C.state.name||C.state.status!=="all"||!!C.state.startDate&&!!C.state.endDate,v=!T.length&&o||!T.length,w=ue(),{mutate:E}=z({mutationFn:c=>L.delete(F.quotation.delete+c),onSuccess:async()=>{W.success("Order Has Been Canceled!")},onSettled:async()=>{await w.invalidateQueries({queryKey:["quotations"]})},onError:()=>{}}),O=m.useCallback(c=>{E(c)},[$.length,n,f]),Y=m.useCallback(c=>{h.replace(Q.dashboard.quotation.details(c))},[h]),_=m.useCallback(c=>{h.replace(Q.dashboard.quotation.edit(c))},[h]),K=()=>{j(!u)},U=()=>{d(null),j(!1)},G=c=>{d(c)};return e.jsx(Ae,{maxWidth:"xl",children:e.jsxs(q,{container:!0,spacing:3,children:[e.jsx(q,{xs:12,md:12,children:e.jsx(Ve,{links:[{name:`${i("listView.breadCrumbsPageRootTitle")}`,href:Q.dashboard.root},{name:`${i("listView.breadCrumbsParentPageTitle")}`,href:Q.dashboard.quotation.root},{name:`${i("listView.breadCrumbsPageTitle")}`}],action:e.jsx(A,{permission:I.ADD_QUOTATION,children:e.jsx(H,{component:Re,href:Q.dashboard.quotation.new,variant:"contained",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),children:`${i("listView.addNewQuotation")}`})})})}),e.jsxs(A,{permission:I.LIST_QUOTATION,children:[!u&&e.jsx(q,{xs:12,md:s?5:12,children:e.jsxs(je,{children:[e.jsx(bs,{filters:C,onResetPage:n.onResetPage,dateError:S}),o&&e.jsx(fs,{filters:C,totalResults:T.length,onResetPage:n.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(r,{sx:{position:"relative"},children:[e.jsx(Ge,{dense:n.dense,numSelected:n.selected.length,rowCount:T.length}),e.jsx(Ee,{sx:{minHeight:444},children:e.jsxs(_e,{size:n.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Ke,{order:n.order,orderBy:n.orderBy,headLabel:y,rowCount:T.length}),e.jsxs(Ue,{children:[T.slice(n.page*n.rowsPerPage,n.page*n.rowsPerPage+n.rowsPerPage).map(c=>e.jsx(us,{row:c,selected:n.selected.includes(c.id),onSelectRow:()=>n.onSelectRow(c.id),onDeleteRow:()=>O(c.id),onViewRow:()=>Y(c.id),onEditRow:()=>_(c.id),onClickRow:()=>G(c),isFullDisplay:s},c.id)),e.jsx(Me,{height:n.dense?56:76,emptyRows:Be(n.page,n.rowsPerPage,T.length)}),e.jsx(He,{notFound:v})]})]})})]}),e.jsx(We,{page:n.page,dense:n.dense,count:T.length,rowsPerPage:n.rowsPerPage,onPageChange:n.onChangePage,onChangeDense:n.onChangeDense,onRowsPerPageChange:n.onChangeRowsPerPage})]})}),s&&e.jsx(r,{sx:{display:"flex",flex:1,p:1.5,transition:"all 2s ease-in-out"},children:e.jsx(js,{selectedQuotation:s,handleResize:K,handleClose:U})})]})]})})}function ys({inputData:t,comparator:n,filters:i,dateError:s}){const{status:d,name:u,startDate:j,endDate:p}=i,y=t==null?void 0:t.map((l,h)=>[l,h]);return y==null||y.sort((l,h)=>{const f=n(l[0],h[0]);return f!==0?f:l[1]-h[1]}),t=y==null?void 0:y.map(l=>l[0]),u&&(t=t.filter(l=>l.id.toString().toLowerCase().indexOf(u.toLowerCase())!==-1||l.customer.name.toLowerCase().indexOf(u.toLowerCase())!==-1||l.status.toLowerCase().indexOf(u.toLowerCase())!==-1||l.customer.email.toLowerCase().indexOf(u.toLowerCase())!==-1)),d!=="all"&&(t=t.filter(l=>l.status===d)),s||j&&p&&(t=t.filter(l=>$e(l.createTime,j,p))),t}const Cs={title:`Quotation list | Dashboard - ${xe.site.name}`};function Nt(){const t=be({queryKey:["quotations"],queryFn:async()=>{const{data:n}=await L.get(F.quotation.list);return n}});return t.isLoading?e.jsx(ae,{}):t.isError?e.jsx(ne,{route:Q.dashboard.quotation.root}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{children:e.jsxs("title",{children:[" ",Cs.title]})}),e.jsx(gs,{quotations:t.data})]})}export{Nt as default};

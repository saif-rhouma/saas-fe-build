import{X as B,e5 as E,r as f,e6 as F,o as O,S as x,s as j,v,j as a,B as y,b2 as $,a3 as L,d8 as K,br as W,I as k,Q as G,A as H,C as z,T as _,d1 as I,b6 as M,ai as U}from"./index-3kUlxXkm.js";import{f as p,i as X,g as Y,u as Q,C as q,j as J,k as V,l as Z}from"./sortable.esm-OoP4I0aM.js";import{S as w}from"./Skeleton-BfhxUI_f.js";import{L as P}from"./ListItem-CBu29PKK.js";import{A as ee}from"./AvatarGroup-DZ0cD606.js";import{b as re}from"./InputBase-Df4WeLlJ.js";function ve(e){const{user:r}=B(),{permissions:n}=E(),[d,i]=f.useState(!1),l=f.useCallback(u=>n.includes(u),[n]);return f.useEffect(()=>{r.roles[0]===F.STAFF?i(l(e)):i(!0)},[e,l,r.roles]),d}const t={item:"mnl__kanban__item",column:"mnl__kanban__column",itemWrap:"mnl__kanban__item__wrap",columnList:"mnl__kanban__column_list",state:{hover:"state-hover",fadeIn:"state-fade-in",sorting:"state-sorting",dragging:"state-dragging",disabled:"state-disabled",dragOverlay:"state-drag-overlay"}},ae=[p.Down,p.Right,p.Up,p.Left],pe=(e,{context:{active:r,droppableRects:n,droppableContainers:d,collisionRect:i}})=>{var l;if(ae.includes(e.code)){if(e.preventDefault(),!r||!i)return;const u=[];d.getEnabled().forEach(o=>{var c;if(!o||o!=null&&o.disabled)return;const g=n.get(o.id);if(!g)return;const s=o.data.current;if(s){const{type:C,children:b}=s;if(C==="container"&&(b==null?void 0:b.length)>0&&((c=r.data.current)==null?void 0:c.type)!=="container")return}switch(e.code){case p.Down:i.top<g.top&&u.push(o);break;case p.Up:i.top>g.top&&u.push(o);break;case p.Left:i.left>=g.left+g.width&&u.push(o);break;case p.Right:i.left+i.width<=g.left&&u.push(o);break}});const h=X({active:r,collisionRect:i,droppableRects:n,droppableContainers:u,pointerCoordinates:null}),m=Y(h,"id");if(m!=null){const o=d.get(m),g=o==null?void 0:o.node.current,s=o==null?void 0:o.rect.current;if(g&&s)return o.id==="placeholder"?{x:s.left+(s.width-i.width)/2,y:s.top+(s.height-i.height)/2}:((l=o.data.current)==null?void 0:l.type)==="container"?{x:s.left+20,y:s.top+74}:{x:s.left,y:s.top}}}},ne=O(x)(({theme:e})=>({flexShrink:0,height:"100%",borderWidth:1,position:"relative",borderStyle:"solid",borderColor:"transparent",padding:"var(--column-padding)",borderRadius:"var(--column-radius)",backgroundColor:e.vars.palette.background.neutral,[j.dark]:{backgroundColor:e.vars.palette.grey[800]},"&::before":{top:0,left:0,content:'""',width:"100%",height:"100%",position:"absolute",borderRadius:"inherit",backgroundColor:"transparent",transition:e.transitions.create(["background-color"])},[`&.${t.state.hover}`]:{"&::before":{backgroundColor:v(e.vars.palette.grey["500Channel"],.08),[j.dark]:{backgroundColor:v(e.vars.palette.grey["500Channel"],.16)}}},[`&.${t.state.dragOverlay}`]:{backdropFilter:"blur(6px)",borderColor:v(e.vars.palette.grey["500Channel"],.08),backgroundColor:v(e.vars.palette.background.neutralChannel,.48),[j.dark]:{backgroundColor:v(e.vars.palette.grey["800Channel"],.48)}},[`&.${t.state.dragging}`]:{opacity:0}})),ie=f.forwardRef(({slots:e,stateProps:r,sx:n,...d},i)=>{const l=t.column.concat((r==null?void 0:r.hover)&&` ${t.state.hover}`||(r==null?void 0:r.dragOverlay)&&` ${t.state.dragOverlay}`||(r==null?void 0:r.dragging)&&` ${t.state.dragging}`||"");return a.jsxs(ne,{ref:i,className:l,sx:{gap:2.5,width:"var(--column-width)",...n},...d,children:[(e==null?void 0:e.header)&&e.header,(e==null?void 0:e.action)&&(e==null?void 0:e.action),(e==null?void 0:e.main)&&a.jsx(y,{component:"ul",className:t.columnList,sx:{minHeight:80,display:"flex",gap:"var(--item-gap)",flexDirection:"column"},children:e.main})]})}),T=f.memo(ie);function oe({sx:e,...r}){return a.jsx(re,{sx:{[`&.${$.root}`]:{py:.75,borderRadius:1,typography:"h6",borderWidth:2,borderStyle:"solid",borderColor:"transparent",transition:n=>n.transitions.create(["padding-left","border-color"]),[`&.${$.focused}`]:{pl:.75,borderColor:"text.primary"}},[`& .${$.input}`]:{typography:"h6"},...e},...r})}function D({columnName:e,columnColor:r,totalTasks:n}){const d=f.useRef(null),i=L(),[l,u]=f.useState(e);return f.useEffect(()=>{i.open&&d.current&&d.current.focus()},[i.open]),a.jsxs(x,{direction:"row",alignItems:"center",children:[a.jsx(K,{sx:{color:`${r}.main`,borderRadius:"50%",borderColor:h=>v(h.vars.palette.grey["500Channel"],.24)},children:n}),a.jsx(oe,{inputRef:d,placeholder:"Column name",value:l,inputProps:{id:`input-column-${l}`},sx:{mx:1,color:`${r}.main`}})]})}function Ce({children:e,column:r,tasks:n,colors:d,disabled:i,sx:l}){var S;const{attributes:u,isDragging:h,listeners:m,setNodeRef:o,transition:g,active:s,over:c,transform:C}=Q({id:r.id,data:{type:"container",children:n},animateLayoutChanges:te}),b=n==null?void 0:n.map(N=>N.id),R=c?r.id===c.id&&((S=s==null?void 0:s.data.current)==null?void 0:S.type)!=="container"||b.includes(c.id):!1;return a.jsx(T,{ref:i?void 0:o,sx:{transition:g,transform:q.Translate.toString(C),...l},stateProps:{dragging:h,hover:R,handleProps:{...u,...m}},slots:{header:a.jsx(D,{totalTasks:n.length,columnName:r.name,columnColor:d[r.name]}),main:a.jsx(a.Fragment,{children:e})}})}const te=e=>J({...e,wasDragging:!0}),de=O(P)(()=>({"@keyframes fadeIn":{"0%":{opacity:0},"100%":{opacity:1}},transform:"translate3d(var(--translate-x, 0), var(--translate-y, 0), 0) scaleX(var(--scale-x, 1)) scaleY(var(--scale-y, 1))",transformOrigin:"0 0",touchAction:"manipulation",[`&.${t.state.fadeIn}`]:{animation:"fadeIn 500ms ease"},[`&.${t.state.dragOverlay}`]:{zIndex:999}})),le=O(x)(({theme:e})=>({width:"100%",cursor:"grab",outline:"none",overflow:"hidden",position:"relative",transformOrigin:"50% 50%",touchAction:"manipulation",boxShadow:e.customShadows.z1,borderRadius:"var(--item-radius)",WebkitTapHighlightColor:"transparent",backgroundColor:e.vars.palette.common.white,transition:e.transitions.create(["box-shadow"]),[j.dark]:{backgroundColor:e.vars.palette.grey[900]},[`&.${t.state.disabled}`]:{},[`&.${t.state.sorting}`]:{},[`&.${t.state.dragOverlay}`]:{backdropFilter:"blur(6px)",boxShadow:e.customShadows.z20,backgroundColor:v(e.vars.palette.common.whiteChannel,.48),[j.dark]:{backgroundColor:v(e.vars.palette.grey["900Channel"],.48)}},[`&.${t.state.dragging}`]:{opacity:.2,filter:"grayscale(1)"}})),se=f.forwardRef(({task:e,stateProps:r,sx:n,...d},i)=>{var g,s;const{t:l}=W("orders-status");f.useEffect(()=>{if(r!=null&&r.dragOverlay)return document.body.style.cursor="grabbing",()=>{document.body.style.cursor=""}},[r==null?void 0:r.dragOverlay]);const u=t.itemWrap.concat((r==null?void 0:r.fadeIn)&&` ${t.state.fadeIn}`||(r==null?void 0:r.dragOverlay)&&` ${t.state.dragOverlay}`||""),h=t.item.concat((r==null?void 0:r.dragging)&&` ${t.state.dragging}`||(r==null?void 0:r.disabled)&&` ${t.state.disabled}`||(r==null?void 0:r.sorting)&&` ${t.state.sorting}`||(r==null?void 0:r.dragOverlay)&&` ${t.state.dragOverlay}`||""),m=a.jsx(k,{icon:e.status==="Delivered"?"solar:double-alt-arrow-up-bold-duotone":"solar:double-alt-arrow-right-bold-duotone",sx:{top:4,right:4,position:"absolute",...e.status==="Delivered"&&{color:"info.main"},...e.status==="Ready"&&{color:"warning.main"},...e.status==="InProcess"&&{color:"error.main"}}}),o=a.jsxs(x,{direction:"row",alignItems:"center",children:[a.jsx(x,{flexGrow:1,direction:"row",alignItems:"center",sx:{typography:"caption",color:"text.disabled"},children:a.jsxs(y,{component:"span",sx:{mr:1},children:[l("card.products"),":"]})}),a.jsx(ee,{sx:{[`& .${G.avatar}`]:{width:24,height:24}},children:(g=e==null?void 0:e.productToOrder)==null?void 0:g.map(c=>{var C,b;return a.jsx(H,{alt:(C=c==null?void 0:c.product)==null?void 0:C.name,src:`${z.site.serverFileHost}${(b=c==null?void 0:c.product)==null?void 0:b.image}`},c==null?void 0:c.id)})})]});return a.jsx(de,{ref:i,disablePadding:!0,className:u,sx:{...!!(r!=null&&r.transition)&&{transition:r.transition},...!!(r!=null&&r.transform)&&{"--translate-x":`${Math.round(r.transform.x)}px`,"--translate-y":`${Math.round(r.transform.y)}px`,"--scale-x":`${r.transform.scaleX}`,"--scale-y":`${r.transform.scaleY}`}},children:a.jsx(le,{className:h,"data-cypress":"draggable-item",sx:n,tabIndex:0,...r==null?void 0:r.listeners,...d,children:a.jsxs(x,{spacing:1,sx:{px:2,py:2.5,position:"relative"},children:[m,a.jsxs(x,{direction:"row",justifyContent:"space-between",children:[a.jsx(_,{variant:"subtitle2",children:(s=e==null?void 0:e.customer)==null?void 0:s.name}),a.jsx(_,{variant:"subtitle2",children:e==null?void 0:e.ref})]}),a.jsxs(x,{direction:"row",justifyContent:"space-between",sx:{typography:"body2"},children:[a.jsx(y,{sx:{color:"text.secondary"},children:l("card.orderDate")}),a.jsx(y,{sx:{color:"text.secondary"},children:I(e==null?void 0:e.orderDate)})]}),a.jsxs(x,{direction:"row",justifyContent:"space-between",sx:{typography:"body2"},children:[a.jsx(y,{sx:{color:"text.secondary"},children:l("card.deliveryDate")}),a.jsx(y,{sx:{color:"text.secondary"},children:e.deliveryDate?I(e==null?void 0:e.deliveryDate):"-"})]}),a.jsxs(x,{direction:"row",justifyContent:"space-between",sx:{typography:"body2"},children:[a.jsx(y,{sx:{color:"text.secondary"},children:l("card.lastUpdate")}),a.jsx(y,{sx:{color:"text.secondary"},children:I(e==null?void 0:e.updateTime)})]}),o]})})})}),A=f.memo(se);function je({amount:e=3,sx:r,...n}){return[...Array(e)].map((d,i)=>a.jsxs(M,{variant:"outlined",sx:{display:"flex",gap:"var(--item-gap)",flexDirection:"column",p:"var(--column-padding)",width:"var(--column-width)",borderRadius:"var(--column-radius)",...r},...n,children:[a.jsx(w,{sx:{pt:"75%",borderRadius:1.5}}),[0].includes(i)&&a.jsx(w,{sx:{pt:"50%",borderRadius:1.5}}),[0,1].includes(i)&&a.jsx(w,{sx:{pt:"25%",borderRadius:1.5}}),[0,1,2].includes(i)&&a.jsx(w,{sx:{pt:"25%",borderRadius:1.5}})]},i))}const ce={sideEffects:Z({styles:{active:{opacity:"0.5"}}})};function we({columns:e,tasks:r,activeId:n,sx:d}){const i=e.map(m=>m.id),l=e.find(m=>m.id===n),h=Object.values(r).flat().find(m=>m.id===n);return a.jsx(U,{children:a.jsx(V,{adjustScale:!1,dropAnimation:ce,children:n?a.jsx(a.Fragment,{children:i.includes(n)?a.jsx(ue,{column:l,tasks:r[n],sx:d}):a.jsx(ge,{task:h,sx:d})}):null})})}function ue({column:e,tasks:r,sx:n}){return a.jsx(T,{slots:{header:a.jsx(D,{columnName:e.name,totalTasks:r.length}),main:r.map(d=>a.jsx(A,{task:d},d.id))},stateProps:{dragOverlay:!0},sx:n})}function ge({task:e,sx:r}){return a.jsx(A,{task:e,sx:r,stateProps:{dragOverlay:!0}})}export{A as I,Ce as K,we as a,je as b,pe as c,t as k,ve as u};

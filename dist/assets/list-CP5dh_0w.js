import{o as k,bO as _,j as e,L as J,S as D,A as M,B as P,aI as F,aJ as V,bm as z,cM as U,C as H,ds as X,w as B,I as b,dh as Y,az as Z,dw as ee,bQ as te,em as R,bR as C,e as $,r as h,en as se,l as ae,b as re,dz as oe,eo as ne,dI as le,p as f,e8 as ie,G as g,R as de,eb as w,aD as ce,dy as me,ep as he,dJ as E,dH as A,dK as pe,ec as ue,H as xe}from"./index-Cq03K-HC.js";import{u as q,E as je}from"./error-block-CBMWt84f.js";import{u as ge}from"./useMutation-Dp0rVztm.js";import{C as ye}from"./custom-breadcrumbs-C_F-6vOC.js";import{P as T}from"./permission-access-controller-Bzg3p7NA.js";import{u as be,g as Ce,r as fe,T as ve,a as we,e as Se}from"./table-selected-action-CjXNfoiW.js";import{T as De}from"./table-no-data-BdJ2y3p3.js";import{T as K,a as Pe,b as Re,c as Te}from"./table-head-custom-xPqHms_A.js";import{T as Ie}from"./table-pagination-custom-C2Jp-FKf.js";import{A as S}from"./app-widget-summary-CmlvdM4Y.js";import{b as Q}from"./format-number-DITXUPMN.js";import{C as Le}from"./confirm-dialog-DvqBGu4G.js";import{T as j}from"./TableCell-BY4odiRW.js";import{A as Oe}from"./AvatarGroup-u8lloYeM.js";import{T as ke}from"./TextField-BNZ3YpVQ.js";import{I as Ee}from"./InputAdornment-B7jHbOut.js";import{S as Ae}from"./Select-BJK6Q71-.js";import{F as Me,a as I,c as L}from"./filters-result-CrYBZAgn.js";import{C as O}from"./Chip-x2W7r02e.js";import"./index-BUALKNpC.js";import"./incrementer-button-D87DqIoS.js";import"./order-payment-details-dialog-Q0ZhSSfB.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-B5P4NoLN.js";import"./empty-content-D3sAh_j_.js";import"./TablePagination-BR53i_Na.js";import"./KeyboardArrowRight-yBnSCV6-.js";import"./LastPage-CGd1p9nh.js";import"./InputBase-CPtucf_J.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-CS2mv3Te.js";import"./use-chart-DuVbMCC_.js";import"./chart-legends-DID90Nvc.js";import"./index-DqNxVOmH.js";import"./DialogContent-D0WbZEYR.js";import"./DialogTitle-CLKmH_im.js";import"./FormControl-DUlfZx4z.js";import"./InputLabel-D6SX5sCR.js";import"./FormLabel-Bx5V1G4l.js";import"./FormHelperText-BdgqWWO0.js";import"./Menu-B_EWYTTU.js";import"./form-provider-DGoPfYCb.js";import"./Rating-C9YzUf05.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-D16lNrfB.js";import"./index-BOf1bnN2.js";import"./Slider-ic8LVZXa.js";import"./RadioGroup-CqyyD7XC.js";import"./FormGroup-ByRTQQuh.js";import"./countries-DSLisFCy.js";import"./Autocomplete-CidbBtOC.js";import"./country-select-D9zKFD0C.js";import"./upload-avatar-CoRpPeQR.js";import"./image-DitvMElQ.js";import"./DatePicker-C0kjDQAX.js";import"./ListItem-Dwol_2rN.js";import"./MobileDateTimePicker-DgPLkewz.js";import"./Tabs-Bg2egs3q.js";import"./schema-helper-DkKalxt7.js";import"./LoadingButton-3T23lww4.js";import"./CircularProgress-sp-m8OZh.js";function Fe({row:t,selected:r,onViewRow:s,onSelectRow:u,onDeleteRow:c}){var p;const d=k(),i=k(),l=_(),m=e.jsxs(K,{hover:!0,selected:r,children:[e.jsx(j,{children:e.jsxs(J,{color:"inherit",onClick:s,underline:"always",sx:{cursor:"pointer"},children:["ORD-",t.id]})}),e.jsx(j,{children:e.jsxs(D,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(M,{alt:t.customer.name,src:t.customer.avatar}),e.jsxs(D,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsx(P,{component:"span",children:t.customer.name}),e.jsx(P,{component:"span",sx:{color:"text.disabled"},children:t.customer.email})]})]})}),e.jsx(j,{children:e.jsx(F,{primary:V(t.orderDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(j,{align:"center",children:e.jsx(Oe,{sx:{[`& .${z.avatar}`]:{width:24,height:24}},children:(p=t==null?void 0:t.productToOrder)==null?void 0:p.map(n=>{var x,y,v;return e.jsx(U,{title:`${(x=n==null?void 0:n.product)==null?void 0:x.name} | Quantity : ${n.quantity}`,children:e.jsx(M,{alt:(y=n==null?void 0:n.product)==null?void 0:y.name,src:`${H.site.serverFileHost}${(v=n==null?void 0:n.product)==null?void 0:v.image}`},n==null?void 0:n.id)})})})}),e.jsxs(j,{children:[" ",Q(t.totalOrderAmount)," "]}),e.jsx(j,{children:e.jsx(X,{variant:"soft",color:t.status==="Ready"&&"info"||t.status==="InProcess"&&"warning"||t.status==="Delivered"&&"success"||"default",children:t.status})}),e.jsxs(j,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(B,{color:i.value?"inherit":"default",onClick:i.onToggle,sx:{...i.value&&{bgcolor:"action.hover"}},children:e.jsx(b,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(B,{color:l.open?"inherit":"default",onClick:l.onOpen,children:e.jsx(b,{icon:"eva:more-vertical-fill"})})]})]}),o=e.jsx(K,{children:e.jsx(j,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(Y,{in:i.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(Z,{sx:{m:1.5},children:t.productToOrder.map(n=>e.jsxs(D,{direction:"row",alignItems:"center",sx:{p:x=>x.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:x=>`solid 2px ${x.vars.palette.background.neutral}`}},children:[e.jsx(F,{primary:n.product.name,secondary:n.sku,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs("div",{children:["x",n.quantity," "]}),e.jsx(P,{sx:{width:110,textAlign:"right"},children:Q(n.product.price)})]},n.id))})})})});return e.jsxs(e.Fragment,{children:[m,o,e.jsx(ee,{open:l.open,anchorEl:l.anchorEl,onClose:l.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(te,{children:[e.jsx(T,{permission:R.VIEW_ORDER,children:e.jsxs(C,{onClick:()=>{s(),l.onClose()},children:[e.jsx(b,{icon:"solar:eye-bold"}),"View"]})}),e.jsx(T,{permission:R.DELETE_ORDER,children:e.jsxs(C,{onClick:()=>{d.onTrue(),l.onClose()},sx:{color:"error.main"},children:[e.jsx(b,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})})]})}),e.jsx(Le,{open:d.value,onClose:d.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx($,{variant:"contained",color:"error",onClick:c,children:"Delete"})})]})}function Be({filters:t,onResetPage:r}){const[s,u]=h.useState("all"),c=h.useCallback(i=>{r(),t.setState({name:i.target.value})},[t,r]),d=h.useCallback(i=>{r(),t.setState({status:i.target.value}),u(i.target.value)},[t,r]);return e.jsxs(D,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(ke,{sx:{width:420},value:t.state.name,onChange:c,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(Ee,{position:"start",children:e.jsx(b,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(Ae,{sx:{width:420,textTransform:"capitalize"},value:s,onChange:d,children:[e.jsx(C,{value:"all",children:"All Orders"}),e.jsx(C,{value:"InProcess",children:"Processing"}),e.jsx(C,{value:"Ready",children:"Ready To Deliver"}),e.jsx(C,{value:"Delivered",children:"Delivered"})]})]})}function qe({filters:t,totalResults:r,onResetPage:s,sx:u}){const c=h.useCallback(()=>{s(),t.setState({name:""})},[t,s]),d=h.useCallback(()=>{s(),t.setState({status:"all"})},[t,s]),i=h.useCallback(()=>{s(),t.setState({startDate:null,endDate:null})},[t,s]),l=h.useCallback(()=>{s(),t.onResetState()},[t,s]);return e.jsxs(Me,{totalResults:r,onReset:l,sx:u,children:[e.jsx(I,{label:"Status:",isShow:t.state.status!=="all",children:e.jsx(O,{...L,label:t.state.status,onDelete:d,sx:{textTransform:"capitalize"}})}),e.jsx(I,{label:"Date:",isShow:!!(t.state.startDate&&t.state.endDate),children:e.jsx(O,{...L,label:se(t.state.startDate,t.state.endDate),onDelete:i})}),e.jsx(I,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(O,{...L,label:t.state.name,onDelete:c})})]})}const Ke=[{id:"orderNumber",label:"#",width:88},{id:"name",label:"Customer"},{id:"createdAt",label:"Date",width:140},{id:"totalQuantity",label:"Items",width:120,align:"center"},{id:"totalAmount",label:"Price",width:140},{id:"status",label:"Status",width:110},{id:"",width:88}];function Qe({orders:t,analytics:r}){const s=be({defaultOrderBy:"orderId"}),u=ae(),c=re();k();const[d,i]=h.useState(()=>t),l=oe({name:"",status:"all",startDate:null,endDate:null});h.useEffect(()=>{i(t)},[t]);const m=ne(l.state.startDate,l.state.endDate),o=He({inputData:d,comparator:Ce(s.order,s.orderBy),filters:l.state,dateError:m}),p=fe(o,s.page,s.rowsPerPage),n=!!l.state.name||l.state.status!=="all"||!!l.state.startDate&&!!l.state.endDate,x=!o.length&&n||!o.length,y=le(),{mutate:v}=ge({mutationFn:a=>E.delete(A.order.delete+a),onSuccess:async()=>{const a=d.filter(W=>W.id!==id);pe.success("Delete success!"),i(a),s.onUpdatePageDeleteRow(p.length)},onSettled:async()=>{await y.invalidateQueries({queryKey:["orders"]}),await y.invalidateQueries({queryKey:["orders-status"]}),await y.invalidateQueries({queryKey:["orders","analytics"]})},onError:()=>{}}),N=h.useCallback(a=>{v(a)},[p.length,s,d]),G=h.useCallback(a=>{u.replace(f.dashboard.order.details(a))},[u]);return e.jsx(ie,{maxWidth:"xl",children:e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{xs:12,md:12,children:e.jsx(ye,{links:[{name:"Dashboard",href:f.dashboard.root},{name:"Order",href:f.dashboard.order.root},{name:"List"}],action:e.jsx(T,{permission:R.ADD_ORDER,children:e.jsx($,{component:de,href:f.dashboard.order.new,variant:"contained",startIcon:e.jsx(b,{icon:"mingcute:add-line"}),children:"New Order"})})})}),e.jsxs(T,{permission:R.LIST_ORDER,children:[e.jsx(g,{xs:12,md:3,children:e.jsx(S,{title:"All Orders",total:t.length,chart:{categories:r.data.lastSixMonth.map(a=>w(a==null?void 0:a.inMonth)),series:r.data.lastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(g,{xs:12,md:3,children:e.jsx(S,{title:"Processing Order",total:r.data.analytics.InProcess,chart:{colors:[c.vars.palette.warning.light],categories:r.data.inProcessLastSixMonth.map(a=>w(a==null?void 0:a.inMonth)),series:r.data.inProcessLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(g,{xs:12,md:3,children:e.jsx(S,{title:"Ready To Deliver Order",total:r.data.analytics.Ready,chart:{colors:[c.vars.palette.info.main],categories:r.data.readyLastSixMonth.map(a=>w(a==null?void 0:a.inMonth)),series:r.data.readyLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(g,{xs:12,md:3,children:e.jsx(S,{title:"Delivered",total:r.data.analytics.Delivered,chart:{colors:[c.vars.palette.success.main],categories:r.data.deliveredLastSixMonth.map(a=>w(a==null?void 0:a.inMonth)),series:r.data.deliveredLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(g,{xs:12,md:12,children:e.jsxs(ce,{children:[e.jsx(Be,{filters:l,onResetPage:s.onResetPage,dateError:m}),n&&e.jsx(qe,{filters:l,totalResults:o.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(P,{sx:{position:"relative"},children:[e.jsx(ve,{dense:s.dense,numSelected:s.selected.length,rowCount:o.length}),e.jsx(me,{sx:{minHeight:444},children:e.jsxs(Pe,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Re,{order:s.order,orderBy:s.orderBy,headLabel:Ke,rowCount:o.length}),e.jsxs(Te,{children:[o.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(a=>e.jsx(Fe,{row:a,selected:s.selected.includes(a.id),onSelectRow:()=>s.onSelectRow(a.id),onDeleteRow:()=>N(a.id),onViewRow:()=>G(a.id)},a.id)),e.jsx(we,{height:s.dense?56:76,emptyRows:Se(s.page,s.rowsPerPage,o.length)}),e.jsx(De,{notFound:x})]})]})})]}),e.jsx(Ie,{page:s.page,dense:s.dense,count:o.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})]})]})})}function He({inputData:t,comparator:r,filters:s,dateError:u}){const{status:c,name:d,startDate:i,endDate:l}=s,m=t==null?void 0:t.map((o,p)=>[o,p]);return m==null||m.sort((o,p)=>{const n=r(o[0],p[0]);return n!==0?n:o[1]-p[1]}),t=m==null?void 0:m.map(o=>o[0]),d&&(t=t.filter(o=>o.id.toString().toLowerCase().indexOf(d.toLowerCase())!==-1||o.customer.name.toLowerCase().indexOf(d.toLowerCase())!==-1||o.customer.email.toLowerCase().indexOf(d.toLowerCase())!==-1)),c!=="all"&&(t=t.filter(o=>o.status===c)),u||i&&l&&(t=t.filter(o=>he(o.createTime,i,l))),t}const $e={title:`Order list | Dashboard - ${H.site.name}`};function Zt(){const t=q({queryKey:["orders"],queryFn:async()=>{const{data:s}=await E.get(A.order.list);return s}}),r=q({queryKey:["orders","analytics"],queryFn:async()=>{const{data:s}=await E.get(A.order.analytics);return s}});return r.isLoading||t.isLoading?e.jsx(ue,{}):t.isError||r.isError?e.jsx(je,{route:f.dashboard.order.root}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{children:e.jsxs("title",{children:[" ",$e.title]})}),e.jsx(Qe,{orders:t.data,analytics:r})]})}export{Zt as default};

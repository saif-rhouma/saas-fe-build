import{Y,dn as J,a3 as Se,j as e,L as De,S as y,A as je,I as x,B as l,a8 as be,d0 as re,Q as Qe,bq as D,C as Ce,e8 as ye,d7 as ge,e9 as h,$ as w,cQ as Ie,b6 as $e,db as Ae,a6 as Ee,e4 as I,a7 as E,e as K,r as m,dq as R,dm as V,dp as Te,dr as W,ea as Re,a5 as _,eb as Ve,W as we,p as Q,cY as ve,v as ee,dU as le,ec as Oe,de as Le,e3 as Fe,dQ as Be,cV as se,R as He,dd as Ne,ed as Me,H as _e}from"./index-88qAwG8P.js";import{u as ie,E as oe}from"./error-block-BTff90qR.js";import{u as z}from"./useMutation-Bjm4Nnvr.js";import{C as Ke}from"./custom-breadcrumbs-x7W5GMPl.js";import{P as $}from"./permission-access-controller-BVvbpBzt.js";import{g as Ue,r as Ge,e as We}from"./utils-MBUcMVfY.js";import{u as ze}from"./use-table-BYPgfP9k.js";import{T as Ye}from"./table-no-data-wFoKraSE.js";import{T as Je}from"./table-empty-rows-6krMqYw2.js";import{T as fe,a as Xe,b as Ze,c as qe}from"./table-head-custom-g2OgtrHv.js";import{T as es}from"./table-selected-action-DnALz1xy.js";import{T as ss}from"./table-pagination-custom-Ds9-Dw8y.js";import{b as U}from"./format-number-B8FPsWIV.js";import{C as ts}from"./confirm-dialog-BdxUyq-O.js";import{T as S}from"./TableCell-Cl8UZGxf.js";import{A as as}from"./AvatarGroup-CWqMds2i.js";import{l as ns}from"./index-BBBOFUXR.js";import{u as rs}from"./use-tabs-BvnvJIoS.js";import{P as ls,Q as is,a as os}from"./print-quotation-details-template-tR9FIB3Y.js";import{Q as ds}from"./quotation-product-table-BPvAyC1U.js";import{T as cs}from"./tickets-create-dialog-C70zFhcK.js";import{R as xs}from"./reminder-create-dialog-BMD07oTC.js";import{C as ms}from"./CircularProgress-DIm-Ts9z.js";import{T as hs,a as us}from"./Tabs-gBKEx7yr.js";import{C as ps}from"./CardHeader-BiUdbdTy.js";import{T as js}from"./TextField-CQpihH7F.js";import{I as bs}from"./InputAdornment-Bg-m_z4_.js";import{S as fs}from"./Select-DFC-Q2QB.js";import{F as Cs,a as te,c as ae}from"./filters-result-B0DfRGbW.js";import{C as ne}from"./Chip-yDeOg34u.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-vgDCQT8r.js";import"./Checkbox-Cpc8f1GH.js";import"./TablePagination-CrnuwEMO.js";import"./KeyboardArrowRight-fE7_2VJ7.js";import"./LastPage-B6xWbdc0.js";import"./InputBase-DD8qHu7J.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-ts_MkIWE.js";import"./DialogContent-F9o-_CVT.js";import"./DialogTitle-CvyYkdF0.js";import"./form-provider-DSldc_Gv.js";import"./FormHelperText-DA7jizKd.js";import"./Rating-4WKJ8FeG.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-DKQnkQYm.js";import"./Menu-BDUaDfAf.js";import"./index-DZ-uLlaR.js";import"./Slider-Cdch2KEI.js";import"./FormControl-BXGEHd-f.js";import"./FormLabel-Ck5_RgM9.js";import"./RadioGroup-DZvtDFL6.js";import"./FormGroup-B0QesIKW.js";import"./utils-BDEKF9xP.js";import"./index-CySZofTa.js";import"./countries-DSLisFCy.js";import"./Autocomplete-Du1dNHWZ.js";import"./country-select-B-6neUw6.js";import"./InputLabel-B0kOUcWA.js";import"./upload-avatar-CSIBlxGF.js";import"./image-CkDsegDa.js";import"./DatePicker-C1aTSbY2.js";import"./ListItem-Bt-kWpW8.js";import"./MobileDateTimePicker-pEp8pQrB.js";import"./upload-box-ad-BK5SyPw0.js";import"./LoadingButton-CM47tPre.js";import"./schema-helper-_nyXaTEe.js";function ys({row:t,index:n,selected:o,onViewRow:r,onClickRow:s,onEditRow:j,onDeleteRow:b,isFullDisplay:u}){var P,g,B;const p=Y(),{t:d}=J("quotations"),f=Y(),C=Se(),v=e.jsxs(fe,{hover:!0,selected:o,children:[e.jsx(S,{onClick:s,children:e.jsx(De,{color:"inherit",onClick:r,underline:"always",sx:{cursor:"pointer"},children:(t==null?void 0:t.ref)||n||(t==null?void 0:t.id)})}),e.jsx(S,{onClick:s,children:e.jsxs(y,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(je,{sx:{bgcolor:"#00AB55"},alt:t.name,src:t.customer.avatar,children:e.jsx(x,{color:"white",icon:"fluent:person-20-filled",width:24})}),e.jsxs(y,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsx(l,{component:"span",children:t.name}),e.jsx(l,{component:"span",sx:{color:"text.disabled"},children:t.customer.name})]})]})}),e.jsx(S,{onClick:s,children:e.jsx(be,{primary:re(t.quotationDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(S,{align:"center",onClick:s,children:e.jsx(as,{sx:{[`& .${Qe.avatar}`]:{width:24,height:24}},children:(P=t==null?void 0:t.productToQuotation)==null?void 0:P.map(c=>{var k,O,L,A;return e.jsx(D,{title:`${(k=c==null?void 0:c.product)==null?void 0:k.name} | Quantity : ${c.quantity}`,children:e.jsx(je,{alt:(O=c==null?void 0:c.product)==null?void 0:O.name,src:`${Ce.site.serverFileHost}${(L=c==null?void 0:c.product)==null?void 0:L.image}`},c==null?void 0:c.id)},(A=c==null?void 0:c.product)==null?void 0:A.id)})})}),e.jsxs(S,{onClick:s,children:[U(ye((t==null?void 0:t.totalAmount)-(t==null?void 0:t.totalAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage))||"-"," "]}),!u&&e.jsxs(S,{onClick:s,children:[(g=t.createdBy)==null?void 0:g.firstName," ",(B=t.createdBy)==null?void 0:B.lastName]}),!u&&e.jsx(S,{onClick:s,children:e.jsxs(ge,{variant:"soft",color:t.status===h.Confirmed&&"info"||t.status===h.Converted&&"success"||t.status===h.Canceled&&"error"||"default",children:[t.status===h.Created&&`${d("listView.table.tableToolbar.selectMenu.created")}`,t.status===h.Confirmed&&`${d("listView.table.tableToolbar.selectMenu.confirmed")}`,t.status===h.Converted&&`${d("listView.table.tableToolbar.selectMenu.converted")}`,t.status===h.Canceled&&`${d("listView.table.tableToolbar.selectMenu.canceled")}`]})}),!u&&e.jsxs(S,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(w,{color:f.value?"inherit":"default",onClick:f.onToggle,sx:{...f.value&&{bgcolor:"action.hover"}},children:e.jsx(x,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(w,{color:C.open?"inherit":"default",onClick:C.onOpen,children:e.jsx(x,{icon:"eva:more-vertical-fill"})})]})]}),T=e.jsx(fe,{children:e.jsx(S,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(Ie,{in:f.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx($e,{sx:{m:1.5},children:t.productToQuotation.map(c=>e.jsxs(y,{direction:"row",alignItems:"center",sx:{p:k=>k.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:k=>`solid 2px ${k.vars.palette.background.neutral}`}},children:[e.jsx(be,{primary:c.product.name,secondary:c.sku,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs("div",{children:[c.quantity," "]}),e.jsx(l,{sx:{width:110,textAlign:"right"},children:U(c.snapshotProductPrice)})]},c.id))})})})});return e.jsxs(e.Fragment,{children:[v,T,e.jsx(Ae,{open:C.open,anchorEl:C.anchorEl,onClose:C.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Ee,{children:[e.jsx($,{permission:I.VIEW_QUOTATION,children:e.jsxs(E,{onClick:()=>{r(),C.onClose()},children:[e.jsx(x,{icon:"solar:eye-bold"}),`${d("listView.table.tableActions.view")}`]})}),(t==null?void 0:t.status)===h.Created&&e.jsx($,{permission:I.EDIT_QUOTATION,children:e.jsxs(E,{onClick:()=>{j(),C.onClose()},children:[e.jsx(x,{icon:"solar:pen-bold"}),`${d("listView.table.tableActions.edit")}`]})}),t.status!==h.Canceled&&e.jsx($,{permission:I.DELETE_QUOTATION,children:e.jsxs(E,{onClick:()=>{p.onTrue(),C.onClose()},sx:{color:"warning.main"},children:[e.jsx(x,{icon:"solar:trash-bin-trash-bold"}),`${d("listView.table.tableActions.cancel")}`]})})]})}),e.jsx(ts,{open:p.value,onClose:p.onFalse,title:"Cancel Quotation",content:"Are you sure want to cancel this quotation?",action:e.jsx(K,{variant:"contained",color:"warning",onClick:()=>{b(),p.onFalse()},children:"Confirm Canceling"})})]})}const gs=({selectedQuotation:t,handleResize:n,handleClose:o})=>{var ce,xe,me,he,ue,pe;const{t:r}=J("quotations"),[s,j]=m.useState(t),b=ie({queryKey:["quotation",s.id],queryFn:async()=>{const{data:a}=await R.get(V.quotation.details+s.id);return j(a),a}}),u=[{value:"details",icon:e.jsx(x,{icon:"solar:eye-bold",width:24}),label:`${r("detailsCard.quotationDetailsTab")}`},{value:"tickets",icon:e.jsx(x,{icon:"solar:case-minimalistic-bold",width:24}),label:`${r("detailsCard.ticketsTab")}`},{value:"reminders",icon:e.jsx(x,{icon:"solar:calendar-bold",width:24}),label:`${r("detailsCard.remindersTab")}`}];m.useEffect(()=>{t.id!==s.id&&j(t)},[s.id,t]);const p=Te(),{mutate:d}=z({mutationFn:a=>R.post(V.quotation.createOrder,a),onSuccess:async({data:a})=>{W.success("Order Has Been Created!");const{id:N}=s;await p.invalidateQueries({queryKey:["quotations"]}),await p.invalidateQueries({queryKey:["quotation",N]})},onError:a=>{console.log(a)}}),{mutate:f}=z({mutationFn:a=>R.post(V.quotation.share,a),onSuccess:async({data:a})=>{W.success("Quotation has been sended to the customer.")},onError:a=>{console.log(a)}}),{mutate:C}=z({mutationFn:a=>R.patch(V.quotation.editStatus+a,{status:h.Confirmed}),onSuccess:async({data:a})=>{W.success("Quotation Has Been Confirmed!");const{id:N}=s;await p.invalidateQueries({queryKey:["quotations"]}),await p.invalidateQueries({queryKey:["quotation",N]})},onError:a=>{console.log(a)}}),v=rs("details"),[T,P]=m.useState(!1),g=()=>{P(!0)},{data:B,isLoading:c,error:k}=ie({queryKey:["download-quotation",s.id],queryFn:async()=>{const a=await R.get(V.quotation.downloadPdf+s.id,{responseType:"blob"}),N=window.URL.createObjectURL(new Blob([a.data])),M=document.createElement("a");return M.href=N,M.setAttribute("download",`Quotation-${s.ref}.pdf`),document.body.appendChild(M),M.click(),document.body.removeChild(M),P(!1),a.data},enabled:T,onSuccess:()=>{P(!1)},onError:a=>{console.error("Download failed:",a)}}),O=e.jsx(D,{title:r("detailsCard.tooltips.downloadTooltip"),children:e.jsx(w,{onClick:g,children:c?e.jsx(ms,{size:24,color:"inherit"}):e.jsx(x,{icon:"eva:cloud-download-fill",color:"error.main"})})}),L=e.jsxs(y,{alignItems:"flex-end",sx:{p:1,textAlign:"right",typography:"body2"},children:[e.jsxs(y,{direction:"row",children:[e.jsx(l,{sx:{color:"text.secondary"},children:r("detailsCard.subtotal")}),e.jsx(l,{sx:{width:160,typography:"subtitle2"},children:U(s==null?void 0:s.totalAmount)||"-"})]}),e.jsxs(y,{direction:"row",children:[e.jsx(l,{sx:{color:"text.secondary"},children:r("detailsCard.discount")}),e.jsx(l,{sx:{width:160,...(s==null?void 0:s.discount)&&{color:"error.main"}},children:s!=null&&s.discount?`- ${s==null?void 0:s.discount}%`:"-"})]}),e.jsxs(y,{direction:"row",children:[e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.tax")," (",(s==null?void 0:s.snapshotTaxPercentage)||"0","%)"]}),e.jsx(l,{sx:{width:160},children:s!=null&&s.snapshotTaxPercentage?U(Re((s==null?void 0:s.totalAmount)-(s==null?void 0:s.totalAmount)*((s==null?void 0:s.discount)/100),s==null?void 0:s.snapshotTaxPercentage)):"-"})]}),e.jsxs(y,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:r("detailsCard.total")}),e.jsx(l,{sx:{width:160},children:U(ye((s==null?void 0:s.totalAmount)-(s==null?void 0:s.totalAmount)*((s==null?void 0:s.discount)/100),s==null?void 0:s.snapshotTaxPercentage))||"-"})]})]}),A=Y(),H=Y(),X=e.jsxs(y,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsxs(l,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",m:1},children:[e.jsxs(l,{flexDirection:"column",sx:{display:"flex"},children:[e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.quotationRef")," #",s==null?void 0:s.ref]}),e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.quotationDate")," ",re(s==null?void 0:s.quotationDate)]}),e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.quotationExpiry")," ",re(s==null?void 0:s.expiredDate)]})]}),e.jsx(l,{sx:{mr:2},children:e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.status"),e.jsxs(ge,{variant:"soft",color:(s==null?void 0:s.status)===h.Confirmed&&"info"||(s==null?void 0:s.status)===h.Converted&&"success"||(s==null?void 0:s.status)===h.Canceled&&"error"||"default",children:[(s==null?void 0:s.status)===h.Created&&`${r("listView.table.tableToolbar.selectMenu.created")}`,(s==null?void 0:s.status)===h.Confirmed&&`${r("listView.table.tableToolbar.selectMenu.confirmed")}`,(s==null?void 0:s.status)===h.Converted&&`${r("listView.table.tableToolbar.selectMenu.converted")}`,(s==null?void 0:s.status)===h.Canceled&&`${r("listView.table.tableToolbar.selectMenu.canceled")}`]})]})}),((ce=s==null?void 0:s.order)==null?void 0:ce.id)&&e.jsx(l,{sx:{color:"text.secondary"},className:"print-hide",children:e.jsxs(K,{variant:"contained",size:"small",startIcon:e.jsx(x,{icon:"heroicons-outline:external-link"}),onClick:()=>{const{id:a}=s==null?void 0:s.order;a&&F(a)},children:[r("detailsCard.relatedToQuotation")," #",(xe=s==null?void 0:s.order)==null?void 0:xe.ref]})})]}),e.jsxs(l,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsx(ds,{products:s==null?void 0:s.productToQuotation,defaultRowsPerPage:s!=null&&s.notes?5:10}),e.jsx(_,{sx:{mt:1}})]}),L,(s==null?void 0:s.notes)&&e.jsxs(l,{children:[e.jsx(_,{}),e.jsx(y,{sx:{typography:"body2"},children:e.jsx(l,{sx:{p:1},children:e.jsxs(y,{sx:{typography:"subtitle2"},children:[e.jsxs("div",{children:[r("detailsCard.notes"),":"]}),e.jsx(l,{sx:{color:"text.secondary"},children:s==null?void 0:s.notes})]})})})]})]}),Z=a=>a.isPending||a.isLoading?e.jsx(le,{}):a.isError?e.jsx(oe,{}):e.jsxs(y,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsx(l,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(l,{children:e.jsx($,{permission:I.ADD_TICKET,children:e.jsx(K,{onClick:()=>A.onToggle(),variant:"contained",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),children:r("detailsCard.newTicket")})})})}),e.jsx(_,{}),e.jsx(l,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(is,{tickets:b.data.tickets})})]}),q=a=>a.isPending||a.isLoading?e.jsx(le,{}):a.isError?e.jsx(oe,{}):e.jsxs(y,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsx(l,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(l,{children:e.jsx($,{permission:I.ADD_REMINDER,children:e.jsx(K,{onClick:()=>H.onToggle(),variant:"contained",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),children:r("detailsCard.newReminder")})})})}),e.jsx(_,{}),e.jsx(l,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(os,{reminders:b.data.reminders})})]}),G=Ve(),i=we(),F=m.useCallback(a=>{i.push(Q.dashboard.order.details(a))},[i]),Pe=m.useCallback(a=>{i.push(Q.dashboard.quotation.details(a))},[i]),ke=m.useCallback(a=>{i.push(Q.dashboard.quotation.edit(a))},[i]),de=m.useRef();return ns.useReactToPrint({content:()=>de.current}),e.jsxs(e.Fragment,{children:[e.jsxs(ve,{ref:de,sx:{height:1,display:"flex",flexDirection:"column",width:1,transition:"all 2s ease-in-out"},children:[e.jsx("style",{jsx:!0,children:`
          .print-title {
            display: none; /* Hide on screen */
          }

          @media print {
            html,
            body {
              height: initial !important;
              overflow: initial !important;
            }
            .print-title {
              display: block; /* Show only when printing */
            }
            .print-hide {
              display: none; /* Hide on screen */
            }
            .print-padding {
              padding: 5px;
            }
            .print-top-margin {
              margin-top: 40px;
            }
          }
        `}),e.jsxs(hs,{className:"print-hide ",value:v.value,onChange:v.onChange,sx:{px:3,boxShadow:a=>`inset 0 -2px 0 0 ${ee(a.vars.palette.grey["500Channel"],.08)}`},children:[u.map(a=>e.jsx(us,{icon:a.icon,value:a.value,label:a.label},a.value)),e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${ee(G.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(w,{sx:{ml:1},onClick:n,children:e.jsx(x,{icon:"solar:full-screen-bold",width:24})})}),e.jsx(l,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${ee(G.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(w,{sx:{ml:1},onClick:o,children:e.jsx(x,{icon:"solar:close-square-outline",width:24})})})]}),e.jsxs(l,{className:"print-top-margin print-padding",sx:{display:"flex",flexDirection:"column",position:"relative",flex:1},children:[e.jsx(ps,{sx:{pt:1},title:s==null?void 0:s.name,subheader:`Quotation for Customer : ${(me=s==null?void 0:s.customer)==null?void 0:me.name}`,action:e.jsx(y,{spacing:3,className:"print-hide",direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"},sx:{mb:{xs:3,md:5}},children:e.jsxs(y,{direction:"row",spacing:1,flexGrow:1,sx:{width:1},children:[e.jsx(D,{title:"View",children:e.jsx(w,{onClick:()=>{Pe(s==null?void 0:s.id)},children:e.jsx(x,{icon:"solar:eye-bold",color:"primary.main"})})}),(s==null?void 0:s.status)===h.Created&&e.jsx(D,{title:"Edit",children:e.jsx(w,{onClick:()=>{ke(s==null?void 0:s.id)},children:e.jsx(x,{icon:"solar:pen-bold",color:"warning.main"})})}),(s==null?void 0:s.status)===h.Created&&e.jsx(D,{title:"Confirm",children:e.jsx(w,{onClick:()=>{C(s==null?void 0:s.id)},children:e.jsx(x,{icon:"line-md:confirm-circle-filled"})})}),e.jsx($,{permission:I.CONVERT_QUOTATION_TO_ORDER,children:!((he=s==null?void 0:s.order)!=null&&he.id)&&((s==null?void 0:s.status)===h.Created||(s==null?void 0:s.status)===h.Confirmed)&&e.jsx(D,{title:"Convert to Order",children:e.jsx(w,{onClick:()=>{d({quotationId:s==null?void 0:s.id})},children:e.jsx(x,{icon:"solar:restart-circle-bold"})})})}),((ue=s==null?void 0:s.order)==null?void 0:ue.id)&&e.jsx(D,{title:`Related to Order: #${(pe=s==null?void 0:s.order)==null?void 0:pe.ref}`,children:e.jsx(w,{onClick:()=>{var a;F((a=s==null?void 0:s.order)==null?void 0:a.id)},children:e.jsx(x,{icon:"heroicons-outline:external-link"})})}),O,e.jsx($,{permission:I.PRINT_QUOTATION,children:e.jsx(D,{title:"Print",children:e.jsx(ls,{quotation:s})})}),e.jsx(D,{title:"Send To the Customer",children:e.jsx(w,{onClick:()=>{f({id:s.id})},children:e.jsx(x,{icon:"iconamoon:send-fill",color:"info.main"})})})]})})}),e.jsx(_,{}),v.value==="details"&&X,v.value==="tickets"&&Z(b),v.value==="reminders"&&q(b)]})]}),e.jsx(cs,{open:A.value,onClose:A.onFalse,quotation:s}),e.jsx(xs,{open:H.value,onClose:H.onFalse,quotation:s})]})};function Ts({filters:t,onResetPage:n}){const[o,r]=m.useState("all"),{t:s}=J("quotations"),j=m.useCallback(u=>{n(),t.setState({name:u.target.value})},[t,n]),b=m.useCallback(u=>{n(),t.setState({status:u.target.value}),r(u.target.value)},[t,n]);return e.jsxs(y,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(js,{sx:{width:420},value:t.state.name,onChange:j,placeholder:`${s("listView.table.tableToolbar.searchPlaceholder")}`,InputProps:{startAdornment:e.jsx(bs,{position:"start",children:e.jsx(x,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(fs,{sx:{width:420,textTransform:"capitalize"},value:o,onChange:b,children:[e.jsx(E,{value:"all",children:`${s("listView.table.tableToolbar.selectMenu.allQuotations")}`}),e.jsx(E,{value:"Created",children:`${s("listView.table.tableToolbar.selectMenu.created")}`}),e.jsx(E,{value:"Confirmed",children:`${s("listView.table.tableToolbar.selectMenu.confirmed")}`}),e.jsx(E,{value:"Canceled",children:`${s("listView.table.tableToolbar.selectMenu.canceled")}`}),e.jsx(E,{value:"Converted",children:`${s("listView.table.tableToolbar.selectMenu.converted")}`})]})]})}function ws({filters:t,totalResults:n,onResetPage:o,sx:r}){const s=m.useCallback(()=>{o(),t.setState({name:""})},[t,o]),j=m.useCallback(()=>{o(),t.setState({status:"all"})},[t,o]),b=m.useCallback(()=>{o(),t.setState({startDate:null,endDate:null})},[t,o]),u=m.useCallback(()=>{o(),t.onResetState()},[t,o]);return e.jsxs(Cs,{totalResults:n,onReset:u,sx:r,children:[e.jsx(te,{label:"Status:",isShow:t.state.status!=="all",children:e.jsx(ne,{...ae,label:t.state.status,onDelete:j,sx:{textTransform:"capitalize"}})}),e.jsx(te,{label:"Date:",isShow:!!(t.state.startDate&&t.state.endDate),children:e.jsx(ne,{...ae,label:Oe(t.state.startDate,t.state.endDate),onDelete:b})}),e.jsx(te,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(ne,{...ae,label:t.state.name,onDelete:s})})]})}function vs({quotations:t}){const n=ze({defaultOrderBy:"orderId",defaultRowsPerPage:5}),{t:o}=J("quotations"),[r,s]=m.useState(),[j,b]=m.useState(!1),u=[{id:"ref",label:"#",width:88},{id:"details",label:`${o("listView.table.tableHeader.details")}`},{id:"createdAt",label:`${o("listView.table.tableHeader.date")}`,width:140},{id:"totalQuantity",label:`${o("listView.table.tableHeader.items")}`,width:120,align:"center"},{id:"totalAmount",label:`${o("listView.table.tableHeader.price")}`,width:140},{id:"createdBy",label:`${o("listView.table.tableHeader.createdBy")}`,width:200},{id:"status",label:`${o("listView.table.tableHeader.status")}`,width:110},{id:"",width:88}],[p,d]=m.useState(u),f=we(),[C,v]=m.useState(()=>t),T=Le({name:"",status:"all",startDate:null,endDate:null});m.useEffect(()=>{if(b(!1),v(t),r){const i=t.find(F=>F.id===r.id);s(i)}},[t]),m.useEffect(()=>{const i=r?u.filter(F=>!["createdBy","status",""].includes(F.id)):u;d(i)},[r]);const P=Fe(T.state.startDate,T.state.endDate),g=Ps({inputData:C,comparator:Ue(n.order,n.orderBy),filters:T.state,dateError:P}),B=Ge(g,n.page,n.rowsPerPage),c=!!T.state.name||T.state.status!=="all"||!!T.state.startDate&&!!T.state.endDate,k=!g.length&&c||!g.length,O=Te(),{mutate:L}=z({mutationFn:i=>R.delete(V.quotation.delete+i),onSuccess:async()=>{W.success("Order Has Been Canceled!")},onSettled:async()=>{await O.invalidateQueries({queryKey:["quotations"]})},onError:()=>{}}),A=m.useCallback(i=>{L(i)},[B.length,n,C]),H=m.useCallback(i=>{f.replace(Q.dashboard.quotation.details(i))},[f]),X=m.useCallback(i=>{f.replace(Q.dashboard.quotation.edit(i))},[f]),Z=()=>{b(!j)},q=()=>{s(null),b(!1)},G=i=>{s(i)};return e.jsx(Be,{maxWidth:"xl",children:e.jsxs(se,{container:!0,spacing:3,children:[e.jsx(se,{xs:12,md:12,children:e.jsx(Ke,{links:[{name:`${o("listView.breadCrumbsPageRootTitle")}`,href:Q.dashboard.root},{name:`${o("listView.breadCrumbsParentPageTitle")}`,href:Q.dashboard.quotation.root},{name:`${o("listView.breadCrumbsPageTitle")}`}],action:e.jsx($,{permission:I.ADD_QUOTATION,children:e.jsx(K,{component:He,href:Q.dashboard.quotation.new,variant:"contained",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),children:`${o("listView.addNewQuotation")}`})})})}),e.jsxs($,{permission:I.LIST_QUOTATION,children:[!j&&e.jsx(se,{xs:12,md:r?5:12,children:e.jsxs(ve,{children:[e.jsx(Ts,{filters:T,onResetPage:n.onResetPage,dateError:P}),c&&e.jsx(ws,{filters:T,totalResults:g.length,onResetPage:n.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(l,{sx:{position:"relative"},children:[e.jsx(es,{dense:n.dense,numSelected:n.selected.length,rowCount:g.length}),e.jsx(Ne,{sx:{minHeight:444},children:e.jsxs(Xe,{size:n.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Ze,{order:n.order,orderBy:n.orderBy,headLabel:p,rowCount:g.length}),e.jsxs(qe,{children:[g.slice(n.page*n.rowsPerPage,n.page*n.rowsPerPage+n.rowsPerPage).map(i=>e.jsx(ys,{row:i,selected:n.selected.includes(i.id),onSelectRow:()=>n.onSelectRow(i.id),onDeleteRow:()=>A(i.id),onViewRow:()=>H(i.id),onEditRow:()=>X(i.id),onClickRow:()=>G(i),isFullDisplay:r},i.id)),e.jsx(Je,{height:n.dense?56:76,emptyRows:We(n.page,n.rowsPerPage,g.length)}),e.jsx(Ye,{notFound:k})]})]})})]}),e.jsx(ss,{page:n.page,dense:n.dense,count:g.length,rowsPerPage:n.rowsPerPage,onPageChange:n.onChangePage,onChangeDense:n.onChangeDense,onRowsPerPageChange:n.onChangeRowsPerPage})]})}),r&&e.jsx(l,{sx:{display:"flex",flex:1,p:1.5,transition:"all 2s ease-in-out"},children:e.jsx(gs,{selectedQuotation:r,handleResize:Z,handleClose:q})})]})]})})}function Ps({inputData:t,comparator:n,filters:o,dateError:r}){const{status:s,name:j,startDate:b,endDate:u}=o,p=t==null?void 0:t.map((d,f)=>[d,f]);return p==null||p.sort((d,f)=>{const C=n(d[0],f[0]);return C!==0?C:d[1]-f[1]}),t=p==null?void 0:p.map(d=>d[0]),j&&(t=t.filter(d=>d.id.toString().toLowerCase().indexOf(j.toLowerCase())!==-1||d.customer.name.toLowerCase().indexOf(j.toLowerCase())!==-1||d.status.toLowerCase().indexOf(j.toLowerCase())!==-1||d.customer.email.toLowerCase().indexOf(j.toLowerCase())!==-1)),s!=="all"&&(t=t.filter(d=>d.status===s)),r||b&&u&&(t=t.filter(d=>Me(d.createTime,b,u))),t}const ks={title:`Quotation list | Dashboard - ${Ce.site.name}`};function _t(){const t=ie({queryKey:["quotations"],queryFn:async()=>{const{data:n}=await R.get(V.quotation.list);return n}});return t.isLoading?e.jsx(le,{}):t.isError?e.jsx(oe,{route:Q.dashboard.quotation.root}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{children:e.jsxs("title",{children:[" ",ks.title]})}),e.jsx(vs,{quotations:t.data})]})}export{_t as default};

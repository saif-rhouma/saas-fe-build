import{j as e,B as n,T as H,ea as K,d6 as I,S as o,e2 as C,e as y,I as L,aB as B,eb as $,ec as W,aH as w,dc as G,r as x,i as P,dm as M,ed as Y,ee as O,dP as _,p as v,ay as b,dn as j,dl as f,dp as D,dT as J,H as V,C as X}from"./index-Cs0Sdxyr.js";import{u as z,E as U}from"./error-block-t40v2wjH.js";import{u as Z}from"./use-params-DtXHnO1y.js";import"./chart-legends-BOu7EPkb.js";import{l as ee}from"./index-C41r4X6T.js";import{u as T}from"./useMutation-Dzc6--kZ.js";import{C as se}from"./confirm-dialog-BRKbYDyG.js";import{C as te}from"./custom-breadcrumbs-BT-Xn517.js";import{b as g}from"./format-number-TrbPmgcB.js";import{P as S}from"./permission-access-controller-Bt7nfdf-.js";import{T as ie,t as ne,a as ae,b as re,c as oe,d as le,e as ce}from"./TimelineSeparator-Bv8S6W30.js";import{C as E}from"./CardHeader-CuZqV3ML.js";import{O as de}from"./order-product-table-CLXWAnbN.js";import{O as xe}from"./order-payment-details-dialog-D8lbn3iK.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./index-B3bfrtVg.js";import"./DialogContent-Crbj6g6G.js";import"./DialogTitle-DrSBT5S6.js";import"./table-head-custom-DweneoZv.js";import"./TableCell-DQSLj1b3.js";import"./Checkbox-BnpdbSxp.js";import"./incrementer-button-CR-GNg1S.js";import"./form-provider-eXyauyxJ.js";import"./TextField-CLYezYfw.js";import"./FormControl-LO9oSJ-o.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-QrwSoYWN.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-CwQQfAsE.js";import"./Select-DDfA3_-T.js";import"./Menu-DSuiBPzi.js";import"./InputBase-BXi8ZaFZ.js";import"./FormHelperText-DkkzjVxJ.js";import"./Rating-BF02HLKo.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-CT3ylhik.js";import"./index-DnS4NWxD.js";import"./Slider-7HzlrEFX.js";import"./RadioGroup-CzKzAp9k.js";import"./FormGroup-BF9selVP.js";import"./FormControlLabel-nLpLCzjO.js";import"./countries-DSLisFCy.js";import"./InputAdornment-B5qV_qPb.js";import"./Autocomplete-BlKHEWOH.js";import"./Chip-xRW8ggU-.js";import"./country-select-D1lnH3Yh.js";import"./upload-avatar-BmI9utwN.js";import"./image-Cq9K1zAl.js";import"./DatePicker-CTzww6R8.js";import"./ListItem-pAOUhWgY.js";import"./MobileDateTimePicker-D7Ni8uEz.js";import"./Tabs-COnq56DM.js";import"./KeyboardArrowRight-jFTTvq_T.js";import"./schema-helper-Ggm2aOvk.js";import"./LoadingButton-BC7HOYkj.js";import"./CircularProgress-DjaT2AqC.js";const pe=({order:s,payments:t,dialog:r,handleApproveOrder:a,handlePrint:p})=>{const c=e.jsxs(n,{sx:{pr:4,pl:4,pb:4,pt:2},children:[e.jsx(ie,{sx:{p:0,m:0,[`& .${ne.root}:before`]:{flex:0,padding:0}},children:t==null?void 0:t.map((d,l)=>{const m=l===0,h=l===t.length-1;return e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(oe,{color:m&&"primary"||"grey"}),h?null:e.jsx(le,{})]}),e.jsx(ce,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsx(H,{variant:"subtitle2",children:g(d.amount)}),e.jsx(n,{sx:{color:"text.disabled",typography:"caption",mt:.5},children:K(d.paymentDate)})]}),e.jsx(I,{color:"success",children:d.paymentType})]})})]},d.id)})}),e.jsxs(o,{justifyContent:"flex-end",spacing:1.5,sx:{marginTop:2},children:[e.jsx(S,{permission:C.ADD_PAYMENT,children:e.jsx(y,{variant:"contained",onClick:()=>r.onTrue(),children:"Add Payment"})}),(s==null?void 0:s.status)==="Draft"&&e.jsx(y,{variant:"outlined",onClick:()=>{a(s.id)},children:"Approve"}),e.jsx(S,{permission:C.PRINT_ORDER,children:e.jsxs(y,{variant:"outlined",color:"info",onClick:()=>p(),children:[e.jsx(L,{icon:"solar:printer-minimalistic-bold"}),e.jsx("span",{style:{margin:4},children:"Print Order"})]})})]})]});return e.jsxs(B,{children:[(t==null?void 0:t.length)>0&&e.jsx(E,{title:"Payments"}),c]})};function me({order:s,discount:t,customer:r,totalAmount:a}){const p=e.jsxs(o,{spacing:2,alignItems:"flex-end",sx:{p:3,textAlign:"right",typography:"body2"},children:[e.jsxs(o,{direction:"row",children:[e.jsx(n,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(n,{sx:{width:160,typography:"subtitle2"},children:g(a)||"-"})]}),e.jsxs(o,{direction:"row",children:[e.jsx(n,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(n,{sx:{width:160,...t&&{color:"error.main"}},children:t?`- ${t}%`:"-"})]}),e.jsxs(o,{direction:"row",children:[e.jsxs(n,{sx:{color:"text.secondary"},children:["Tax (",(s==null?void 0:s.snapshotTaxPercentage)||"0","%)"]}),e.jsx(n,{sx:{width:160},children:s!=null&&s.snapshotTaxPercentage?g($(a-a*(t/100),s==null?void 0:s.snapshotTaxPercentage)):"-"})]}),e.jsxs(o,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:"Gross Total"}),e.jsx(n,{sx:{width:160},children:g(W(a-a*(t/100),s==null?void 0:s.snapshotTaxPercentage))||"-"})]})]});return e.jsxs(B,{children:[e.jsx(o,{justifyContent:"center",alignItems:"center",children:e.jsxs("h1",{className:"print-title",children:["Order REF: #",s.ref]})}),e.jsx("style",{jsx:!0,children:`
        .print-title {
          display: none; /* Hide on screen */
        }

        @media print {
          .print-title {
            display: block; /* Show only when printing */
          }
          .print-hide {
            display: none; /* Hide on screen */
          }
        }
      `}),e.jsx(E,{className:"print-hide",title:"Details"}),e.jsxs(o,{direction:"row",justifyContent:"space-between",sx:{p:3,typography:"body2"},children:[e.jsxs(n,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[e.jsx(o,{direction:"row",sx:{typography:"subtitle2",marginBottom:1},children:e.jsx("div",{children:"Order Details"})}),e.jsxs(n,{sx:{color:"text.secondary"},children:["ORDER ID: #",s.ref]}),e.jsxs(n,{sx:{color:"text.secondary"},children:["Order Date: ",w(s.orderDate)]}),e.jsxs(n,{sx:{color:"text.secondary"},children:["Delivery Date: ",s.deliveryDate?w(s.deliveryDate):e.jsx("span",{children:" - "})]})]}),e.jsxs(n,{flexDirection:"column",gap:.5,sx:{display:"flex",width:"100%",p:1,borderRight:c=>`dashed 2px ${c.vars.palette.background.neutral}`,borderLeft:c=>`dashed 2px ${c.vars.palette.background.neutral}`},children:[e.jsx(o,{display:"flex",justifyContent:"center",alignItems:"center",sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:e.jsx("div",{children:"NFCAC"})}),e.jsxs(n,{sx:{color:"text.secondary"},children:["Status :"," ",e.jsx(I,{variant:"soft",color:(s==null?void 0:s.status)==="Ready"&&"info"||(s==null?void 0:s.status)==="InProcess"&&"warning"||(s==null?void 0:s.status)==="Delivered"&&"success"||"default",children:s==null?void 0:s.status})]}),e.jsxs(n,{sx:{color:"text.secondary"},children:["TAX: ",r==null?void 0:r.taxNumber]})]}),e.jsxs(n,{flexDirection:"column",alignItems:"center",sx:{p:1,display:"flex",width:"100%"},children:[e.jsx(o,{display:"flex",alignItems:"center",gap:1,sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:e.jsx("div",{children:"Invoice To"})}),e.jsx(n,{sx:{color:"text.secondary"},children:r==null?void 0:r.name}),e.jsxs(n,{sx:{color:"text.secondary"},children:["Tel: ",r==null?void 0:r.phoneNumber]})]})]}),e.jsx(G,{children:e.jsx(n,{fullWidth:!0,alignItems:"center",sx:{p:3,borderBottom:c=>`dashed 2px ${c.vars.palette.background.neutral}`},children:e.jsx(de,{products:s.productToOrder,isDetail:!0})})}),p,(s==null?void 0:s.notes)&&e.jsx(o,{justifyContent:"space-between",sx:{p:3,typography:"body2"},children:e.jsxs(n,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[e.jsx(o,{sx:{typography:"subtitle2",marginBottom:1},children:e.jsx("div",{children:"Notes:"})}),e.jsx(n,{sx:{color:"text.secondary"},children:s==null?void 0:s.notes})]})})]})}function he({currentOrder:s}){const[t,r]=x.useState(s),[a,p]=x.useState(),c=x.useRef(),d=P(),l=M(),[m,h]=x.useState([]),u=P(),F=Y();x.useEffect(()=>{r(s)},[s]),x.useEffect(()=>{const i=O(t==null?void 0:t.payments,"paymentDate");h(i)},[t==null?void 0:t.payments]);const{mutate:k}=T({mutationFn:i=>j.post(f.payments.create,i),onSuccess:async i=>{D.success("New Payment Has Been Created!");const{data:R}=i,N=O([...m,R],"paymentDate");h(N)},onSettled:async()=>{await l.invalidateQueries({queryKey:["payments"]});const{id:i}=t;await l.invalidateQueries({queryKey:["order",i]}),d.onFalse()},onError:i=>{console.log(i)}}),{mutate:q}=T({mutationFn:i=>j.get(f.order.approve+i),onSuccess:async({data:i})=>{i!=null&&i.length?(u.onTrue(),p(i)):(D.success("Order Has Been Approved!"),r(i))},onSettled:async()=>{const{id:i}=t;await l.invalidateQueries({queryKey:["orders"]}),await l.invalidateQueries({queryKey:["orders","analytics"]}),await l.invalidateQueries({queryKey:["order",i]})},onError:i=>{console.log(i)}}),{mutate:A}=T({mutationFn:i=>j.post(f.order.createPlans,i),onSuccess:async({data:i})=>{D.success("Order Has Been Approved!"),r(i),u.onFalse()},onSettled:async()=>{const{id:i}=t;await l.invalidateQueries({queryKey:["orders"]}),await l.invalidateQueries({queryKey:["orders","analytics"]}),await l.invalidateQueries({queryKey:["order",i]})},onError:i=>{console.log(i)}}),Q=ee.useReactToPrint({content:()=>c.current});return e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx(te,{links:[{name:"Dashboard",href:v.dashboard.root},{name:"Order",href:v.dashboard.order.root},{name:"Order Details"}],sx:{mb:{xs:3,md:5}}}),e.jsxs(b,{container:!0,spacing:3,children:[e.jsx(b,{xs:12,md:9,children:e.jsx(o,{ref:c,spacing:3,direction:{xs:"column-reverse",md:"column"},children:e.jsx(me,{order:t,customer:t==null?void 0:t.customer,discount:t==null?void 0:t.discount,totalAmount:t==null?void 0:t.totalOrderAmount})})}),e.jsx(b,{xs:12,md:3,children:e.jsx(pe,{order:t,payments:m,dialog:d,handleApproveOrder:q,handlePrint:Q})})]}),e.jsx(xe,{order:t,open:d.value,onClose:d.onFalse,handler:k})]}),e.jsx(se,{open:u.value,onClose:u.onFalse,title:"Out of Stock",content:e.jsxs(e.Fragment,{children:[e.jsx(n,{children:"Products are out of Stock! do you want to create plans?"}),e.jsxs(n,{sx:{mt:1,mb:1},children:["You need to create ",e.jsx("span",{style:{fontWeight:"bold"},children:a==null?void 0:a.length})," :"]}),a==null?void 0:a.map(i=>e.jsxs(n,{children:["Plan for ",e.jsx("span",{style:{fontWeight:"bold"},children:i.product.name})," because is missing"," ",e.jsx("span",{style:{fontWeight:"bold",color:`${F.vars.palette.error.light}`},children:i.missingQuantity}),"."]}))]}),action:e.jsx(y,{variant:"contained",color:"error",onClick:()=>{A(a)},children:(a==null?void 0:a.length)>1?"Create Plans":"Create Plan"})})]})}const ue={title:`Order details | Dashboard - ${X.site.name}`};function bs(){const{id:s=""}=Z(),t=z({queryKey:["order",s],queryFn:async()=>{const{data:r}=await j.get(f.order.details+s);return r}});return t.isPending||t.isLoading?e.jsx(J,{}):t.isError?e.jsx(U,{route:v.dashboard.order.root}):e.jsxs(e.Fragment,{children:[e.jsx(V,{children:e.jsxs("title",{children:[" ",ue.title]})}),e.jsx(he,{currentOrder:t.data})]})}export{bs as default};

import{Y as j,br as E,a3 as _,j as e,d1 as z,e as T,I as h,$ as W,dc as U,a6 as G,a7 as P,e4 as f,r as u,S as V,df as J,e3 as Y,dp as Z,W as X,p as C,dQ as ee,cZ as te,B as se,de as oe,ed as ae,dq as D,dn as y,dr as k,dU as re,H as ne,C as ie}from"./index-3kUlxXkm.js";import{u as le,E as de}from"./error-block-BTCpMwIj.js";import{u as v}from"./useMutation-DWyFExRk.js";import{d as ce}from"./download-file-BpJCjP7w.js";import{C as me}from"./custom-breadcrumbs-CQM3hT8w.js";import{P as w}from"./permission-access-controller-6Z2YefAG.js";import{g as pe,r as ue,e as he}from"./utils-MBUcMVfY.js";import{u as xe}from"./use-table-9MzCtmNE.js";import{T as ge}from"./table-no-data-DRMtffow.js";import{T as be}from"./table-empty-rows-R6XLgnwX.js";import{T as je,a as Ce,b as fe,c as we}from"./table-head-custom-Bzh_BuNQ.js";import{T as Re}from"./table-selected-action-77MIBAPT.js";import{T as Pe}from"./table-pagination-custom-HAHTP3sF.js";import{C as Te}from"./confirm-dialog-DcDyWDMb.js";import{T as b}from"./TableCell-YgDy_fKI.js";import{R as A}from"./reminder-create-dialog-CBV46smf.js";import{T as De}from"./TextField-Ff9PgcBD.js";import{I as ye}from"./InputAdornment-Ug97Thua.js";import{F as Ee,a as Fe,c as Se}from"./filters-result-CHuN9x5s.js";import{C as Ie}from"./Chip-yUQfyewU.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-DygIpP7Y.js";import"./Checkbox-BPHZ30Zu.js";import"./TablePagination-CVcJMlXd.js";import"./KeyboardArrowRight-o7aJmcRm.js";import"./LastPage-FHI8cfYQ.js";import"./Select-DOB8r047.js";import"./Menu-CsXXwNKW.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-Df4WeLlJ.js";import"./FormControlLabel-DWtRb9VA.js";import"./DialogContent-BZuUPSmG.js";import"./DialogTitle-DD3683-9.js";import"./form-provider-Ddj1YnLe.js";import"./FormHelperText-47ensrNn.js";import"./Rating-BWS0RvVN.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-BMX_0Xq6.js";import"./index-nrKetuMS.js";import"./Slider-Dlywp6Zb.js";import"./FormControl-BaWzc8Dl.js";import"./FormLabel-CX5M124t.js";import"./RadioGroup-D6FwwOLi.js";import"./FormGroup-DHewWmvb.js";import"./utils-NIylK1Um.js";import"./index-BySBJlbP.js";import"./countries-DSLisFCy.js";import"./Autocomplete-CuAKdGKX.js";import"./country-select-i0JEsBFQ.js";import"./InputLabel-Df2ESQnA.js";import"./upload-avatar-BbAzKhJK.js";import"./format-number-CFuBAOSh.js";import"./image-BEDFCDEn.js";import"./DatePicker-vbOob6Xb.js";import"./ListItem-CBu29PKK.js";import"./MobileDateTimePicker-DlpjHwQr.js";import"./Tabs-Cs2uCeCP.js";import"./upload-box-ad-C5ekRHFU.js";import"./schema-helper-pKPnN3t8.js";import"./LoadingButton-BtwwM36s.js";import"./CircularProgress-CZhO4lMk.js";const ke=({row:t,index:s,selected:r,onViewFileRow:i,onDeleteRow:l,onEditRow:d,onViewQuotationRow:x})=>{var n;const m=j(),{t:c}=E("reminders"),o=_(),p=e.jsxs(je,{hover:!0,selected:r,children:[e.jsx(b,{children:s||(t==null?void 0:t.id)}),e.jsx(b,{children:z(t.reminderDate)}),e.jsx(b,{children:t.title}),e.jsx(b,{children:(n=t.quotation)!=null&&n.ref?e.jsxs(T,{variant:"contained",size:"small",startIcon:e.jsx(h,{icon:"heroicons-outline:external-link"}),onClick:()=>{t.quotation.id&&x(t.quotation.id)},children:["#",t.quotation.ref]}):"-"}),e.jsx(b,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(W,{color:o.open?"inherit":"default",onClick:o.onOpen,children:e.jsx(h,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[p,e.jsx(U,{open:o.open,anchorEl:o.anchorEl,onClose:o.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(G,{children:[(t==null?void 0:t.file)&&e.jsxs(P,{onClick:()=>{i(),o.onClose()},children:[e.jsx(h,{icon:"solar:cloud-download-bold"}),c("listView.table.tableActions.download")]}),e.jsx(w,{permission:f.ADD_REMINDER,children:e.jsxs(P,{onClick:()=>{d(),o.onClose()},children:[e.jsx(h,{icon:"solar:pen-bold"}),c("listView.table.tableActions.edit")]})}),e.jsx(w,{permission:f.ADD_REMINDER,children:e.jsxs(P,{onClick:()=>{m.onTrue(),o.onClose()},sx:{color:"error.main"},children:[e.jsx(h,{icon:"solar:trash-bin-trash-bold"}),c("listView.table.tableActions.delete")]})})]})}),e.jsx(Te,{open:m.value,onClose:m.onFalse,title:c("listView.messages.dialogDelete.title"),content:c("listView.messages.dialogDelete.text"),action:e.jsx(T,{variant:"contained",color:"error",onClick:l,children:c("listView.table.tableActions.delete")})})]})},ve=({reminder:t,open:s,onClose:r,handler:i})=>e.jsx(A,{currentReminder:t,open:s,onClose:r,handler:i});function Ve({filters:t,onResetPage:s,options:r}){const{t:i}=E("reminders"),l=u.useCallback(d=>{s(),t.setState({name:d.target.value})},[t,s]);return e.jsx(V,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(De,{sx:{width:420},value:t.state.name,onChange:l,placeholder:i("listView.table.tableToolbar.searchPlaceholder"),InputProps:{startAdornment:e.jsx(ye,{position:"start",children:e.jsx(h,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}function Ae({filters:t,totalResults:s,onResetPage:r,sx:i}){const l=u.useCallback(()=>{r(),t.setState({name:""})},[t,r]),d=u.useCallback(()=>{r(),t.onResetState()},[t,r]);return e.jsx(Ee,{totalResults:s,onReset:d,sx:i,children:e.jsx(Fe,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(Ie,{...Se,label:t.state.name,onDelete:l})})})}const Be=({reminders:t})=>{const s=xe({defaultOrderBy:"orderNumber"}),{t:r}=E("reminders"),i=j(),l=j(),d=j(),x=[{id:"reminderId",label:"#",width:140},{id:"date",label:`${r("listView.table.tableHeader.date")}`,width:280},{id:"title",label:`${r("listView.table.tableHeader.title")}`},{id:"related",label:`${r("listView.table.tableHeader.related")}`,width:280},{id:"",width:88}],[m,c]=u.useState(t),o=J({name:"",status:"all",startDate:null,endDate:null}),p=Y(o.state.startDate,o.state.endDate);u.useEffect(()=>{c(t)},[t]);const n=Le({inputData:m,comparator:pe(s.order,s.orderBy),filters:o.state,dateError:p}),R=ue(n,s.page,s.rowsPerPage),F=!!o.state.name||o.state.status!=="all"||!!o.state.startDate&&!!o.state.endDate,B=!n.length&&F||!n.length,L=u.useCallback(a=>{Q(a)},[R.length,s,m]),[q,M]=u.useState(),N=u.useCallback(a=>{M(a),l.onToggle()},[R.length,s,m]),S=Z(),H=a=>{ce(a)},{mutate:Q}=v({mutationFn:a=>D.delete(y.reminders.delete+a),onSuccess:async a=>{const g=m.filter(K=>K.id!==a);k.success(r("listView.toastMessages.deleteSuccess")),c(g),s.onUpdatePageDeleteRow(R.length),d.onFalse()},onSettled:async()=>{await S.invalidateQueries({queryKey:["reminders"]}),d.onFalse()},onError:()=>{}}),{mutate:$}=v({mutationFn:({id:a,payload:g})=>D.patch(y.reminders.edit+a,g),onSuccess:async()=>{k.success(r("listView.toastMessages.editSuccess"))},onSettled:async()=>{await S.invalidateQueries({queryKey:["reminders"]}),l.onFalse()},onError:a=>{console.log(a)}}),I=X(),O=u.useCallback(a=>{I.push(C.dashboard.quotation.details(a))},[I]);return e.jsxs(e.Fragment,{children:[e.jsx(ee,{maxWidth:"xl",children:e.jsxs(V,{spacing:3,children:[e.jsx(me,{links:[{name:`${r("listView.breadCrumbsPageRootTitle")}`,href:C.dashboard.root},{name:`${r("listView.breadCrumbsParentPageTitle")}`,href:C.dashboard.reminders.root}],action:e.jsx(w,{permission:f.ADD_REMINDER,children:e.jsx(T,{onClick:()=>i.onToggle(),variant:"contained",startIcon:e.jsx(h,{icon:"mingcute:add-line"}),children:r("listView.addNewReminder")})})}),e.jsx(w,{permission:f.REMINDER_LIST,children:e.jsxs(te,{children:[e.jsx(Ve,{filters:o,onResetPage:s.onResetPage,dateError:p}),F&&e.jsx(Ae,{filters:o,totalResults:n.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(se,{sx:{position:"relative"},children:[e.jsx(Re,{dense:s.dense,numSelected:s.selected.length,rowCount:n.length}),e.jsx(oe,{sx:{minHeight:444},children:e.jsxs(Ce,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(fe,{order:s.order,orderBy:s.orderBy,headLabel:x,rowCount:n.length}),e.jsxs(we,{children:[n.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map((a,g)=>e.jsx(ke,{row:a,index:s.page*s.rowsPerPage+g+1,selected:s.selected.includes(a.id),onEditRow:()=>N(a),onDeleteRow:()=>L(a.id),onViewFileRow:()=>H(a.file),onViewQuotationRow:O},a.id)),e.jsx(be,{height:s.dense?56:76,emptyRows:he(s.page,s.rowsPerPage,n.length)}),e.jsx(ge,{notFound:B})]})]})})]}),e.jsx(Pe,{page:s.page,dense:s.dense,count:n.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})]})}),e.jsx(A,{open:i.value,onClose:i.onFalse}),e.jsx(ve,{reminder:q,open:l.value,onClose:l.onFalse,handler:$})]})};function Le({inputData:t,comparator:s,filters:r,dateError:i}){const{status:l,name:d,startDate:x,endDate:m}=r,c=t.map((o,p)=>[o,p]);return c.sort((o,p)=>{const n=s(o[0],p[0]);return n!==0?n:o[1]-p[1]}),t=c.map(o=>o[0]),d&&(t=t.filter(o=>o.id.toString().toLowerCase().indexOf(d.toLowerCase())!==-1||o.title.toLowerCase().indexOf(d.toLowerCase())!==-1||o.description.toLowerCase().indexOf(d.toLowerCase())!==-1)),l!=="all"&&(t=t.filter(o=>o.status===l)),i||x&&m&&(t=t.filter(o=>ae(o.createdAt,x,m))),t}const qe={title:`Reminders list | Dashboard - ${ie.site.name}`};function Ut(){const t=le({queryKey:["reminders"],queryFn:async()=>{const{data:s}=await D.get(y.reminders.list);return s}});return t.isPending||t.isLoading?e.jsx(re,{}):t.isError?e.jsx(de,{route:C.dashboard.reminders.root}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsxs("title",{children:[" ",qe.title]})}),e.jsx(Be,{reminders:t.data})]})}export{Ut as default};

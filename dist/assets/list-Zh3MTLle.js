import{o as j,bO as M,j as e,w as K,I as g,dw as q,bQ as Q,em as P,bR as F,e as v,r as d,S as I,dz as U,eo as _,dI as z,e8 as $,p as R,aD as J,B as W,dy as G,ep as V,dJ as b,dH as f,dK as S,ec as X,H as Y,C as Z}from"./index-DCM0dqKu.js";import{u as ee,E as te}from"./error-block-DeCjSF4t.js";import{u as D}from"./useMutation-D2La3F2r.js";import{C as se}from"./custom-breadcrumbs-IetWuDPQ.js";import{P as y}from"./permission-access-controller-BgXcwVE8.js";import{u as oe,g as ae,r as ne,T as re,a as ie,e as le}from"./table-selected-action-7WjA_XRC.js";import{T as ce}from"./table-no-data-DG1YJIcm.js";import{T as me,a as de,b as ue,c as pe}from"./table-head-custom-BoFwl8d4.js";import{T as he}from"./table-pagination-custom-COA0RpS-.js";import{C as xe}from"./confirm-dialog-BBBRv5VF.js";import{T as x}from"./TableCell-COeTtVrZ.js";import{O as B}from"./order-customer-create-dialog-B3YnSTaG.js";import{T as Ce}from"./TextField-n063yImk.js";import{I as ge}from"./InputAdornment-DO0FXlwx.js";import{F as je,a as be,c as fe}from"./filters-result-CbksVm1D.js";import{C as Pe}from"./Chip-B7AXZfmm.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-bK399IpG.js";import"./empty-content-CBh9MUbL.js";import"./TablePagination-DnPqO4b4.js";import"./KeyboardArrowRight-CIlbmAZJ.js";import"./LastPage-DhTfx2BG.js";import"./Select-BfBEUDqV.js";import"./Menu-DUao5Yoh.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-DTC7mqIN.js";import"./FormControlLabel-DzI7o2_A.js";import"./DialogContent-BFR1QZgD.js";import"./DialogTitle-DthX4Z2k.js";import"./form-provider-CsXzZQi6.js";import"./FormHelperText-DqZjaKA5.js";import"./Rating-bGgbH5MB.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-DskST7D0.js";import"./index-BWYPRE2-.js";import"./Slider-DbZp1IuP.js";import"./FormControl-CzeO_UtU.js";import"./FormLabel-sPKOeIzp.js";import"./RadioGroup-Dwnhy8-J.js";import"./FormGroup-B2wxUdmP.js";import"./index-BdcQkSNX.js";import"./countries-DSLisFCy.js";import"./Autocomplete-B8SRK5t2.js";import"./country-select-D81VscAm.js";import"./InputLabel-D4P0yivD.js";import"./upload-avatar-QqSqRao9.js";import"./format-number-BQ7t0qkw.js";import"./image-DskMD1i2.js";import"./DatePicker-BHh4WHnP.js";import"./ListItem-BlYb29G3.js";import"./MobileDateTimePicker-B4xWrI2C.js";import"./Tabs-D0Tq82TW.js";import"./schema-helper-Bjct6y-B.js";import"./LoadingButton-CNUTqo8f.js";import"./CircularProgress-CObVdEvj.js";const ye=({row:t,index:s,selected:n,onDeleteRow:r,onEditRow:m})=>{const i=j(),l=M(),p=o=>o?`${o==null?void 0:o.street} ${o==null?void 0:o.country}.`:" - ",h=e.jsxs(me,{hover:!0,selected:n,children:[e.jsx(x,{children:(t==null?void 0:t.ref)||s||(t==null?void 0:t.id)}),e.jsx(x,{children:t==null?void 0:t.name}),e.jsx(x,{children:t==null?void 0:t.email}),e.jsx(x,{children:t==null?void 0:t.phoneNumber}),e.jsx(x,{children:p(t==null?void 0:t.address)}),e.jsx(x,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(K,{color:l.open?"inherit":"default",onClick:l.onOpen,children:e.jsx(g,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[h,e.jsx(q,{open:l.open,anchorEl:l.anchorEl,onClose:l.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Q,{children:[e.jsx(y,{permission:P.EDIT_CUSTOMER,children:e.jsxs(F,{onClick:()=>{m(),l.onClose()},children:[e.jsx(g,{icon:"solar:pen-bold"}),"Edit"]})}),e.jsx(y,{permission:P.DELETE_CUSTOMER,children:e.jsxs(F,{onClick:()=>{i.onTrue(),l.onClose()},sx:{color:"error.main"},children:[e.jsx(g,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})})]})}),e.jsx(xe,{open:i.value,onClose:i.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(v,{variant:"contained",color:"error",onClick:r,children:"Delete"})})]})};function Te({customer:t,open:s,onClose:n,handler:r}){return e.jsx(B,{customer:t,open:s,onClose:n,handler:r})}function Ee({customer:t,open:s,onClose:n,handler:r}){return e.jsx(B,{customer:t,open:s,onClose:n,handler:r})}function Se({filters:t,onResetPage:s,options:n}){const r=d.useCallback(m=>{s(),t.setState({name:m.target.value})},[t,s]);return e.jsx(I,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(Ce,{sx:{width:420},value:t.state.name,onChange:r,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(ge,{position:"start",children:e.jsx(g,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}function De({filters:t,totalResults:s,onResetPage:n,sx:r}){const m=d.useCallback(()=>{n(),t.setState({name:""})},[t,n]),i=d.useCallback(()=>{n(),t.onResetState()},[t,n]);return e.jsx(je,{totalResults:s,onReset:i,sx:r,children:e.jsx(be,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(Pe,{...fe,label:t.state.name,onDelete:m})})})}const Re=[{id:"customerId",label:"#",width:88},{id:"name",label:"Customer Name",width:220},{id:"email",label:"Email",width:220},{id:"phoneNumber",label:"Phone Number",width:120},{id:"address",label:"Address",width:120},{id:"",width:88}],we=({customers:t})=>{const s=oe({defaultOrderBy:"id"}),n=j(),r=j(),m=j(),[i,l]=d.useState(t),[p,h]=d.useState(),o=U({name:"",status:"all",startDate:null,endDate:null}),u=_(o.state.startDate,o.state.endDate),c=Fe({inputData:i,comparator:ae(s.order,s.orderBy),filters:o.state,dateError:u});d.useEffect(()=>{l(t)},[t]);const T=ne(c,s.page,s.rowsPerPage),w=!!o.state.name||o.state.status!=="all"||!!o.state.startDate&&!!o.state.endDate,L=!c.length&&w||!c.length,k=d.useCallback(a=>{H(a)},[T.length,s,i]),O=d.useCallback(a=>{h(a),r.onToggle()},[T.length,s,i]),E=z(),{mutate:A}=D({mutationFn:a=>b.post(f.customers.create,a),onSuccess:async()=>{S.success("New Customer Has Been Created!")},onSettled:async()=>{await E.invalidateQueries({queryKey:["customers"]}),n.onFalse()},onError:a=>{console.log(a)}}),{mutate:N}=D({mutationFn:({id:a,payload:C})=>b.patch(f.customers.edit+a,C),onSuccess:async()=>{S.success("New Customer Has Been Modified!")},onSettled:async()=>{await E.invalidateQueries({queryKey:["customers"]}),r.onFalse()},onError:a=>{console.log(a)}}),{mutate:H}=D({mutationFn:a=>b.delete(f.customers.delete+a),onSuccess:async()=>{const a=i.filter(C=>C.id!==id);S.success("Delete success!"),l(a),s.onUpdatePageDeleteRow(T.length),m.onFalse()},onSettled:async()=>{await E.invalidateQueries({queryKey:["customers"]}),m.onFalse()},onError:()=>{}});return e.jsxs(e.Fragment,{children:[e.jsx($,{maxWidth:"xl",children:e.jsxs(I,{spacing:3,children:[e.jsx(se,{links:[{name:"Dashboard",href:R.dashboard.root},{name:"Customers",href:R.dashboard.customers.root}],action:e.jsx(y,{permission:P.ADD_CUSTOMER,children:e.jsx(v,{onClick:()=>n.onToggle(),variant:"contained",startIcon:e.jsx(g,{icon:"mingcute:add-line"}),children:"Add New Customer"})})}),e.jsx(y,{permission:P.LIST_CUSTOMER,children:e.jsxs(J,{children:[e.jsx(Se,{filters:o,onResetPage:s.onResetPage,dateError:u}),w&&e.jsx(De,{filters:o,totalResults:c.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(W,{sx:{position:"relative"},children:[e.jsx(re,{dense:s.dense,numSelected:s.selected.length,rowCount:c.length}),e.jsx(G,{sx:{minHeight:444},children:e.jsxs(de,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(ue,{order:s.order,orderBy:s.orderBy,headLabel:Re,rowCount:c.length}),e.jsxs(pe,{children:[c.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map((a,C)=>e.jsx(ye,{index:s.page*s.rowsPerPage+C+1,row:a,selected:s.selected.includes(a.id),onEditRow:()=>O(a),onDeleteRow:()=>k(a.id)},a.id)),e.jsx(ie,{height:s.dense?56:76,emptyRows:le(s.page,s.rowsPerPage,c.length)}),e.jsx(ce,{notFound:L})]})]})})]}),e.jsx(he,{page:s.page,dense:s.dense,count:c.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})]})}),e.jsx(Ee,{open:n.value,onClose:n.onFalse,handler:A}),e.jsx(Te,{open:r.value,onClose:r.onFalse,handler:N,customer:p})]})};function Fe({inputData:t,comparator:s,filters:n,dateError:r}){const{status:m,name:i,startDate:l,endDate:p}=n,h=t.map((o,u)=>[o,u]);return h.sort((o,u)=>{const c=s(o[0],u[0]);return c!==0?c:o[1]-u[1]}),t=h.map(o=>o[0]),i&&(t=t.filter(o=>o.id.toString().toLowerCase().indexOf(i.toLowerCase())!==-1||o.name.toLowerCase().indexOf(i.toLowerCase())!==-1||o.email.toLowerCase().indexOf(i.toLowerCase())!==-1||o.phoneNumber.toString().toLowerCase().indexOf(i.toLowerCase())!==-1)),r||l&&p&&(t=t.filter(o=>V(o.createdAt,l,p))),t}const ve={title:`Customers list | Dashboard - ${Z.site.name}`};function Ot(){const t=ee({queryKey:["customers"],queryFn:async()=>(await b.get(f.customers.list)).data});return t.isPending||t.isLoading?e.jsx(X,{}):t.isError?e.jsx(te,{route:R.dashboard.customers.root}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:e.jsxs("title",{children:[" ",ve.title]})}),e.jsx(we,{customers:t.data})]})}export{Ot as default};

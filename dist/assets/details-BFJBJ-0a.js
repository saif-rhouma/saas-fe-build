import{r as x,i as A,j as s,S as t,B as i,ea as M,e8 as Y,d0 as W,d7 as X,e9 as o,e as C,I as n,am as F,g as Z,p as m,dn as q,e1 as ee,c9 as l,l as c,dP as se,cV as B,cY as re,e3 as T,v as ie,dp as j,dm as u,dq as w,dT as te,H as ne,C as oe}from"./index-CuWEjZ-G.js";import{u as ae,E as le}from"./error-block-XCP8Xdky.js";import{u as de}from"./use-params-BcUfmB3_.js";import{l as ce}from"./index-6zEgpWm3.js";import{P as xe}from"./react-pdf.browser-D5ipLDg5.js";import{u as v}from"./useMutation-D-9-TWzs.js";import{u as me}from"./use-tabs-CxLPC3H5.js";import{b as Q}from"./format-number-Cf_bMPPr.js";import{C as pe}from"./custom-breadcrumbs-BsK2CLus.js";import{P as k}from"./permission-access-controller-DPfkFmAQ.js";import{T as he}from"./tickets-create-dialog-0lRN0jYV.js";import{R as je}from"./reminder-create-dialog-C7yDQfCz.js";import{Q as ue,b as fe,P as ye,a as be}from"./print-quotation-details-template-Bn-nnbKS.js";import{Q as ge}from"./quotation-product-table-Bw6PPZW-.js";import{C as Ce}from"./CircularProgress-BQtYa1Y4.js";import{C as Te}from"./CardHeader-C57Jho8K.js";import{T as we,a as ve}from"./Tabs-CHtYoTYT.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./___vite-browser-external_commonjs-proxy-CNiTFjhR.js";import"./form-provider-C1xS_hNP.js";import"./TextField-DJCgOoyp.js";import"./FormControl-DRHf0uzO.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-BAzUnbSc.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-zMy-kTel.js";import"./Select-yTvD-6UB.js";import"./Menu-CcOZhntM.js";import"./InputBase-bLqbXfWL.js";import"./FormHelperText-DfcjtDV_.js";import"./Rating-BgGpqiV1.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-C8JBU4_J.js";import"./index-D6vCI2qn.js";import"./Slider-Bu8AHep1.js";import"./RadioGroup-Ot3P4Sgm.js";import"./FormGroup-DUCZroZE.js";import"./FormControlLabel-QWd6EiOd.js";import"./utils-l0ft-egQ.js";import"./index-BunGN8rp.js";import"./countries-DSLisFCy.js";import"./InputAdornment-BPgjxEzZ.js";import"./Autocomplete-B1GsGeQy.js";import"./Chip-qREBfbaX.js";import"./country-select-CeDBhmhh.js";import"./Checkbox-BmspYUiW.js";import"./upload-avatar-ByWFD0be.js";import"./image--hG_jsIt.js";import"./DatePicker-B-CwTbre.js";import"./DialogContent-BvQOSjqo.js";import"./ListItem-CSeHJl30.js";import"./MobileDateTimePicker-DGQpVjcR.js";import"./upload-box-ad-DkAE6uOo.js";import"./DialogTitle-CwCOmkp8.js";import"./LoadingButton-DZjqLJO9.js";import"./schema-helper-Bh6rnOep.js";import"./utils-MBUcMVfY.js";import"./use-table-75dAXbPG.js";import"./table-head-custom-B_b4Mciq.js";import"./TableCell-xn0OHm1b.js";import"./table-pagination-custom-B4KJAJyJ.js";import"./TablePagination-CJMhKRte.js";import"./KeyboardArrowRight-jh7tJvHZ.js";import"./LastPage-NFUUwqpx.js";import"./table-empty-rows-Flo5S0Tu.js";import"./AvatarGroup-Cm6eJVW3.js";const Qe=[{value:"details",icon:s.jsx(n,{icon:"solar:eye-bold",width:24}),label:"Details"},{value:"tickets",icon:s.jsx(n,{icon:"solar:case-minimalistic-bold",width:24}),label:"Tickets"},{value:"reminders",icon:s.jsx(n,{icon:"solar:calendar-bold",width:24}),label:"Reminders"}];function ke({currentQuotation:d}){var I,S,O,R,E,N;const[e,f]=x.useState(d),a=me("details"),D=x.useRef();x.useEffect(()=>{f(d)},[d]),ce.useReactToPrint({content:()=>D.current});const y=A(),b=A(),H=s.jsxs(t,{alignItems:"flex-end",sx:{pr:3,pl:3,pb:3,textAlign:"right",typography:"body2"},children:[s.jsxs(t,{direction:"row",children:[s.jsx(i,{sx:{color:"text.secondary"},children:"Subtotal"}),s.jsx(i,{sx:{width:160,typography:"subtitle2"},children:Q(e==null?void 0:e.totalAmount)||"-"})]}),s.jsxs(t,{direction:"row",children:[s.jsx(i,{sx:{color:"text.secondary"},children:"Discount"}),s.jsx(i,{sx:{width:160,...(e==null?void 0:e.discount)&&{color:"error.main"}},children:e!=null&&e.discount?`- ${e==null?void 0:e.discount}%`:"-"})]}),s.jsxs(t,{direction:"row",children:[s.jsxs(i,{sx:{color:"text.secondary"},children:["Tax (",(e==null?void 0:e.snapshotTaxPercentage)||"0","%)"]}),s.jsx(i,{sx:{width:160},children:e!=null&&e.snapshotTaxPercentage?Q(M((e==null?void 0:e.totalAmount)-(e==null?void 0:e.totalAmount)*((e==null?void 0:e.discount)/100),e==null?void 0:e.snapshotTaxPercentage)):"-"})]}),s.jsxs(t,{direction:"row",sx:{typography:"subtitle1"},children:[s.jsx("div",{children:"Total"}),s.jsx(i,{sx:{width:160},children:Q(Y((e==null?void 0:e.totalAmount)-(e==null?void 0:e.totalAmount)*((e==null?void 0:e.discount)/100),e==null?void 0:e.snapshotTaxPercentage))||"-"})]})]}),L=s.jsxs(t,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[s.jsxs(i,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",m:1},children:[s.jsxs(i,{flexDirection:"column",sx:{display:"flex"},children:[s.jsxs(i,{sx:{color:"text.secondary"},children:["Quotation Ref: #",e==null?void 0:e.ref]}),s.jsxs(i,{sx:{color:"text.secondary"},children:["Quotation Date: ",W(e==null?void 0:e.quotationDate)]})]}),s.jsx(i,{sx:{mr:2},children:s.jsxs(i,{sx:{color:"text.secondary"},children:["Status:"," ",s.jsx(X,{variant:"soft",color:(e==null?void 0:e.status)===o.Confirmed&&"info"||(e==null?void 0:e.status)===o.Converted&&"success"||(e==null?void 0:e.status)===o.Canceled&&"error"||"default",children:e==null?void 0:e.status})]})}),((I=e==null?void 0:e.order)==null?void 0:I.id)&&s.jsx(i,{sx:{color:"text.secondary"},className:"print-hide",children:s.jsxs(C,{variant:"contained",size:"small",startIcon:s.jsx(n,{icon:"heroicons-outline:external-link"}),onClick:()=>{const{id:r}=e==null?void 0:e.order;r&&P(r)},children:["Related to Order: #",(S=e==null?void 0:e.order)==null?void 0:S.ref]})})]}),(e==null?void 0:e.notes)&&s.jsxs(i,{children:[s.jsx(F,{}),s.jsx(t,{sx:{typography:"body2"},children:s.jsx(i,{sx:{p:1},children:s.jsxs(t,{sx:{typography:"subtitle2"},children:[s.jsx("div",{children:"Notes:"}),s.jsx(i,{sx:{color:"text.secondary"},children:e==null?void 0:e.notes})]})})})]})]}),K=s.jsxs(s.Fragment,{children:[s.jsx(i,{sx:{pr:3,pl:3,mb:3,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:s.jsx(ge,{products:e==null?void 0:e.productToQuotation,defaultRowsPerPage:10})}),H]}),_=s.jsx(t,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:s.jsx(i,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:s.jsx(ue,{tickets:e.tickets})})}),$=s.jsx(t,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:s.jsx(i,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:s.jsx(fe,{reminders:e==null?void 0:e.reminders})})}),p=Z(),V=x.useCallback(r=>{p.push(m.dashboard.quotation.edit(r))},[p]),P=x.useCallback(r=>{p.push(m.dashboard.order.details(r))},[p]),h=q(),{mutate:G}=v({mutationFn:r=>j.post(u.quotation.createOrder,r),onSuccess:async({data:r})=>{w.success("Order Has Been Created!");const{id:g}=e;await h.invalidateQueries({queryKey:["quotations"]}),await h.invalidateQueries({queryKey:["quotation",g]})},onError:r=>{console.log(r)}}),{mutate:U}=v({mutationFn:r=>j.post(u.quotation.share,r),onSuccess:async({data:r})=>{w.success("Quotation has been sended to the customer.")},onError:r=>{console.log(r)}}),{mutate:z}=v({mutationFn:r=>j.patch(u.quotation.editStatus+r,{status:o.Confirmed}),onSuccess:async({data:r})=>{w.success("Quotation Has Been Confirmed!");const{id:g}=e;await h.invalidateQueries({queryKey:["quotations"]}),await h.invalidateQueries({queryKey:["quotation",g]})},onError:r=>{console.log(r)}}),J=s.jsx(ee,{children:s.jsx(xe,{document:e?s.jsx(ye,{quotation:e}):s.jsx("span",{}),fileName:e==null?void 0:e.ref,style:{textDecoration:"none"},children:({loading:r})=>s.jsx(l,{title:"Download Pdf",children:s.jsx(c,{children:r?s.jsx(Ce,{size:24,color:"inherit"}):s.jsx(n,{icon:"eva:cloud-download-fill"})})})})});return s.jsxs(se,{children:[s.jsx(pe,{links:[{name:"Dashboard",href:m.dashboard.root},{name:"Quotations",href:m.dashboard.quotation.root},{name:"Quotation Details"}],sx:{mb:{xs:3,md:5}}}),s.jsx(B,{container:!0,spacing:3,children:s.jsx(B,{xs:12,md:12,children:s.jsxs(re,{ref:D,children:[s.jsx("style",{jsx:!0,children:`
              .print-title {
                display: none; /* Hide on screen */
              }

              @media print {
                html,
                body {
                  height: initial !important;
                  overflow: initial !important;
                }
                .print-title {
                  display: block; /* Show only when printing */
                }
                .print-hide {
                  display: none; /* Hide on screen */
                }
                .print-padding {
                  padding: 5px;
                }
                .print-top-margin {
                  margin-top: 40px;
                }
              }
            `}),s.jsxs(t,{direction:{md:"column",p:3},className:"print-top-margin print-padding",children:[s.jsx(Te,{sx:{pt:1},title:e==null?void 0:e.name,subheader:`Quotation for Customer : ${(O=e==null?void 0:e.customer)==null?void 0:O.name}`,action:s.jsx(t,{className:"print-hide",spacing:3,direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"},sx:{mb:{xs:3,md:5}},children:s.jsxs(t,{direction:"row",spacing:1,flexGrow:1,sx:{width:1},children:[s.jsx(k,{permission:T.EDIT_QUOTATION,children:(e==null?void 0:e.status)===o.Created&&s.jsx(l,{title:"Edit",children:s.jsx(c,{onClick:()=>{V(e==null?void 0:e.id)},children:s.jsx(n,{icon:"solar:pen-bold"})})})}),(e==null?void 0:e.status)===o.Created&&s.jsx(l,{title:"Confirm",children:s.jsx(c,{onClick:()=>{z(e==null?void 0:e.id)},children:s.jsx(n,{icon:"line-md:confirm-circle-filled"})})}),s.jsx(k,{permission:T.CONVERT_QUOTATION_TO_ORDER,children:!((R=e==null?void 0:e.order)!=null&&R.id)&&((e==null?void 0:e.status)===o.Created||(e==null?void 0:e.status)===o.Confirmed)&&s.jsx(l,{title:"Convert to Order",children:s.jsx(c,{onClick:()=>{G({quotationId:e==null?void 0:e.id})},children:s.jsx(n,{icon:"solar:restart-circle-bold"})})})}),((E=e==null?void 0:e.order)==null?void 0:E.id)&&s.jsx(l,{title:`Related to Order: #${(N=e==null?void 0:e.order)==null?void 0:N.ref}`,children:s.jsx(c,{onClick:()=>{var r;P((r=e==null?void 0:e.order)==null?void 0:r.id)},children:s.jsx(n,{icon:"heroicons-outline:external-link"})})}),J,s.jsx(k,{permission:T.PRINT_QUOTATION,children:s.jsx(l,{title:"Print",children:s.jsx(be,{quotation:e})})}),s.jsx(l,{title:"Send To the Customer",children:s.jsx(c,{onClick:()=>{U({id:e.id})},children:s.jsx(n,{icon:"iconamoon:send-fill"})})})]})})}),L,s.jsx(F,{sx:{mt:3}}),s.jsxs(we,{value:a.value,className:"print-hide",onChange:a.onChange,sx:{px:3,mb:3,boxShadow:r=>`inset 0 -2px 0 0 ${ie(r.vars.palette.grey["500Channel"],.08)}`},children:[Qe.map(r=>s.jsx(ve,{icon:r.icon,value:r.value,label:r.label},r.value)),a.value==="tickets"&&s.jsx(i,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx(C,{onClick:()=>y.onToggle(),variant:"outlined",startIcon:s.jsx(n,{icon:"mingcute:add-line"}),children:"New Ticket"})}),a.value==="reminders"&&s.jsx(i,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx(C,{onClick:()=>b.onToggle(),variant:"outlined",startIcon:s.jsx(n,{icon:"mingcute:add-line"}),children:"New Reminder"})})]}),a.value==="details"&&K,a.value==="tickets"&&_,a.value==="reminders"&&$]})]})})}),s.jsx(he,{open:y.value,onClose:y.onFalse,quotation:e}),s.jsx(je,{open:b.value,onClose:b.onFalse,quotation:e})]})}const De={title:`Quotation details | Dashboard - ${oe.site.name}`};function $s(){const{id:d=""}=de(),e=ae({queryKey:["quotation",d],queryFn:async()=>{const{data:f}=await j.get(u.quotation.details+d);return f}});return e.isPending||e.isLoading?s.jsx(te,{}):e.isError?s.jsx(le,{route:m.dashboard.order.root}):s.jsxs(s.Fragment,{children:[s.jsx(ne,{children:s.jsxs("title",{children:[" ",De.title]})}),s.jsx(ke,{currentQuotation:e.data})]})}export{$s as default};

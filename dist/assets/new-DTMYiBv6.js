import{br as L,Y as w,r as s,W as ye,ab as Pe,dp as be,dq as C,dn as f,dr as B,p as D,j as t,cZ as Y,S as l,B as a,I as N,C as H,v as we,ea as De,e8 as Ie,e as F,cW as T,dQ as Fe,dU as Te,H as Se}from"./index-BqQARj70.js";import{u as S,E as Oe}from"./error-block-Cvsq6LVS.js";import{C as qe}from"./custom-breadcrumbs-ryDpeVg5.js";import{u as R}from"./useMutation-D9b-SBJX.js";import{b as O}from"./format-number-BvEweN_e.js";import{u as ke}from"./use-table-CIIi1yXP.js";import{C as Ve,O as Ee,a as Ae,I as Be}from"./order-discount-product-dialog-eL-X2gE5.js";import{P as Ye}from"./product-Item-button-CPLCq2vV.js";import{C as Ne}from"./component-pagination-custom-BDXoTB5K.js";import{O as Re}from"./order-product-table-GgygIUT3.js";import{O as ve}from"./order-customer-create-dialog-CVDRgyy3.js";import{T as v}from"./TextField-Ddc-2_B3.js";import{I as Le}from"./InputAdornment-BfS4czl_.js";import{F as He}from"./FormControl-C8LIfacH.js";import{F as Ke}from"./FormHelperText-D7zaUcMu.js";import{D as Qe}from"./DatePicker-Ce3HVs4j.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./DialogContent-Bu9AzrBB.js";import"./DialogTitle-rK5KahkH.js";import"./Autocomplete-mVzVA2ZY.js";import"./Select-BcNE4CY6.js";import"./Menu-CyG4g8V9.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-ByUog9Qa.js";import"./Chip-DPBTbqGw.js";import"./form-provider-ccfU2XUN.js";import"./Rating-CRHSMtZR.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-QJd8noTi.js";import"./index-3on3wy4W.js";import"./Slider-CY1kJa8b.js";import"./FormLabel-Dza6C49E.js";import"./RadioGroup-ChlGooHA.js";import"./FormGroup-CXDpwB7j.js";import"./FormControlLabel-DYa7_yhu.js";import"./utils-BkGDLkaZ.js";import"./index-ALNGUIW9.js";import"./countries-DSLisFCy.js";import"./country-select-BdT_Z9O2.js";import"./InputLabel-Cypnw6Fi.js";import"./Checkbox-Bhx6CUcB.js";import"./upload-avatar-rmFzksOv.js";import"./image-D-bc4Fg4.js";import"./MobileDateTimePicker-huLGYsGv.js";import"./Tabs-CmqXMWlF.js";import"./KeyboardArrowRight-CBFHahxG.js";import"./TablePagination-Dx3_2Y4O.js";import"./LastPage-B8ZhtlKX.js";import"./TableCell-BYUYO2qG.js";import"./table-head-custom-BsfRnN01.js";import"./incrementer-button-8gy3nd8i.js";import"./schema-helper-BD6wlizp.js";import"./LoadingButton-F-RhBSUA.js";import"./CircularProgress-CnEecEq8.js";import"./ListItem-D-3kOQEW.js";function Me({products:i,customers:p,taxPercentage:c}){const o=ke({defaultRowsPerPage:6}),{t:d}=L("orders"),j=w(),y=w(),P=w(),q=w(),[K,Q]=s.useState(""),[M,W]=s.useState(""),$=ye(),[G,J]=s.useState(),[x,U]=s.useState(0),[Z,z]=s.useState(0),[k,h]=s.useState(!1),[X,_]=s.useState(),[b,ee]=s.useState("Customer"),[V,te]=s.useState(Pe(new Date)),[n,u]=s.useState([]),[E,A]=s.useState(i),I=be(),re=(e,r)=>{z(r),_(e),P.onToggle()},se=e=>{U(e),y.onFalse()},oe=(e,r)=>{u(m=>(m[e].price=r,[...m])),P.onFalse()},{mutate:ae}=R({mutationFn:e=>C.post(f.order.create,e),onSuccess:async()=>{B.success("New Order Has Been Created!"),await I.invalidateQueries({queryKey:["orders"]}),await I.invalidateQueries({queryKey:["orders","analytics"]})},onSettled:async()=>{$.push(D.dashboard.order.root)},onError:e=>{console.error(e)}}),ne=s.useCallback(e=>{J(e.target.value)},[]),ie=s.useCallback(e=>{ee(e),h(!e)},[]),ce=s.useCallback(e=>{u(r=>{const m=r.findIndex(je=>je.id===e.id);return m>=0?r[m].quantity+=1:(e.quantity=1,e.discount=0,r.push(e)),[...r]})},[]),le=s.useCallback(e=>{const r=e.target.value;r&&A(i.filter(m=>m.name.toLowerCase().indexOf(r)!==-1)),(r==null||r==="")&&A(i)},[]),de=s.useCallback(e=>{u(r=>(r[e].quantity-=1,r[e].quantity===0&&r.splice(e,1),[...r]))},[n]),ue=s.useCallback(e=>{u(r=>(r[e].discount>0&&(r[e].discount-=1),[...r]))},[]),me=s.useCallback(e=>{u(r=>(r[e].discount<100&&(r[e].discount+=1),[...r]))},[]),pe=s.useCallback(e=>{u(r=>(r[e].quantity+=1,[...r]))},[n]),xe=s.useCallback(e=>{u(r=>(r.splice(e,1),[...r]))},[n]),g=s.useCallback(()=>n.reduce((e,r)=>e+r.price*r.quantity,0),[n]);s.useCallback(()=>n.reduce((e,r)=>e+r.price*(r.discount/100)*r.quantity,0),[n]);const{mutate:he}=R({mutationFn:e=>C.post(f.customers.create,e),onSuccess:async()=>{B.success("New Customer Has Been Created!")},onSettled:async()=>{await I.invalidateQueries({queryKey:["customers"]}),j.onFalse()},onError:e=>{console.log(e)}}),ge=t.jsx(Y,{children:t.jsxs(l,{children:[t.jsx(a,{sx:{p:3},children:t.jsx(v,{color:"success",fullWidth:!0,maxWidth:"xs",placeholder:d("createView.productsList.searchPlaceholder"),InputProps:{startAdornment:t.jsx(Le,{position:"start",children:t.jsx(N,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},onChange:le})}),t.jsx(a,{sx:{pl:3,pr:3},gap:1,display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:E.slice(o.page*o.rowsPerPage,o.page*o.rowsPerPage+o.rowsPerPage).map(e=>t.jsx(Ye,{payload:e,handleClick:ce,productName:e==null?void 0:e.name,image:H.site.serverFileHost+(e==null?void 0:e.image)},e==null?void 0:e.id))}),t.jsx(Ne,{page:o.page,count:E.length,rowsPerPage:6,defaultRowsPerPage:6,onPageChange:o.onChangePage,onRowsPerPageChange:o.onChangeRowsPerPage})]})}),Ce=t.jsxs(l,{spacing:2,alignItems:"flex-end",sx:{p:2,textAlign:"right",typography:"body2"},children:[t.jsxs(l,{direction:"row",children:[t.jsx(a,{sx:{color:"text.secondary"},children:d("createView.createForm.extra.subTotal")}),t.jsx(a,{sx:{width:160,typography:"subtitle2"},children:O(g())||"-"})]}),t.jsxs(l,{direction:"row",alignItems:"center",children:[t.jsx(a,{sx:{color:"text.secondary"},children:d("createView.createForm.extra.discount")}),t.jsx(a,{sx:{width:160},children:t.jsx(a,{sx:{pl:4,mr:-.5},children:t.jsxs(l,{onClick:()=>{y.onToggle()},sx:{cursor:"pointer",p:.5,color:"error.main",borderRadius:1,typography:"subtitle2",border:e=>`solid 1px ${we(e.vars.palette.grey["500Channel"],.2)}`},children:[x,"%"]})})})]}),t.jsxs(l,{direction:"row",children:[t.jsxs(a,{sx:{color:"text.secondary"},children:[d("createView.createForm.extra.tax")," (",c||"0","%)"]}),t.jsx(a,{sx:{width:160},children:c?O(De(g()-g()*(x/100),c)):"-"})]}),t.jsxs(l,{direction:"row",sx:{typography:"subtitle1"},children:[t.jsxs("div",{children:[d("createView.createForm.extra.total"),":"]}),t.jsx(a,{sx:{width:160},children:O(Ie(g()-g()*(x/100),c))||"-"})]})]}),fe=t.jsx(Y,{children:t.jsxs(l,{spacing:2,sx:{p:3},children:[t.jsxs(a,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[t.jsxs(He,{error:k&&!b,children:[t.jsx(Ve,{customers:p,onChange:ie}),k&&t.jsx(Ke,{error:!0,children:"Customer is required!"})]}),t.jsx(a,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:t.jsx(F,{variant:"contained",startIcon:t.jsx(N,{icon:"mingcute:add-line"}),onClick:()=>j.onToggle(),children:d("createView.createForm.buttons.addCustomer")})}),t.jsx(v,{label:"Order ID",placeholder:"This Could Be Generated Automatically",value:G,disabled:!0,InputLabelProps:{shrink:!0},onChange:ne,sx:{mt:2}}),t.jsx(Qe,{label:d("createView.createForm.fields.date.label"),sx:{mt:2},format:"DD/MM/YYYY",value:V,onChange:e=>{te(e)}})]}),t.jsx(Re,{products:n,onDecrease:de,onIncrease:pe,onDecreaseDiscount:ue,onIncreaseDiscount:me,handleDiscountDialog:re,removeItem:xe}),t.jsxs(a,{display:"flex",flexDirection:"column",alignItems:"flex-end",justifyContent:"center",children:[Ce,t.jsxs(a,{display:"flex",gap:2,height:50,children:[t.jsx(F,{variant:"contained",onClick:()=>{if(isNaN(parseInt(b))){h(!0);return}if(h(!1),!n.length){Q("Something went wrong. Product(s) are required!"),W("You need to add at least one product to this order. Please select a product from the list on the right."),q.onToggle();return}if(!isNaN(parseInt(b))&&n.length){h(!1);const e={discount:parseInt(x,10),orderDate:V.format("YYYY-MM-DD"),products:n.map(r=>({id:r.id,snapshotProductPrice:r.price,quantity:r.quantity})),customer:b};ae(e)}},children:d("createView.createForm.buttons.saveAndContinue")}),t.jsx(F,{variant:"outlined",onClick:()=>u([]),children:d("createView.createForm.buttons.clearAll")})]})]})]})});return t.jsxs(T,{container:!0,spacing:3,children:[t.jsx(T,{xs:12,md:3,children:t.jsx(l,{children:ge})}),t.jsx(T,{xs:12,md:9,children:t.jsx(l,{children:fe})}),t.jsx(ve,{open:j.value,onClose:j.onFalse,handler:he}),t.jsx(Ee,{discount:x,open:y.value,onClose:y.onFalse,handler:se}),t.jsx(Ae,{product:X,discount:Z,open:P.value,onClose:P.onFalse,handler:oe}),t.jsx(Be,{dialog:q,title:K,contentText:M})]})}function We({products:i,customers:p,taxPercentage:c}){const{t:o}=L("orders");return t.jsxs(Fe,{children:[t.jsx(qe,{heading:o("createView.pageTitle"),links:[{name:o("createView.breadCrumbsPageRootTitle"),href:D.dashboard.root},{name:`${o("createView.breadCrumbsParentPageTitle")}`,href:D.dashboard.order.root},{name:`${o("createView.breadCrumbsPageTitle")}`}],sx:{mb:{xs:3,md:5}}}),t.jsx(Me,{products:i,customers:p,taxPercentage:c})]})}const $e={title:`Create a new Order | Dashboard - ${H.site.name}`};function zt(){const i=S({queryKey:["products"],queryFn:async()=>(await C.get(f.products.list)).data}),p=S({queryKey:["customers"],queryFn:async()=>(await C.get(f.customers.list)).data}),c=S({queryKey:["account-application"],queryFn:async()=>{const{data:o}=await C.get(f.auth.application);return o}});return c.isLoading||i.isLoading||p.isLoading?t.jsx(Te,{}):c.isError||i.isError||i.isError?t.jsx(Oe,{route:D.dashboard.order.root}):t.jsxs(t.Fragment,{children:[t.jsx(Se,{children:t.jsxs("title",{children:[" ",$e.title]})}),t.jsx(We,{products:i.data,customers:p.data,taxPercentage:c.data.taxPercentage})]})}export{zt as default};

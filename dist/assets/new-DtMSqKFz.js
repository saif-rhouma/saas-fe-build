import{j as e,e as p,B as l,am as T,r,i as I,g as Se,bc as Ie,dm as Te,dn as w,dl as S,dp as M,p as F,aB as z,S as u,I as V,C as X,v as Fe,eb as Oe,ec as ke,b9 as $,ay as A,dP as ve,dT as qe,H as Ae}from"./index-Cs0Sdxyr.js";import{u as E,E as Ee}from"./error-block-t40v2wjH.js";import{C as Be}from"./custom-breadcrumbs-BT-Xn517.js";import{u as J}from"./useMutation-Dzc6--kZ.js";import{b as B}from"./format-number-TrbPmgcB.js";import{u as Ne}from"./use-table-C7PcYmrj.js";import{a as R,b as W,D as H}from"./DialogContent-Crbj6g6G.js";import{D as K}from"./DialogTitle-DrSBT5S6.js";import{P as Re}from"./product-Item-button-PEQX2E2g.js";import{T as We}from"./TablePagination-ewpmKKcd.js";import{O as He}from"./order-product-table-CLXWAnbN.js";import{z as U,u as Ke,t as Le,a as Qe,F as Ye}from"./form-provider-eXyauyxJ.js";import"./image-Cq9K1zAl.js";import"./editor-CT3ylhik.js";import{O as Ge}from"./order-customer-create-dialog-Dd95-KEW.js";import{T as N}from"./TextField-CLYezYfw.js";import{I as Me}from"./InputAdornment-B5qV_qPb.js";import{F as ze}from"./FormControl-LO9oSJ-o.js";import{S as Ve}from"./Select-DDfA3_-T.js";import{F as $e}from"./FormHelperText-DkkzjVxJ.js";import{D as Je}from"./DatePicker-CTzww6R8.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./KeyboardArrowRight-jFTTvq_T.js";import"./LastPage-oiHFkgQw.js";import"./TableCell-DQSLj1b3.js";import"./InputBase-BXi8ZaFZ.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./table-head-custom-DweneoZv.js";import"./Checkbox-BnpdbSxp.js";import"./incrementer-button-CR-GNg1S.js";import"./Rating-BF02HLKo.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-7HzlrEFX.js";import"./FormLabel-CwQQfAsE.js";import"./RadioGroup-CzKzAp9k.js";import"./FormGroup-BF9selVP.js";import"./FormControlLabel-nLpLCzjO.js";import"./index-B3bfrtVg.js";import"./countries-DSLisFCy.js";import"./Autocomplete-BlKHEWOH.js";import"./Chip-xRW8ggU-.js";import"./country-select-D1lnH3Yh.js";import"./InputLabel-QrwSoYWN.js";import"./upload-avatar-BmI9utwN.js";import"./MobileDateTimePicker-D7Ni8uEz.js";import"./Tabs-COnq56DM.js";import"./Menu-DSuiBPzi.js";import"./index-DnS4NWxD.js";import"./LoadingButton-BC7HOYkj.js";import"./CircularProgress-DjaT2AqC.js";import"./ListItem-pAOUhWgY.js";const Ue=({dialog:n,title:i,contentText:o})=>e.jsxs(R,{open:n.value,onClose:n.onFalse,children:[e.jsx(K,{children:i}),e.jsx(W,{sx:{color:"text.secondary"},children:e.jsx("p",{children:o})}),e.jsx(H,{children:e.jsx(p,{variant:"contained",onClick:n.onFalse,autoFocus:!0,children:"Okay"})})]});function Xe({sx:n,rowsPerPageOptions:i=6,...o}){return e.jsx(l,{sx:{position:"relative",...n},children:e.jsx(We,{rowsPerPageOptions:i,component:"div",...o,sx:{borderTopColor:"transparent"}})})}const Ze=U.object({percentage:U.number().min(1,{message:"Discount Percentage is required!"}).min(1,{message:"Discount Percentage must be between 1 and 100"}).max(100,{message:"Discount Percentage must be between 1 and 100"})}),_e=({discount:n,open:i,onClose:o,handler:a})=>{const m=Ke({resolver:Le(Ze)}),{reset:d,watch:x,setValue:j,handleSubmit:f,formState:{isSubmitting:L}}=m,O=f(async k=>{try{const{percentage:C}=k;d(),a(C)}catch(C){console.error(C)}});return e.jsx(R,{fullWidth:!0,open:i,onClose:o,children:e.jsxs(Qe,{methods:m,onSubmit:O,children:[e.jsx(K,{children:"Discount Percentage"}),e.jsx(T,{}),e.jsx(W,{sx:{pt:1,mt:1},children:e.jsx(Ye.Text,{fullWidth:!0,type:"number",label:"Percentage",name:"percentage"})}),e.jsx(T,{sx:{pt:1,mt:1}}),e.jsxs(H,{children:[e.jsx(p,{type:"submit",variant:"contained",children:"Confirm"}),e.jsx(p,{color:"inherit",variant:"outlined",onClick:()=>{d(),o()},children:"Cancel"})]})]})})},et=({product:n,discount:i,open:o,onClose:a,handler:m})=>{var j;const[d,x]=r.useState(i);return r.useEffect(()=>{x(i)},[i]),e.jsxs(R,{fullWidth:!0,open:o,onClose:a,children:[e.jsxs(K,{children:["Discount Product : ",(j=n==null?void 0:n.product)==null?void 0:j.name]}),e.jsx(T,{}),e.jsx(W,{sx:{pt:1,mt:1},children:e.jsx(N,{fullWidth:!0,label:"Discount Amount",type:"number",value:d,onChange:f=>{x(f.target.value)}})}),e.jsx(T,{sx:{pt:1,mt:1}}),e.jsxs(H,{children:[e.jsx(p,{type:"submit",variant:"contained",onClick:()=>{m(n.index,d)},children:"Confirm"}),e.jsx(p,{color:"inherit",variant:"outlined",onClick:a,children:"Cancel"})]})]})};function tt({products:n,customers:i,taxPercentage:o}){const a=Ne({defaultRowsPerPage:6}),m=I(),d=I(),x=I(),j=I(),[f,L]=r.useState(""),[O,k]=r.useState(""),C=Se(),[Z,_]=r.useState(),[y,ee]=r.useState(0),[te,se]=r.useState(0),[v,b]=r.useState(!1),[re,ne]=r.useState(),[D,oe]=r.useState("Customer"),[Q,ae]=r.useState(Ie(new Date)),[c,h]=r.useState([]),[Y,G]=r.useState(n),q=Te(),ie=(t,s)=>{se(s),ne(t),x.onToggle()},le=t=>{ee(t),d.onFalse()},ce=(t,s)=>{h(g=>(g[t].price=s,[...g])),x.onFalse()},{mutate:de}=J({mutationFn:t=>w.post(S.order.create,t),onSuccess:async()=>{M.success("New Order Has Been Created!"),await q.invalidateQueries({queryKey:["orders"]}),await q.invalidateQueries({queryKey:["orders","analytics"]})},onSettled:async()=>{C.push(F.dashboard.order.root)},onError:t=>{console.error(t)}}),ue=r.useCallback(t=>{_(t.target.value)},[]),me=r.useCallback(t=>{oe(t.target.value),t.target.value==="Customer"?b(!0):b(!1)},[]),xe=r.useCallback(t=>{h(s=>{const g=s.findIndex(we=>we.id===t.id);return g>=0?s[g].quantity+=1:(t.quantity=1,t.discount=0,s.push(t)),[...s]})},[]),he=r.useCallback(t=>{const s=t.target.value;s&&G(n.filter(g=>g.name.toLowerCase().indexOf(s)!==-1)),(s==null||s==="")&&G(n)},[]),pe=r.useCallback(t=>{h(s=>(s[t].quantity-=1,s[t].quantity===0&&s.splice(t,1),[...s]))},[c]),ge=r.useCallback(t=>{h(s=>(s[t].discount>0&&(s[t].discount-=1),[...s]))},[]),je=r.useCallback(t=>{h(s=>(s[t].discount<100&&(s[t].discount+=1),[...s]))},[]),fe=r.useCallback(t=>{h(s=>(s[t].quantity+=1,[...s]))},[c]),Ce=r.useCallback(t=>{h(s=>(s.splice(t,1),[...s]))},[c]),P=r.useCallback(()=>c.reduce((t,s)=>t+s.price*s.quantity,0),[c]);r.useCallback(()=>c.reduce((t,s)=>t+s.price*(s.discount/100)*s.quantity,0),[c]);const{mutate:ye}=J({mutationFn:t=>w.post(S.customers.create,t),onSuccess:async()=>{M.success("New Customer Has Been Created!")},onSettled:async()=>{await q.invalidateQueries({queryKey:["customers"]}),m.onFalse()},onError:t=>{console.log(t)}}),be=e.jsx(z,{children:e.jsxs(u,{children:[e.jsx(l,{sx:{p:3},children:e.jsx(N,{color:"success",fullWidth:!0,maxWidth:"xs",placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(Me,{position:"start",children:e.jsx(V,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},onChange:he})}),e.jsx(l,{sx:{pl:3,pr:3},gap:1,display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:Y.slice(a.page*a.rowsPerPage,a.page*a.rowsPerPage+a.rowsPerPage).map(t=>e.jsx(Re,{payload:t,handleClick:xe,productName:t==null?void 0:t.name,image:X.site.serverFileHost+(t==null?void 0:t.image)},t==null?void 0:t.id))}),e.jsx(Xe,{page:a.page,count:Y.length,rowsPerPage:6,defaultRowsPerPage:6,onPageChange:a.onChangePage,onRowsPerPageChange:a.onChangeRowsPerPage})]})}),De=e.jsxs(u,{spacing:2,alignItems:"flex-end",sx:{p:2,textAlign:"right",typography:"body2"},children:[e.jsxs(u,{direction:"row",children:[e.jsx(l,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(l,{sx:{width:160,typography:"subtitle2"},children:B(P())||"-"})]}),e.jsxs(u,{direction:"row",alignItems:"center",children:[e.jsx(l,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(l,{sx:{width:160},children:e.jsx(l,{sx:{pl:4,mr:-.5},children:e.jsxs(u,{onClick:()=>{d.onToggle()},sx:{cursor:"pointer",p:.5,color:"error.main",borderRadius:1,typography:"subtitle2",border:t=>`solid 1px ${Fe(t.vars.palette.grey["500Channel"],.2)}`},children:[y,"%"]})})})]}),e.jsxs(u,{direction:"row",children:[e.jsxs(l,{sx:{color:"text.secondary"},children:["Tax (",o||"0","%)"]}),e.jsx(l,{sx:{width:160},children:o?B(Oe(P()-P()*(y/100),o)):"-"})]}),e.jsxs(u,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:"Gross Total:"}),e.jsx(l,{sx:{width:160},children:B(ke(P()-P()*(y/100),o))||"-"})]})]}),Pe=e.jsx(z,{children:e.jsxs(u,{spacing:2,sx:{p:3},children:[e.jsxs(l,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[e.jsxs(ze,{sx:{m:1,minWidth:120},error:v&&!D,children:[e.jsxs(Ve,{sx:{maxWidth:420,textTransform:"capitalize"},value:D,error:v,onChange:me,children:[e.jsx($,{value:"Customer",children:"Customer"}),i.map(t=>e.jsx($,{value:t.id,children:t.name},t.id))]}),v&&e.jsx($e,{error:!0,children:"Customer is required!"})]}),e.jsx(l,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:e.jsx(p,{variant:"contained",startIcon:e.jsx(V,{icon:"mingcute:add-line"}),onClick:()=>m.onToggle(),children:"Add Customer"})}),e.jsx(N,{label:"Order ID",placeholder:"This Could Be Generated Automatically",value:Z,onChange:ue,sx:{mt:2}}),e.jsx(Je,{label:"Date",sx:{mt:2},value:Q,onChange:t=>{ae(t)}})]}),e.jsx(He,{products:c,onDecrease:pe,onIncrease:fe,onDecreaseDiscount:ge,onIncreaseDiscount:je,handleDiscountDialog:ie,removeItem:Ce}),e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"flex-end",justifyContent:"center",children:[De,e.jsxs(l,{display:"flex",gap:2,height:50,children:[e.jsx(p,{variant:"contained",onClick:()=>{if(isNaN(parseInt(D))){b(!0);return}if(b(!1),!c.length){L("Something went wrong. Product(s) are required!"),k("You need to add at least one product to this order. Please select a product from the list on the right."),j.onToggle();return}if(!isNaN(parseInt(D))&&c.length){b(!1);const t={discount:parseInt(y,10),orderDate:Q.format("YYYY-MM-DD"),products:c.map(s=>({id:s.id,snapshotProductPrice:s.price,quantity:s.quantity})),customer:D};de(t)}},children:"Save and Continue"}),e.jsx(p,{variant:"outlined",onClick:()=>h([]),children:"Clear All"})]})]})]})});return e.jsxs(A,{container:!0,spacing:3,children:[e.jsx(A,{xs:12,md:3,children:e.jsx(u,{children:be})}),e.jsx(A,{xs:12,md:9,children:e.jsx(u,{children:Pe})}),e.jsx(Ge,{open:m.value,onClose:m.onFalse,handler:ye}),e.jsx(_e,{discount:y,open:d.value,onClose:d.onFalse,handler:le}),e.jsx(et,{product:re,discount:te,open:x.value,onClose:x.onFalse,handler:ce}),e.jsx(Ue,{dialog:j,title:f,contentText:O})]})}function st({products:n,customers:i,taxPercentage:o}){return e.jsxs(ve,{children:[e.jsx(Be,{heading:"Create a new Order",links:[{name:"Dashboard",href:F.dashboard.root},{name:"Order",href:F.dashboard.order.root},{name:"Add Order"}],sx:{mb:{xs:3,md:5}}}),e.jsx(tt,{products:n,customers:i,taxPercentage:o})]})}const rt={title:`Create a new Order | Dashboard - ${X.site.name}`};function ns(){const n=E({queryKey:["products"],queryFn:async()=>(await w.get(S.products.list)).data}),i=E({queryKey:["customers"],queryFn:async()=>(await w.get(S.customers.list)).data}),o=E({queryKey:["account-application"],queryFn:async()=>{const{data:a}=await w.get(S.auth.application);return a}});return o.isLoading||n.isLoading||i.isLoading?e.jsx(qe,{}):o.isError||n.isError||n.isError?e.jsx(Ee,{route:F.dashboard.order.root}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{children:e.jsxs("title",{children:[" ",rt.title]})}),e.jsx(st,{products:n.data,customers:i.data,taxPercentage:o.data.taxPercentage})]})}export{ns as default};

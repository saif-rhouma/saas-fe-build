import{j as s,S as t,B as n,e as c,w as F,dL as g,dM as p,dK as u,dN as f,aF as b,du as j,I as C,dB as M,T as E,aL as q,eb as L,p as x,G as m,ef as K,H as N,C as P}from"./index-Bm3rBIkL.js";import{u as $,E as H}from"./error-block-BO5MDXKX.js";import{u as Q}from"./use-params-D5wlM2Nh.js";import{C as G}from"./custom-breadcrumbs-DgyWxDBR.js";import{u as T}from"./useMutation-BPy7H-1h.js";import{a as R,b as A,D as O}from"./DialogContent-adXfkuCx.js";import{C as D}from"./CardHeader-jSMq8N2-.js";import{z as y,u as V,t as z,a as J,F as U}from"./form-provider-BVzxbRNt.js";import"./image-BvWqJKQA.js";import"./editor-B_eq4lpY.js";import{T as W,t as X,a as Y,b as Z,c as _,d as k,e as ss}from"./TimelineSeparator-DUUTQz3y.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./TextField-Zaq0_UQI.js";import"./FormControl-Dpp_E6i1.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-XKr5fbZR.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-CW4sUJth.js";import"./Select-BbFY65UU.js";import"./Menu-BCmDYN65.js";import"./InputBase-CLwZiNSB.js";import"./FormHelperText-D4MtsGiu.js";import"./Rating-DDX-0-qU.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-DEF2K-nH.js";import"./RadioGroup-CcFDuSjI.js";import"./FormGroup-C2nO5a7k.js";import"./FormControlLabel-3udn0dpo.js";import"./index-I76JgJ8L.js";import"./countries-DSLisFCy.js";import"./InputAdornment-C5fdA_pt.js";import"./Autocomplete-uJqWLfO9.js";import"./Chip-wb6jkBj9.js";import"./country-select-dI5VfxcM.js";import"./Checkbox-DZc8qiZw.js";import"./upload-avatar-CklA5cX-.js";import"./format-number-zZ3CkgDh.js";import"./DatePicker-BFbM1AIt.js";import"./ListItem-B8LRzQux.js";import"./MobileDateTimePicker-BrtExEWs.js";import"./index-DJLOkwgj.js";const es=({open:e,onClose:r,handler:l})=>s.jsxs(R,{open:e,onClose:r,children:[s.jsx(A,{children:s.jsxs(t,{spacing:1,alignItems:"center",children:[s.jsx(n,{}),s.jsx("strong",{children:"Are you sure?"}),s.jsx("p",{children:"Do you want to mark seleted ticket as closed."})]})}),s.jsxs(O,{children:[s.jsx(c,{variant:"contained",onClick:l,children:"Confirm"}),s.jsx(c,{color:"inherit",variant:"outlined",onClick:r,children:"Cancel"})]})]});function rs({ticket:e}){const r=F(),l=g(),{mutate:d}=T({mutationFn:a=>p.patch(u.tickets.close+a,{status:"Closed"}),onSuccess:async()=>{f.success("Closed success!"),r.onFalse()},onSettled:async()=>{await l.invalidateQueries({queryKey:["tickets"]})},onError:a=>{}});return s.jsxs(s.Fragment,{children:[s.jsxs(b,{children:[s.jsx(D,{title:"Details"}),s.jsxs(t,{sx:{p:3},children:[s.jsxs(t,{direction:"row",justifyContent:"space-between",sx:{typography:"body2"},children:[s.jsxs(n,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[s.jsx(t,{direction:"row",sx:{typography:"subtitle2",marginBottom:1},children:s.jsx("div",{children:"Ticket Details"})}),s.jsxs(n,{sx:{color:"text.secondary"},children:["TICKET ID: ",e==null?void 0:e.id]}),s.jsxs(n,{sx:{color:"text.secondary"},children:["Member: ",`${e==null?void 0:e.member.firstName} ${e==null?void 0:e.member.lastName}`]}),s.jsxs(n,{sx:{color:"text.secondary"},children:["Topic: ",e==null?void 0:e.topic,"."]})]}),s.jsxs(n,{flexDirection:"column",alignItems:"center",gap:.5,sx:{display:"flex",width:"100%",p:1,borderRight:a=>`dashed 2px ${a.vars.palette.background.neutral}`,borderLeft:a=>`dashed 2px ${a.vars.palette.background.neutral}`},children:[s.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:s.jsx("div",{children:"Ticket Status"})}),s.jsx(n,{sx:{color:"text.secondary"},children:s.jsx(j,{variant:"soft",color:e.status==="Open"&&"info"||e.status==="Closed"&&"default"||"default",children:e.status})})]}),s.jsxs(n,{flexDirection:"column",alignItems:"center",sx:{p:1,display:"flex",width:"100%"},children:[s.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",gap:1,sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:s.jsx("div",{children:"Ticket Priority"})}),s.jsx(n,{sx:{color:"text.secondary"},children:s.jsx(j,{variant:"soft",color:(e==null?void 0:e.priority)==="Low"&&"success"||(e==null?void 0:e.priority)==="Medium"&&"warning"||(e==null?void 0:e.priority)==="Hight"&&"error"||"default",children:e==null?void 0:e.priority})})]})]}),s.jsx(n,{sx:{pt:5},children:s.jsx(c,{onClick:r.onTrue,disabled:e.status==="Closed",variant:"contained",startIcon:s.jsx(C,{icon:"carbon:checkmark-filled"}),children:"Mark as Closed"})})]})]}),s.jsx(es,{open:r.value,onClose:r.onFalse,handler:()=>d(e.id)})]})}const ns=y.object({message:y.string().min(1,{message:"Name is required!"})}),is=({ticket:e,messages:r})=>{const l={message:""},d=V({resolver:z(ns),defaultValues:l}),{reset:a,handleSubmit:v,formState:{isSubmitting:as}}=d,h=g(),{mutate:w}=T({mutationFn:i=>p.post(u.tickets.createMessage,i),onSuccess:async()=>{f.success("Message Has Been Created!"),a()},onSettled:async()=>{const{id:i}=e;await h.invalidateQueries({queryKey:["tickets"]}),await h.invalidateQueries({queryKey:["tickets",i]})},onError:i=>{}}),I=v(async i=>{try{if(e.id){const o={...i};o.ticketId=e.id,w(o)}}catch(o){console.log(o),setErrorMsg(o instanceof Error?o.message:o)}}),S=s.jsxs(n,{sx:{pr:4,pl:4,pb:4,pt:2},children:[s.jsx(W,{sx:{p:0,m:0,[`& .${X.root}:before`]:{flex:0,padding:0}},children:s.jsx(M,{fillContent:!0,sx:{height:360},children:r==null?void 0:r.map((i,o)=>{const B=o===r.length-1;return s.jsxs(Y,{children:[s.jsxs(Z,{children:[s.jsx(_,{color:"primary"}),B?null:s.jsx(k,{})]}),s.jsx(ss,{children:s.jsxs(n,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(n,{children:[s.jsx(E,{variant:"subtitle2",children:i.createdBy.firstName}),s.jsx(n,{sx:{color:"text.disabled",typography:"caption",mt:.5},children:i.message})]}),s.jsx(n,{sx:{color:"text.disabled",typography:"caption"},children:q(i.createTime)})]})})]},i.id)})})}),s.jsx(J,{methods:d,onSubmit:I,children:s.jsxs(t,{justifyContent:"flex-end",spacing:1,sx:{marginTop:1},children:[s.jsx(t,{sx:{typography:"subtitle1",width:"100%",marginBottom:1},children:s.jsx("div",{children:"Send Reply:"})}),s.jsx(U.Text,{label:"Enter Description",name:"message",multiline:!0,rows:3,sx:{mb:2}}),s.jsx(n,{children:s.jsx(c,{type:"submit",variant:"contained",endIcon:s.jsx(C,{icon:"iconamoon:send-fill"}),children:"Send"})})]})})]});return s.jsxs(b,{children:[s.jsx(D,{title:"Previous Messages"}),S]})};function os({ticket:e}){return s.jsxs(L,{children:[s.jsx(G,{links:[{name:"Dashboard",href:x.dashboard.root},{name:"Tickets",href:x.dashboard.tickets.root},{name:"Ticket Details"}],sx:{mb:{xs:3,md:5}}}),s.jsxs(m,{container:!0,spacing:3,children:[s.jsx(m,{xs:12,md:9,children:s.jsx(t,{spacing:3,direction:{xs:"column-reverse",md:"column"},children:s.jsx(rs,{ticket:e})})}),s.jsx(m,{xs:12,md:3,children:s.jsx(is,{ticket:e,messages:e==null?void 0:e.messages})})]})]})}const ts={title:`Ticket details | Dashboard - ${P.site.name}`};function Zs(){const{id:e=""}=Q(),r=$({queryKey:["tickets",e],queryFn:async()=>{const{data:l}=await p.get(u.tickets.details+e);return l}});return r.isPending||r.isLoading?s.jsx(K,{}):r.isError?s.jsx(H,{route:x.dashboard.tickets.root}):s.jsxs(s.Fragment,{children:[s.jsx(N,{children:s.jsxs("title",{children:[" ",ts.title]})}),s.jsx(os,{ticket:r.data})]})}export{Zs as default};

import{dL as q,r as u,C as B,w as J,j as n,B as E,cr as X,e as Y,I as Q,S as j,aJ as Z,ed as ss,T as ts,bN as ns,H as es}from"./index-BjIn7_qX.js";import{u as as,a as w,c as F,p as os,r as rs,g as is,D as ls,M as cs,S as K,h as ds,v as us,K as ms,T as xs,b as ps,d as L}from"./sortable.esm-DdaWjmap.js";import{u as fs,m as T}from"./index-BdHse7QF.js";import{E as hs}from"./empty-content-DUH3kGlt.js";import{k as ks,K as Cs,a as gs,b as bs,c as ys,d as js}from"./utils-DG0Z3K-z.js";import{T as Is}from"./TextField-DpiQLRVb.js";import{C as Ss}from"./ClickAwayListener-BWZYBfjK.js";import{F as vs}from"./FormControlLabel-Cebq6FC-.js";import"./InputBase-B1W2ZC-C.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./Skeleton-DzclVOWZ.js";import"./image-Cp18p2kF.js";import"./ListItem-Dqffwavq.js";import"./AvatarGroup-DXy9L2Dd.js";import"./FormControl-7ae63LEX.js";import"./InputLabel-CFOghGNi.js";import"./FormLabel-CGBfd-SD.js";import"./Select-DuF5QBaf.js";import"./Menu-BwYh9-WP.js";import"./FormHelperText-CzQPg626.js";const O=!1,v=`${B.site.serverUrl}/api/orders-status`,ws={revalidateIfStale:O,revalidateOnFocus:O,revalidateOnReconnect:O};function Os(){const{data:s,isLoading:a,error:r,isValidating:l}=fs(v,q,ws);return u.useMemo(()=>{const C=(s==null?void 0:s.board.tasks)??{},p=(s==null?void 0:s.board.columns)??[];return{board:{tasks:C,columns:p},boardLoading:a,boardError:r,boardValidating:l,boardEmpty:!a&&!p.length}},[s==null?void 0:s.board.columns,s==null?void 0:s.board.tasks,r,a,l])}async function Ts(s){T(v,a=>{const{board:r}=a,l=[...r.columns,s],m={...r.tasks,[s.id]:[]};return{...a,board:{...r,columns:l,tasks:m}}},!1)}async function Es(s){T(v,a=>{const{board:r}=a;return{...a,board:{...r,columns:s}}},!1)}async function A(s){T(v,a=>{const{board:r}=a;return{...a,board:{...r,tasks:s}}},!1)}function Fs(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const a=Math.random()*16|0;return(s==="x"?a:a&3|8).toString(16)})}function Ks({sx:s,...a}){const[r,l]=u.useState(""),m=J(),C=u.useCallback(c=>{l(c.target.value)},[]),p=u.useCallback(async()=>{try{const c={id:Fs(),name:r.trim()?r:"Untitled"};Ts(c),l(""),m.onFalse()}catch(c){console.error(c)}},[r,m]),k=u.useCallback(c=>{c.key==="Enter"&&p()},[p]),b=u.useCallback(()=>{l(""),m.onFalse()},[m]);return n.jsxs(n.Fragment,{children:[n.jsx(E,{sx:{width:"var(--column-width)",flex:"0 0 auto",...s},...a,children:m.value?n.jsx(Ss,{onClickAway:b,children:n.jsx(Is,{autoFocus:!0,fullWidth:!0,placeholder:"Untitled",value:r,onChange:C,onKeyUp:k,helperText:"Press Enter to create the column.",sx:{[`& .${X.input}`]:{typography:"h6"}}})}):n.jsx(Y,{fullWidth:!0,size:"large",color:"inherit",variant:"outlined",startIcon:n.jsx(Q,{icon:"mingcute:add-line",sx:{mr:-.5}}),onClick:m.onTrue,children:"Add column"})}),n.jsx(E,{sx:{width:"1px",flexShrink:0}})]})}const D="placeholder",N={"--item-gap":"16px","--item-radius":"12px","--column-gap":"24px","--column-width":"336px","--column-radius":"16px","--column-padding":"20px 16px 16px 16px"};function Ls(){const{board:s,boardLoading:a,boardEmpty:r}=Os(),[l,m]=u.useState(!0),C=u.useRef(!1),p=u.useRef(null),[k,b]=u.useState(null),c=s.columns.map(t=>t.id),M=k?c.includes(k):!1,H=as(w(ps,{activationConstraint:{distance:5}}),w(xs,{activationConstraint:{distance:5}}),w(ms,{coordinateGetter:ys})),P=u.useCallback(t=>{var i;if(k&&k in s.tasks)return F({...t,droppableContainers:t.droppableContainers.filter(f=>f.id in s.tasks)});const e=os(t),x=e.length>0?e:rs(t);let o=is(x,"id");if(o!=null){if(o in s.tasks){const f=s.tasks[o].map(d=>d.id);f.length>0&&(o=(i=F({...t,droppableContainers:t.droppableContainers.filter(d=>d.id!==o&&f.includes(d.id))})[0])==null?void 0:i.id)}return p.current=o,[{id:o}]}return C.current&&(p.current=k),p.current?[{id:p.current}]:[]},[k,s==null?void 0:s.tasks]),I=t=>t in s.tasks?t:Object.keys(s.tasks).find(e=>s.tasks[e].map(x=>x.id).includes(t));u.useEffect(()=>{requestAnimationFrame(()=>{C.current=!1})},[]);const R=({active:t})=>{b(t.id)},V=({active:t,over:e})=>{const x=e==null?void 0:e.id;if(x==null||t.id in s.tasks)return;const o=I(x),i=I(t.id);if(!(!o||!i)&&i!==o){const f=s.tasks[i].map(y=>y.id),d=s.tasks[o].map(y=>y.id),g=d.indexOf(x),S=f.indexOf(t.id);let h;if(x in s.tasks)h=d.length+1;else{const _=e&&t.rect.current.translated&&t.rect.current.translated.top>e.rect.top+e.rect.height?1:0;h=g>=0?g+_:d.length+1}C.current=!0;const G={...s.tasks,[i]:s.tasks[i].filter(y=>y.id!==t.id),[o]:[...s.tasks[o].slice(0,h),s.tasks[i][S],...s.tasks[o].slice(h,s.tasks[o].length)]};A(G)}},U=({active:t,over:e})=>{if(t.id in s.tasks&&(e!=null&&e.id)){const f=c.indexOf(t.id),d=c.indexOf(e.id),g=L(s.columns,f,d);Es(g)}const x=I(t.id);if(!x){b(null);return}const o=e==null?void 0:e.id;if(o==null){b(null);return}const i=I(o);if(i){const f=s.tasks[x].map(h=>h.id),d=s.tasks[i].map(h=>h.id),g=f.indexOf(t.id),S=d.indexOf(o);if(g!==S){const h={...s.tasks,[i]:L(s.tasks[i],g,S)};A(h)}}b(null)},W=n.jsx(j,{direction:"row",alignItems:"flex-start",sx:{gap:"var(--column-gap)"},children:n.jsx(js,{})}),z=n.jsx(hs,{filled:!0,sx:{py:10,maxHeight:{md:480}}}),$=n.jsxs(ls,{id:"dnd-kanban",sensors:H,collisionDetection:P,measuring:{droppable:{strategy:cs.Always}},onDragStart:R,onDragOver:V,onDragEnd:U,children:[n.jsx(j,{sx:{flex:"1 1 auto",overflowX:"auto"},children:n.jsx(j,{sx:{pb:3,display:"unset",...l&&{minHeight:0,display:"flex",flex:"1 1 auto"}},children:n.jsx(j,{direction:"row",sx:{gap:"var(--column-gap)",...l&&{minHeight:0,flex:"1 1 auto",[`& .${ks.columnList}`]:{...Z,flex:"1 1 auto"}}},children:n.jsxs(K,{items:[...c,D],strategy:ds,children:[s==null?void 0:s.columns.map(t=>n.jsx(Cs,{column:t,tasks:s.tasks[t.id],children:n.jsx(K,{items:s.tasks[t.id],strategy:us,children:s.tasks[t.id].map(e=>n.jsx(gs,{task:e,columnId:t.id,disabled:M},e.id))})},t.id)),n.jsx(Ks,{id:D})]})})})}),n.jsx(bs,{columns:s==null?void 0:s.columns,tasks:s==null?void 0:s.tasks,activeId:k,sx:N})]});return n.jsxs(ss,{maxWidth:!1,sx:{...N,pb:0,pl:{sm:3},pr:{sm:0},flex:"1 1 0",display:"flex",overflow:"hidden",flexDirection:"column"},children:[n.jsxs(j,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{pr:{sm:3},mb:{xs:3,md:5}},children:[n.jsx(ts,{variant:"h4",children:"Kanban"}),n.jsx(vs,{label:"Column fixed",labelPlacement:"start",control:n.jsx(ns,{checked:l,onChange:t=>{m(t.target.checked)},inputProps:{id:"column-fixed-switch"}})})]}),a?W:n.jsx(n.Fragment,{children:r?z:$})]})}const As={title:`Kanban | Dashboard - ${B.site.name}`};function tt(){return n.jsxs(n.Fragment,{children:[n.jsx(es,{children:n.jsxs("title",{children:[" ",As.title]})}),n.jsx(Ls,{})]})}export{tt as default};

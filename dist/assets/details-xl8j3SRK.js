import{j as t,B as n,T as L,el as V,d7 as A,S as o,e3 as q,e as R,I as D,cY as N,h as W,g as G,r as d,p as v,ee as Y,e8 as _,i as k,c9 as P,l as B,d0 as F,em as M,dn as z,ef as J,en as Q,dP as U,cV as O,dp as w,dm as C,dq as I,dT as X,H as Z,C as tt}from"./index-DBAnnifB.js";import{u as et,E as st}from"./error-block-I6x1Hy75.js";import{u as it}from"./use-params-DEx6JbuU.js";import"./chart-legends-CbMMWM0D.js";import{l as nt}from"./index-JU6SrAG_.js";import{u as S}from"./useMutation-DLdc3eWl.js";import{C as at}from"./confirm-dialog-Bix3pn1a.js";import{C as lt}from"./custom-breadcrumbs-DBItHaBE.js";import{b as T}from"./format-number-DHkj0q5I.js";import{P as E}from"./permission-access-controller-Dti4v_dk.js";import{T as ot,t as ct,a as rt,b as xt,c as pt,d as dt,e as ht}from"./TimelineSeparator-CsvY_CJc.js";import{C as K}from"./CardHeader-Vz8vospd.js";import{O as mt}from"./order-product-table-DWlLoTU0.js";import{P as ut,O as jt,a as yt}from"./order-payment-details-dialog-d5deobuu.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./index-BHbW1OCY.js";import"./DialogContent-BOG7TMWB.js";import"./DialogTitle-m6FUYnnv.js";import"./table-head-custom-oTVXNsWX.js";import"./TableCell-D0tRcJwU.js";import"./Checkbox-C9zyd1yT.js";import"./incrementer-button-Dvx1B3F1.js";import"./form-provider-C9WrYleO.js";import"./TextField-Cnf5s-_6.js";import"./FormControl-BL4Ls0ff.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-B6YlaWfN.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-qH7g1y9y.js";import"./Select-Cs1GmroI.js";import"./Menu-CWYUzvJj.js";import"./InputBase-Dk2d0D5e.js";import"./FormHelperText-DbwQqqnD.js";import"./Rating-DsIJUcaL.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-CpxSiSi_.js";import"./index-B9zhif9o.js";import"./Slider-BALWrmvq.js";import"./RadioGroup-C_0xPGj6.js";import"./FormGroup-ZuySfzWi.js";import"./FormControlLabel-BLHOqcns.js";import"./utils-C3i7epmT.js";import"./countries-DSLisFCy.js";import"./InputAdornment-kj6j4mRM.js";import"./Autocomplete-Bk7RHyx1.js";import"./Chip-DfL_ynnF.js";import"./country-select-SNPz2g0K.js";import"./upload-avatar-CgBNTr-y.js";import"./image-V4smZB5P.js";import"./DatePicker-WvioqOmJ.js";import"./ListItem-CRRiYsyQ.js";import"./MobileDateTimePicker-kmTIkQgP.js";import"./Tabs-D1nVhLuN.js";import"./KeyboardArrowRight-tacz4Y6j.js";import"./schema-helper-CvPOGW5C.js";import"./LoadingButton-CunA2jBP.js";import"./CircularProgress-DeUuXNKO.js";const gt=({order:e,payments:s,dialog:a,handleApproveOrder:l,handlePrint:j})=>{const u=t.jsxs(n,{sx:{pr:4,pl:4,pb:4,pt:2},children:[t.jsx(ot,{sx:{p:0,m:0,[`& .${ct.root}:before`]:{flex:0,padding:0}},children:s==null?void 0:s.map((x,c)=>{const h=c===0,m=c===s.length-1;return t.jsxs(rt,{children:[t.jsxs(xt,{children:[t.jsx(pt,{color:h&&"primary"||"grey"}),m?null:t.jsx(dt,{})]}),t.jsx(ht,{children:t.jsxs(n,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs(n,{children:[t.jsx(L,{variant:"subtitle2",children:T(x.amount)}),t.jsx(n,{sx:{color:"text.disabled",typography:"caption",mt:.5},children:V(x.paymentDate)})]}),t.jsx(A,{color:"success",children:x.paymentType})]})})]},x.id)})}),t.jsx(o,{justifyContent:"flex-end",spacing:1.5,sx:{marginTop:2},children:(e==null?void 0:e.status)!=="Draft"&&(e==null?void 0:e.status)!=="Canceled"&&t.jsx(E,{permission:q.ADD_PAYMENT,children:t.jsx(R,{variant:"contained",onClick:()=>a.onTrue(),startIcon:t.jsx(D,{icon:"mingcute:add-line"}),children:"New Payment"})})})]});return t.jsxs(N,{children:[(s==null?void 0:s.length)>0&&t.jsx(K,{title:"Payments"}),u]})};function ft({order:e,discount:s,customer:a,totalAmount:l,handleApproveOrder:j,handlePrint:u}){var y,g,f,b;const{user:x}=W(),c=G(),h=d.useCallback(r=>{c.replace(v.dashboard.quotation.details(r))},[c]),m=t.jsxs(o,{spacing:2,alignItems:"flex-end",sx:{p:3,textAlign:"right",typography:"body2"},children:[t.jsxs(o,{direction:"row",children:[t.jsx(n,{sx:{color:"text.secondary"},children:"Subtotal"}),t.jsx(n,{sx:{width:160,typography:"subtitle2"},children:T(l)||"-"})]}),t.jsxs(o,{direction:"row",children:[t.jsx(n,{sx:{color:"text.secondary"},children:"Discount"}),t.jsx(n,{sx:{width:160,...s&&{color:"error.main"}},children:s?`- ${s}%`:"-"})]}),t.jsxs(o,{direction:"row",children:[t.jsxs(n,{sx:{color:"text.secondary"},children:["Tax (",(e==null?void 0:e.snapshotTaxPercentage)||"0","%)"]}),t.jsx(n,{sx:{width:160},children:e!=null&&e.snapshotTaxPercentage?T(Y(l-l*(s/100),e==null?void 0:e.snapshotTaxPercentage)):"-"})]}),t.jsxs(o,{direction:"row",sx:{typography:"subtitle1"},children:[t.jsx("div",{children:"Total"}),t.jsx(n,{sx:{width:160},children:T(_(l-l*(s/100),e==null?void 0:e.snapshotTaxPercentage))||"-"})]})]}),p=k();return t.jsxs(t.Fragment,{children:[t.jsxs(N,{children:[t.jsx(o,{justifyContent:"center",alignItems:"center",children:t.jsxs("h1",{className:"print-title",children:["Order REF: #",e.ref]})}),t.jsx("style",{jsx:!0,children:`
          .print-title {
            display: none; /* Hide on screen */
          }

          @media print {
            .print-title {
              display: block; /* Show only when printing */
            }
            .print-hide {
              display: none; /* Hide on screen */
            }
            html,
            body {
              height: initial !important;
              overflow: initial !important;
            }

            .scrollableDiv {
              width: 100%;
              height: 100% !important;
              overflow: visible;
            }
          }
        `}),t.jsx(K,{className:"print-hide",title:"Details",subheader:((y=e==null?void 0:e.quotation)==null?void 0:y.id)&&`Related to Quotation: #${(g=e==null?void 0:e.quotation)==null?void 0:g.ref}`,action:t.jsx(o,{className:"print-hide",children:t.jsxs(o,{direction:"row",spacing:1,flexGrow:1,children:[((f=e==null?void 0:e.quotation)==null?void 0:f.id)&&t.jsx(P,{title:`Related to Quotation: #${(b=e==null?void 0:e.quotation)==null?void 0:b.ref}`,children:t.jsx(B,{onClick:()=>{var r;h((r=e==null?void 0:e.quotation)==null?void 0:r.id)},children:t.jsx(D,{icon:"heroicons-outline:external-link"})})}),(e==null?void 0:e.status)!=="Draft"&&(e==null?void 0:e.status)!=="Canceled"&&t.jsx(P,{title:"Change Order Status",children:t.jsx(B,{color:"warning",onClick:()=>p.onToggle(),children:t.jsx(D,{icon:"tabler:status-change"})})}),t.jsx(E,{permission:q.PRINT_ORDER,children:t.jsx(P,{title:"Print",children:t.jsx(ut,{order:e})})}),t.jsx(E,{permission:q.APPROVE_ORDER,children:(e==null?void 0:e.status)==="Draft"&&t.jsx(R,{variant:"contained",size:"medium",color:"primary",startIcon:t.jsx(D,{icon:"solar:check-square-bold"}),onClick:()=>{j(e.id)},children:"Approve"})})]})})}),t.jsxs(o,{direction:"row",justifyContent:"space-between",sx:{p:3,typography:"body2"},children:[t.jsxs(n,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[t.jsx(o,{direction:"row",sx:{typography:"subtitle2",marginBottom:1},children:t.jsx("div",{children:"Order Details"})}),t.jsxs(n,{sx:{color:"text.secondary"},children:["ORDER ID: #",e.ref]}),t.jsxs(n,{sx:{color:"text.secondary"},children:["Order Date: ",F(e.orderDate)]}),t.jsxs(n,{sx:{color:"text.secondary"},children:["Delivery Date: ",e.deliveryDate?F(e.deliveryDate):t.jsx("span",{children:" - "})]})]}),t.jsxs(n,{flexDirection:"column",gap:.5,sx:{display:"flex",width:"100%",p:1,borderRight:r=>`dashed 2px ${r.vars.palette.background.neutral}`,borderLeft:r=>`dashed 2px ${r.vars.palette.background.neutral}`},children:[t.jsx(o,{display:"flex",justifyContent:"center",alignItems:"center",sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:t.jsx("div",{children:M(x)})}),t.jsxs(n,{sx:{color:"text.secondary"},children:["Status :"," ",t.jsx(A,{variant:"soft",color:(e==null?void 0:e.status)==="Ready"&&"info"||(e==null?void 0:e.status)==="InProcess"&&"warning"||(e==null?void 0:e.status)==="Delivered"&&"success"||"default",children:e==null?void 0:e.status})]}),t.jsxs(n,{sx:{color:"text.secondary"},children:["Tax/Vat: ",a==null?void 0:a.taxNumber]})]}),t.jsxs(n,{flexDirection:"column",alignItems:"center",sx:{p:1,display:"flex",width:"100%"},children:[t.jsx(o,{display:"flex",alignItems:"center",gap:1,sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:t.jsx("div",{children:"Order To"})}),t.jsx(n,{sx:{color:"text.secondary"},children:a==null?void 0:a.name}),t.jsxs(n,{sx:{color:"text.secondary"},children:["Tel: ",a==null?void 0:a.phoneNumber]})]})]}),t.jsx(n,{fullWidth:!0,alignItems:"center",sx:{p:3,borderBottom:r=>`dashed 2px ${r.vars.palette.background.neutral}`},children:t.jsx(mt,{products:e.productToOrder,isDetail:!0})}),m,(e==null?void 0:e.notes)&&t.jsx(o,{justifyContent:"space-between",sx:{p:3,typography:"body2"},children:t.jsxs(n,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[t.jsx(o,{sx:{typography:"subtitle2",marginBottom:1},children:t.jsx("div",{children:"Notes:"})}),t.jsx(n,{sx:{color:"text.secondary"},children:e==null?void 0:e.notes})]})})]}),t.jsx(jt,{currentOrder:e,open:p.value,onClose:p.onFalse})]})}function bt({currentOrder:e}){const[s,a]=d.useState(e),[l,j]=d.useState(),u=d.useRef(),x=k(),c=z(),[h,m]=d.useState([]),p=k(),y=J();d.useEffect(()=>{a(e)},[e]),d.useEffect(()=>{const i=Q(s==null?void 0:s.payments,"paymentDate");m(i)},[s==null?void 0:s.payments]);const{mutate:g}=S({mutationFn:i=>w.post(C.payments.create,i),onSuccess:async i=>{I.success("New Payment Has Been Created!");const{data:$}=i,H=Q([...h,$],"paymentDate");m(H)},onSettled:async()=>{await c.invalidateQueries({queryKey:["payments"]});const{id:i}=s;await c.invalidateQueries({queryKey:["order",i]}),x.onFalse()},onError:i=>{console.log(i)}}),{mutate:f}=S({mutationFn:i=>w.get(C.order.approve+i),onSuccess:async({data:i})=>{i!=null&&i.length?(p.onTrue(),j(i)):(I.success("Order Has Been Approved!"),a(i))},onSettled:async()=>{const{id:i}=s;await c.invalidateQueries({queryKey:["orders"]}),await c.invalidateQueries({queryKey:["orders","analytics"]}),await c.invalidateQueries({queryKey:["order",i]})},onError:i=>{console.log(i)}}),{mutate:b}=S({mutationFn:i=>w.post(C.order.createPlans,i),onSuccess:async({data:i})=>{I.success("Order Has Been Approved!"),a(i),p.onFalse()},onSettled:async()=>{const{id:i}=s;await c.invalidateQueries({queryKey:["orders"]}),await c.invalidateQueries({queryKey:["orders","analytics"]}),await c.invalidateQueries({queryKey:["order",i]})},onError:i=>{console.log(i)}}),r=nt.useReactToPrint({content:()=>u.current});return t.jsxs(t.Fragment,{children:[t.jsxs(U,{children:[t.jsx(lt,{links:[{name:"Dashboard",href:v.dashboard.root},{name:"Orders",href:v.dashboard.order.root},{name:"Order Details"}],sx:{mb:{xs:3,md:5}}}),t.jsxs(O,{container:!0,spacing:3,children:[t.jsx(O,{xs:12,md:(s==null?void 0:s.status)!=="Draft"&&(s==null?void 0:s.status)!=="Canceled"?9:12,children:t.jsx(o,{ref:u,spacing:3,direction:{xs:"column-reverse",md:"column"},children:t.jsx(ft,{order:s,customer:s==null?void 0:s.customer,discount:s==null?void 0:s.discount,totalAmount:s==null?void 0:s.totalOrderAmount,handleApproveOrder:f,handlePrint:r})})}),(s==null?void 0:s.status)!=="Draft"&&(s==null?void 0:s.status)!=="Canceled"&&t.jsx(O,{xs:12,md:3,children:t.jsx(gt,{order:s,payments:h,dialog:x})})]}),t.jsx(yt,{order:s,open:x.value,onClose:x.onFalse,handler:g})]}),t.jsx(at,{open:p.value,onClose:p.onFalse,title:"Out of Stock",content:t.jsxs(t.Fragment,{children:[t.jsx(n,{children:"Products are out of Stock! do you want to create plans?"}),t.jsxs(n,{sx:{mt:1,mb:1},children:["You need to create ",t.jsx("span",{style:{fontWeight:"bold"},children:l==null?void 0:l.length})," :"]}),l==null?void 0:l.map(i=>t.jsxs(n,{children:["Plan for ",t.jsx("span",{style:{fontWeight:"bold"},children:i.product.name})," because is missing"," ",t.jsx("span",{style:{fontWeight:"bold",color:`${y.vars.palette.error.light}`},children:i.missingQuantity}),"."]}))]}),action:t.jsx(R,{variant:"contained",color:"error",onClick:()=>{b(l)},children:(l==null?void 0:l.length)>1?"Create Plans":"Create Plan"})})]})}const Dt={title:`Order details | Dashboard - ${tt.site.name}`};function Oe(){const{id:e=""}=it(),s=et({queryKey:["order",e],queryFn:async()=>{const{data:a}=await w.get(C.order.details+e);return a}});return s.isPending||s.isLoading?t.jsx(X,{}):s.isError?t.jsx(st,{route:v.dashboard.order.root}):t.jsxs(t.Fragment,{children:[t.jsx(Z,{children:t.jsxs("title",{children:[" ",Dt.title]})}),t.jsx(bt,{currentOrder:s.data})]})}export{Oe as default};

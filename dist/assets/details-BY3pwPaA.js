import{j as s,S as o,B as i,e as c,o as F,dI as g,dJ as p,dH as u,dK as f,aD as b,ds as j,I as C,dy as M,T as q,aJ as E,e8 as H,p as x,G as m,ec as K,H as P,C as $}from"./index-DCM0dqKu.js";import{u as L,E as N}from"./error-block-DeCjSF4t.js";import{u as Q}from"./use-params-D3xvRTwk.js";import{C as G}from"./custom-breadcrumbs-IetWuDPQ.js";import{u as T}from"./useMutation-D2La3F2r.js";import{a as J,b as R,D as A}from"./DialogContent-BFR1QZgD.js";import{C as D}from"./CardHeader-BQI3yEzz.js";import{z as y,u as O,t as V,a as z,F as U}from"./form-provider-CsXzZQi6.js";import"./image-DskMD1i2.js";import"./editor-DskST7D0.js";import{T as W,t as X,a as Y,b as Z,c as _,d as k,e as ss}from"./TimelineSeparator-BdYhu0xS.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./TextField-n063yImk.js";import"./FormControl-CzeO_UtU.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-D4P0yivD.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-sPKOeIzp.js";import"./Select-BfBEUDqV.js";import"./Menu-DUao5Yoh.js";import"./InputBase-DTC7mqIN.js";import"./FormHelperText-DqZjaKA5.js";import"./Rating-bGgbH5MB.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-DbZp1IuP.js";import"./RadioGroup-Dwnhy8-J.js";import"./FormGroup-B2wxUdmP.js";import"./FormControlLabel-DzI7o2_A.js";import"./index-BdcQkSNX.js";import"./countries-DSLisFCy.js";import"./InputAdornment-DO0FXlwx.js";import"./Autocomplete-B8SRK5t2.js";import"./Chip-B7AXZfmm.js";import"./country-select-D81VscAm.js";import"./Checkbox-bK399IpG.js";import"./upload-avatar-QqSqRao9.js";import"./format-number-BQ7t0qkw.js";import"./DatePicker-BHh4WHnP.js";import"./ListItem-BlYb29G3.js";import"./MobileDateTimePicker-B4xWrI2C.js";import"./Tabs-D0Tq82TW.js";import"./KeyboardArrowRight-CIlbmAZJ.js";import"./index-BWYPRE2-.js";const es=({open:e,onClose:r,handler:a})=>s.jsxs(J,{open:e,onClose:r,children:[s.jsx(R,{children:s.jsxs(o,{spacing:1,alignItems:"center",children:[s.jsx(i,{}),s.jsx("strong",{children:"Are you sure?"}),s.jsx("p",{children:"Do you want to mark seleted ticket as closed."})]})}),s.jsxs(A,{children:[s.jsx(c,{variant:"contained",onClick:a,children:"Confirm"}),s.jsx(c,{color:"inherit",variant:"outlined",onClick:r,children:"Cancel"})]})]});function rs({ticket:e}){const r=F(),a=g(),{mutate:d}=T({mutationFn:t=>p.patch(u.tickets.close+t,{status:"Closed"}),onSuccess:async()=>{f.success("Closed success!"),r.onFalse()},onSettled:async()=>{await a.invalidateQueries({queryKey:["tickets"]})},onError:t=>{}});return s.jsxs(s.Fragment,{children:[s.jsxs(b,{children:[s.jsx(D,{title:"Details"}),s.jsxs(o,{sx:{p:3},children:[s.jsxs(o,{direction:"row",justifyContent:"space-between",sx:{typography:"body2"},children:[s.jsxs(i,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[s.jsx(o,{direction:"row",sx:{typography:"subtitle2",marginBottom:1},children:s.jsx("div",{children:"Ticket Details"})}),s.jsxs(i,{sx:{color:"text.secondary"},children:["TICKET ID: ",e==null?void 0:e.id]}),s.jsxs(i,{sx:{color:"text.secondary"},children:["Member: ",`${e==null?void 0:e.member.firstName} ${e==null?void 0:e.member.lastName}`]}),s.jsxs(i,{sx:{color:"text.secondary"},children:["Topic: ",e==null?void 0:e.topic,"."]})]}),s.jsxs(i,{flexDirection:"column",alignItems:"center",gap:.5,sx:{display:"flex",width:"100%",p:1,borderRight:t=>`dashed 2px ${t.vars.palette.background.neutral}`,borderLeft:t=>`dashed 2px ${t.vars.palette.background.neutral}`},children:[s.jsx(o,{display:"flex",justifyContent:"center",alignItems:"center",sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:s.jsx("div",{children:"Ticket Status"})}),s.jsx(i,{sx:{color:"text.secondary"},children:s.jsx(j,{variant:"soft",color:e.status==="Open"&&"info"||e.status==="Closed"&&"default"||"default",children:e.status})})]}),s.jsxs(i,{flexDirection:"column",alignItems:"center",sx:{p:1,display:"flex",width:"100%"},children:[s.jsx(o,{display:"flex",justifyContent:"center",alignItems:"center",gap:1,sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:s.jsx("div",{children:"Ticket Priority"})}),s.jsx(i,{sx:{color:"text.secondary"},children:s.jsx(j,{variant:"soft",color:(e==null?void 0:e.priority)==="Low"&&"success"||(e==null?void 0:e.priority)==="Medium"&&"warning"||(e==null?void 0:e.priority)==="Hight"&&"error"||"default",children:e==null?void 0:e.priority})})]})]}),s.jsx(i,{sx:{pt:5},children:s.jsx(c,{onClick:r.onTrue,disabled:e.status==="Closed",variant:"contained",startIcon:s.jsx(C,{icon:"carbon:checkmark-filled"}),children:"Mark as Closed"})})]})]}),s.jsx(es,{open:r.value,onClose:r.onFalse,handler:()=>d(e.id)})]})}const is=y.object({message:y.string().min(1,{message:"Name is required!"})}),ns=({ticket:e,messages:r})=>{const a={message:""},d=O({resolver:V(is),defaultValues:a}),{reset:t,handleSubmit:v,formState:{isSubmitting:as}}=d,h=g(),{mutate:w}=T({mutationFn:n=>p.post(u.tickets.createMessage,n),onSuccess:async()=>{f.success("Message Has Been Created!"),t()},onSettled:async()=>{const{id:n}=e;await h.invalidateQueries({queryKey:["tickets"]}),await h.invalidateQueries({queryKey:["tickets",n]})},onError:n=>{}}),I=v(async n=>{try{if(e.id){const l={...n};l.ticketId=e.id,w(l)}}catch(l){console.log(l)}}),S=s.jsxs(i,{sx:{pr:4,pl:4,pb:4,pt:2},children:[s.jsx(W,{sx:{p:0,m:0,[`& .${X.root}:before`]:{flex:0,padding:0}},children:s.jsx(M,{fillContent:!0,sx:{height:360},children:r==null?void 0:r.map((n,l)=>{const B=l===r.length-1;return s.jsxs(Y,{children:[s.jsxs(Z,{children:[s.jsx(_,{color:"primary"}),B?null:s.jsx(k,{})]}),s.jsx(ss,{children:s.jsxs(i,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(i,{children:[s.jsx(q,{variant:"subtitle2",children:n.createdBy.firstName}),s.jsx(i,{sx:{color:"text.disabled",typography:"caption",mt:.5},children:n.message})]}),s.jsx(i,{sx:{color:"text.disabled",typography:"caption"},children:E(n.createTime)})]})})]},n.id)})})}),s.jsx(z,{methods:d,onSubmit:I,children:s.jsxs(o,{justifyContent:"flex-end",spacing:1,sx:{marginTop:1},children:[s.jsx(o,{sx:{typography:"subtitle1",width:"100%",marginBottom:1},children:s.jsx("div",{children:"Send Reply:"})}),s.jsx(U.Text,{label:"Enter Description",name:"message",multiline:!0,rows:3,sx:{mb:2}}),s.jsx(i,{children:s.jsx(c,{type:"submit",variant:"contained",endIcon:s.jsx(C,{icon:"iconamoon:send-fill"}),children:"Send"})})]})})]});return s.jsxs(b,{children:[s.jsx(D,{title:"Previous Messages"}),S]})};function os({ticket:e}){return s.jsxs(H,{children:[s.jsx(G,{links:[{name:"Dashboard",href:x.dashboard.root},{name:"Tickets",href:x.dashboard.tickets.root},{name:"Ticket Details"}],sx:{mb:{xs:3,md:5}}}),s.jsxs(m,{container:!0,spacing:3,children:[s.jsx(m,{xs:12,md:9,children:s.jsx(o,{spacing:3,direction:{xs:"column-reverse",md:"column"},children:s.jsx(rs,{ticket:e})})}),s.jsx(m,{xs:12,md:3,children:s.jsx(ns,{ticket:e,messages:e==null?void 0:e.messages})})]})]})}const ts={title:`Ticket details | Dashboard - ${$.site.name}`};function ks(){const{id:e=""}=Q(),r=L({queryKey:["tickets",e],queryFn:async()=>{const{data:a}=await p.get(u.tickets.details+e);return a}});return r.isPending||r.isLoading?s.jsx(K,{}):r.isError?s.jsx(N,{route:x.dashboard.tickets.root}):s.jsxs(s.Fragment,{children:[s.jsx(P,{children:s.jsxs("title",{children:[" ",ts.title]})}),s.jsx(os,{ticket:r.data})]})}export{ks as default};

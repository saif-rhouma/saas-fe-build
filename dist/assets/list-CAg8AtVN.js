import{w as A,bI as _,j as e,aN as W,dw as z,y as X,I as T,dB as Y,bK as Z,bL as x,e as N,r as p,dN as Q,dO as b,dM as C,dP as V,eh as G,p as D,D as ee,S as B,B as q,T as te,dD as U,o as se,dE as ae,er as oe,ed as ie,G as f,aH as re,es as ne,H as le,C as de}from"./index-CZcV1F_p.js";import{u as O,E as $}from"./error-block-Dw3l6JuN.js";import{u as H}from"./useMutation-RCoCYUsr.js";import{C as ce}from"./custom-breadcrumbs-CbtQHK8e.js";import{u as me,g as pe,r as ue,T as he,a as xe,e as ge}from"./table-selected-action-CboGdCqh.js";import{T as je}from"./table-no-data-CVXJF7AK.js";import{T as fe,a as ye,b as be,c as Ce}from"./table-head-custom-Cs1cDsOq.js";import{T as we}from"./table-pagination-custom-CQDZANoi.js";import{A as E}from"./app-widget-summary-BkfxYfZu.js";import{O as Se}from"./order-table-filters-result-Dc4qxcHG.js";import{C as Te}from"./confirm-dialog-CFSR5CRi.js";import{T as y}from"./TableCell-C1nm99o0.js";import{z as S,u as De,t as ve,F as Pe}from"./form-provider-Bx2WBj5v.js";import{b as Fe}from"./upload-avatar-1D7Vf-s3.js";import"./image-DzsMNwzu.js";import{F as P}from"./fields-hbdK3Trc.js";import"./editor-DaVZ1Z83.js";import{a as ke,b as Le,D as Re}from"./DialogContent-BM8q5mKd.js";import{D as Ie}from"./DialogTitle-DLTxRMh7.js";import{L as Ee}from"./LoadingButton-C_R2hpVD.js";import{T as Ae}from"./TextField-D7n2_qXr.js";import{I as Be}from"./InputAdornment-DsfHwWIs.js";import{S as qe}from"./Select-DLGgW76C.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-B9Q7SrE_.js";import"./empty-content-CpfMP5Ra.js";import"./TablePagination-CPW6B5yR.js";import"./LastPage-CSCREIen.js";import"./InputBase-De2NihOG.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-BJNlLSWJ.js";import"./format-number-_ePrRxix.js";import"./use-chart-DR-M4HfT.js";import"./chart-legends-C964NUlM.js";import"./index-BQhbB6Ru.js";import"./filters-result-CDgCxZP5.js";import"./Chip-C3BxFZTA.js";import"./countries-DSLisFCy.js";import"./FormHelperText-BnZQySOl.js";import"./Rating-DVTNlvpL.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-B7KCQCsS.js";import"./FormControl-3TPlxton.js";import"./FormLabel-CRn0_UJR.js";import"./RadioGroup-r2gxq8lN.js";import"./FormGroup-BdZDUz2q.js";import"./Autocomplete-3PR52KH6.js";import"./country-select-C2iLpbAw.js";import"./InputLabel-h10-06k3.js";import"./DatePicker-omkT4XAu.js";import"./ListItem-cuOSimek.js";import"./MobileDateTimePicker-SOESVVJ9.js";import"./Menu-Biq0K9Dc.js";import"./index-DHVWpqoh.js";import"./CircularProgress-Dtq66Llh.js";const Oe=({row:t,selected:r,onViewRow:s,onDeleteRow:m})=>{const c=A();A();const i=_(),n=e.jsxs(fe,{hover:!0,selected:r,children:[e.jsx(y,{children:t.id}),e.jsx(y,{children:W(t.createTime)}),e.jsx(y,{children:t.topic}),e.jsx(y,{children:e.jsx(z,{variant:"soft",color:t.priority==="Low"&&"success"||t.priority==="Medium"&&"warning"||t.priority==="Hight"&&"error"||"default",children:t.priority})}),e.jsx(y,{children:W(t.updateTime)}),e.jsx(y,{children:e.jsx(z,{variant:"soft",color:t.status==="Open"&&"info"||t.status==="Closed"&&"default"||"default",children:t.status})}),e.jsx(y,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(X,{color:i.open?"inherit":"default",onClick:i.onOpen,children:e.jsx(T,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[n,e.jsx(Y,{open:i.open,anchorEl:i.anchorEl,onClose:i.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Z,{children:[e.jsxs(x,{onClick:()=>{s(),i.onClose()},children:[e.jsx(T,{icon:"solar:eye-bold"}),"View"]}),e.jsxs(x,{onClick:()=>{c.onTrue(),i.onClose()},sx:{color:"error.main"},children:[e.jsx(T,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),e.jsx(Te,{open:c.value,onClose:c.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(N,{variant:"contained",color:"error",onClick:m,children:"Delete"})})]})},He=S.object({topic:S.string().min(1,{message:"Topic is required!"}),description:S.string().min(1,{message:"Description is required!"}),memberId:S.number().min(1,{message:"Member is required!"}),priority:S.string().min(1,{message:"Priority is required!"})}),Ne=({currentTicket:t,open:r,onClose:s})=>{//! Upload Logic START
const m=p.useRef(),[c,i]=p.useState([]),[n,l]=p.useState(),g=p.useCallback(a=>{const h=a[0];l(()=>h)},[]),o=()=>{l(null)},u=Q(),j={headers:{"content-type":"multipart/form-data"}};//! Upload Logic END
const{mutate:F}=H({mutationFn:a=>b.post(C.files.upload,a,j),onSuccess:async({data:a})=>{const{name:h}=a;if(h){const{current:K}=m;K.file=h,await v(K)}return a},onSettled:async()=>{await u.invalidateQueries({queryKey:["tickets-images"]})},onError:a=>{console.log(a)}}),{mutate:v}=H({mutationFn:a=>b.post(C.tickets.create,a),onSuccess:async()=>{V.success("New Ticket Has Been Created!"),L()},onSettled:async()=>{await u.invalidateQueries({queryKey:["tickets"]}),m.current={},l(null),s()},onError:a=>{console.log(a)}}),k=p.useMemo(()=>({topic:(t==null?void 0:t.topic)||"",description:(t==null?void 0:t.description)||"",memberId:(t==null?void 0:t.memberId)||null,priority:(t==null?void 0:t.priority)||null}),[t]),w=De({resolver:ve(He),defaultValues:k}),{reset:L,watch:M,setValue:d,handleSubmit:R,formState:{isSubmitting:Ge}}=w,J=R(async a=>{try{if(n){m.current={...a};const h=new FormData;h.append("file",n),h.append("category","Ticket"),await F(h)}else await v(a)}catch(h){console.error(h)}}),I=O({queryKey:["members"],queryFn:async()=>{const{data:a}=await b.get(C.staff.list);return i(a),a}});return I.isPending||I.isLoading?e.jsx(G,{}):I.isError?e.jsx($,{route:D.dashboard.staff.root}):e.jsxs(ke,{fullWidth:!0,maxWidth:"md",open:r,onClose:s,children:[e.jsx(Ie,{children:"Add New Ticket"}),e.jsxs(Pe,{methods:w,onSubmit:J,children:[e.jsxs(Le,{children:[e.jsx(ee,{}),e.jsxs(B,{spacing:2,sx:{pt:4,pb:1},children:[e.jsxs(q,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[e.jsx(P.Text,{fullWidth:!0,label:"Enter Topic",name:"topic",sx:{flexGrow:1}}),e.jsx(P.Text,{fullWidth:!0,label:"Description",name:"description",sx:{flexGrow:1}}),e.jsxs(P.Select,{name:"priority",label:"Select a Priority",sx:{width:420,textTransform:"capitalize"},children:[e.jsx(x,{value:"Low",children:"Low"}),e.jsx(x,{value:"Medium",children:"Medium"}),e.jsx(x,{value:"Hight",children:"Hight"})]}),e.jsx(P.Select,{name:"memberId",label:"Select a Member",sx:{width:420,textTransform:"capitalize"},children:c.map(a=>e.jsx(x,{value:a.id,children:`${a==null?void 0:a.firstName} ${a==null?void 0:a.lastName}`},a.id))})]}),e.jsx(q,{children:e.jsxs(B,{spacing:1.5,children:[e.jsx(te,{variant:"subtitle2",children:"Attachments"}),e.jsx(U,{sx:{maxHeight:360,p:2},children:e.jsx(Fe,{value:n,onDrop:g,onDelete:o})})]})})]})]}),e.jsxs(Re,{children:[e.jsx(Ee,{type:"submit",variant:"contained",children:"Save"}),e.jsx(N,{color:"inherit",variant:"outlined",onClick:s,children:"Cancel"})]})]})]})};function Me({filters:t,onResetPage:r}){const[s,m]=p.useState("all"),c=p.useCallback(n=>{r(),t.setState({name:n.target.value})},[t,r]),i=p.useCallback(n=>{r(),t.setState({status:n.target.value}),m(n.target.value)},[t,r]);return e.jsxs(B,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(Ae,{sx:{width:420},value:t.state.name,onChange:c,placeholder:"Search Here...",InputProps:{startAdornment:e.jsx(Be,{position:"start",children:e.jsx(T,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(qe,{sx:{width:420,textTransform:"capitalize"},value:s,onChange:i,children:[e.jsx(x,{value:"all",children:"All Tickets"}),e.jsx(x,{value:"Open",children:"Open Tickets"}),e.jsx(x,{value:"Closed",children:"Close Tickets"})]})]})}const Ke=[{id:"ticketId",label:"#",width:140},{id:"date",label:"Date",width:280},{id:"topic",label:"Topic"},{id:"priority",label:"Priority"},{id:"lastUpdate",label:"Last Updated"},{id:"status",label:"Status"},{id:"",width:88}],We=({tickets:t,analytics:r})=>{const s=me({defaultOrderBy:"orderNumber"}),m=se(),c=A(),[i,n]=p.useState(t),l=ae({name:"",status:"all",startDate:null,endDate:null});p.useEffect(()=>{n(t)},[t]);const g=oe(l.state.startDate,l.state.endDate),o=Qe({inputData:i,comparator:pe(s.order,s.orderBy),filters:l.state,dateError:g}),u=ue(o,s.page,s.rowsPerPage),j=!!l.state.name||l.state.status!=="all"||!!l.state.startDate&&!!l.state.endDate,F=!o.length&&j||!o.length,v=p.useCallback(d=>{L(d)},[u.length,s,i]),k=p.useCallback(d=>{m.push(D.dashboard.tickets.details(d))},[m]),w=Q(),{mutate:L}=H({mutationFn:d=>b.delete(C.tickets.delete+d),onSuccess:async()=>{const d=i.filter(R=>R.id!==id);V.success("Delete success!"),n(d),s.onUpdatePageDeleteRow(u.length)},onSettled:async()=>{await w.invalidateQueries({queryKey:["tickets"]}),await w.invalidateQueries({queryKey:["tickets","analytics"]})},onError:d=>{}}),M=()=>r.isPending||r.isLoading?e.jsx(f,{xs:12,md:12,children:e.jsx(LoadingScreen,{})}):e.jsxs(e.Fragment,{children:[e.jsx(f,{xs:12,md:4,children:e.jsx(E,{title:"All Tickets",total:t.length,chart:{}})}),e.jsx(f,{xs:12,md:4,children:e.jsx(E,{title:"Open Tickets",total:r.data.analytics.Open,chart:{}})}),e.jsx(f,{xs:12,md:4,children:e.jsx(E,{title:"Close Tickets",total:r.data.analytics.Closed,chart:{}})})]});return e.jsxs(e.Fragment,{children:[e.jsx(ie,{maxWidth:"xl",children:e.jsxs(f,{container:!0,spacing:3,children:[e.jsx(f,{xs:12,md:12,children:e.jsx(ce,{links:[{name:"Dashboard",href:D.dashboard.root},{name:"Ticket",href:D.dashboard.tickets.root}],action:e.jsx(N,{onClick:()=>c.onToggle(),variant:"contained",startIcon:e.jsx(T,{icon:"mingcute:add-line"}),children:"Add New Ticket"})})}),M(),e.jsx(f,{xs:12,md:12,children:e.jsxs(re,{children:[e.jsx(Me,{filters:l,onResetPage:s.onResetPage,dateError:g}),j&&e.jsx(Se,{filters:l,totalResults:o.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(q,{sx:{position:"relative"},children:[e.jsx(he,{dense:s.dense,numSelected:s.selected.length,rowCount:o.length}),e.jsx(U,{sx:{minHeight:444},children:e.jsxs(ye,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(be,{order:s.order,orderBy:s.orderBy,headLabel:Ke,rowCount:o.length}),e.jsxs(Ce,{children:[o.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(d=>e.jsx(Oe,{row:d,selected:s.selected.includes(d.id),onSelectRow:()=>s.onSelectRow(d.id),onDeleteRow:()=>v(d.id),onViewRow:()=>k(d.id)},d.id)),e.jsx(xe,{height:s.dense?56:76,emptyRows:ge(s.page,s.rowsPerPage,o.length)}),e.jsx(je,{notFound:F})]})]})})]}),e.jsx(we,{page:s.page,dense:s.dense,count:o.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})]})}),e.jsx(Ne,{open:c.value,onClose:c.onFalse})]})},ze=We;function Qe({inputData:t,comparator:r,filters:s,dateError:m}){const{status:c,name:i,startDate:n,endDate:l}=s,g=t.map((o,u)=>[o,u]);return g.sort((o,u)=>{const j=r(o[0],u[0]);return j!==0?j:o[1]-u[1]}),t=g.map(o=>o[0]),i&&(t=t.filter(o=>o.id.toString().indexOf(i.toLowerCase())!==-1||o.topic.toLowerCase().indexOf(i.toLowerCase())!==-1||o.priority.toLowerCase().indexOf(i.toLowerCase())!==-1)),c!=="all"&&(t=t.filter(o=>o.status===c)),m||n&&l&&(t=t.filter(o=>ne(o.createdAt,n,l))),t}const Ve={title:`Tickets list | Dashboard - ${de.site.name}`};function Xt(){const t=O({queryKey:["tickets"],queryFn:async()=>{const{data:s}=await b.get(C.tickets.list);return s}}),r=O({queryKey:["tickets","analytics"],queryFn:async()=>{const{data:s}=await b.get(C.tickets.analytics);return s}});return r.isLoading||t.isLoading?e.jsx(G,{}):t.isError||r.isError?e.jsx($,{route:D.dashboard.tickets.root}):e.jsxs(e.Fragment,{children:[e.jsx(le,{children:e.jsxs("title",{children:[" ",Ve.title]})}),e.jsx(ze,{tickets:t.data,analytics:r})]})}export{Xt as default};

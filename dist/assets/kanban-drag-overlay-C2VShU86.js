import{h as L,e5 as B,r as m,e6 as E,au as I,S as f,s as j,v as y,j as n,B as b,bL as $,aN as F,d7 as K,I as W,aJ as k,A as G,C as H,T as _,d0 as O,bP as z,a$ as M}from"./index-BEaGYMEI.js";import{f as v,i as U,g as X,u as Y,C as J,j as q,k as Q,l as V}from"./sortable.esm-BDq2XdD4.js";import{S as w}from"./Skeleton-CcaOVnEt.js";import{L as Z}from"./ListItem-BFzJ2Xb7.js";import{A as P}from"./AvatarGroup-BL49mAPT.js";import{b as ee}from"./InputBase-Cx_XAmin.js";function ye(e){const{user:r}=L(),{permissions:a}=B(),[l,i]=m.useState(!1),c=m.useCallback(s=>a.includes(s),[a]);return m.useEffect(()=>{r.roles[0]===E.STAFF?i(c(e)):i(!0)},[e,c,r.roles]),l}const d={item:"mnl__kanban__item",column:"mnl__kanban__column",itemWrap:"mnl__kanban__item__wrap",columnList:"mnl__kanban__column_list",state:{hover:"state-hover",fadeIn:"state-fade-in",sorting:"state-sorting",dragging:"state-dragging",disabled:"state-disabled",dragOverlay:"state-drag-overlay"}},re=[v.Down,v.Right,v.Up,v.Left],ve=(e,{context:{active:r,droppableRects:a,droppableContainers:l,collisionRect:i}})=>{var c;if(re.includes(e.code)){if(e.preventDefault(),!r||!i)return;const s=[];l.getEnabled().forEach(t=>{var h;if(!t||t!=null&&t.disabled)return;const u=a.get(t.id);if(!u)return;const o=t.data.current;if(o){const{type:p,children:C}=o;if(p==="container"&&(C==null?void 0:C.length)>0&&((h=r.data.current)==null?void 0:h.type)!=="container")return}switch(e.code){case v.Down:i.top<u.top&&s.push(t);break;case v.Up:i.top>u.top&&s.push(t);break;case v.Left:i.left>=u.left+u.width&&s.push(t);break;case v.Right:i.left+i.width<=u.left&&s.push(t);break}});const x=U({active:r,collisionRect:i,droppableRects:a,droppableContainers:s,pointerCoordinates:null}),g=X(x,"id");if(g!=null){const t=l.get(g),u=t==null?void 0:t.node.current,o=t==null?void 0:t.rect.current;if(u&&o)return t.id==="placeholder"?{x:o.left+(o.width-i.width)/2,y:o.top+(o.height-i.height)/2}:((c=t.data.current)==null?void 0:c.type)==="container"?{x:o.left+20,y:o.top+74}:{x:o.left,y:o.top}}}},ne=I(f)(({theme:e})=>({flexShrink:0,height:"100%",borderWidth:1,position:"relative",borderStyle:"solid",borderColor:"transparent",padding:"var(--column-padding)",borderRadius:"var(--column-radius)",backgroundColor:e.vars.palette.background.neutral,[j.dark]:{backgroundColor:e.vars.palette.grey[800]},"&::before":{top:0,left:0,content:'""',width:"100%",height:"100%",position:"absolute",borderRadius:"inherit",backgroundColor:"transparent",transition:e.transitions.create(["background-color"])},[`&.${d.state.hover}`]:{"&::before":{backgroundColor:y(e.vars.palette.grey["500Channel"],.08),[j.dark]:{backgroundColor:y(e.vars.palette.grey["500Channel"],.16)}}},[`&.${d.state.dragOverlay}`]:{backdropFilter:"blur(6px)",borderColor:y(e.vars.palette.grey["500Channel"],.08),backgroundColor:y(e.vars.palette.background.neutralChannel,.48),[j.dark]:{backgroundColor:y(e.vars.palette.grey["800Channel"],.48)}},[`&.${d.state.dragging}`]:{opacity:0}})),ae=m.forwardRef(({slots:e,stateProps:r,sx:a,...l},i)=>{const c=d.column.concat((r==null?void 0:r.hover)&&` ${d.state.hover}`||(r==null?void 0:r.dragOverlay)&&` ${d.state.dragOverlay}`||(r==null?void 0:r.dragging)&&` ${d.state.dragging}`||"");return n.jsxs(ne,{ref:i,className:c,sx:{gap:2.5,width:"var(--column-width)",...a},...l,children:[(e==null?void 0:e.header)&&e.header,(e==null?void 0:e.action)&&(e==null?void 0:e.action),(e==null?void 0:e.main)&&n.jsx(b,{component:"ul",className:d.columnList,sx:{minHeight:80,display:"flex",gap:"var(--item-gap)",flexDirection:"column"},children:e.main})]})}),D=m.memo(ae);function ie({sx:e,...r}){return n.jsx(ee,{sx:{[`&.${$.root}`]:{py:.75,borderRadius:1,typography:"h6",borderWidth:2,borderStyle:"solid",borderColor:"transparent",transition:a=>a.transitions.create(["padding-left","border-color"]),[`&.${$.focused}`]:{pl:.75,borderColor:"text.primary"}},[`& .${$.input}`]:{typography:"h6"},...e},...r})}function T({columnName:e,columnColor:r,totalTasks:a}){const l=m.useRef(null),i=F(),[c,s]=m.useState(e);return m.useEffect(()=>{i.open&&l.current&&l.current.focus()},[i.open]),n.jsxs(f,{direction:"row",alignItems:"center",children:[n.jsx(K,{sx:{color:`${r}.main`,borderRadius:"50%",borderColor:x=>y(x.vars.palette.grey["500Channel"],.24)},children:a}),n.jsx(ie,{inputRef:l,placeholder:"Column name",value:c,inputProps:{id:`input-column-${c}`},sx:{mx:1,color:`${r}.main`}})]})}function pe({children:e,column:r,tasks:a,colors:l,disabled:i,sx:c}){var S;const{attributes:s,isDragging:x,listeners:g,setNodeRef:t,transition:u,active:o,over:h,transform:p}=Y({id:r.id,data:{type:"container",children:a},animateLayoutChanges:oe}),C=a==null?void 0:a.map(R=>R.id),N=h?r.id===h.id&&((S=o==null?void 0:o.data.current)==null?void 0:S.type)!=="container"||C.includes(h.id):!1;return n.jsx(D,{ref:i?void 0:t,sx:{transition:u,transform:J.Translate.toString(p),...c},stateProps:{dragging:x,hover:N,handleProps:{...s,...g}},slots:{header:n.jsx(T,{totalTasks:a.length,columnName:r.name,columnColor:l[r.name]}),main:n.jsx(n.Fragment,{children:e})}})}const oe=e=>q({...e,wasDragging:!0}),te=I(Z)(()=>({"@keyframes fadeIn":{"0%":{opacity:0},"100%":{opacity:1}},transform:"translate3d(var(--translate-x, 0), var(--translate-y, 0), 0) scaleX(var(--scale-x, 1)) scaleY(var(--scale-y, 1))",transformOrigin:"0 0",touchAction:"manipulation",[`&.${d.state.fadeIn}`]:{animation:"fadeIn 500ms ease"},[`&.${d.state.dragOverlay}`]:{zIndex:999}})),de=I(f)(({theme:e})=>({width:"100%",cursor:"grab",outline:"none",overflow:"hidden",position:"relative",transformOrigin:"50% 50%",touchAction:"manipulation",boxShadow:e.customShadows.z1,borderRadius:"var(--item-radius)",WebkitTapHighlightColor:"transparent",backgroundColor:e.vars.palette.common.white,transition:e.transitions.create(["box-shadow"]),[j.dark]:{backgroundColor:e.vars.palette.grey[900]},[`&.${d.state.disabled}`]:{},[`&.${d.state.sorting}`]:{},[`&.${d.state.dragOverlay}`]:{backdropFilter:"blur(6px)",boxShadow:e.customShadows.z20,backgroundColor:y(e.vars.palette.common.whiteChannel,.48),[j.dark]:{backgroundColor:y(e.vars.palette.grey["900Channel"],.48)}},[`&.${d.state.dragging}`]:{opacity:.2,filter:"grayscale(1)"}})),le=m.forwardRef(({task:e,stateProps:r,sx:a,...l},i)=>{var t,u;m.useEffect(()=>{if(r!=null&&r.dragOverlay)return document.body.style.cursor="grabbing",()=>{document.body.style.cursor=""}},[r==null?void 0:r.dragOverlay]);const c=d.itemWrap.concat((r==null?void 0:r.fadeIn)&&` ${d.state.fadeIn}`||(r==null?void 0:r.dragOverlay)&&` ${d.state.dragOverlay}`||""),s=d.item.concat((r==null?void 0:r.dragging)&&` ${d.state.dragging}`||(r==null?void 0:r.disabled)&&` ${d.state.disabled}`||(r==null?void 0:r.sorting)&&` ${d.state.sorting}`||(r==null?void 0:r.dragOverlay)&&` ${d.state.dragOverlay}`||""),x=n.jsx(W,{icon:e.status==="Delivered"?"solar:double-alt-arrow-up-bold-duotone":"solar:double-alt-arrow-right-bold-duotone",sx:{top:4,right:4,position:"absolute",...e.status==="Delivered"&&{color:"info.main"},...e.status==="Ready"&&{color:"warning.main"},...e.status==="InProcess"&&{color:"error.main"}}}),g=n.jsxs(f,{direction:"row",alignItems:"center",children:[n.jsx(f,{flexGrow:1,direction:"row",alignItems:"center",sx:{typography:"caption",color:"text.disabled"},children:n.jsx(b,{component:"span",sx:{mr:1},children:"Product:"})}),n.jsx(P,{sx:{[`& .${k.avatar}`]:{width:24,height:24}},children:(t=e==null?void 0:e.productToOrder)==null?void 0:t.map(o=>{var h,p;return n.jsx(G,{alt:(h=o==null?void 0:o.product)==null?void 0:h.name,src:`${H.site.serverFileHost}${(p=o==null?void 0:o.product)==null?void 0:p.image}`},o==null?void 0:o.id)})})]});return n.jsx(te,{ref:i,disablePadding:!0,className:c,sx:{...!!(r!=null&&r.transition)&&{transition:r.transition},...!!(r!=null&&r.transform)&&{"--translate-x":`${Math.round(r.transform.x)}px`,"--translate-y":`${Math.round(r.transform.y)}px`,"--scale-x":`${r.transform.scaleX}`,"--scale-y":`${r.transform.scaleY}`}},children:n.jsx(de,{className:s,"data-cypress":"draggable-item",sx:a,tabIndex:0,...r==null?void 0:r.listeners,...l,children:n.jsxs(f,{spacing:1,sx:{px:2,py:2.5,position:"relative"},children:[x,n.jsxs(f,{direction:"row",justifyContent:"space-between",children:[n.jsx(_,{variant:"subtitle2",children:(u=e==null?void 0:e.customer)==null?void 0:u.name}),n.jsx(_,{variant:"subtitle2",children:e==null?void 0:e.ref})]}),n.jsxs(f,{direction:"row",justifyContent:"space-between",sx:{typography:"body2"},children:[n.jsx(b,{sx:{color:"text.secondary"},children:"Order Date:"}),n.jsx(b,{sx:{color:"text.secondary"},children:O(e==null?void 0:e.orderDate)})]}),n.jsxs(f,{direction:"row",justifyContent:"space-between",sx:{typography:"body2"},children:[n.jsx(b,{sx:{color:"text.secondary"},children:"Delivery Date:"}),n.jsx(b,{sx:{color:"text.secondary"},children:e.deliveryDate?O(e==null?void 0:e.deliveryDate):"-"})]}),n.jsxs(f,{direction:"row",justifyContent:"space-between",sx:{typography:"body2"},children:[n.jsx(b,{sx:{color:"text.secondary"},children:"Last Updated Date:"}),n.jsx(b,{sx:{color:"text.secondary"},children:O(e==null?void 0:e.updateTime)})]}),g]})})})}),A=m.memo(le);function Ce({amount:e=3,sx:r,...a}){return[...Array(e)].map((l,i)=>n.jsxs(z,{variant:"outlined",sx:{display:"flex",gap:"var(--item-gap)",flexDirection:"column",p:"var(--column-padding)",width:"var(--column-width)",borderRadius:"var(--column-radius)",...r},...a,children:[n.jsx(w,{sx:{pt:"75%",borderRadius:1.5}}),[0].includes(i)&&n.jsx(w,{sx:{pt:"50%",borderRadius:1.5}}),[0,1].includes(i)&&n.jsx(w,{sx:{pt:"25%",borderRadius:1.5}}),[0,1,2].includes(i)&&n.jsx(w,{sx:{pt:"25%",borderRadius:1.5}})]},i))}const ce={sideEffects:V({styles:{active:{opacity:"0.5"}}})};function je({columns:e,tasks:r,activeId:a,sx:l}){const i=e.map(g=>g.id),c=e.find(g=>g.id===a),x=Object.values(r).flat().find(g=>g.id===a);return n.jsx(M,{children:n.jsx(Q,{adjustScale:!1,dropAnimation:ce,children:a?n.jsx(n.Fragment,{children:i.includes(a)?n.jsx(se,{column:c,tasks:r[a],sx:l}):n.jsx(ue,{task:x,sx:l})}):null})})}function se({column:e,tasks:r,sx:a}){return n.jsx(D,{slots:{header:n.jsx(T,{columnName:e.name,totalTasks:r.length}),main:r.map(l=>n.jsx(A,{task:l},l.id))},stateProps:{dragOverlay:!0},sx:a})}function ue({task:e,sx:r}){return n.jsx(A,{task:e,sx:r,stateProps:{dragOverlay:!0}})}export{A as I,pe as K,je as a,Ce as b,ve as c,d as k,ye as u};

import{g as H,r as d,p as D,j as t,B as n,T as L,el as $,d7 as R,S as l,e3 as C,e as y,I as S,cY as B,h as V,ee as W,e8 as G,d0 as E,em as Y,i as k,dn as _,ef as M,en as q,dP as J,cV as T,dp as f,dm as g,dq as P,dT as X,H as z,C as U}from"./index-cVC9loO2.js";import{u as Z,E as tt}from"./error-block-CTLR1Q8T.js";import{u as et}from"./use-params-CtDwpxcA.js";import"./chart-legends-DRA4H-kY.js";import{l as st}from"./index-C1AM_uPK.js";import{u as O}from"./useMutation-D1Ao7QLV.js";import{C as it}from"./confirm-dialog-BPASpEx5.js";import{C as nt}from"./custom-breadcrumbs-CcAluHeA.js";import{b}from"./format-number-B1WjFeaX.js";import{P as I}from"./permission-access-controller-DFrwOXyc.js";import{T as at,t as ot,a as rt,b as lt,c as ct,d as pt,e as xt}from"./TimelineSeparator-D4Q3U1MY.js";import{C as A}from"./CardHeader-CQoDelDK.js";import{O as dt}from"./order-product-table-D71nJKKH.js";import{O as mt}from"./order-payment-details-dialog-D-h8MNy_.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./index-atk_TUbO.js";import"./DialogContent-DkiO8DEm.js";import"./DialogTitle-BiPM3Q-L.js";import"./table-head-custom-bk3oBXPg.js";import"./TableCell-8gOmF4Ok.js";import"./Checkbox-Bdobw5-i.js";import"./incrementer-button-B9G-XrUz.js";import"./form-provider-DE5_2kIJ.js";import"./TextField-LJCfmosc.js";import"./FormControl-9caSTWx2.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-CMJbfDqe.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-B5edal7e.js";import"./Select-DUYbOU_T.js";import"./Menu-BRMv56CN.js";import"./InputBase-C5V7Cyqr.js";import"./FormHelperText-CsRk0ikA.js";import"./Rating-Db2sKZev.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-DwJGbbeJ.js";import"./index-B1BrQbnY.js";import"./Slider-CVkTwevy.js";import"./RadioGroup-CCJQrmJv.js";import"./FormGroup-Cn0OYj2K.js";import"./FormControlLabel-BYQ2iE67.js";import"./utils-CvPn6zY6.js";import"./countries-DSLisFCy.js";import"./InputAdornment-BrZhMZcc.js";import"./Autocomplete-B3o3prWm.js";import"./Chip-BK1jcf0v.js";import"./country-select-BbxEBL6Y.js";import"./upload-avatar-B9N719Cg.js";import"./image-CtYWjOfZ.js";import"./DatePicker-DiMqDnIW.js";import"./ListItem-BGevg6HN.js";import"./MobileDateTimePicker-DxnCUIg9.js";import"./Tabs-TNFzyBZH.js";import"./KeyboardArrowRight-BnvIvIxZ.js";import"./schema-helper-ll1kvunf.js";import"./LoadingButton-KRbn5Mjy.js";import"./CircularProgress-BKEJ3hM4.js";const ht=({order:e,payments:s,dialog:o,handleApproveOrder:a,handlePrint:m})=>{var h,u;const x=H(),c=d.useCallback(r=>{x.replace(D.dashboard.quotation.details(r))},[x]),p=t.jsxs(n,{sx:{pr:4,pl:4,pb:4,pt:2},children:[t.jsx(at,{sx:{p:0,m:0,[`& .${ot.root}:before`]:{flex:0,padding:0}},children:s==null?void 0:s.map((r,j)=>{const v=j===0,w=j===s.length-1;return t.jsxs(rt,{children:[t.jsxs(lt,{children:[t.jsx(ct,{color:v&&"primary"||"grey"}),w?null:t.jsx(pt,{})]}),t.jsx(xt,{children:t.jsxs(n,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs(n,{children:[t.jsx(L,{variant:"subtitle2",children:b(r.amount)}),t.jsx(n,{sx:{color:"text.disabled",typography:"caption",mt:.5},children:$(r.paymentDate)})]}),t.jsx(R,{color:"success",children:r.paymentType})]})})]},r.id)})}),t.jsxs(l,{justifyContent:"flex-end",spacing:1.5,sx:{marginTop:2},children:[(e==null?void 0:e.status)!=="Draft"&&(e==null?void 0:e.status)!=="Canceled"&&t.jsx(I,{permission:C.ADD_PAYMENT,children:t.jsx(y,{variant:"contained",onClick:()=>o.onTrue(),children:"Add Payment"})}),t.jsx(I,{permission:C.APPROVE_ORDER,children:(e==null?void 0:e.status)==="Draft"&&t.jsx(y,{variant:"outlined",onClick:()=>{a(e.id)},children:"Approve"})}),t.jsx(I,{permission:C.PRINT_ORDER,children:t.jsxs(y,{variant:"outlined",color:"info",onClick:()=>m(),children:[t.jsx(S,{icon:"solar:printer-minimalistic-bold"}),t.jsx("span",{style:{margin:4},children:"Print Order"})]})}),((h=e==null?void 0:e.quotation)==null?void 0:h.id)&&t.jsxs(y,{variant:"contained",startIcon:t.jsx(S,{icon:"heroicons-outline:external-link"}),onClick:()=>{const{id:r}=e==null?void 0:e.quotation;r&&c(r)},children:["Related to Quotation: #",(u=e==null?void 0:e.quotation)==null?void 0:u.ref]})]})]});return t.jsxs(B,{children:[(s==null?void 0:s.length)>0&&t.jsx(A,{title:"Payments"}),p]})};function ut({order:e,discount:s,customer:o,totalAmount:a}){const{user:m}=V(),x=t.jsxs(l,{spacing:2,alignItems:"flex-end",sx:{p:3,textAlign:"right",typography:"body2"},children:[t.jsxs(l,{direction:"row",children:[t.jsx(n,{sx:{color:"text.secondary"},children:"Subtotal"}),t.jsx(n,{sx:{width:160,typography:"subtitle2"},children:b(a)||"-"})]}),t.jsxs(l,{direction:"row",children:[t.jsx(n,{sx:{color:"text.secondary"},children:"Discount"}),t.jsx(n,{sx:{width:160,...s&&{color:"error.main"}},children:s?`- ${s}%`:"-"})]}),t.jsxs(l,{direction:"row",children:[t.jsxs(n,{sx:{color:"text.secondary"},children:["Tax (",(e==null?void 0:e.snapshotTaxPercentage)||"0","%)"]}),t.jsx(n,{sx:{width:160},children:e!=null&&e.snapshotTaxPercentage?b(W(a-a*(s/100),e==null?void 0:e.snapshotTaxPercentage)):"-"})]}),t.jsxs(l,{direction:"row",sx:{typography:"subtitle1"},children:[t.jsx("div",{children:"Gross Total"}),t.jsx(n,{sx:{width:160},children:b(G(a-a*(s/100),e==null?void 0:e.snapshotTaxPercentage))||"-"})]})]});return t.jsxs(B,{children:[t.jsx(l,{justifyContent:"center",alignItems:"center",children:t.jsxs("h1",{className:"print-title",children:["Order REF: #",e.ref]})}),t.jsx("style",{jsx:!0,children:`
        .print-title {
          display: none; /* Hide on screen */
        }

        @media print {
          .print-title {
            display: block; /* Show only when printing */
          }
          .print-hide {
            display: none; /* Hide on screen */
          }
          html,
          body {
            height: initial !important;
            overflow: initial !important;
          }

          .scrollableDiv {
            width: 100%;
            height: 100% !important;
            overflow: visible;
          }
        }
      `}),t.jsx(A,{className:"print-hide",title:"Details"}),t.jsxs(l,{direction:"row",justifyContent:"space-between",sx:{p:3,typography:"body2"},children:[t.jsxs(n,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[t.jsx(l,{direction:"row",sx:{typography:"subtitle2",marginBottom:1},children:t.jsx("div",{children:"Order Details"})}),t.jsxs(n,{sx:{color:"text.secondary"},children:["ORDER ID: #",e.ref]}),t.jsxs(n,{sx:{color:"text.secondary"},children:["Order Date: ",E(e.orderDate)]}),t.jsxs(n,{sx:{color:"text.secondary"},children:["Delivery Date: ",e.deliveryDate?E(e.deliveryDate):t.jsx("span",{children:" - "})]})]}),t.jsxs(n,{flexDirection:"column",gap:.5,sx:{display:"flex",width:"100%",p:1,borderRight:c=>`dashed 2px ${c.vars.palette.background.neutral}`,borderLeft:c=>`dashed 2px ${c.vars.palette.background.neutral}`},children:[t.jsx(l,{display:"flex",justifyContent:"center",alignItems:"center",sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:t.jsx("div",{children:Y(m)})}),t.jsxs(n,{sx:{color:"text.secondary"},children:["Status :"," ",t.jsx(R,{variant:"soft",color:(e==null?void 0:e.status)==="Ready"&&"info"||(e==null?void 0:e.status)==="InProcess"&&"warning"||(e==null?void 0:e.status)==="Delivered"&&"success"||"default",children:e==null?void 0:e.status})]}),t.jsxs(n,{sx:{color:"text.secondary"},children:["TAX: ",o==null?void 0:o.taxNumber]})]}),t.jsxs(n,{flexDirection:"column",alignItems:"center",sx:{p:1,display:"flex",width:"100%"},children:[t.jsx(l,{display:"flex",alignItems:"center",gap:1,sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:t.jsx("div",{children:"Order To"})}),t.jsx(n,{sx:{color:"text.secondary"},children:o==null?void 0:o.name}),t.jsxs(n,{sx:{color:"text.secondary"},children:["Tel: ",o==null?void 0:o.phoneNumber]})]})]}),t.jsx(n,{fullWidth:!0,alignItems:"center",sx:{p:3,borderBottom:c=>`dashed 2px ${c.vars.palette.background.neutral}`},children:t.jsx(dt,{products:e.productToOrder,isDetail:!0})}),x,(e==null?void 0:e.notes)&&t.jsx(l,{justifyContent:"space-between",sx:{p:3,typography:"body2"},children:t.jsxs(n,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[t.jsx(l,{sx:{typography:"subtitle2",marginBottom:1},children:t.jsx("div",{children:"Notes:"})}),t.jsx(n,{sx:{color:"text.secondary"},children:e==null?void 0:e.notes})]})})]})}function yt({currentOrder:e}){const[s,o]=d.useState(e),[a,m]=d.useState(),x=d.useRef(),c=k(),p=_(),[h,u]=d.useState([]),r=k(),j=M();d.useEffect(()=>{o(e)},[e]),d.useEffect(()=>{const i=q(s==null?void 0:s.payments,"paymentDate");u(i)},[s==null?void 0:s.payments]);const{mutate:v}=O({mutationFn:i=>f.post(g.payments.create,i),onSuccess:async i=>{P.success("New Payment Has Been Created!");const{data:N}=i,K=q([...h,N],"paymentDate");u(K)},onSettled:async()=>{await p.invalidateQueries({queryKey:["payments"]});const{id:i}=s;await p.invalidateQueries({queryKey:["order",i]}),c.onFalse()},onError:i=>{console.log(i)}}),{mutate:w}=O({mutationFn:i=>f.get(g.order.approve+i),onSuccess:async({data:i})=>{i!=null&&i.length?(r.onTrue(),m(i)):(P.success("Order Has Been Approved!"),o(i))},onSettled:async()=>{const{id:i}=s;await p.invalidateQueries({queryKey:["orders"]}),await p.invalidateQueries({queryKey:["orders","analytics"]}),await p.invalidateQueries({queryKey:["order",i]})},onError:i=>{console.log(i)}}),{mutate:F}=O({mutationFn:i=>f.post(g.order.createPlans,i),onSuccess:async({data:i})=>{P.success("Order Has Been Approved!"),o(i),r.onFalse()},onSettled:async()=>{const{id:i}=s;await p.invalidateQueries({queryKey:["orders"]}),await p.invalidateQueries({queryKey:["orders","analytics"]}),await p.invalidateQueries({queryKey:["order",i]})},onError:i=>{console.log(i)}}),Q=st.useReactToPrint({content:()=>x.current});return t.jsxs(t.Fragment,{children:[t.jsxs(J,{children:[t.jsx(nt,{links:[{name:"Dashboard",href:D.dashboard.root},{name:"Order",href:D.dashboard.order.root},{name:"Order Details"}],sx:{mb:{xs:3,md:5}}}),t.jsxs(T,{container:!0,spacing:3,children:[t.jsx(T,{xs:12,md:9,children:t.jsx(l,{ref:x,spacing:3,direction:{xs:"column-reverse",md:"column"},children:t.jsx(ut,{order:s,customer:s==null?void 0:s.customer,discount:s==null?void 0:s.discount,totalAmount:s==null?void 0:s.totalOrderAmount})})}),t.jsx(T,{xs:12,md:3,children:t.jsx(ht,{order:s,payments:h,dialog:c,handleApproveOrder:w,handlePrint:Q})})]}),t.jsx(mt,{order:s,open:c.value,onClose:c.onFalse,handler:v})]}),t.jsx(it,{open:r.value,onClose:r.onFalse,title:"Out of Stock",content:t.jsxs(t.Fragment,{children:[t.jsx(n,{children:"Products are out of Stock! do you want to create plans?"}),t.jsxs(n,{sx:{mt:1,mb:1},children:["You need to create ",t.jsx("span",{style:{fontWeight:"bold"},children:a==null?void 0:a.length})," :"]}),a==null?void 0:a.map(i=>t.jsxs(n,{children:["Plan for ",t.jsx("span",{style:{fontWeight:"bold"},children:i.product.name})," because is missing"," ",t.jsx("span",{style:{fontWeight:"bold",color:`${j.vars.palette.error.light}`},children:i.missingQuantity}),"."]}))]}),action:t.jsx(y,{variant:"contained",color:"error",onClick:()=>{F(a)},children:(a==null?void 0:a.length)>1?"Create Plans":"Create Plan"})})]})}const jt={title:`Order details | Dashboard - ${U.site.name}`};function we(){const{id:e=""}=et(),s=Z({queryKey:["order",e],queryFn:async()=>{const{data:o}=await f.get(g.order.details+e);return o}});return s.isPending||s.isLoading?t.jsx(X,{}):s.isError?t.jsx(tt,{route:D.dashboard.order.root}):t.jsxs(t.Fragment,{children:[t.jsx(z,{children:t.jsxs("title",{children:[" ",jt.title]})}),t.jsx(yt,{currentOrder:s.data})]})}export{we as default};

import{Y as R,dn as G,a3 as X,j as e,S as V,A as Z,C as $,B as W,$ as _,I as C,db as ee,a6 as te,e4 as T,a7 as L,e as N,r as h,dq as D,dm as S,a5 as M,a0 as se,T as ae,de as oe,e3 as ne,dp as re,W as ie,p as A,dQ as le,cV as H,cY as ce,bq as de,dd as me,ed as pe,dr as O,dU as ue,H as ge}from"./index-88qAwG8P.js";import{u as he,E as xe}from"./error-block-BTff90qR.js";import{u as I}from"./useMutation-Bjm4Nnvr.js";import{C as je}from"./custom-breadcrumbs-x7W5GMPl.js";import{P as E}from"./permission-access-controller-BVvbpBzt.js";import{g as fe,r as be,e as Ce}from"./utils-MBUcMVfY.js";import{u as ye}from"./use-table-BYPgfP9k.js";import{T as we}from"./table-no-data-wFoKraSE.js";import{T as Pe}from"./table-empty-rows-6krMqYw2.js";import{T as Te,a as De,b as Se,c as Ee}from"./table-head-custom-g2OgtrHv.js";import{T as ve}from"./table-selected-action-DnALz1xy.js";import{T as Fe}from"./table-pagination-custom-Ds9-Dw8y.js";import{C as Re}from"./confirm-dialog-BdxUyq-O.js";import{T as P}from"./TableCell-Cl8UZGxf.js";import{z as q,u as Ae,t as Ie,a as Ve,F as Q}from"./form-provider-DSldc_Gv.js";import{b as Be}from"./upload-avatar-CSIBlxGF.js";import"./image-CkDsegDa.js";import"./editor-DKQnkQYm.js";import{a as ke,b as Le,D as He}from"./DialogContent-F9o-_CVT.js";import{D as Oe}from"./DialogTitle-CvyYkdF0.js";import{L as qe}from"./LoadingButton-CM47tPre.js";import{T as $e}from"./TextField-CQpihH7F.js";import{I as Ge}from"./InputAdornment-Bg-m_z4_.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-vgDCQT8r.js";import"./Checkbox-Cpc8f1GH.js";import"./TablePagination-CrnuwEMO.js";import"./KeyboardArrowRight-fE7_2VJ7.js";import"./LastPage-B6xWbdc0.js";import"./Select-DFC-Q2QB.js";import"./Menu-BDUaDfAf.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-DD8qHu7J.js";import"./FormControlLabel-ts_MkIWE.js";import"./FormHelperText-DA7jizKd.js";import"./Rating-4WKJ8FeG.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-Cdch2KEI.js";import"./FormControl-BXGEHd-f.js";import"./FormLabel-Ck5_RgM9.js";import"./RadioGroup-DZvtDFL6.js";import"./FormGroup-B0QesIKW.js";import"./utils-BDEKF9xP.js";import"./index-CySZofTa.js";import"./countries-DSLisFCy.js";import"./Autocomplete-Du1dNHWZ.js";import"./Chip-yDeOg34u.js";import"./country-select-B-6neUw6.js";import"./InputLabel-B0kOUcWA.js";import"./DatePicker-C1aTSbY2.js";import"./ListItem-Bt-kWpW8.js";import"./MobileDateTimePicker-pEp8pQrB.js";import"./Tabs-gBKEx7yr.js";import"./format-number-B8FPsWIV.js";import"./index-DZ-uLlaR.js";import"./CircularProgress-DIm-Ts9z.js";const Ne=({row:t,index:c,selected:n,onDeleteRow:r,onEditRow:d,onViewRow:m})=>{const u=R(),{t:i}=G("products"),s=X(),o=e.jsxs(Te,{hover:!0,selected:n,children:[e.jsx(P,{children:c||(t==null?void 0:t.id)}),e.jsx(P,{children:e.jsxs(V,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(Z,{alt:t==null?void 0:t.name,src:$.site.serverFileHost+((t==null?void 0:t.image)||$.site.defaultImgPlaceHolder)}),e.jsx(W,{component:"span",children:t==null?void 0:t.name})]})}),e.jsx(P,{children:t.description}),e.jsx(P,{children:t.products.length}),e.jsx(P,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(_,{color:s.open?"inherit":"default",onClick:s.onOpen,children:e.jsx(C,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[o,e.jsx(ee,{open:s.open,anchorEl:s.anchorEl,onClose:s.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(te,{children:[e.jsx(E,{permission:T.VIEW_CATEGORY,children:e.jsxs(L,{onClick:()=>{m(),s.onClose()},children:[e.jsx(C,{icon:"solar:eye-bold"}),i("categoryView.table.tableActions.view")]})}),e.jsx(E,{permission:T.EDIT_CATEGORY,children:e.jsxs(L,{onClick:()=>{d(t.id),s.onClose()},children:[e.jsx(C,{icon:"solar:pen-bold"}),i("categoryView.table.tableActions.edit")]})}),e.jsx(E,{permission:T.DELETE_CATEGORY,children:e.jsxs(L,{onClick:()=>{u.onTrue(),s.onClose()},sx:{color:"error.main"},children:[e.jsx(C,{icon:"solar:trash-bin-trash-bold"}),i("categoryView.table.tableActions.delete")]})})]})}),e.jsx(Re,{open:u.value,onClose:u.onFalse,title:i("categoryView.messages.dialogDelete.title"),content:i("categoryView.messages.dialogDelete.text"),action:e.jsx(N,{variant:"contained",color:"error",onClick:r,children:i("categoryView.table.tableActions.delete")})})]})},Ye=q.object({name:q.string().min(1,{message:"Name is required!"}),description:q.string()}),K=({productCategory:t,open:c,onClose:n,handler:r})=>{const d={name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||"",image:t==null?void 0:t.image},m=h.useRef(t),[u,i]=h.useState(),s=h.useCallback(g=>{const l=g[0];i(()=>l)},[]),o=()=>{i(null)},j={headers:{"content-type":"multipart/form-data"}},{mutate:p}=I({mutationFn:g=>D.post(S.files.upload,g,j),onSuccess:async({data:g})=>{const{name:l}=g;if(l){const{current:f}=m;f.image=l,t?await r({id:t.id,payload:f}):await r(f)}return g},onSettled:async()=>{i(null),m.current={}},onError:g=>{console.log(g)}});h.useEffect(()=>{t&&v(d)},[t]);const[w,x]=h.useState(""),y=Ae({resolver:Ie(Ye),defaultValues:d}),{reset:v,handleSubmit:B,formState:{isSubmitting:F}}=y,k=B(async g=>{try{const l={...g};if(u){m.current={...l};const f=new FormData;f.append("file",u),f.append("category","Category"),await p(f)}else t?await r({id:t.id,payload:l}):await r(l);v()}catch(l){console.log(l),x(l instanceof Error?l.message:l)}});return e.jsxs(ke,{fullWidth:!0,open:c,onClose:n,children:[e.jsx(Oe,{children:"Add Category"}),e.jsx(M,{}),!!w&&e.jsx(se,{severity:"error",sx:{mb:3},children:w}),e.jsxs(Ve,{methods:y,onSubmit:k,children:[e.jsxs(Le,{children:[e.jsxs(V,{spacing:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(1, 1fr)",lg:"repeat(1, 1fr)"},children:[e.jsx(Q.Text,{fullWidth:!0,label:"Category Name",name:"name",sx:{mt:2}}),e.jsx(Q.Text,{label:"Description",name:"description",multiline:!0,rows:3,inputProps:{maxLength:250},sx:{mt:2}})]}),e.jsxs(V,{spacing:1.5,sx:{mt:2},children:[e.jsx(ae,{variant:"subtitle2",children:"Attachments"}),e.jsx(Be,{value:u,onDrop:s,onDelete:o})]})]}),e.jsx(M,{sx:{pt:1,mt:1}}),e.jsxs(He,{children:[e.jsx(qe,{type:"submit",variant:"contained",children:t?"Save Changes":"Save"}),e.jsx(N,{color:"inherit",variant:"outlined",onClick:n,children:"Cancel"})]})]})]})},Me=({category:t,open:c,onClose:n,handler:r})=>e.jsx(K,{productCategory:t,open:c,onClose:n,handler:r});function Qe({filters:t,onResetPage:c,options:n}){const{t:r}=G("products"),d=h.useCallback(m=>{c(),t.setState({name:m.target.value})},[t,c]);return e.jsx(V,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx($e,{sx:{width:420},value:t.state.name,onChange:d,placeholder:r("categoryView.table.tableToolbar.searchPlaceholder"),InputProps:{startAdornment:e.jsx(Ge,{position:"start",children:e.jsx(C,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}const We=({categories:t})=>{const c=R(),{t:n}=G("products"),r=R(),d=R(),[m,u]=h.useState(),i=[{id:"id",label:`${n("categoryView.table.tableHeader.no")}`,width:80},{id:"name",label:`${n("categoryView.table.tableHeader.name")}`,width:300},{id:"desc",label:`${n("categoryView.table.tableHeader.description")}`},{id:"status",label:`${n("categoryView.table.tableHeader.productCount")}`,width:200},{id:"",width:88}],s=ye({defaultOrderBy:"planId"}),[o,j]=h.useState(t),p=oe({name:"",status:"all",startDate:null,endDate:null});h.useEffect(()=>{j(t)},[t]);const w=ne(p.state.startDate,p.state.endDate),x=_e({inputData:o,comparator:fe(s.order,s.orderBy),filters:p.state,dateError:w}),y=be(x,s.page,s.rowsPerPage),v=!!p.state.name||p.state.status!=="all"||!!p.state.startDate&&!!p.state.endDate,B=!x.length&&v||!x.length,F=re(),{mutate:k}=I({mutationFn:a=>D.delete(S.productCategories.delete+a),onSuccess:async a=>{const b=o.filter(J=>J.id!==a);O.success("Delete success!"),j(b),s.onUpdatePageDeleteRow(y.length),await F.invalidateQueries({queryKey:["product-categories"]})},onError:a=>{console.log(a)}}),g=h.useCallback(a=>{k(a)},[y.length,s,o]),l=h.useCallback(a=>{u(a),d.onToggle()},[y.length,s,o]),{mutate:f}=I({mutationFn:a=>D.post(S.productCategories.create,a),onSuccess:async()=>{O.success("New Category Has Been Created!"),await F.invalidateQueries({queryKey:["product-categories"]})},onSettled:async()=>{r.onFalse()},onError:a=>{console.log(a)}}),{mutate:U}=I({mutationFn:({id:a,payload:b})=>D.patch(S.productCategories.edit+a,b),onSuccess:async()=>{O.success("Category Has Been Modified!"),await F.invalidateQueries({queryKey:["product-categories"]})},onSettled:async()=>{d.onFalse()},onError:a=>{console.log(a)}}),Y=ie(),z=h.useCallback(a=>{Y.push(A.dashboard.product.categoryDetails(a))},[Y]);return e.jsxs(e.Fragment,{children:[e.jsx(le,{maxWidth:"xl",children:e.jsxs(H,{container:!0,spacing:3,children:[e.jsx(H,{xs:12,md:12,children:e.jsx(je,{links:[{name:`${n("categoryView.breadCrumbsPageRootTitle")}`,href:A.dashboard.root},{name:`${n("categoryView.breadCrumbsParentPageTitle")}`,href:A.dashboard.product.root},{name:`${n("categoryView.breadCrumbsPageTitle")}`}],action:e.jsx(E,{permission:T.ADD_CATEGORY,children:e.jsx(N,{onClick:()=>r.onToggle(),variant:"contained",startIcon:e.jsx(C,{icon:"mingcute:add-line"}),children:n("categoryView.addNewCategory")})})})}),e.jsx(H,{xs:12,md:12,children:e.jsx(E,{permission:T.CATEGORY_LIST,children:e.jsxs(ce,{children:[e.jsx(Qe,{filters:p,onResetPage:s.onResetPage,dateError:w}),e.jsxs(W,{sx:{position:"relative"},children:[e.jsx(ve,{dense:s.dense,numSelected:s.selected.length,rowCount:x.length,onSelectAllRows:a=>s.onSelectAllRows(a,x.map(b=>b.id)),action:e.jsx(de,{title:"Delete",children:e.jsx(_,{color:"primary",onClick:c.onTrue,children:e.jsx(C,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(me,{sx:{minHeight:444},children:e.jsxs(De,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Se,{order:s.order,orderBy:s.orderBy,headLabel:i,rowCount:x.length,numSelected:s.selected.length,onSort:s.onSort}),e.jsxs(Ee,{children:[x.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map((a,b)=>e.jsx(Ne,{row:a,index:s.page*s.rowsPerPage+b+1,selected:s.selected.includes(a.id),onEditRow:()=>l(a),onViewRow:()=>z(a.id),onDeleteRow:()=>g(a.id)},a.id)),e.jsx(Pe,{height:s.dense?56:76,emptyRows:Ce(s.page,s.rowsPerPage,x.length)}),e.jsx(we,{notFound:B})]})]})})]}),e.jsx(Fe,{page:s.page,dense:s.dense,count:x.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})})]})}),e.jsx(K,{handler:f,open:r.value,onClose:r.onFalse}),e.jsx(Me,{handler:U,open:d.value,onClose:d.onFalse,category:m})]})};function _e({inputData:t,comparator:c,filters:n,dateError:r}){const{status:d,name:m,startDate:u,endDate:i}=n,s=t.map((o,j)=>[o,j]);return s.sort((o,j)=>{const p=c(o[0],j[0]);return p!==0?p:o[1]-j[1]}),t=s.map(o=>o[0]),m&&(t=t.filter(o=>o.id.toString().toLowerCase().indexOf(m.toLowerCase())!==-1||o.name.toLowerCase().indexOf(m.toLowerCase())!==-1||o.description.toLowerCase().indexOf(m.toLowerCase())!==-1)),d!=="all"&&(t=t.filter(o=>o.status===d)),r||u&&i&&(t=t.filter(o=>pe(o.createdAt,u,i))),t}const Ke={title:`Product Addons | Dashboard - ${$.site.name}`};function es(){const t=he({queryKey:["product-categories"],queryFn:async()=>{const{data:c}=await D.get(S.productCategories.list);return c}});return t.isPending||t.isLoading?e.jsx(ue,{}):t.isError?e.jsx(xe,{route:A.dashboard.product.root}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{children:e.jsxs("title",{children:[" ",Ke.title]})}),e.jsx(We,{categories:t.data})]})}export{es as default};

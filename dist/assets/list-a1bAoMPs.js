import{i as le,aP as Le,j as e,L as Ee,S as f,A as ue,I as b,B as c,aT as he,d0 as ce,aL as Be,c9 as M,C as me,e8 as ie,d7 as de,ef as v,l as A,cQ as Fe,bR as $e,db as qe,aR as Me,e3 as N,aS as w,e as Y,r as h,de as pe,e2 as je,ed as ge,eb as Ne,dn as ye,dp as E,dm as B,dq as fe,g as be,p as L,ea as Qe,am as _,cY as Ce,v as ee,dT as Pe,ec as He,e7 as Ve,b as Ke,dP as We,cV as R,R as ze,dS as G,dd as _e,H as Ge}from"./index-BNST9t3H.js";import{u as J,E as ve}from"./error-block-DFMrUAWZ.js";import{u as we}from"./useMutation-BKsYnDxa.js";import{C as Ue}from"./custom-breadcrumbs-BiTdiLox.js";import{P as Q}from"./permission-access-controller-BH1Y6uE3.js";import{g as Te,r as Se,e as Ye}from"./utils-MBUcMVfY.js";import{u as De}from"./use-table-DgK1nPu6.js";import{T as Je}from"./table-no-data-CEKK_uI0.js";import{T as Xe}from"./table-empty-rows-IVEuq4ke.js";import{T as oe,a as Re,b as Ae,c as ke}from"./table-head-custom-Cj6hevi-.js";import{T as Ze}from"./table-selected-action-CNkcr7X-.js";import{T as Ie}from"./table-pagination-custom-DoKSyP-T.js";import{A as U}from"./app-widget-summary-CtefBCRF.js";import{b as F}from"./format-number-DalNf45u.js";import{C as et}from"./confirm-dialog-Capw1-Hb.js";import{T as P}from"./TableCell-Drz6UoJo.js";import{A as tt}from"./AvatarGroup-D0spDZSJ.js";import{u as st}from"./use-tabs-DeIu0VnD.js";import{S as Oe}from"./Select-CO9g0L3k.js";import{P as at,O as nt}from"./order-status-dialog-BiNxN-Dj.js";import{Q as rt}from"./quotation-product-table-Bu-_sHQw.js";import{T as lt,a as it}from"./Tabs-C3pqEdNS.js";import{C as ot}from"./CardHeader-bE6dVpbn.js";import{C as ct}from"./CircularProgress-Du1pN_CC.js";import{T as dt}from"./TextField-XhUvK9fJ.js";import{I as xt}from"./InputAdornment-CF1A_q0t.js";import{F as ut,a as te,c as se}from"./filters-result-DQeHfVLH.js";import{C as ae}from"./Chip-CIWjz3HQ.js";import"./index-DtQInucw.js";import"./incrementer-button-B9-YUF9V.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-BSOA6nwW.js";import"./Checkbox-CO6e7jJW.js";import"./TablePagination-B0u1_Y1-.js";import"./KeyboardArrowRight-DqZ8rSQg.js";import"./LastPage-B12F3dR7.js";import"./InputBase-B53atiLK.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-rUw4AD6l.js";import"./use-chart-_T6REhiX.js";import"./chart-legends-Cg-SCPC7.js";import"./index-D4rN_k6Q.js";import"./DialogContent-DHjRqSAQ.js";import"./DialogTitle-BnePALrZ.js";import"./Menu-0-Hoa3ia.js";import"./form-provider-BNtu7LB5.js";import"./FormHelperText-BxJIEqds.js";import"./Rating-SUN7LmWn.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-FUkieYNV.js";import"./index-BqwDHqj-.js";import"./Slider-CwRTu9Nu.js";import"./FormControl-LqjWjsHB.js";import"./FormLabel-BA37t66N.js";import"./RadioGroup-B-Un6V4l.js";import"./FormGroup-DxIrRj-4.js";import"./utils-rQONW9Cc.js";import"./countries-DSLisFCy.js";import"./Autocomplete-LuGCl68c.js";import"./country-select-D-FzK9b2.js";import"./InputLabel-BKRRW4uk.js";import"./upload-avatar-DVJoxmTC.js";import"./image-Dv-AG5zQ.js";import"./DatePicker-Dg_ZdpM0.js";import"./ListItem-3GvF7WdZ.js";import"./MobileDateTimePicker-CGGE3WaR.js";import"./upload-box-ad-B4Pnx2UW.js";import"./schema-helper-C8Rc66eZ.js";import"./LoadingButton-DKBdvIXL.js";function ht({row:s,index:r,selected:n,onViewRow:m,onDeleteRow:t,onClickRow:o,isFullDisplay:d}){var T,S,C;const j=le(),p=le(),l=Le(),i=e.jsxs(oe,{hover:!0,selected:n,children:[e.jsx(P,{onClick:o,children:e.jsx(Ee,{color:"inherit",onClick:m,underline:"always",sx:{cursor:"pointer"},children:(s==null?void 0:s.ref)||r||(s==null?void 0:s.id)})}),e.jsx(P,{onClick:o,children:e.jsxs(f,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(ue,{sx:{bgcolor:"#00AB55"},alt:s.name,src:s.customer.avatar,children:e.jsx(b,{color:"white",icon:"fluent:person-20-filled",width:24})}),e.jsxs(f,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsx(c,{component:"span",sx:{textTransform:"capitalize"},children:s.customer.name}),e.jsx(c,{component:"span",sx:{color:"text.disabled"},children:s.customer.email})]})]})}),!d&&e.jsx(P,{onClick:o,children:e.jsx(he,{primary:ce(s.orderDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(P,{align:"center",onClick:o,children:e.jsx(tt,{sx:{[`& .${Be.avatar}`]:{width:24,height:24}},children:(T=s==null?void 0:s.productToOrder)==null?void 0:T.map(u=>{var g,k,D,I;return e.jsx(M,{title:`${(g=u==null?void 0:u.product)==null?void 0:g.name} | Quantity : ${u.quantity}`,children:e.jsx(ue,{alt:(k=u==null?void 0:u.product)==null?void 0:k.name,src:`${me.site.serverFileHost}${(D=u==null?void 0:u.product)==null?void 0:D.image}`},u==null?void 0:u.id)},(I=u==null?void 0:u.product)==null?void 0:I.id)})})}),e.jsx(P,{onClick:o,children:F(ie(s.totalOrderAmount-s.totalOrderAmount*(s.discount/100),s.snapshotTaxPercentage))||"-"}),!d&&e.jsxs(P,{onClick:o,children:[(S=s.createdBy)==null?void 0:S.firstName," ",(C=s.createdBy)==null?void 0:C.lastName]}),!d&&e.jsx(P,{onClick:o,children:e.jsx(de,{variant:"soft",color:s.status===v.Ready&&"info"||s.status===v.InProcess&&"warning"||s.status===v.Delivered&&"success"||s.status===v.Canceled&&"error"||"default",children:s.status})}),!d&&e.jsxs(P,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(A,{color:p.value?"inherit":"default",onClick:p.onToggle,sx:{...p.value&&{bgcolor:"action.hover"}},children:e.jsx(b,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(A,{color:l.open?"inherit":"default",onClick:l.onOpen,children:e.jsx(b,{icon:"eva:more-vertical-fill"})})]})]}),y=e.jsx(oe,{children:e.jsx(P,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(Fe,{in:p.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx($e,{sx:{m:1.5},children:s.productToOrder.map(u=>e.jsxs(f,{direction:"row",alignItems:"center",sx:{p:g=>g.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:g=>`solid 2px ${g.vars.palette.background.neutral}`}},children:[e.jsx(he,{primary:u.product.name,secondary:u.sku,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs("div",{children:[u.quantity," "]}),e.jsx(c,{sx:{width:110,textAlign:"right"},children:F(u.snapshotProductPrice)})]},u.id))})})})});return e.jsxs(e.Fragment,{children:[i,y,e.jsx(qe,{open:l.open,anchorEl:l.anchorEl,onClose:l.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Me,{children:[e.jsx(Q,{permission:N.VIEW_ORDER,children:e.jsxs(w,{onClick:()=>{m(),l.onClose()},children:[e.jsx(b,{icon:"solar:eye-bold"}),"View"]})}),s.status!==v.Canceled&&e.jsx(Q,{permission:N.DELETE_ORDER,children:e.jsxs(w,{onClick:()=>{j.onTrue(),l.onClose()},sx:{color:"warning.main"},children:[e.jsx(b,{icon:"solar:trash-bin-trash-bold"}),"Cancel"]})})]})}),e.jsx(et,{open:j.value,onClose:j.onFalse,title:"Cancel Order",content:"Are you sure want to cancel this order?",action:e.jsx(Y,{variant:"contained",color:"warning",onClick:()=>{t(),j.onFalse()},children:"Confirm Canceling"})})]})}const mt=[{id:"orderNumber",label:"#",width:40,align:"center"},{id:"date",label:"Date"},{id:"status",label:"Payment Type",width:200,align:"center"},{id:"totalAmount",label:"	Paid Amount",width:200,align:"center"}],pt=({payments:s})=>{const r=De({defaultOrderBy:"orderId",defaultRowsPerPage:5}),[n,m]=h.useState(s),t=pe({name:"",status:"all",startDate:null,endDate:null});h.useEffect(()=>{m(s)},[s]);const o=je(t.state.startDate,t.state.endDate),d=jt({inputData:n,comparator:Te(r.order,r.orderBy),filters:t.state,dateError:o});Se(d,r.page,r.rowsPerPage),t.state.name||t.state.status!=="all"||t.state.startDate&&t.state.endDate;const[j,p]=h.useState("all");h.useCallback(i=>{r.onResetPage(),t.setState({name:i.target.value})},[t,r]);const l=h.useCallback(i=>{r.onResetPage(),t.setState({status:i.target.value}),p(i.target.value)},[t,r]);return e.jsxs(c,{display:"flex",flexDirection:"column",alignItems:"center",sx:{borderRadius:1,height:1,width:1,overflow:"hidden",border:i=>`solid 1px ${i.vars.palette.divider}`},children:[e.jsx(f,{spacing:2,justifyContent:{xs:"flex-end"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:1,width:1},children:e.jsxs(Oe,{size:"small",sx:{width:200,textTransform:"capitalize"},value:j,onChange:l,children:[e.jsx(w,{value:"all",children:"All Payments"}),e.jsx(w,{value:"Cash",children:"Cash"}),e.jsx(w,{value:"Card",children:"Card"}),e.jsx(w,{value:"Transfer",children:"Transfer"})]})}),e.jsx(c,{sx:{flex:1,width:1},children:e.jsxs(Re,{size:"small",children:[e.jsx(Ae,{headLabel:mt}),e.jsx(ke,{children:d.slice(r.page*r.rowsPerPage,r.page*r.rowsPerPage+r.rowsPerPage).map((i,y)=>e.jsxs(oe,{children:[e.jsxs(P,{align:"center",children:[" ",y+1||i.id," "]}),e.jsx(P,{children:ce(i.paymentDate)}),e.jsx(P,{align:"center",children:e.jsx(de,{variant:"soft",color:i.paymentType==="Cash"&&"info"||i.paymentType==="Card"&&"success"||i.paymentType==="Transfer"&&"default"||"default",children:i.paymentType})}),e.jsx(P,{align:"center",children:F(i==null?void 0:i.amount)})]},`${i.id}`))})]})}),e.jsx(Ie,{sx:{width:1},page:r.page,dense:!0,count:d.length,rowsPerPage:r.rowsPerPage,onPageChange:r.onChangePage,onRowsPerPageChange:r.onChangeRowsPerPage})]})};function jt({inputData:s,comparator:r,filters:n,dateError:m}){const{status:t,name:o,startDate:d,endDate:j}=n,p=s.map((l,i)=>[l,i]);return p.sort((l,i)=>{const y=r(l[0],i[0]);return y!==0?y:l[1]-i[1]}),s=p.map(l=>l[0]),t!=="all"&&(s=s.filter(l=>l.paymentType===t)),m||d&&j&&(s=s.filter(l=>ge(l.createdAt,d,j))),s}const ne=[{value:"details",icon:e.jsx(b,{icon:"solar:eye-bold",width:24}),label:"Details"},{value:"payments",icon:e.jsx(b,{icon:"solar:case-minimalistic-bold",width:24}),label:"Payments"}],gt=({selectedOrder:s,handleResize:r,handleClose:n,onViewOrder:m})=>{var K,W,z,a,O,xe;const[t,o]=h.useState(s),d=st("details"),[j,p]=h.useState(ne),l=Ne();h.useEffect(()=>{s.id!==t.id&&o(s)},[t.id,s]),h.useEffect(()=>{const x=(s==null?void 0:s.status)!==v.Draft&&(s==null?void 0:s.status)!==v.Canceled?ne:ne.filter(Z=>!["payments"].includes(Z.value));p(x)},[s]);const i=le(),y=ye(),{mutate:T}=we({mutationFn:x=>E.post(B.payments.create,x),onSuccess:async x=>{fe.success("New Payment Has Been Created!"),i.onFalse()},onSettled:async()=>{await y.invalidateQueries({queryKey:["payments"]}),await y.invalidateQueries({queryKey:["order",t.id]})},onError:x=>{console.log(x)}}),S=be(),C=h.useCallback(x=>{S.replace(L.dashboard.quotation.details(x))},[S]),[u,g]=h.useState(!1),k=()=>{g(!0)},{isLoading:D}=J({queryKey:["download-order",t.id],queryFn:async()=>{const x=await E.get(B.order.downloadPdf+t.id,{responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([x.data])),q=document.createElement("a");return q.href=Z,q.setAttribute("download",`Order-${t.ref}.pdf`),document.body.appendChild(q),q.click(),document.body.removeChild(q),x.data},enabled:u,cacheTime:0,onSuccess:()=>{g(!1)}}),I=e.jsx(M,{title:"Download Pdf",children:e.jsx(A,{onClick:k,children:D?e.jsx(ct,{size:24,color:"inherit"}):e.jsx(b,{icon:"eva:cloud-download-fill"})})}),$=e.jsxs(f,{alignItems:"flex-end",sx:{p:1,textAlign:"right",typography:"body2"},children:[e.jsxs(f,{direction:"row",children:[e.jsx(c,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(c,{sx:{width:160,typography:"subtitle2"},children:F(t==null?void 0:t.totalOrderAmount)||"-"})]}),e.jsxs(f,{direction:"row",children:[e.jsx(c,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(c,{sx:{width:160,...(t==null?void 0:t.discount)&&{color:"error.main"}},children:t!=null&&t.discount?`- ${t==null?void 0:t.discount}%`:"-"})]}),e.jsxs(f,{direction:"row",children:[e.jsxs(c,{sx:{color:"text.secondary"},children:["Tax (",(t==null?void 0:t.snapshotTaxPercentage)||"0","%)"]}),e.jsx(c,{sx:{width:160},children:t!=null&&t.snapshotTaxPercentage?F(Qe((t==null?void 0:t.totalOrderAmount)-(t==null?void 0:t.totalOrderAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage)):"-"})]}),e.jsxs(f,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:"Total"}),e.jsx(c,{sx:{width:160},children:F(ie((t==null?void 0:t.totalOrderAmount)-(t==null?void 0:t.totalOrderAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage))||"-"})]})]}),X=e.jsxs(f,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsxs(c,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",m:1},children:[e.jsxs(c,{flexDirection:"column",sx:{display:"flex"},children:[e.jsxs(c,{sx:{color:"text.secondary"},children:["Order Ref: #",t==null?void 0:t.ref]}),e.jsxs(c,{sx:{color:"text.secondary"},children:["Order Date: ",ce(t==null?void 0:t.orderDate)]})]}),e.jsx(c,{sx:{mr:2},children:e.jsxs(c,{sx:{color:"text.secondary"},children:["Status:"," ",e.jsx(de,{variant:"soft",color:(t==null?void 0:t.status)===v.Ready&&"info"||(t==null?void 0:t.status)===v.InProcess&&"warning"||(t==null?void 0:t.status)===v.Delivered&&"success"||(t==null?void 0:t.status)===v.Canceled&&"error"||"default",children:t==null?void 0:t.status})]})}),((K=t==null?void 0:t.order)==null?void 0:K.id)&&e.jsx(c,{sx:{color:"text.secondary"},className:"print-hide",children:e.jsxs(Y,{variant:"contained",size:"small",startIcon:e.jsx(b,{icon:"heroicons-outline:external-link"}),onClick:()=>{t==null||t.quotation},children:["Related to Quotation: #",(W=t==null?void 0:t.quotation)==null?void 0:W.ref]})})]}),e.jsxs(c,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsx(rt,{products:t==null?void 0:t.productToOrder,defaultRowsPerPage:t!=null&&t.notes?5:10}),e.jsx(_,{sx:{mt:1}})]}),$,(t==null?void 0:t.notes)&&e.jsxs(c,{children:[e.jsx(_,{}),e.jsx(f,{sx:{typography:"body2"},children:e.jsx(c,{sx:{p:1},children:e.jsxs(f,{sx:{typography:"subtitle2"},children:[e.jsx("div",{children:"Notes:"}),e.jsx(c,{sx:{color:"text.secondary"},children:t==null?void 0:t.notes})]})})})]})]}),H=J({queryKey:["order",t.id],queryFn:async()=>{const{data:x}=await E.get(B.order.details+t.id);return o(x),x}}),V=x=>x.isPending||x.isLoading?e.jsx(Pe,{}):x.isError?e.jsx(ve,{}):e.jsxs(f,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[(t==null?void 0:t.status)!==v.Draft&&(t==null?void 0:t.status)!==v.Canceled&&Math.round(ie(t.totalOrderAmount-t.totalOrderAmount*(t.discount/100),t==null?void 0:t.snapshotTaxPercentage)-t.orderPaymentAmount)>0&&e.jsxs(e.Fragment,{children:[e.jsx(c,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(c,{children:e.jsx(Q,{permission:N.ADD_PAYMENT,children:e.jsx(Y,{onClick:()=>i.onToggle(),variant:"contained",startIcon:e.jsx(b,{icon:"mingcute:add-line"}),children:"New Payment"})})})}),e.jsx(_,{})]}),e.jsx(c,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(pt,{payments:H.data.payments})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{sx:{height:1,display:"flex",flexDirection:"column",width:1,transition:"all 2s ease-in-out"},children:[e.jsxs(lt,{className:"print-hide ",value:d.value,onChange:d.onChange,sx:{px:3,boxShadow:x=>`inset 0 -2px 0 0 ${ee(x.vars.palette.grey["500Channel"],.08)}`},children:[j.map(x=>e.jsx(it,{icon:x.icon,value:x.value,label:x.label},x.value)),e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${ee(l.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(A,{sx:{ml:1},onClick:r,children:e.jsx(b,{icon:"solar:full-screen-bold",width:24})})}),e.jsx(c,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${ee(l.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(A,{sx:{ml:1},onClick:n,children:e.jsx(b,{icon:"solar:close-square-outline",width:24})})})]}),e.jsxs(c,{className:"print-top-margin print-padding",sx:{display:"flex",flexDirection:"column",position:"relative",flex:1},children:[e.jsx(ot,{sx:{pt:1},title:`Order Reference: ${t==null?void 0:t.ref}`,subheader:`Created By : ${(z=t.createdBy)==null?void 0:z.firstName} ${(a=t.createdBy)==null?void 0:a.lastName}`,action:e.jsx(f,{spacing:3,direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"},sx:{mb:{xs:3,md:5}},children:e.jsxs(f,{direction:"row",spacing:1,alignItems:"center",flexGrow:1,sx:{width:1},children:[e.jsx(M,{title:"View",children:e.jsx(A,{onClick:()=>{m(t.id)},children:e.jsx(b,{icon:"solar:eye-bold"})})}),((O=t==null?void 0:t.quotation)==null?void 0:O.id)&&e.jsx(M,{title:`Related to Quotation: #${(xe=t==null?void 0:t.quotation)==null?void 0:xe.ref}`,children:e.jsx(A,{onClick:()=>{var x;C((x=t==null?void 0:t.quotation)==null?void 0:x.id)},children:e.jsx(b,{icon:"heroicons-outline:external-link"})})}),I,e.jsx(M,{title:"Print",children:e.jsx(at,{order:t})})]})})}),e.jsx(_,{}),d.value==="details"&&X,d.value==="payments"&&V(H)]})]}),e.jsx(nt,{order:t,open:i.value,onClose:i.onFalse,handler:T})]})};function yt({filters:s,onResetPage:r}){const[n,m]=h.useState("all"),t=h.useCallback(d=>{r(),s.setState({name:d.target.value})},[s,r]),o=h.useCallback(d=>{r(),s.setState({status:d.target.value}),m(d.target.value)},[s,r]);return e.jsxs(f,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(dt,{sx:{width:420},value:s.state.name,onChange:t,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(xt,{position:"start",children:e.jsx(b,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(Oe,{sx:{width:420,textTransform:"capitalize"},value:n,onChange:o,children:[e.jsx(w,{value:"all",children:"All Orders"}),e.jsx(w,{value:"Draft",children:"Draft"}),e.jsx(w,{value:"Canceled",children:"Canceled"}),e.jsx(w,{value:"InProcess",children:"Processing"}),e.jsx(w,{value:"Ready",children:"Ready To Deliver"}),e.jsx(w,{value:"Delivered",children:"Delivered"})]})]})}function ft({filters:s,totalResults:r,onResetPage:n,sx:m}){const t=h.useCallback(()=>{n(),s.setState({name:""})},[s,n]),o=h.useCallback(()=>{n(),s.setState({status:"all"})},[s,n]),d=h.useCallback(()=>{n(),s.setState({startDate:null,endDate:null})},[s,n]),j=h.useCallback(()=>{n(),s.onResetState()},[s,n]);return e.jsxs(ut,{totalResults:r,onReset:j,sx:m,children:[e.jsx(te,{label:"Status:",isShow:s.state.status!=="all",children:e.jsx(ae,{...se,label:s.state.status,onDelete:o,sx:{textTransform:"capitalize"}})}),e.jsx(te,{label:"Date:",isShow:!!(s.state.startDate&&s.state.endDate),children:e.jsx(ae,{...se,label:He(s.state.startDate,s.state.endDate),onDelete:d})}),e.jsx(te,{label:"Keyword:",isShow:!!s.state.name,children:e.jsx(ae,{...se,label:s.state.name,onDelete:t})})]})}const re=[{id:"orderNumber",label:"#",width:88},{id:"name",label:"Customer"},{id:"createdAt",label:"Date",width:140},{id:"totalQuantity",label:"Items",width:120,align:"center"},{id:"totalAmount",label:"Price",width:140},{id:"createdBy",label:"Created By",width:200},{id:"status",label:"Status",width:110},{id:"",width:88}];function bt({orders:s,analytics:r}){const n=De({defaultOrderBy:"orderId",defaultRowsPerPage:5}),{t:m}=Ve("orders"),t=be(),[o,d]=h.useState(),[j,p]=h.useState(!1),[l,i]=h.useState(re),y=Ke(),[T,S]=h.useState(()=>s),C=pe({name:"",status:"all",startDate:null,endDate:null});h.useEffect(()=>{if(p(!1),S(s),o){const a=s.find(O=>O.id===o.id);d(a)}},[s]),h.useEffect(()=>{const a=o?re.filter(O=>!["createdAt","createdBy","status",""].includes(O.id)):re;i(a)},[o]);const u=je(C.state.startDate,C.state.endDate),g=Ct({inputData:T,comparator:Te(n.order,n.orderBy),filters:C.state,dateError:u}),k=Se(g,n.page,n.rowsPerPage),D=!!C.state.name||C.state.status!=="all"||!!C.state.startDate&&!!C.state.endDate,I=!g.length&&D||!g.length,$=ye(),{mutate:X}=we({mutationFn:a=>E.delete(B.order.delete+a),onSuccess:async()=>{fe.success("Order Has Been Canceled!")},onSettled:async()=>{await $.invalidateQueries({queryKey:["orders"]}),await $.invalidateQueries({queryKey:["orders-status"]}),await $.invalidateQueries({queryKey:["orders","analytics"]})},onError:()=>{}}),H=h.useCallback(a=>{X(a)},[k.length,n,T]),V=h.useCallback(a=>{t.replace(L.dashboard.order.details(a))},[t]),K=()=>{p(!j)},W=()=>{d(null),p(!1)},z=a=>{d(a)};return e.jsx(We,{maxWidth:"xl",children:e.jsxs(R,{container:!0,spacing:3,children:[e.jsx(R,{xs:12,md:12,children:e.jsx(Ue,{links:[{name:`${m("listView.breadCrumbsPageRootTitle")}`,href:L.dashboard.root},{name:`${m("listView.breadCrumbsParentPageTitle")}`,href:L.dashboard.order.root},{name:`${m("listView.breadCrumbsPageTitle")}`}],action:e.jsx(Q,{permission:N.ADD_ORDER,children:e.jsx(Y,{component:ze,href:L.dashboard.order.new,variant:"contained",startIcon:e.jsx(b,{icon:"mingcute:add-line"}),children:`${m("listView.addNewOrder")}`})})})}),e.jsxs(Q,{permission:N.LIST_ORDER,children:[e.jsx(R,{xs:12,md:3,children:e.jsx(U,{title:`${m("listView.statisticsWidgets.allOrders")}`,total:s.length,chart:{categories:r.data.lastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:r.data.lastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(R,{xs:12,md:3,children:e.jsx(U,{title:`${m("listView.statisticsWidgets.processingOrder")}`,total:r.data.analytics.InProcess,chart:{colors:[y.vars.palette.warning.light],categories:r.data.inProcessLastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:r.data.inProcessLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(R,{xs:12,md:3,children:e.jsx(U,{title:`${m("listView.statisticsWidgets.readyToDeliver")}`,total:r.data.analytics.Ready,chart:{colors:[y.vars.palette.info.main],categories:r.data.readyLastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:r.data.readyLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(R,{xs:12,md:3,children:e.jsx(U,{title:`${m("listView.statisticsWidgets.delivered")}`,total:r.data.analytics.Delivered,chart:{colors:[y.vars.palette.success.main],categories:r.data.deliveredLastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:r.data.deliveredLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),!j&&e.jsx(R,{xs:12,md:o?5:12,children:e.jsxs(Ce,{children:[e.jsx(yt,{filters:C,onResetPage:n.onResetPage,dateError:u}),D&&e.jsx(ft,{filters:C,totalResults:g.length,onResetPage:n.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(c,{sx:{position:"relative"},children:[e.jsx(Ze,{dense:n.dense,numSelected:n.selected.length,rowCount:g.length}),e.jsx(_e,{sx:{minHeight:444},children:e.jsxs(Re,{size:n.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Ae,{order:n.order,orderBy:n.orderBy,headLabel:l,rowCount:g.length}),e.jsxs(ke,{children:[g.slice(n.page*n.rowsPerPage,n.page*n.rowsPerPage+n.rowsPerPage).map(a=>e.jsx(ht,{row:a,selected:n.selected.includes(a.id),onSelectRow:()=>n.onSelectRow(a.id),onDeleteRow:()=>H(a.id),onViewRow:()=>V(a.id),onClickRow:()=>z(a),isFullDisplay:o},a.id)),e.jsx(Xe,{height:n.dense?56:76,emptyRows:Ye(n.page,n.rowsPerPage,g.length)}),e.jsx(Je,{notFound:I})]})]})})]}),e.jsx(Ie,{page:n.page,dense:n.dense,count:g.length,rowsPerPage:n.rowsPerPage,onPageChange:n.onChangePage,onChangeDense:n.onChangeDense,onRowsPerPageChange:n.onChangeRowsPerPage})]})}),o&&e.jsx(c,{sx:{display:"flex",flex:1,p:1.5,transition:"all 2s ease-in-out"},children:e.jsx(gt,{selectedOrder:o,handleResize:K,handleClose:W,onViewOrder:V})})]})]})})}function Ct({inputData:s,comparator:r,filters:n,dateError:m}){const{status:t,name:o,startDate:d,endDate:j}=n,p=s==null?void 0:s.map((l,i)=>[l,i]);return p==null||p.sort((l,i)=>{const y=r(l[0],i[0]);return y!==0?y:l[1]-i[1]}),s=p==null?void 0:p.map(l=>l[0]),o&&(s=s.filter(l=>l.id.toString().toLowerCase().indexOf(o.toLowerCase())!==-1||l.customer.name.toLowerCase().indexOf(o.toLowerCase())!==-1||l.status.toLowerCase().indexOf(o.toLowerCase())!==-1||l.customer.email.toLowerCase().indexOf(o.toLowerCase())!==-1)),t!=="all"&&(s=s.filter(l=>l.status===t)),m||d&&j&&(s=s.filter(l=>ge(l.createTime,d,j))),s}const Pt={title:`Order list | Dashboard - ${me.site.name}`};function Qs(){const s=J({queryKey:["orders"],queryFn:async()=>{const{data:n}=await E.get(B.order.list);return n}}),r=J({queryKey:["orders","analytics"],queryFn:async()=>{const{data:n}=await E.get(B.order.analytics);return n}});return r.isLoading||s.isLoading?e.jsx(Pe,{}):s.isError||r.isError?e.jsx(ve,{route:L.dashboard.order.root}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{children:e.jsxs("title",{children:[" ",Pt.title]})}),e.jsx(bt,{orders:s.data,analytics:r})]})}export{Qs as default};

import{i as f,aN as K,j as e,d0 as _,e as P,I as h,l as V,db as z,aP as U,aQ as w,e4 as R,r as p,S as I,de as W,e3 as G,dn as J,g as Y,p as C,dQ as $,cY as X,B as Z,dd as ee,ed as te,dp as D,dm as y,dq as F,dU as se,H as oe,C as ne}from"./index-BEaGYMEI.js";import{u as re,E as ae}from"./error-block-BQYINy50.js";import{u as S}from"./useMutation-CD7lT4vI.js";import{d as ie}from"./download-file-DTYvwIqY.js";import{C as le}from"./custom-breadcrumbs-D4hwk-rw.js";import{P as b}from"./permission-access-controller-Cc7F7Sq7.js";import{g as de,r as ce,e as me}from"./utils-MBUcMVfY.js";import{u as pe}from"./use-table-DsQxT_g8.js";import{T as ue}from"./table-no-data-1VG6qoaS.js";import{T as he}from"./table-empty-rows-D7ODdqoL.js";import{T as xe,a as ge,b as je,c as fe}from"./table-head-custom-Drg40nu1.js";import{T as Ce}from"./table-selected-action-4MJ4AHc-.js";import{T as Re}from"./table-pagination-custom-B8a_JMe_.js";import{C as be}from"./confirm-dialog-B_hHuFtb.js";import{T as j}from"./TableCell-CzBf4-Ov.js";import{R as k}from"./reminder-create-dialog-DpeYpikH.js";import{T as we}from"./TextField-CIxpyOlN.js";import{I as Pe}from"./InputAdornment-CGsQ7T7u.js";import{F as De,a as ye,c as Te}from"./filters-result-DA5pDRfI.js";import{C as Ee}from"./Chip-Db-a91wo.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-DxNFQfFL.js";import"./Checkbox-DRhnNWXi.js";import"./TablePagination-BtzWghPM.js";import"./KeyboardArrowRight-BWGrV5E8.js";import"./LastPage-BtJVqGJo.js";import"./Select-C-U3VYQj.js";import"./Menu-Dc9eDgdb.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-Cx_XAmin.js";import"./FormControlLabel-BO7gRcil.js";import"./DialogContent-kX6pwS8I.js";import"./DialogTitle-CjPJnsJT.js";import"./form-provider-D1JqQzDy.js";import"./FormHelperText-BJ35fbuN.js";import"./Rating-OrTvPT5o.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-BIhbmUVt.js";import"./index-MqrcwFfK.js";import"./Slider-Vpiw_yof.js";import"./FormControl-2hnEuYCX.js";import"./FormLabel-DT9mGYCJ.js";import"./RadioGroup-CBePuX0v.js";import"./FormGroup-Co3Xm8J_.js";import"./utils-BEJZLJ_B.js";import"./index-DHKdtuyp.js";import"./countries-DSLisFCy.js";import"./Autocomplete-DxNaZqwA.js";import"./country-select-UHhuvlSO.js";import"./InputLabel-CeWPpGeQ.js";import"./upload-avatar-Bt3nnzfi.js";import"./format-number-JDGLw5r5.js";import"./image-C-zCjJjA.js";import"./DatePicker-CrD84yY4.js";import"./ListItem-BFzJ2Xb7.js";import"./MobileDateTimePicker-hl_QFTv-.js";import"./Tabs-CAp3wR44.js";import"./upload-box-ad-C6UF2VQ-.js";import"./schema-helper-B8q_BDb0.js";import"./LoadingButton-EriFvYzy.js";import"./CircularProgress-Dqum4YNW.js";const Fe=({row:t,index:s,selected:a,onViewFileRow:i,onDeleteRow:c,onEditRow:d,onViewQuotationRow:u})=>{var m;const r=f(),l=K(),o=e.jsxs(xe,{hover:!0,selected:a,children:[e.jsx(j,{children:s||(t==null?void 0:t.id)}),e.jsx(j,{children:_(t.reminderDate)}),e.jsx(j,{children:t.title}),e.jsx(j,{children:(m=t.quotation)!=null&&m.ref?e.jsxs(P,{variant:"contained",size:"small",startIcon:e.jsx(h,{icon:"heroicons-outline:external-link"}),onClick:()=>{t.quotation.id&&u(t.quotation.id)},children:["#",t.quotation.ref]}):"-"}),e.jsx(j,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(V,{color:l.open?"inherit":"default",onClick:l.onOpen,children:e.jsx(h,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[o,e.jsx(z,{open:l.open,anchorEl:l.anchorEl,onClose:l.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(U,{children:[(t==null?void 0:t.file)&&e.jsxs(w,{onClick:()=>{i(),l.onClose()},children:[e.jsx(h,{icon:"solar:cloud-download-bold"}),"Download"]}),e.jsx(b,{permission:R.ADD_REMINDER,children:e.jsxs(w,{onClick:()=>{d(),l.onClose()},children:[e.jsx(h,{icon:"solar:pen-bold"}),"Edit"]})}),e.jsx(b,{permission:R.ADD_REMINDER,children:e.jsxs(w,{onClick:()=>{r.onTrue(),l.onClose()},sx:{color:"error.main"},children:[e.jsx(h,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})})]})}),e.jsx(be,{open:r.value,onClose:r.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(P,{variant:"contained",color:"error",onClick:c,children:"Delete"})})]})},Se=({reminder:t,open:s,onClose:a,handler:i})=>e.jsx(k,{currentReminder:t,open:s,onClose:a,handler:i});function Ie({filters:t,onResetPage:s,options:a}){const i=p.useCallback(c=>{s(),t.setState({name:c.target.value})},[t,s]);return e.jsx(I,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(we,{sx:{width:420},value:t.state.name,onChange:i,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(Pe,{position:"start",children:e.jsx(h,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}function ke({filters:t,totalResults:s,onResetPage:a,sx:i}){const c=p.useCallback(()=>{a(),t.setState({name:""})},[t,a]),d=p.useCallback(()=>{a(),t.onResetState()},[t,a]);return e.jsx(De,{totalResults:s,onReset:d,sx:i,children:e.jsx(ye,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(Ee,{...Te,label:t.state.name,onDelete:c})})})}const ve=[{id:"reminderId",label:"#",width:140},{id:"date",label:"Date",width:280},{id:"title",label:"Title"},{id:"related",label:"Related",width:280},{id:"",width:88}],Be=({reminders:t})=>{const s=pe({defaultOrderBy:"orderNumber"}),a=f(),i=f(),c=f(),[d,u]=p.useState(t),r=W({name:"",status:"all",startDate:null,endDate:null}),l=G(r.state.startDate,r.state.endDate);p.useEffect(()=>{u(t)},[t]);const o=Le({inputData:d,comparator:de(s.order,s.orderBy),filters:r.state,dateError:l}),m=ce(o,s.page,s.rowsPerPage),x=!!r.state.name||r.state.status!=="all"||!!r.state.startDate&&!!r.state.endDate,v=!o.length&&x||!o.length,B=p.useCallback(n=>{M(n)},[m.length,s,d]),[L,A]=p.useState(),q=p.useCallback(n=>{A(n),i.onToggle()},[m.length,s,d]),T=J(),N=n=>{ie(n)},{mutate:M}=S({mutationFn:n=>D.delete(y.reminders.delete+n),onSuccess:async n=>{const g=d.filter(O=>O.id!==n);F.success("Delete success!"),u(g),s.onUpdatePageDeleteRow(m.length),c.onFalse()},onSettled:async()=>{await T.invalidateQueries({queryKey:["reminders"]}),c.onFalse()},onError:()=>{}}),{mutate:Q}=S({mutationFn:({id:n,payload:g})=>D.patch(y.reminders.edit+n,g),onSuccess:async()=>{F.success("New Reminder Has Been Modified!")},onSettled:async()=>{await T.invalidateQueries({queryKey:["reminders"]}),i.onFalse()},onError:n=>{console.log(n)}}),E=Y(),H=p.useCallback(n=>{E.push(C.dashboard.quotation.details(n))},[E]);return e.jsxs(e.Fragment,{children:[e.jsx($,{maxWidth:"xl",children:e.jsxs(I,{spacing:3,children:[e.jsx(le,{links:[{name:"Dashboard",href:C.dashboard.root},{name:"Reminders",href:C.dashboard.reminders.root}],action:e.jsx(b,{permission:R.ADD_REMINDER,children:e.jsx(P,{onClick:()=>a.onToggle(),variant:"contained",startIcon:e.jsx(h,{icon:"mingcute:add-line"}),children:"New Reminder"})})}),e.jsx(b,{permission:R.REMINDER_LIST,children:e.jsxs(X,{children:[e.jsx(Ie,{filters:r,onResetPage:s.onResetPage,dateError:l}),x&&e.jsx(ke,{filters:r,totalResults:o.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(Z,{sx:{position:"relative"},children:[e.jsx(Ce,{dense:s.dense,numSelected:s.selected.length,rowCount:o.length}),e.jsx(ee,{sx:{minHeight:444},children:e.jsxs(ge,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(je,{order:s.order,orderBy:s.orderBy,headLabel:ve,rowCount:o.length}),e.jsxs(fe,{children:[o.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map((n,g)=>e.jsx(Fe,{row:n,index:s.page*s.rowsPerPage+g+1,selected:s.selected.includes(n.id),onEditRow:()=>q(n),onDeleteRow:()=>B(n.id),onViewFileRow:()=>N(n.file),onViewQuotationRow:H},n.id)),e.jsx(he,{height:s.dense?56:76,emptyRows:me(s.page,s.rowsPerPage,o.length)}),e.jsx(ue,{notFound:v})]})]})})]}),e.jsx(Re,{page:s.page,dense:s.dense,count:o.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})]})}),e.jsx(k,{open:a.value,onClose:a.onFalse}),e.jsx(Se,{reminder:L,open:i.value,onClose:i.onFalse,handler:Q})]})};function Le({inputData:t,comparator:s,filters:a,dateError:i}){const{status:c,name:d,startDate:u,endDate:r}=a,l=t.map((o,m)=>[o,m]);return l.sort((o,m)=>{const x=s(o[0],m[0]);return x!==0?x:o[1]-m[1]}),t=l.map(o=>o[0]),d&&(t=t.filter(o=>o.id.toString().toLowerCase().indexOf(d.toLowerCase())!==-1||o.title.toLowerCase().indexOf(d.toLowerCase())!==-1||o.description.toLowerCase().indexOf(d.toLowerCase())!==-1)),c!=="all"&&(t=t.filter(o=>o.status===c)),i||u&&r&&(t=t.filter(o=>te(o.createdAt,u,r))),t}const Ae={title:`Reminders list | Dashboard - ${ne.site.name}`};function Ut(){const t=re({queryKey:["reminders"],queryFn:async()=>{const{data:s}=await D.get(y.reminders.list);return s}});return t.isPending||t.isLoading?e.jsx(se,{}):t.isError?e.jsx(ae,{route:C.dashboard.reminders.root}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{children:e.jsxs("title",{children:[" ",Ae.title]})}),e.jsx(Be,{reminders:t.data})]})}export{Ut as default};

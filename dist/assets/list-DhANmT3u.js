import{Y as Z,br as X,a3 as Se,j as e,L as De,S as g,A as je,I as x,B as l,a8 as be,d1 as re,Q as Qe,bq as D,C as Ce,e8 as ge,d8 as ye,e9 as h,$ as v,cR as Ie,b6 as $e,dc as Ae,a6 as Ee,e4 as I,a7 as E,e as W,r as m,dq as V,dn as O,dp as Te,dr as J,ea as Re,a5 as U,eb as Ve,W as we,p as Q,cZ as ve,v as ee,dU as le,ec as Oe,df as Le,e3 as Be,dQ as Fe,cW as se,R as He,de as Ne,ed as Me,H as _e}from"./index-3kUlxXkm.js";import{u as ie,E as oe}from"./error-block-BTCpMwIj.js";import{u as Y}from"./useMutation-DWyFExRk.js";import{C as Ke}from"./custom-breadcrumbs-CQM3hT8w.js";import{P as $}from"./permission-access-controller-6Z2YefAG.js";import{g as Ue,r as We,e as Ge}from"./utils-MBUcMVfY.js";import{u as ze}from"./use-table-9MzCtmNE.js";import{T as Je}from"./table-no-data-DRMtffow.js";import{T as Ye}from"./table-empty-rows-R6XLgnwX.js";import{T as fe,a as Ze,b as Xe,c as qe}from"./table-head-custom-Bzh_BuNQ.js";import{T as es}from"./table-selected-action-77MIBAPT.js";import{T as ss}from"./table-pagination-custom-HAHTP3sF.js";import{b as G}from"./format-number-CFuBAOSh.js";import{C as ts}from"./confirm-dialog-DcDyWDMb.js";import{T as S}from"./TableCell-YgDy_fKI.js";import{A as as}from"./AvatarGroup-DZ0cD606.js";import{l as ns}from"./index-DSmIvarc.js";import{u as rs}from"./use-tabs-B9ArrO3C.js";import{P as ls,Q as is,a as os}from"./print-quotation-details-template-Ddouwvt4.js";import{Q as ds}from"./quotation-product-table-CToYXclt.js";import{T as cs}from"./tickets-create-dialog-BUJjDvE_.js";import{R as xs}from"./reminder-create-dialog-CBV46smf.js";import{C as ms}from"./CircularProgress-CZhO4lMk.js";import{T as hs,a as us}from"./Tabs-Cs2uCeCP.js";import{C as ps}from"./CardHeader-Dma4zJfI.js";import{T as js}from"./TextField-Ff9PgcBD.js";import{I as bs}from"./InputAdornment-Ug97Thua.js";import{S as fs}from"./Select-DOB8r047.js";import{F as Cs,a as te,c as ae}from"./filters-result-CHuN9x5s.js";import{C as ne}from"./Chip-yUQfyewU.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-DygIpP7Y.js";import"./Checkbox-BPHZ30Zu.js";import"./TablePagination-CVcJMlXd.js";import"./KeyboardArrowRight-o7aJmcRm.js";import"./LastPage-FHI8cfYQ.js";import"./InputBase-Df4WeLlJ.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-DWtRb9VA.js";import"./DialogContent-BZuUPSmG.js";import"./DialogTitle-DD3683-9.js";import"./form-provider-Ddj1YnLe.js";import"./FormHelperText-47ensrNn.js";import"./Rating-BWS0RvVN.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-BMX_0Xq6.js";import"./Menu-CsXXwNKW.js";import"./index-nrKetuMS.js";import"./Slider-Dlywp6Zb.js";import"./FormControl-BaWzc8Dl.js";import"./FormLabel-CX5M124t.js";import"./RadioGroup-D6FwwOLi.js";import"./FormGroup-DHewWmvb.js";import"./utils-NIylK1Um.js";import"./index-BySBJlbP.js";import"./countries-DSLisFCy.js";import"./Autocomplete-CuAKdGKX.js";import"./country-select-i0JEsBFQ.js";import"./InputLabel-Df2ESQnA.js";import"./upload-avatar-BbAzKhJK.js";import"./image-BEDFCDEn.js";import"./DatePicker-vbOob6Xb.js";import"./ListItem-CBu29PKK.js";import"./MobileDateTimePicker-DlpjHwQr.js";import"./upload-box-ad-C5ekRHFU.js";import"./LoadingButton-BtwwM36s.js";import"./schema-helper-pKPnN3t8.js";function gs({row:t,index:n,selected:d,onViewRow:r,onClickRow:s,onEditRow:j,onDeleteRow:b,isFullDisplay:u}){var k,y,N,R,M,L;const p=Z(),{t:i}=X("quotations"),f=Z(),C=Se(),P=e.jsxs(fe,{hover:!0,selected:d,children:[e.jsx(S,{onClick:s,children:e.jsx(De,{color:"inherit",onClick:r,underline:"always",sx:{cursor:"pointer"},children:(t==null?void 0:t.ref)||n||(t==null?void 0:t.id)})}),e.jsx(S,{onClick:s,children:e.jsxs(g,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(je,{sx:{bgcolor:"#00AB55"},alt:t.name,src:(k=t.customer)==null?void 0:k.avatar,children:e.jsx(x,{color:"white",icon:"fluent:person-20-filled",width:24})}),e.jsxs(g,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsx(l,{component:"span",children:t.name}),e.jsx(l,{component:"span",sx:{color:"text.disabled"},children:(y=t.customer)==null?void 0:y.name})]})]})}),e.jsx(S,{onClick:s,children:e.jsx(be,{primary:re(t.quotationDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(S,{align:"center",onClick:s,children:e.jsx(as,{sx:{[`& .${Qe.avatar}`]:{width:24,height:24}},children:(N=t==null?void 0:t.productToQuotation)==null?void 0:N.map(c=>{var w,A,B,F;return e.jsx(D,{title:`${(w=c==null?void 0:c.product)==null?void 0:w.name} | Quantity : ${c.quantity}`,children:e.jsx(je,{alt:(A=c==null?void 0:c.product)==null?void 0:A.name,src:`${Ce.site.serverFileHost}${(B=c==null?void 0:c.product)==null?void 0:B.image}`},c==null?void 0:c.id)},(F=c==null?void 0:c.product)==null?void 0:F.id)})})}),e.jsxs(S,{onClick:s,children:[G(ge((t==null?void 0:t.totalAmount)-(t==null?void 0:t.totalAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage))||"-"," "]}),!u&&e.jsxs(S,{onClick:s,children:[(R=t.createdBy)==null?void 0:R.firstName," ",(M=t.createdBy)==null?void 0:M.lastName]}),!u&&e.jsx(S,{onClick:s,children:e.jsxs(ye,{variant:"soft",color:t.status===h.Confirmed&&"info"||t.status===h.Converted&&"success"||t.status===h.Canceled&&"error"||"default",children:[t.status===h.Created&&`${i("listView.table.tableToolbar.selectMenu.created")}`,t.status===h.Confirmed&&`${i("listView.table.tableToolbar.selectMenu.confirmed")}`,t.status===h.Converted&&`${i("listView.table.tableToolbar.selectMenu.converted")}`,t.status===h.Canceled&&`${i("listView.table.tableToolbar.selectMenu.canceled")}`]})}),!u&&e.jsxs(S,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(v,{color:f.value?"inherit":"default",onClick:f.onToggle,sx:{...f.value&&{bgcolor:"action.hover"}},children:e.jsx(x,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(v,{color:C.open?"inherit":"default",onClick:C.onOpen,children:e.jsx(x,{icon:"eva:more-vertical-fill"})})]})]}),T=e.jsx(fe,{children:e.jsx(S,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(Ie,{in:f.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx($e,{sx:{m:1.5},children:(L=t.productToQuotation)==null?void 0:L.map(c=>e.jsxs(g,{direction:"row",alignItems:"center",sx:{p:w=>w.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:w=>`solid 2px ${w.vars.palette.background.neutral}`}},children:[e.jsx(be,{primary:c.product.name,secondary:c.sku,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs("div",{children:[c.quantity," "]}),e.jsx(l,{sx:{width:110,textAlign:"right"},children:G(c.snapshotProductPrice)})]},c.id))})})})});return e.jsxs(e.Fragment,{children:[P,T,e.jsx(Ae,{open:C.open,anchorEl:C.anchorEl,onClose:C.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Ee,{children:[e.jsx($,{permission:I.VIEW_QUOTATION,children:e.jsxs(E,{onClick:()=>{r(),C.onClose()},children:[e.jsx(x,{icon:"solar:eye-bold"}),`${i("listView.table.tableActions.view")}`]})}),(t==null?void 0:t.status)===h.Created&&e.jsx($,{permission:I.EDIT_QUOTATION,children:e.jsxs(E,{onClick:()=>{j(),C.onClose()},children:[e.jsx(x,{icon:"solar:pen-bold"}),`${i("listView.table.tableActions.edit")}`]})}),t.status!==h.Canceled&&t.status!==h.Converted&&e.jsx($,{permission:I.DELETE_QUOTATION,children:e.jsxs(E,{onClick:()=>{p.onTrue(),C.onClose()},sx:{color:"warning.main"},children:[e.jsx(x,{icon:"solar:trash-bin-trash-bold"}),`${i("listView.table.tableActions.cancel")}`]})})]})}),e.jsx(ts,{open:p.value,onClose:p.onFalse,title:i("listView.messages.dialogCancel.title"),content:i("listView.messages.dialogCancel.text"),action:e.jsx(W,{variant:"contained",color:"warning",onClick:()=>{b(),p.onFalse()},children:i("listView.messages.dialogCancel.confirmButton")})})]})}const ys=({selectedQuotation:t,handleResize:n,handleClose:d})=>{var ce,xe,me,he,ue,pe;const{t:r}=X("quotations"),[s,j]=m.useState(t),b=ie({queryKey:["quotation",s.id],queryFn:async()=>{const{data:a}=await V.get(O.quotation.details+s.id);return j(a),a}}),u=[{value:"details",icon:e.jsx(x,{icon:"solar:eye-bold",width:24}),label:`${r("detailsCard.quotationDetailsTab")}`},{value:"tickets",icon:e.jsx(x,{icon:"solar:case-minimalistic-bold",width:24}),label:`${r("detailsCard.ticketsTab")}`},{value:"reminders",icon:e.jsx(x,{icon:"solar:calendar-bold",width:24}),label:`${r("detailsCard.remindersTab")}`}];m.useEffect(()=>{t.id!==s.id&&j(t)},[s.id,t]);const p=Te(),{mutate:i}=Y({mutationFn:a=>V.post(O.quotation.createOrder,a),onSuccess:async({data:a})=>{J.success("Order Has Been Created!");const{id:_}=s;await p.invalidateQueries({queryKey:["quotations"]}),await p.invalidateQueries({queryKey:["quotation",_]})},onError:a=>{console.log(a)}}),{mutate:f}=Y({mutationFn:a=>V.post(O.quotation.share,a),onSuccess:async({data:a})=>{J.success("Quotation has been sended to the customer.")},onError:a=>{console.log(a)}}),{mutate:C}=Y({mutationFn:a=>V.patch(O.quotation.editStatus+a,{status:h.Confirmed}),onSuccess:async({data:a})=>{J.success("Quotation Has Been Confirmed!");const{id:_}=s;await p.invalidateQueries({queryKey:["quotations"]}),await p.invalidateQueries({queryKey:["quotation",_]})},onError:a=>{console.log(a)}}),P=rs("details"),[T,k]=m.useState(!1),y=()=>{k(!0)},{data:N,isLoading:R,error:M}=ie({queryKey:["download-quotation",s.id],queryFn:async()=>{const a=await V.get(O.quotation.downloadPdf+s.id,{responseType:"blob"}),_=window.URL.createObjectURL(new Blob([a.data])),K=document.createElement("a");return K.href=_,K.setAttribute("download",`Quotation-${s.ref}.pdf`),document.body.appendChild(K),K.click(),document.body.removeChild(K),k(!1),a.data},enabled:T,onSuccess:()=>{k(!1)},onError:a=>{console.error("Download failed:",a)}}),L=e.jsx(D,{title:r("detailsCard.tooltips.downloadTooltip"),children:e.jsx(v,{onClick:y,children:R?e.jsx(ms,{size:24,color:"inherit"}):e.jsx(x,{icon:"eva:cloud-download-fill",color:"error.main"})})}),c=e.jsxs(g,{alignItems:"flex-end",sx:{p:1,textAlign:"right",typography:"body2"},children:[e.jsxs(g,{direction:"row",children:[e.jsx(l,{sx:{color:"text.secondary"},children:r("detailsCard.subtotal")}),e.jsx(l,{sx:{width:160,typography:"subtitle2"},children:G(s==null?void 0:s.totalAmount)||"-"})]}),e.jsxs(g,{direction:"row",children:[e.jsx(l,{sx:{color:"text.secondary"},children:r("detailsCard.discount")}),e.jsx(l,{sx:{width:160,...(s==null?void 0:s.discount)&&{color:"error.main"}},children:s!=null&&s.discount?`- ${s==null?void 0:s.discount}%`:"-"})]}),e.jsxs(g,{direction:"row",children:[e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.tax")," (",(s==null?void 0:s.snapshotTaxPercentage)||"0","%)"]}),e.jsx(l,{sx:{width:160},children:s!=null&&s.snapshotTaxPercentage?G(Re((s==null?void 0:s.totalAmount)-(s==null?void 0:s.totalAmount)*((s==null?void 0:s.discount)/100),s==null?void 0:s.snapshotTaxPercentage)):"-"})]}),e.jsxs(g,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:r("detailsCard.total")}),e.jsx(l,{sx:{width:160},children:G(ge((s==null?void 0:s.totalAmount)-(s==null?void 0:s.totalAmount)*((s==null?void 0:s.discount)/100),s==null?void 0:s.snapshotTaxPercentage))||"-"})]})]}),w=Z(),A=Z(),B=e.jsxs(g,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsxs(l,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",m:1},children:[e.jsxs(l,{flexDirection:"column",sx:{display:"flex"},children:[e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.quotationRef")," #",s==null?void 0:s.ref]}),e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.quotationDate")," ",re(s==null?void 0:s.quotationDate)]}),e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.quotationExpiry")," ",re(s==null?void 0:s.expiredDate)]})]}),e.jsx(l,{sx:{mr:2},children:e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.status"),e.jsxs(ye,{variant:"soft",color:(s==null?void 0:s.status)===h.Confirmed&&"info"||(s==null?void 0:s.status)===h.Converted&&"success"||(s==null?void 0:s.status)===h.Canceled&&"error"||"default",children:[(s==null?void 0:s.status)===h.Created&&`${r("listView.table.tableToolbar.selectMenu.created")}`,(s==null?void 0:s.status)===h.Confirmed&&`${r("listView.table.tableToolbar.selectMenu.confirmed")}`,(s==null?void 0:s.status)===h.Converted&&`${r("listView.table.tableToolbar.selectMenu.converted")}`,(s==null?void 0:s.status)===h.Canceled&&`${r("listView.table.tableToolbar.selectMenu.canceled")}`]})]})}),((ce=s==null?void 0:s.order)==null?void 0:ce.id)&&e.jsx(l,{sx:{color:"text.secondary"},className:"print-hide",children:e.jsxs(W,{variant:"contained",size:"small",startIcon:e.jsx(x,{icon:"heroicons-outline:external-link"}),onClick:()=>{const{id:a}=s==null?void 0:s.order;a&&H(a)},children:[r("detailsCard.relatedToQuotation")," #",(xe=s==null?void 0:s.order)==null?void 0:xe.ref]})})]}),e.jsxs(l,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsx(ds,{products:s==null?void 0:s.productToQuotation,defaultRowsPerPage:s!=null&&s.notes?5:10}),e.jsx(U,{sx:{mt:1}})]}),c,(s==null?void 0:s.notes)&&e.jsxs(l,{children:[e.jsx(U,{}),e.jsx(g,{sx:{typography:"body2"},children:e.jsx(l,{sx:{p:1},children:e.jsxs(g,{sx:{typography:"subtitle2"},children:[e.jsxs("div",{children:[r("detailsCard.notes"),":"]}),e.jsx(l,{sx:{color:"text.secondary"},children:s==null?void 0:s.notes})]})})})]})]}),F=a=>a.isPending||a.isLoading?e.jsx(le,{}):a.isError?e.jsx(oe,{}):e.jsxs(g,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsx(l,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(l,{children:e.jsx($,{permission:I.ADD_TICKET,children:e.jsx(W,{onClick:()=>w.onToggle(),variant:"contained",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),children:r("detailsCard.newTicket")})})})}),e.jsx(U,{}),e.jsx(l,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(is,{tickets:b.data.tickets})})]}),q=a=>a.isPending||a.isLoading?e.jsx(le,{}):a.isError?e.jsx(oe,{}):e.jsxs(g,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsx(l,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(l,{children:e.jsx($,{permission:I.ADD_REMINDER,children:e.jsx(W,{onClick:()=>A.onToggle(),variant:"contained",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),children:r("detailsCard.newReminder")})})})}),e.jsx(U,{}),e.jsx(l,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(os,{reminders:b.data.reminders})})]}),z=Ve(),o=we(),H=m.useCallback(a=>{o.push(Q.dashboard.order.details(a))},[o]),Pe=m.useCallback(a=>{o.push(Q.dashboard.quotation.details(a))},[o]),ke=m.useCallback(a=>{o.push(Q.dashboard.quotation.edit(a))},[o]),de=m.useRef();return ns.useReactToPrint({content:()=>de.current}),e.jsxs(e.Fragment,{children:[e.jsxs(ve,{ref:de,sx:{height:1,display:"flex",flexDirection:"column",width:1,transition:"all 2s ease-in-out"},children:[e.jsx("style",{jsx:!0,children:`
          .print-title {
            display: none; /* Hide on screen */
          }

          @media print {
            html,
            body {
              height: initial !important;
              overflow: initial !important;
            }
            .print-title {
              display: block; /* Show only when printing */
            }
            .print-hide {
              display: none; /* Hide on screen */
            }
            .print-padding {
              padding: 5px;
            }
            .print-top-margin {
              margin-top: 40px;
            }
          }
        `}),e.jsxs(hs,{className:"print-hide ",value:P.value,onChange:P.onChange,sx:{px:3,boxShadow:a=>`inset 0 -2px 0 0 ${ee(a.vars.palette.grey["500Channel"],.08)}`},children:[u.map(a=>e.jsx(us,{icon:a.icon,value:a.value,label:a.label},a.value)),e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${ee(z.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(v,{sx:{ml:1},onClick:n,children:e.jsx(x,{icon:"solar:full-screen-bold",width:24})})}),e.jsx(l,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${ee(z.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(v,{sx:{ml:1},onClick:d,children:e.jsx(x,{icon:"solar:close-square-outline",width:24})})})]}),e.jsxs(l,{className:"print-top-margin print-padding",sx:{display:"flex",flexDirection:"column",position:"relative",flex:1},children:[e.jsx(ps,{sx:{pt:1},title:s==null?void 0:s.name,subheader:`Quotation for Customer : ${(me=s==null?void 0:s.customer)==null?void 0:me.name}`,action:e.jsx(g,{spacing:3,className:"print-hide",direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"},sx:{mb:{xs:3,md:5}},children:e.jsxs(g,{direction:"row",spacing:1,flexGrow:1,sx:{width:1},children:[e.jsx(D,{title:"View",children:e.jsx(v,{onClick:()=>{Pe(s==null?void 0:s.id)},children:e.jsx(x,{icon:"solar:eye-bold",color:"primary.main"})})}),(s==null?void 0:s.status)===h.Created&&e.jsx(D,{title:"Edit",children:e.jsx(v,{onClick:()=>{ke(s==null?void 0:s.id)},children:e.jsx(x,{icon:"solar:pen-bold",color:"warning.main"})})}),(s==null?void 0:s.status)===h.Created&&e.jsx(D,{title:"Confirm",children:e.jsx(v,{onClick:()=>{C(s==null?void 0:s.id)},children:e.jsx(x,{icon:"line-md:confirm-circle-filled"})})}),e.jsx($,{permission:I.CONVERT_QUOTATION_TO_ORDER,children:!((he=s==null?void 0:s.order)!=null&&he.id)&&((s==null?void 0:s.status)===h.Created||(s==null?void 0:s.status)===h.Confirmed)&&e.jsx(D,{title:"Convert to Order",children:e.jsx(v,{onClick:()=>{i({quotationId:s==null?void 0:s.id})},children:e.jsx(x,{icon:"solar:restart-circle-bold"})})})}),((ue=s==null?void 0:s.order)==null?void 0:ue.id)&&e.jsx(D,{title:`Related to Order: #${(pe=s==null?void 0:s.order)==null?void 0:pe.ref}`,children:e.jsx(v,{onClick:()=>{var a;H((a=s==null?void 0:s.order)==null?void 0:a.id)},children:e.jsx(x,{icon:"heroicons-outline:external-link"})})}),L,e.jsx($,{permission:I.PRINT_QUOTATION,children:e.jsx(D,{title:"Print",children:e.jsx(ls,{quotation:s})})}),e.jsx(D,{title:"Send To the Customer",children:e.jsx(v,{onClick:()=>{f({id:s.id})},children:e.jsx(x,{icon:"iconamoon:send-fill",color:"info.main"})})})]})})}),e.jsx(U,{}),P.value==="details"&&B,P.value==="tickets"&&F(b),P.value==="reminders"&&q(b)]})]}),e.jsx(cs,{open:w.value,onClose:w.onFalse,quotation:s}),e.jsx(xs,{open:A.value,onClose:A.onFalse,quotation:s})]})};function Ts({filters:t,onResetPage:n}){const[d,r]=m.useState("all"),{t:s}=X("quotations"),j=m.useCallback(u=>{n(),t.setState({name:u.target.value})},[t,n]),b=m.useCallback(u=>{n(),t.setState({status:u.target.value}),r(u.target.value)},[t,n]);return e.jsxs(g,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(js,{sx:{width:420},value:t.state.name,onChange:j,placeholder:`${s("listView.table.tableToolbar.searchPlaceholder")}`,InputProps:{startAdornment:e.jsx(bs,{position:"start",children:e.jsx(x,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(fs,{sx:{width:420,textTransform:"capitalize"},value:d,onChange:b,children:[e.jsx(E,{value:"all",children:`${s("listView.table.tableToolbar.selectMenu.allQuotations")}`}),e.jsx(E,{value:"Created",children:`${s("listView.table.tableToolbar.selectMenu.created")}`}),e.jsx(E,{value:"Confirmed",children:`${s("listView.table.tableToolbar.selectMenu.confirmed")}`}),e.jsx(E,{value:"Canceled",children:`${s("listView.table.tableToolbar.selectMenu.canceled")}`}),e.jsx(E,{value:"Converted",children:`${s("listView.table.tableToolbar.selectMenu.converted")}`})]})]})}function ws({filters:t,totalResults:n,onResetPage:d,sx:r}){const s=m.useCallback(()=>{d(),t.setState({name:""})},[t,d]),j=m.useCallback(()=>{d(),t.setState({status:"all"})},[t,d]),b=m.useCallback(()=>{d(),t.setState({startDate:null,endDate:null})},[t,d]),u=m.useCallback(()=>{d(),t.onResetState()},[t,d]);return e.jsxs(Cs,{totalResults:n,onReset:u,sx:r,children:[e.jsx(te,{label:"Status:",isShow:t.state.status!=="all",children:e.jsx(ne,{...ae,label:t.state.status,onDelete:j,sx:{textTransform:"capitalize"}})}),e.jsx(te,{label:"Date:",isShow:!!(t.state.startDate&&t.state.endDate),children:e.jsx(ne,{...ae,label:Oe(t.state.startDate,t.state.endDate),onDelete:b})}),e.jsx(te,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(ne,{...ae,label:t.state.name,onDelete:s})})]})}function vs({quotations:t}){const n=ze({defaultOrderBy:"orderId",defaultRowsPerPage:5}),{t:d}=X("quotations"),[r,s]=m.useState(),[j,b]=m.useState(!1),u=[{id:"ref",label:"#",width:88},{id:"details",label:`${d("listView.table.tableHeader.details")}`},{id:"createdAt",label:`${d("listView.table.tableHeader.date")}`,width:140},{id:"totalQuantity",label:`${d("listView.table.tableHeader.items")}`,width:120,align:"center"},{id:"totalAmount",label:`${d("listView.table.tableHeader.price")}`,width:140},{id:"createdBy",label:`${d("listView.table.tableHeader.createdBy")}`,width:200},{id:"status",label:`${d("listView.table.tableHeader.status")}`,width:110},{id:"",width:88}],[p,i]=m.useState(u),f=we(),[C,P]=m.useState(()=>t),T=Le({name:"",status:"all",startDate:null,endDate:null});m.useEffect(()=>{if(b(!1),P(t),r){const o=t.find(H=>H.id===r.id);s(o)}},[t]),m.useEffect(()=>{const o=r?u.filter(H=>!["createdBy","status",""].includes(H.id)):u;i(o)},[r]);const k=Be(T.state.startDate,T.state.endDate),y=Ps({inputData:C,comparator:Ue(n.order,n.orderBy),filters:T.state,dateError:k}),N=We(y,n.page,n.rowsPerPage),R=!!T.state.name||T.state.status!=="all"||!!T.state.startDate&&!!T.state.endDate,M=!y.length&&R||!y.length,L=Te(),{mutate:c}=Y({mutationFn:o=>V.delete(O.quotation.delete+o),onSuccess:async()=>{J.success("Order Has Been Canceled!")},onSettled:async()=>{await L.invalidateQueries({queryKey:["quotations"]})},onError:()=>{}}),w=m.useCallback(o=>{c(o)},[N.length,n,C]),A=m.useCallback(o=>{f.replace(Q.dashboard.quotation.details(o))},[f]),B=m.useCallback(o=>{f.replace(Q.dashboard.quotation.edit(o))},[f]),F=()=>{b(!j)},q=()=>{s(null),b(!1)},z=o=>{s(o)};return e.jsx(Fe,{maxWidth:"xl",children:e.jsxs(se,{container:!0,spacing:3,children:[e.jsx(se,{xs:12,md:12,children:e.jsx(Ke,{links:[{name:`${d("listView.breadCrumbsPageRootTitle")}`,href:Q.dashboard.root},{name:`${d("listView.breadCrumbsParentPageTitle")}`,href:Q.dashboard.quotation.root},{name:`${d("listView.breadCrumbsPageTitle")}`}],action:e.jsx($,{permission:I.ADD_QUOTATION,children:e.jsx(W,{component:He,href:Q.dashboard.quotation.new,variant:"contained",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),children:`${d("listView.addNewQuotation")}`})})})}),e.jsxs($,{permission:I.LIST_QUOTATION,children:[!j&&e.jsx(se,{xs:12,md:r?5:12,children:e.jsxs(ve,{children:[e.jsx(Ts,{filters:T,onResetPage:n.onResetPage,dateError:k}),R&&e.jsx(ws,{filters:T,totalResults:y.length,onResetPage:n.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(l,{sx:{position:"relative"},children:[e.jsx(es,{dense:n.dense,numSelected:n.selected.length,rowCount:y.length}),e.jsx(Ne,{sx:{minHeight:444},children:e.jsxs(Ze,{size:n.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Xe,{order:n.order,orderBy:n.orderBy,headLabel:p,rowCount:y.length}),e.jsxs(qe,{children:[y.slice(n.page*n.rowsPerPage,n.page*n.rowsPerPage+n.rowsPerPage).map(o=>e.jsx(gs,{row:o,selected:n.selected.includes(o.id),onSelectRow:()=>n.onSelectRow(o.id),onDeleteRow:()=>w(o.id),onViewRow:()=>A(o.id),onEditRow:()=>B(o.id),onClickRow:()=>z(o),isFullDisplay:r},o.id)),e.jsx(Ye,{height:n.dense?56:76,emptyRows:Ge(n.page,n.rowsPerPage,y.length)}),e.jsx(Je,{notFound:M})]})]})})]}),e.jsx(ss,{page:n.page,dense:n.dense,count:y.length,rowsPerPage:n.rowsPerPage,onPageChange:n.onChangePage,onChangeDense:n.onChangeDense,onRowsPerPageChange:n.onChangeRowsPerPage})]})}),r&&e.jsx(l,{sx:{display:"flex",flex:1,p:1.5,transition:"all 2s ease-in-out"},children:e.jsx(ys,{selectedQuotation:r,handleResize:F,handleClose:q})})]})]})})}function Ps({inputData:t,comparator:n,filters:d,dateError:r}){const{status:s,name:j,startDate:b,endDate:u}=d,p=t==null?void 0:t.map((i,f)=>[i,f]);return p==null||p.sort((i,f)=>{const C=n(i[0],f[0]);return C!==0?C:i[1]-f[1]}),t=p==null?void 0:p.map(i=>i[0]),j&&(t=t.filter(i=>i.id.toString().toLowerCase().indexOf(j.toLowerCase())!==-1||i.customer.name.toLowerCase().indexOf(j.toLowerCase())!==-1||i.status.toLowerCase().indexOf(j.toLowerCase())!==-1||i.customer.email.toLowerCase().indexOf(j.toLowerCase())!==-1)),s!=="all"&&(t=t.filter(i=>i.status===s)),r||b&&u&&(t=t.filter(i=>Me(i.createTime,b,u))),t}const ks={title:`Quotation list | Dashboard - ${Ce.site.name}`};function _t(){const t=ie({queryKey:["quotations"],queryFn:async()=>{const{data:n}=await V.get(O.quotation.list);return n}});return t.isLoading?e.jsx(le,{}):t.isError?e.jsx(oe,{route:Q.dashboard.quotation.root}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{children:e.jsxs("title",{children:[" ",ks.title]})}),e.jsx(vs,{quotations:t.data})]})}export{_t as default};

import{o as j,bO as M,j as e,w as K,I as g,dw as q,bQ as Q,em as P,bR as F,e as v,r as d,S as I,dz as U,eo as _,dI as z,e8 as $,p as R,aD as J,B as W,dy as G,ep as V,dJ as b,dH as f,dK as S,ec as X,H as Y,C as Z}from"./index-CwDFRBrV.js";import{u as ee,E as te}from"./error-block-po56rbru.js";import{u as D}from"./useMutation-CkTHNDXi.js";import{C as se}from"./custom-breadcrumbs-tdSVNm9k.js";import{P as y}from"./permission-access-controller-7g9WRehD.js";import{g as oe,r as re,T as ae,a as ne,e as ie}from"./table-selected-action-QvRRh6wE.js";import{u as le}from"./use-table-keuem4Xf.js";import{T as ce}from"./table-no-data-C6vJju_i.js";import{T as me,a as de,b as ue,c as pe}from"./table-head-custom-0GEy35EZ.js";import{T as he}from"./table-pagination-custom-B9zCiItL.js";import{C as xe}from"./confirm-dialog-CzBLlYBs.js";import{T as x}from"./TableCell-D5WBIyLx.js";import{O as B}from"./order-customer-create-dialog-Bds99vh7.js";import{T as Ce}from"./TextField-CHPZUTqF.js";import{I as ge}from"./InputAdornment-DEbikF0Z.js";import{F as je,a as be,c as fe}from"./filters-result-DEYNNCA9.js";import{C as Pe}from"./Chip-BadVSybg.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-Cm203eFc.js";import"./empty-content-LLazwqBz.js";import"./TablePagination-CxmbsKV-.js";import"./KeyboardArrowRight-DJc55wOs.js";import"./LastPage-DeJVGkdu.js";import"./Select-C_u8K-J_.js";import"./Menu-B_jyagBS.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-Bn2YUrmy.js";import"./FormControlLabel-HvXv_MVH.js";import"./DialogContent-DQegyPQl.js";import"./DialogTitle-B_p_zW0I.js";import"./form-provider-C8IltM3z.js";import"./FormHelperText-Bj0ulyme.js";import"./Rating-C4JeVFy2.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-eNq_8vRL.js";import"./index-BP8NwpZp.js";import"./Slider-Brhk4K8C.js";import"./FormControl-yMCQcYEm.js";import"./FormLabel-BavGwz4i.js";import"./RadioGroup-c9F65hOo.js";import"./FormGroup-DOTqUq1f.js";import"./index-DM_1Xs39.js";import"./countries-DSLisFCy.js";import"./Autocomplete-CmyTYkoe.js";import"./country-select-DGH5tKc3.js";import"./InputLabel-CKyW86qE.js";import"./upload-avatar-Bqr4alq-.js";import"./format-number-Ch538jHW.js";import"./image-D_atTa8y.js";import"./DatePicker-DijfO7Ga.js";import"./ListItem-M-XT_teX.js";import"./MobileDateTimePicker-DjMxEeI_.js";import"./Tabs-BdVdVdbh.js";import"./schema-helper-DaL9n66F.js";import"./LoadingButton-BM8YRB0z.js";import"./CircularProgress-f16JZADw.js";const ye=({row:t,index:s,selected:a,onDeleteRow:n,onEditRow:m})=>{const i=j(),l=M(),p=o=>o?`${o==null?void 0:o.street} ${o==null?void 0:o.country}.`:" - ",h=e.jsxs(me,{hover:!0,selected:a,children:[e.jsx(x,{children:(t==null?void 0:t.ref)||s||(t==null?void 0:t.id)}),e.jsx(x,{children:t==null?void 0:t.name}),e.jsx(x,{children:t==null?void 0:t.email}),e.jsx(x,{children:t==null?void 0:t.phoneNumber}),e.jsx(x,{children:p(t==null?void 0:t.address)}),e.jsx(x,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(K,{color:l.open?"inherit":"default",onClick:l.onOpen,children:e.jsx(g,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[h,e.jsx(q,{open:l.open,anchorEl:l.anchorEl,onClose:l.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Q,{children:[e.jsx(y,{permission:P.EDIT_CUSTOMER,children:e.jsxs(F,{onClick:()=>{m(),l.onClose()},children:[e.jsx(g,{icon:"solar:pen-bold"}),"Edit"]})}),e.jsx(y,{permission:P.DELETE_CUSTOMER,children:e.jsxs(F,{onClick:()=>{i.onTrue(),l.onClose()},sx:{color:"error.main"},children:[e.jsx(g,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})})]})}),e.jsx(xe,{open:i.value,onClose:i.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(v,{variant:"contained",color:"error",onClick:n,children:"Delete"})})]})};function Te({customer:t,open:s,onClose:a,handler:n}){return e.jsx(B,{customer:t,open:s,onClose:a,handler:n})}function Ee({customer:t,open:s,onClose:a,handler:n}){return e.jsx(B,{customer:t,open:s,onClose:a,handler:n})}function Se({filters:t,onResetPage:s,options:a}){const n=d.useCallback(m=>{s(),t.setState({name:m.target.value})},[t,s]);return e.jsx(I,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(Ce,{sx:{width:420},value:t.state.name,onChange:n,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(ge,{position:"start",children:e.jsx(g,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}function De({filters:t,totalResults:s,onResetPage:a,sx:n}){const m=d.useCallback(()=>{a(),t.setState({name:""})},[t,a]),i=d.useCallback(()=>{a(),t.onResetState()},[t,a]);return e.jsx(je,{totalResults:s,onReset:i,sx:n,children:e.jsx(be,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(Pe,{...fe,label:t.state.name,onDelete:m})})})}const Re=[{id:"customerId",label:"#",width:88},{id:"name",label:"Customer Name",width:220},{id:"email",label:"Email",width:220},{id:"phoneNumber",label:"Phone Number",width:120},{id:"address",label:"Address",width:120},{id:"",width:88}],we=({customers:t})=>{const s=le({defaultOrderBy:"id"}),a=j(),n=j(),m=j(),[i,l]=d.useState(t),[p,h]=d.useState(),o=U({name:"",status:"all",startDate:null,endDate:null}),u=_(o.state.startDate,o.state.endDate),c=Fe({inputData:i,comparator:oe(s.order,s.orderBy),filters:o.state,dateError:u});d.useEffect(()=>{l(t)},[t]);const T=re(c,s.page,s.rowsPerPage),w=!!o.state.name||o.state.status!=="all"||!!o.state.startDate&&!!o.state.endDate,L=!c.length&&w||!c.length,k=d.useCallback(r=>{H(r)},[T.length,s,i]),O=d.useCallback(r=>{h(r),n.onToggle()},[T.length,s,i]),E=z(),{mutate:A}=D({mutationFn:r=>b.post(f.customers.create,r),onSuccess:async()=>{S.success("New Customer Has Been Created!")},onSettled:async()=>{await E.invalidateQueries({queryKey:["customers"]}),a.onFalse()},onError:r=>{console.log(r)}}),{mutate:N}=D({mutationFn:({id:r,payload:C})=>b.patch(f.customers.edit+r,C),onSuccess:async()=>{S.success("New Customer Has Been Modified!")},onSettled:async()=>{await E.invalidateQueries({queryKey:["customers"]}),n.onFalse()},onError:r=>{console.log(r)}}),{mutate:H}=D({mutationFn:r=>b.delete(f.customers.delete+r),onSuccess:async()=>{const r=i.filter(C=>C.id!==id);S.success("Delete success!"),l(r),s.onUpdatePageDeleteRow(T.length),m.onFalse()},onSettled:async()=>{await E.invalidateQueries({queryKey:["customers"]}),m.onFalse()},onError:()=>{}});return e.jsxs(e.Fragment,{children:[e.jsx($,{maxWidth:"xl",children:e.jsxs(I,{spacing:3,children:[e.jsx(se,{links:[{name:"Dashboard",href:R.dashboard.root},{name:"Customers",href:R.dashboard.customers.root}],action:e.jsx(y,{permission:P.ADD_CUSTOMER,children:e.jsx(v,{onClick:()=>a.onToggle(),variant:"contained",startIcon:e.jsx(g,{icon:"mingcute:add-line"}),children:"Add New Customer"})})}),e.jsx(y,{permission:P.LIST_CUSTOMER,children:e.jsxs(J,{children:[e.jsx(Se,{filters:o,onResetPage:s.onResetPage,dateError:u}),w&&e.jsx(De,{filters:o,totalResults:c.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(W,{sx:{position:"relative"},children:[e.jsx(ae,{dense:s.dense,numSelected:s.selected.length,rowCount:c.length}),e.jsx(G,{sx:{minHeight:444},children:e.jsxs(de,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(ue,{order:s.order,orderBy:s.orderBy,headLabel:Re,rowCount:c.length}),e.jsxs(pe,{children:[c.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map((r,C)=>e.jsx(ye,{index:s.page*s.rowsPerPage+C+1,row:r,selected:s.selected.includes(r.id),onEditRow:()=>O(r),onDeleteRow:()=>k(r.id)},r.id)),e.jsx(ne,{height:s.dense?56:76,emptyRows:ie(s.page,s.rowsPerPage,c.length)}),e.jsx(ce,{notFound:L})]})]})})]}),e.jsx(he,{page:s.page,dense:s.dense,count:c.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})]})}),e.jsx(Ee,{open:a.value,onClose:a.onFalse,handler:A}),e.jsx(Te,{open:n.value,onClose:n.onFalse,handler:N,customer:p})]})};function Fe({inputData:t,comparator:s,filters:a,dateError:n}){const{status:m,name:i,startDate:l,endDate:p}=a,h=t.map((o,u)=>[o,u]);return h.sort((o,u)=>{const c=s(o[0],u[0]);return c!==0?c:o[1]-u[1]}),t=h.map(o=>o[0]),i&&(t=t.filter(o=>o.id.toString().toLowerCase().indexOf(i.toLowerCase())!==-1||o.name.toLowerCase().indexOf(i.toLowerCase())!==-1||o.email.toLowerCase().indexOf(i.toLowerCase())!==-1||o.phoneNumber.toString().toLowerCase().indexOf(i.toLowerCase())!==-1)),n||l&&p&&(t=t.filter(o=>V(o.createdAt,l,p))),t}const ve={title:`Customers list | Dashboard - ${Z.site.name}`};function At(){const t=ee({queryKey:["customers"],queryFn:async()=>(await b.get(f.customers.list)).data});return t.isPending||t.isLoading?e.jsx(X,{}):t.isError?e.jsx(te,{route:R.dashboard.customers.root}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:e.jsxs("title",{children:[" ",ve.title]})}),e.jsx(we,{customers:t.data})]})}export{At as default};

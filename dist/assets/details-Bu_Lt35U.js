import{j as s,S as t,B as i,e as c,w as B,dL as g,dM as p,dK as u,dN as f,aF as b,du as j,I as C,dB as M,T as E,aL as q,eb as L,p as x,G as m,ef as K,H as N,C as P}from"./index-DLJImauo.js";import{u as $,E as H}from"./error-block-CpNyIBSO.js";import{u as Q}from"./use-params-DeowL31Y.js";import{C as G}from"./custom-breadcrumbs-B-49wW2q.js";import{u as T}from"./useMutation-7HTcUz2p.js";import{a as R,b as A,D as O}from"./DialogContent-DDfVnIX5.js";import{C as D}from"./CardHeader-DDkjAWap.js";import{z as y,u as V,t as z,F as J}from"./form-provider-CFcdla9F.js";import{F as U}from"./fields-BliOQ6O0.js";import"./image-BZDZbX9M.js";import"./editor-Cv_jl3Bs.js";import{T as W,t as X,a as Y,b as Z,c as _,d as k,e as ss}from"./TimelineSeparator-BiO_IF9H.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./TextField-Dn-4Yx6H.js";import"./FormControl-CkwXYy0A.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-CEebhHey.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-CL79af0c.js";import"./Select-C24IVDgk.js";import"./Menu-u9Fg2yBB.js";import"./InputBase-DlzL5OFi.js";import"./FormHelperText-kKfXHIoW.js";import"./index-CVIDvc2K.js";import"./countries-DSLisFCy.js";import"./InputAdornment-DKC0KPnD.js";import"./Rating-FzotwsHz.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-0xmJrVsO.js";import"./RadioGroup-C3COSxFX.js";import"./FormGroup-vDyIqZ9l.js";import"./FormControlLabel-C_QV2Cmj.js";import"./Autocomplete-BlHa76y8.js";import"./Chip-B_i8-SK5.js";import"./country-select-CN1OaNL9.js";import"./Checkbox-iCj-brcW.js";import"./upload-avatar-6dytMmax.js";import"./format-number-Be330NDU.js";import"./DatePicker-D6XSSTkA.js";import"./ListItem-BofKFpgJ.js";import"./MobileDateTimePicker-CdN8K0hT.js";import"./index-B2cAHtCt.js";const es=({open:e,onClose:r,handler:l})=>s.jsxs(R,{open:e,onClose:r,children:[s.jsx(A,{children:s.jsxs(t,{spacing:1,alignItems:"center",children:[s.jsx(i,{}),s.jsx("strong",{children:"Are you sure?"}),s.jsx("p",{children:"Do you want to mark seleted ticket as closed."})]})}),s.jsxs(O,{children:[s.jsx(c,{variant:"contained",onClick:l,children:"Confirm"}),s.jsx(c,{color:"inherit",variant:"outlined",onClick:r,children:"Cancel"})]})]});function rs({ticket:e}){const r=B(),l=g(),{mutate:d}=T({mutationFn:a=>p.patch(u.tickets.close+a,{status:"Closed"}),onSuccess:async()=>{f.success("Closed success!"),r.onFalse()},onSettled:async()=>{await l.invalidateQueries({queryKey:["tickets"]})},onError:a=>{}});return s.jsxs(s.Fragment,{children:[s.jsxs(b,{children:[s.jsx(D,{title:"Details"}),s.jsxs(t,{sx:{p:3},children:[s.jsxs(t,{direction:"row",justifyContent:"space-between",sx:{typography:"body2"},children:[s.jsxs(i,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[s.jsx(t,{direction:"row",sx:{typography:"subtitle2",marginBottom:1},children:s.jsx("div",{children:"Ticket Details"})}),s.jsxs(i,{sx:{color:"text.secondary"},children:["TICKET ID: ",e==null?void 0:e.id]}),s.jsxs(i,{sx:{color:"text.secondary"},children:["Member: ",`${e==null?void 0:e.member.firstName} ${e==null?void 0:e.member.lastName}`]}),s.jsxs(i,{sx:{color:"text.secondary"},children:["Topic: ",e==null?void 0:e.topic,"."]})]}),s.jsxs(i,{flexDirection:"column",alignItems:"center",gap:.5,sx:{display:"flex",width:"100%",p:1,borderRight:a=>`dashed 2px ${a.vars.palette.background.neutral}`,borderLeft:a=>`dashed 2px ${a.vars.palette.background.neutral}`},children:[s.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:s.jsx("div",{children:"Ticket Status"})}),s.jsx(i,{sx:{color:"text.secondary"},children:s.jsx(j,{variant:"soft",color:e.status==="Open"&&"info"||e.status==="Closed"&&"default"||"default",children:e.status})})]}),s.jsxs(i,{flexDirection:"column",alignItems:"center",sx:{p:1,display:"flex",width:"100%"},children:[s.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",gap:1,sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:s.jsx("div",{children:"Ticket Priority"})}),s.jsx(i,{sx:{color:"text.secondary"},children:s.jsx(j,{variant:"soft",color:(e==null?void 0:e.priority)==="Low"&&"success"||(e==null?void 0:e.priority)==="Medium"&&"warning"||(e==null?void 0:e.priority)==="Hight"&&"error"||"default",children:e==null?void 0:e.priority})})]})]}),s.jsx(i,{sx:{pt:5},children:s.jsx(c,{onClick:r.onTrue,disabled:e.status==="Closed",variant:"contained",startIcon:s.jsx(C,{icon:"carbon:checkmark-filled"}),children:"Mark as Closed"})})]})]}),s.jsx(es,{open:r.value,onClose:r.onFalse,handler:()=>d(e.id)})]})}const is=y.object({message:y.string().min(1,{message:"Name is required!"})}),ns=({ticket:e,messages:r})=>{const l={message:""},d=V({resolver:z(is),defaultValues:l}),{reset:a,handleSubmit:v,formState:{isSubmitting:as}}=d,h=g(),{mutate:w}=T({mutationFn:n=>p.post(u.tickets.createMessage,n),onSuccess:async()=>{f.success("Message Has Been Created!"),a()},onSettled:async()=>{const{id:n}=e;await h.invalidateQueries({queryKey:["tickets"]}),await h.invalidateQueries({queryKey:["tickets",n]})},onError:n=>{}}),I=v(async n=>{try{if(e.id){const o={...n};o.ticketId=e.id,w(o)}}catch(o){console.log(o),setErrorMsg(o instanceof Error?o.message:o)}}),S=s.jsxs(i,{sx:{pr:4,pl:4,pb:4,pt:2},children:[s.jsx(W,{sx:{p:0,m:0,[`& .${X.root}:before`]:{flex:0,padding:0}},children:s.jsx(M,{fillContent:!0,sx:{height:360},children:r==null?void 0:r.map((n,o)=>{const F=o===r.length-1;return s.jsxs(Y,{children:[s.jsxs(Z,{children:[s.jsx(_,{color:"primary"}),F?null:s.jsx(k,{})]}),s.jsx(ss,{children:s.jsxs(i,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(i,{children:[s.jsx(E,{variant:"subtitle2",children:n.createdBy.firstName}),s.jsx(i,{sx:{color:"text.disabled",typography:"caption",mt:.5},children:n.message})]}),s.jsx(i,{sx:{color:"text.disabled",typography:"caption"},children:q(n.createTime)})]})})]},n.id)})})}),s.jsx(J,{methods:d,onSubmit:I,children:s.jsxs(t,{justifyContent:"flex-end",spacing:1,sx:{marginTop:1},children:[s.jsx(t,{sx:{typography:"subtitle1",width:"100%",marginBottom:1},children:s.jsx("div",{children:"Send Reply:"})}),s.jsx(U.Text,{label:"Enter Description",name:"message",multiline:!0,rows:3,sx:{mb:2}}),s.jsx(i,{children:s.jsx(c,{type:"submit",variant:"contained",endIcon:s.jsx(C,{icon:"iconamoon:send-fill"}),children:"Send"})})]})})]});return s.jsxs(b,{children:[s.jsx(D,{title:"Previous Messages"}),S]})};function os({ticket:e}){return s.jsxs(L,{children:[s.jsx(G,{links:[{name:"Dashboard",href:x.dashboard.root},{name:"Tickets",href:x.dashboard.tickets.root},{name:"Ticket Details"}],sx:{mb:{xs:3,md:5}}}),s.jsxs(m,{container:!0,spacing:3,children:[s.jsx(m,{xs:12,md:9,children:s.jsx(t,{spacing:3,direction:{xs:"column-reverse",md:"column"},children:s.jsx(rs,{ticket:e})})}),s.jsx(m,{xs:12,md:3,children:s.jsx(ns,{ticket:e,messages:e==null?void 0:e.messages})})]})]})}const ts={title:`Ticket details | Dashboard - ${P.site.name}`};function _s(){const{id:e=""}=Q(),r=$({queryKey:["tickets",e],queryFn:async()=>{const{data:l}=await p.get(u.tickets.details+e);return l}});return r.isPending||r.isLoading?s.jsx(K,{}):r.isError?s.jsx(H,{route:x.dashboard.tickets.root}):s.jsxs(s.Fragment,{children:[s.jsx(N,{children:s.jsxs("title",{children:[" ",ts.title]})}),s.jsx(os,{ticket:r.data})]})}export{_s as default};

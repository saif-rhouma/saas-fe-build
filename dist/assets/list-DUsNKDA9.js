import{w as F,bG as z,j as e,aL as Y,y as U,I as f,dz as _,bI as $,bJ as R,e as M,r as p,dL as G,dM as C,dK as w,bM as b,D as J,S as E,B as A,T as X,dB as Q,dC as Z,eq as ee,eb as te,p as H,aF as se,er as ae,dN as L,ef as oe,H as ne,C as ie}from"./index-lMp9zap6.js";import{u as re,E as le}from"./error-block-DXWblvjp.js";import{u as v}from"./useMutation-B2tKEkiI.js";import{C as de}from"./custom-breadcrumbs-CnRCretL.js";import{u as ce,g as me,r as pe,T as he,a as ue,e as xe}from"./table-selected-action-Cgn9qQis.js";import{T as ge}from"./table-no-data-D5fgAy-Q.js";import{T as fe,a as je,b as be,c as Ce}from"./table-head-custom-BwAPFtwe.js";import{T as we}from"./table-pagination-custom-sK7wTfre.js";import{C as De}from"./confirm-dialog-CfE53hWp.js";import{T as S}from"./TableCell-ljoaX5oi.js";import{z as q,u as ye,t as Te,a as Se,F as P}from"./form-provider-Cj0Z9UsE.js";import{b as Pe}from"./upload-avatar-jEC4OtmL.js";import"./image-7Gw8g56m.js";import"./editor-56m6PEpo.js";import{s as W}from"./schema-helper-DOzR5VHI.js";import{a as Fe,b as ve,D as Ee}from"./DialogContent-B0tqVN_s.js";import{D as ke}from"./DialogTitle-BCkrw5VA.js";import{L as Be}from"./LoadingButton-BI3VwLzw.js";import{T as Ie}from"./TextField-BEm0Gfgz.js";import{I as Re}from"./InputAdornment-CznJJWQj.js";import{F as Le,a as qe,c as Ae}from"./filters-result-BnQFy5UF.js";import{C as He}from"./Chip-lc0vODcu.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-BfbryewD.js";import"./empty-content-v04S0NJf.js";import"./TablePagination-Dir7BHGy.js";import"./LastPage-B3GbPSnl.js";import"./Select-DE7_tqxX.js";import"./Menu-Di83eYAm.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-D6UR9yYG.js";import"./FormControlLabel-CSqTNcaw.js";import"./FormHelperText-CiWaMPMf.js";import"./Rating-D1epoFLf.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider--FnFNgPJ.js";import"./FormControl-BFlCQpvi.js";import"./FormLabel-CKyhTT_V.js";import"./RadioGroup-C-GnO1ca.js";import"./FormGroup-BE8TyzSB.js";import"./index-KeOEaw8h.js";import"./countries-DSLisFCy.js";import"./Autocomplete-DnVwYLlc.js";import"./country-select-DkXlsKd6.js";import"./InputLabel-D2FT-Pcv.js";import"./DatePicker-CRaT7_Tx.js";import"./ListItem-Eefms6HN.js";import"./MobileDateTimePicker-CghIhRUp.js";import"./format-number-BW6JEF9q.js";import"./index-DTyO1f1S.js";import"./CircularProgress-CX5vuYgb.js";const Me=({row:t,selected:s,onViewRow:n,onDeleteRow:i,onEditRow:m})=>{const r=F(),l=z(),c=e.jsxs(fe,{hover:!0,selected:s,children:[e.jsx(S,{children:t.id}),e.jsx(S,{children:Y(t.reminderDate)}),e.jsx(S,{children:t.title}),e.jsx(S,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(U,{color:l.open?"inherit":"default",onClick:l.onOpen,children:e.jsx(f,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[c,e.jsx(_,{open:l.open,anchorEl:l.anchorEl,onClose:l.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs($,{children:[(t==null?void 0:t.file)&&e.jsxs(R,{onClick:()=>{n(),l.onClose()},children:[e.jsx(f,{icon:"solar:cloud-download-bold"}),"Download"]}),e.jsxs(R,{onClick:()=>{m(),l.onClose()},children:[e.jsx(f,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(R,{onClick:()=>{r.onTrue(),l.onClose()},sx:{color:"error.main"},children:[e.jsx(f,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),e.jsx(De,{open:r.value,onClose:r.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(M,{variant:"contained",color:"error",onClick:i,children:"Delete"})})]})},Ke=q.object({title:q.string().min(1,{message:"title is required!"}),description:q.string().min(1,{message:"Description is required!"}),date:W.date({message:{required_error:"Date is required!"}}),time:W.date({message:{required_error:"Time is required!"}})}),V=({currentReminder:t,open:s,onClose:n,handler:i})=>{const m=p.useRef(t);//! Upload Logic START
const[r,l]=p.useState(),c=p.useCallback(d=>{const a=d[0];l(()=>a)},[]),x=()=>{l(null)},o=G(),u={headers:{"content-type":"multipart/form-data"}},{mutate:g}=v({mutationFn:d=>C.post(w.files.upload,d,u),onSuccess:async({data:d})=>{const{name:a}=d;if(a){const{current:h}=m;h.file=a,delete h.time,delete h.date,t?await i({id:t.id,payload:h}):await i(h)}return d},onSettled:async()=>{l(null),await o.invalidateQueries({queryKey:["reminders-images"]})},onError:d=>{console.log(d)}});//! Upload Logic END
const D=p.useMemo(()=>({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",date:(t==null?void 0:t.reminderDate)||b(),time:(t==null?void 0:t.reminderDate)||b()}),[t]);p.useEffect(()=>{t&&T(D)},[t]);const y=ye({resolver:Te(Ke),defaultValues:D}),{reset:T,watch:K,setValue:N,handleSubmit:j,formState:{isSubmitting:O}}=y,k=j(async d=>{try{const a=b(d.date).format("YYYY-MM-DD"),h=b(d.time).format("HH:mm:ss"),B=b(`${a}T${h}`).toISOString();if(d.reminderDate=B,r){m.current={...d};const I=new FormData;I.append("file",r),I.append("category","Reminder"),await g(I)}else t?await i({id:t.id,payload:d}):await i(d);n(),m.current={},T()}catch(a){console.error(a)}});return e.jsxs(Fe,{fullWidth:!0,maxWidth:"md",open:s,onClose:n,children:[e.jsx(ke,{children:t?"Edit Reminder":"Add Reminder"}),e.jsxs(Se,{methods:y,onSubmit:k,children:[e.jsxs(ve,{children:[e.jsx(J,{}),e.jsxs(E,{spacing:2,sx:{pt:4,pb:1},children:[e.jsxs(A,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[e.jsx(P.DatePicker,{fullWidth:!0,label:"Date",name:"date",sx:{flexGrow:1}}),e.jsx(P.TimePicker,{label:"Time",name:"time",sx:{flexGrow:1}}),e.jsx(P.Text,{fullWidth:!0,name:"title",label:"Title",sx:{flexGrow:1}}),e.jsx(P.Text,{fullWidth:!0,name:"description",label:"Description",sx:{flexGrow:1}})]}),e.jsx(A,{children:e.jsxs(E,{spacing:1.5,children:[e.jsx(X,{variant:"subtitle2",children:"Attachments"}),e.jsx(Q,{sx:{maxHeight:360,p:2},children:e.jsx(Pe,{value:r,onDrop:c,onDelete:x})})]})})]})]}),e.jsxs(Ee,{children:[e.jsx(Be,{type:"submit",variant:"contained",children:t?"Save Changes":"Save"}),e.jsx(M,{color:"inherit",variant:"outlined",onClick:n,children:"Cancel"})]})]})]})},Ne=({reminder:t,open:s,onClose:n,handler:i})=>e.jsx(V,{currentReminder:t,open:s,onClose:n,handler:i});function Oe({filters:t,onResetPage:s,options:n}){const i=p.useCallback(m=>{s(),t.setState({name:m.target.value})},[t,s]);return e.jsx(E,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(Ie,{sx:{width:420},value:t.state.name,onChange:i,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(Re,{position:"start",children:e.jsx(f,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}function We({filters:t,totalResults:s,onResetPage:n,sx:i}){const m=p.useCallback(()=>{n(),t.setState({name:""})},[t,n]),r=p.useCallback(()=>{n(),t.onResetState()},[t,n]);return e.jsx(Le,{totalResults:s,onReset:r,sx:i,children:e.jsx(qe,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(He,{...Ae,label:t.state.name,onDelete:m})})})}const Ge=[{id:"reminderId",label:"#",width:140},{id:"date",label:"Date",width:280},{id:"title",label:"Title"},{id:"",width:88}],Qe=({reminders:t})=>{const s=ce({defaultOrderBy:"orderNumber"}),n=F(),i=F(),m=F(),[r,l]=p.useState(t),c=Z({name:"",status:"all",startDate:null,endDate:null}),x=ee(c.state.startDate,c.state.endDate);p.useEffect(()=>{l(t)},[t]);const o=Ve({inputData:r,comparator:me(s.order,s.orderBy),filters:c.state,dateError:x}),u=pe(o,s.page,s.rowsPerPage),g=!!c.state.name||c.state.status!=="all"||!!c.state.startDate&&!!c.state.endDate,D=!o.length&&g||!o.length,y=p.useCallback(a=>{O(a)},[u.length,s,r]),[T,K]=p.useState(),N=p.useCallback(a=>{K(a),i.onToggle()},[u.length,s,r]),j=G(),{mutate:O}=v({mutationFn:a=>C.delete(w.reminders.delete+a),onSuccess:async a=>{const h=r.filter(B=>B.id!==a);L.success("Delete success!"),l(h),s.onUpdatePageDeleteRow(u.length),m.onFalse()},onSettled:async()=>{await j.invalidateQueries({queryKey:["reminders"]}),m.onFalse()},onError:()=>{}}),{mutate:k}=v({mutationFn:a=>C.post(w.reminders.create,a),onSuccess:async()=>{L.success("New Reminder Has Been Created!")},onSettled:async()=>{await j.invalidateQueries({queryKey:["reminders"]}),n.onClose()},onError:a=>{console.log(a)}}),{mutate:d}=v({mutationFn:({id:a,payload:h})=>C.patch(w.reminders.edit+a,h),onSuccess:async()=>{L.success("New Reminder Has Been Modified!")},onSettled:async()=>{await j.invalidateQueries({queryKey:["reminders"]}),i.onClose()},onError:a=>{console.log(a)}});return e.jsxs(e.Fragment,{children:[e.jsx(te,{maxWidth:"xl",children:e.jsxs(E,{spacing:3,children:[e.jsx(de,{links:[{name:"Dashboard",href:H.dashboard.root},{name:"Reminders",href:H.dashboard.reminders.root}],action:e.jsx(M,{onClick:()=>n.onToggle(),variant:"contained",startIcon:e.jsx(f,{icon:"mingcute:add-line"}),children:"Add Reminder"})}),e.jsxs(se,{children:[e.jsx(Oe,{filters:c,onResetPage:s.onResetPage,dateError:x}),g&&e.jsx(We,{filters:c,totalResults:o.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(A,{sx:{position:"relative"},children:[e.jsx(he,{dense:s.dense,numSelected:s.selected.length,rowCount:o.length}),e.jsx(Q,{sx:{minHeight:444},children:e.jsxs(je,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(be,{order:s.order,orderBy:s.orderBy,headLabel:Ge,rowCount:o.length}),e.jsxs(Ce,{children:[o.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(a=>e.jsx(Me,{row:a,selected:s.selected.includes(a.id),onEditRow:()=>N(a),onDeleteRow:()=>y(a.id),onViewRow:()=>handleViewRow(a.id)},a.id)),e.jsx(ue,{height:s.dense?56:76,emptyRows:xe(s.page,s.rowsPerPage,o.length)}),e.jsx(ge,{notFound:D})]})]})})]}),e.jsx(we,{page:s.page,dense:s.dense,count:o.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})]})}),e.jsx(V,{open:n.value,onClose:n.onFalse,handler:k}),e.jsx(Ne,{reminder:T,open:i.value,onClose:i.onFalse,handler:d})]})};function Ve({inputData:t,comparator:s,filters:n,dateError:i}){const{status:m,name:r,startDate:l,endDate:c}=n,x=t.map((o,u)=>[o,u]);return x.sort((o,u)=>{const g=s(o[0],u[0]);return g!==0?g:o[1]-u[1]}),t=x.map(o=>o[0]),r&&(t=t.filter(o=>o.id.toString().toLowerCase().indexOf(r.toLowerCase())!==-1||o.title.toLowerCase().indexOf(r.toLowerCase())!==-1||o.description.toLowerCase().indexOf(r.toLowerCase())!==-1)),m!=="all"&&(t=t.filter(o=>o.status===m)),i||l&&c&&(t=t.filter(o=>ae(o.createdAt,l,c))),t}const ze={title:`Reminders list | Dashboard - ${ie.site.name}`};function Yt(){const t=re({queryKey:["reminders"],queryFn:async()=>{const{data:s}=await C.get(w.reminders.list);return s}});return t.isPending||t.isLoading?e.jsx(oe,{}):t.isError?e.jsx(le,{route:H.dashboard.reminders.root}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsxs("title",{children:[" ",ze.title]})}),e.jsx(Qe,{reminders:t.data})]})}export{Yt as default};

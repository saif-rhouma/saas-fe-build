import{o as R,r as a,bO as j,dN as G,dO as y,dM as C,dP as P,p as I,j as s,aH as D,S as c,I as K,B as d,G as u,e as S}from"./index-BPQkDe0s.js";import{u as b}from"./useMutation-BoBY0b1e.js";import{P as L}from"./product-Item-button-DoRkn7dE.js";import{P as W}from"./plan-product-table-DcOGnYJF.js";import{T as q}from"./TextField-Bi7NVwCq.js";import{I as J}from"./InputAdornment-Ck59aR0s.js";import{D as z}from"./DatePicker-BGXln9IR.js";function se({products:l,plan:n}){const m=R(),[k,h]=a.useState(),[x,f]=a.useState(j(new Date)),[r,o]=a.useState([]),[w,p]=a.useState(l),g=G(),F="http://localhost:3000/api/files/show/";a.useEffect(()=>{n&&(n.product.quantity=n.quantity,o([n.product]),h(n.id),f(j(n.planDate)))},[n]);const{mutate:O}=b({mutationFn:e=>y.post(C.plan.create,e),onSuccess:async()=>{P.success("New Plan Has Been Created!")},onSettled:async()=>{await g.invalidateQueries({queryKey:["plans"]}),m.push(I.dashboard.plan.root)},onError:()=>{}}),{mutate:B}=b({mutationFn:({id:e,payload:t})=>y.patch(C.plan.edit+e,t),onSuccess:async()=>{P.success("Plan Has Been Modified!")},onSettled:async()=>{await g.invalidateQueries({queryKey:["plans"]}),m.push(I.dashboard.plan.root)},onError:e=>{console.log(e)}}),E=a.useCallback(e=>{h(e.target.value)},[]),M=a.useCallback(e=>{const t=e.target.value;t&&p(l.filter(i=>i.name.toLowerCase().indexOf(t)!==-1)),(t==null||t==="")&&p(l)},[l]),T=a.useCallback(e=>{o(t=>{const i=t.findIndex(Q=>Q.id===e.id);return i>=0?t[i].quantity+=1:t.length===0&&(e.quantity=1,t.push(e)),[...t]})},[r]),v=a.useCallback(e=>{o(t=>(t[e].quantity-=1,t[e].quantity===0&&t.splice(e,1),[...t]))},[r]),A=a.useCallback(e=>{o(t=>(t[e].quantity+=1,[...t]))},[r]),H=a.useCallback(e=>{o(t=>(t.splice(e,1),[...t]))},[r]),N=s.jsx(D,{children:s.jsxs(c,{spacing:4,sx:{p:3},children:[s.jsx(q,{fullWidth:!0,maxWidth:"xs",placeholder:"Search customer or order number...",InputProps:{startAdornment:s.jsx(J,{position:"start",children:s.jsx(K,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},onChange:M}),s.jsx(d,{spacing:2,gap:3,display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:w.map(e=>s.jsx(L,{payload:e,handleClick:T,productName:e==null?void 0:e.name,image:F+(e==null?void 0:e.image)},e==null?void 0:e.id))})]})}),Y=s.jsx(D,{children:s.jsxs(c,{spacing:2,sx:{p:3},children:[s.jsxs(d,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[s.jsx(q,{label:"Plan ID",value:k,onChange:E,sx:{mt:2}}),s.jsx(z,{label:"Date",sx:{mt:2},value:x,onChange:e=>{f(e)}})]}),s.jsx(W,{products:r,onDecrease:v,onIncrease:A,removeItem:H}),s.jsx(d,{display:"flex",flexDirection:"column",alignItems:"flex-end",justifyContent:"center",children:s.jsxs(d,{display:"flex",gap:2,height:50,children:[s.jsx(S,{variant:"contained",onClick:()=>{if(r.length){const e={planDate:x.format("YYYY-MM-DD"),productId:r[0].id,quantity:r[0].quantity};n?B({id:n.id,payload:e}):O(e)}},children:n?"Save Changes":"Save"}),s.jsx(S,{variant:"outlined",onClick:()=>o([]),children:"Clear All"})]})})]})});return s.jsxs(u,{container:!0,spacing:3,children:[s.jsx(u,{xs:12,md:4,children:s.jsx(c,{children:N})}),s.jsx(u,{xs:12,md:8,children:s.jsx(c,{children:Y})})]})}export{se as P};

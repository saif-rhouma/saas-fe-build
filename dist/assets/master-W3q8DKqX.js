import{r as l,C as p,dm as V,dn as u,dl as h,dp as Y,cL as _,j as r,aB as T,S as g,T as x,B as j,b9 as B,e as L,dP as J,p as E,dT as Z,H as W}from"./index-CDcUgrfM.js";import{u as X,E as R}from"./error-block-XWJxuTVo.js";import{C as A}from"./custom-breadcrumbs-BL_vTuJF.js";import{z as n,c as ee,u as re,t as se,a as te,F as i}from"./form-provider-DPEGnoLi.js";import{u as c}from"./useMutation-BWrcWSYi.js";import{a as M}from"./format-number-K3MYeV6b.js";import{b as ae,U as ne}from"./upload-avatar-D77EIrlr.js";import"./editor-CGxeH7db.js";import{s as ie}from"./schema-helper-BqX8D7s6.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./TextField-BuUBnZDj.js";import"./FormControl-C7WzToVA.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-DFNFmoZn.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-e37nWMJI.js";import"./Select-BZojGQgr.js";import"./Menu--HgoqF6K.js";import"./InputBase-jbxmQqqV.js";import"./FormHelperText-CpMJHbvL.js";import"./Rating-w3dgxeCA.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-Cc_JEzEp.js";import"./RadioGroup-SuhSugdB.js";import"./FormGroup-D7ycBH1u.js";import"./FormControlLabel-C9Nh_YCW.js";import"./index-DkkRrZbX.js";import"./countries-DSLisFCy.js";import"./InputAdornment-C4RBZEHJ.js";import"./Autocomplete-BXgXmYj0.js";import"./Chip-CVtkDWmm.js";import"./country-select-BMAkVgNz.js";import"./Checkbox-BxyuHg5r.js";import"./DatePicker-D6wu5-8l.js";import"./DialogContent-B3AK0H-W.js";import"./ListItem-D2_hmcct.js";import"./MobileDateTimePicker-BKtNADfB.js";import"./Tabs-0KFgPQsD.js";import"./KeyboardArrowRight-BY3fczxh.js";import"./image-C4WktV16.js";import"./index-h55rDlR6.js";const me=n.object({name:n.string().min(1,{message:"Staff First Name is required!"}),description:n.string(),email:n.string().min(1,{message:"Email is required!"}).email({message:"Email must be a valid email address!"}),phoneNumber:ie.phoneNumber({isValidPhoneNumber:ee}),currencySymbol:n.string().min(1,{message:"Staff Last Name is required!"}),taxPercentage:n.number().min(1,{message:"Staff Last Name is required!"}),country:n.string().min(1,{message:"Country is required!"}),state:n.string(),street:n.string(),city:n.string(),district:n.string(),zipCode:n.string(),taxNumber:n.number(),printerPOS:n.string().min(1,{message:"Printer POS is required!"})}),oe=({applicationAccount:s,financial:S})=>{const y=l.useRef(s),[f,P]=l.useState(null),[b,D]=l.useState(null);l.useEffect(()=>{s&&(O(N),P(`${p.site.serverFileHost}${s.favicon}`),D(`${p.site.serverFileHost}${s.appLogo}`))},[s]);const N=l.useMemo(()=>{var e,t,a,m,o,d;return{name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",email:(s==null?void 0:s.email)||"",phoneNumber:(s==null?void 0:s.phoneNumber)||"",currencySymbol:(s==null?void 0:s.currencySymbol)||"",taxPercentage:(s==null?void 0:s.taxPercentage)||"",country:((e=s==null?void 0:s.address)==null?void 0:e.country)||"",state:((t=s==null?void 0:s.address)==null?void 0:t.state)||"",city:((a=s==null?void 0:s.address)==null?void 0:a.city)||"",district:((m=s==null?void 0:s.address)==null?void 0:m.district)||"",zipCode:((o=s==null?void 0:s.address)==null?void 0:o.zipCode)||"",street:((d=s==null?void 0:s.address)==null?void 0:d.street)||"",printerPOS:(s==null?void 0:s.printerPOS)||""}},[s]),q=re({resolver:se(me),defaultValues:N}),{reset:O,watch:xe,setValue:ge,handleSubmit:k,control:ue,formState:{isSubmitting:he}}=q,$=k(async e=>{try{if(e.city||e.country||e.district||e.state||e.street||e.zipCode){const{country:t,state:a,city:m,district:o,zipCode:d,street:w}=e;e.address={country:t,state:a,city:m,district:o,zipCode:d,street:w},delete e.city,delete e.country,delete e.district,delete e.state,delete e.street,delete e.zipCode}if(y.current={...e},f&&b){const t=new FormData;t.append("file",f),t.append("category","AppAvatar");const a=new FormData;a.append("file",b),a.append("category","AppLogo"),await I({avatar:t,logo:a})}else if(f){const t=new FormData;t.append("file",f),t.append("category","AppAvatar"),await K(t)}else if(b){const t=new FormData;t.append("file",b),t.append("category","AppLogo"),await Q(t)}else await C(e)}catch(t){console.error(t)}}),G=l.useCallback(e=>{const t=e[0];P(t)},[]),U=l.useCallback(e=>{const t=e[0];D(()=>t)},[]),H=()=>{D(null)},v={headers:{"content-type":"multipart/form-data"}},z=l.useCallback(e=>{const t=document.querySelector("link[rel~='icon']")||document.createElement("link");t.type="image/x-icon",t.rel="icon",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)},[]),F=V(),{mutate:K}=c({mutationFn:e=>u.post(h.files.upload,e,v),onSuccess:async({data:e})=>{const{name:t}=e;if(t){const{current:a}=y;a.favicon=t,z(`${p.site.serverFileHost}${t}`),await C(a)}return e},onSettled:async()=>{await F.invalidateQueries({queryKey:["appAvatar-images"]})},onError:e=>{console.log(e)}}),{mutate:Q}=c({mutationFn:e=>u.post(h.files.upload,e,v),onSuccess:async({data:e})=>{const{name:t}=e;if(t){const{current:a}=y;a.appLogo=t,await C(a)}return e},onSettled:async()=>{await F.invalidateQueries({queryKey:["appAvatar-images"]})},onError:e=>{console.log(e)}}),{mutate:I}=c({mutationFn:async({avatar:e,logo:t})=>{const a=await u.post(h.files.upload,e,v),m=await u.post(h.files.upload,t,v);return{avatarRes:a,logoRes:m}},onSuccess:async({avatarRes:e,logoRes:t})=>{var d,w;const a=(d=e==null?void 0:e.data)==null?void 0:d.name,m=(w=t==null?void 0:t.data)==null?void 0:w.name,{current:o}=y;m&&(o.appLogo=m),a&&(o.favicon=a),z(`${p.site.serverFileHost}${a}`),await C(o)},onSettled:async()=>{await F.invalidateQueries({queryKey:["appAvatar-images"]})},onError:e=>{console.log(e)}}),{mutate:C}=c({mutationFn:e=>u.patch(h.master.edit,e),onSuccess:async()=>{Y.success("Master Account Has Been Modified!");const{currencySymbol:e}=y.current;localStorage.setItem(_,e)},onSettled:async()=>{await F.invalidateQueries({queryKey:["account-application"]})},onError:e=>{console.log(e)}});return r.jsxs(te,{methods:q,onSubmit:$,children:[r.jsx(T,{sx:{mb:4},children:r.jsxs(g,{spacing:2,sx:{p:3},children:[r.jsx(x,{variant:"h6",gutterBottom:!0,children:"Organization Details"}),r.jsxs(j,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[r.jsx(i.Text,{name:"name",label:"Organization Name"}),r.jsx(i.Phone,{name:"phoneNumber",label:"Phone number"}),r.jsx(i.Text,{name:"email",label:"Email address"}),r.jsx(i.Text,{name:"description",label:"Description"}),r.jsxs(g,{spacing:1.5,children:[r.jsx(x,{variant:"subtitle2",children:"Attachments"}),r.jsx(ae,{value:b,onDrop:U,onDelete:H})]}),r.jsxs(g,{spacing:1.5,children:[r.jsx(x,{variant:"subtitle2",children:"Favicon"}),r.jsx(ne,{value:f,onDrop:G,validator:e=>e.size>1e6?{code:"file-too-large",message:`File is larger than ${M(1e6)}`}:null,helperText:r.jsxs(x,{variant:"caption",sx:{mt:3,mx:"auto",display:"block",textAlign:"center",color:"text.disabled"},children:["Allowed *.jpeg, *.jpg, *.png, *.gif",r.jsx("br",{})," max size of ",M(3145728)]})})]})]})]})}),r.jsx(T,{sx:{mb:4},children:r.jsxs(g,{spacing:2,sx:{p:3},children:[r.jsx(x,{variant:"h6",gutterBottom:!0,children:"Finance Setting"}),r.jsxs(j,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[r.jsx(i.Text,{name:"currencySymbol",label:"Currency Symbol"}),r.jsx(i.Text,{name:"taxPercentage",label:"Tax Percentage"})]})]})}),r.jsx(T,{sx:{mb:4},children:r.jsxs(g,{spacing:2,sx:{p:3},children:[r.jsx(x,{variant:"h6",gutterBottom:!0,children:"Firm Address"}),r.jsxs(j,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[r.jsx(i.CountrySelect,{name:"country",label:"Country",placeholder:"Choose a country"}),r.jsx(i.Text,{name:"state",label:"State/region"}),r.jsx(i.Text,{name:"city",label:"City"}),r.jsx(i.Text,{name:"district",label:"District"}),r.jsx(i.Text,{name:"zipCode",label:"Zip/code"}),r.jsx(i.Text,{name:"street",label:"Address"}),r.jsx(i.Text,{type:"number",name:"taxNumber",label:"Store Tax Number"})]})]})}),r.jsx(T,{sx:{mb:4},children:r.jsxs(g,{spacing:2,sx:{p:3},children:[r.jsx(x,{variant:"h6",gutterBottom:!0,children:"Other Settings"}),r.jsx(j,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:r.jsxs(i.Select,{name:"printerPOS",label:"Printer POS",sx:{width:420,textTransform:"capitalize"},children:[r.jsx(B,{value:"A4",children:"A4"}),r.jsx(B,{value:"Thermal",children:"Thermal"})]})})]})}),r.jsxs(j,{display:"flex",justifyContent:"flex-end",gap:2,mt:2,children:[r.jsx(L,{type:"submit",variant:"contained",children:"Save Changes"}),r.jsx(L,{variant:"outlined",children:"Cancel"})]})]})},le=({applicationAccount:s,financial:S})=>r.jsxs(J,{children:[r.jsx(A,{links:[{name:"Dashboard",href:E.dashboard.root},{name:"Settings",href:E.dashboard.tools.root},{name:"Master Settings"}],sx:{mb:{xs:3,md:5}}}),r.jsx(oe,{applicationAccount:s,financial:S})]}),de={title:`Tools | Dashboard - ${p.site.name}`};function ar(){const s=X({queryKey:["account-application"],queryFn:async()=>{const{data:S}=await u.get(h.auth.application);return S}});return s.isLoading?r.jsx(Z,{}):s.isError?r.jsx(R,{route:E.dashboard.tools.root}):r.jsxs(r.Fragment,{children:[r.jsx(W,{children:r.jsxs("title",{children:[" ",de.title]})}),r.jsx(le,{applicationAccount:s.data})]})}export{ar as default};

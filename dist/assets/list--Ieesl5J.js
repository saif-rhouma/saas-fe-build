import{w as B,bG as L,r as m,j as e,bL as N,y as w,I as g,dz as K,bI as q,ep as j,bJ as T,e as D,S as E,o as H,dC as M,er as O,dL as Q,p as x,eb as _,R as z,aF as $,B as G,dB as J,es as W,dM as y,dK as P,dN as R,ef as U,H as V,C as X}from"./index-Bm3rBIkL.js";import{u as Y,E as Z}from"./error-block-BO5MDXKX.js";import{u as F}from"./useMutation-BPy7H-1h.js";import{C as ee}from"./custom-breadcrumbs-DgyWxDBR.js";import{P as b}from"./permission-access-controller-Bd1g1bvY.js";import{u as te,g as se,r as ae,T as ne,a as oe,e as re}from"./table-selected-action-FGFYoCf9.js";import{T as ie}from"./table-no-data-C5ESOE9S.js";import{T as le,a as de,b as ce,c as me}from"./table-head-custom-fAI8azNC.js";import{T as he}from"./table-pagination-custom-B5OCrP_3.js";import{C as ue}from"./confirm-dialog-CdiBdWQ6.js";import{T as p}from"./TableCell-DwZUj5h4.js";import{T as fe}from"./TextField-Zaq0_UQI.js";import{I as pe}from"./InputAdornment-C5fdA_pt.js";import{F as xe,a as ge,c as je}from"./filters-result-VXglGh15.js";import{C as be}from"./Chip-wb6jkBj9.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-DZc8qiZw.js";import"./empty-content-Bj3fPw3b.js";import"./TablePagination-xS2VmU8P.js";import"./LastPage-Bo5KhWUM.js";import"./Select-BbFY65UU.js";import"./Menu-BCmDYN65.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-CLwZiNSB.js";import"./FormControlLabel-3udn0dpo.js";import"./DialogContent-adXfkuCx.js";import"./DialogTitle-3zwXmVtf.js";import"./FormControl-Dpp_E6i1.js";import"./InputLabel-XKr5fbZR.js";import"./FormLabel-CW4sUJth.js";import"./FormHelperText-D4MtsGiu.js";const Ce=({row:t,selected:s,onEditRow:i,onDeleteRow:d,handler:c})=>{const n=B(),l=L(),[r,h]=m.useState(t==null?void 0:t.isActive);m.useEffect(()=>{h(t==null?void 0:t.isActive)},[t]);const o=f=>()=>{h(!r),c({id:f,payload:{isActive:!r}})},u=e.jsxs(le,{hover:!0,selected:s,children:[e.jsx(p,{children:t==null?void 0:t.id}),e.jsx(p,{children:`${t==null?void 0:t.firstName} ${t==null?void 0:t.lastName}`}),e.jsx(p,{children:t==null?void 0:t.phoneNumber}),e.jsx(p,{children:t==null?void 0:t.email}),e.jsx(p,{children:e.jsx(N,{checked:r,onChange:o(t.id),color:"primary"})}),e.jsx(p,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(w,{color:l.open?"inherit":"default",onClick:l.onOpen,children:e.jsx(g,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[u,e.jsx(K,{open:l.open,anchorEl:l.anchorEl,onClose:l.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(q,{children:[e.jsx(b,{permission:j.EDIT_STAFF,children:e.jsxs(T,{onClick:()=>{i()},children:[e.jsx(g,{icon:"solar:pen-bold"}),"Edit"]})}),e.jsx(b,{permission:j.DELETE_STAFF,children:e.jsxs(T,{onClick:()=>{n.onTrue(),l.onClose()},sx:{color:"error.main"},children:[e.jsx(g,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})})]})}),e.jsx(ue,{open:n.value,onClose:n.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(D,{variant:"contained",color:"error",onClick:d,children:"Delete"})})]})};function Se({filters:t,onResetPage:s,options:i}){const d=m.useCallback(c=>{s(),t.setState({name:c.target.value})},[t,s]);return e.jsx(E,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(fe,{sx:{width:420},value:t.state.name,onChange:d,placeholder:"Search staff or email...",InputProps:{startAdornment:e.jsx(pe,{position:"start",children:e.jsx(g,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}function ye({filters:t,totalResults:s,onResetPage:i,sx:d}){const c=m.useCallback(()=>{i(),t.setState({name:""})},[t,i]),n=m.useCallback(()=>{i(),t.onResetState()},[t,i]);return e.jsx(xe,{totalResults:s,onReset:n,sx:d,children:e.jsx(ge,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(be,{...je,label:t.state.name,onDelete:c})})})}const Pe=[{id:"reminderId",label:"#",width:140},{id:"staffName",label:"Staff Name",width:280},{id:"phoneNumber",label:"Phone Number"},{id:"emailAddress",label:"Email Address"},{id:"status",label:"Status"},{id:"",width:88}],Te=({staffs:t})=>{const s=te({defaultOrderBy:"orderNumber"}),i=H(),[d,c]=m.useState(t),n=M({name:"",status:"all",startDate:null,endDate:null});m.useEffect(()=>{c(t)},[t]);const l=O(n.state.startDate,n.state.endDate),r=Re({inputData:d,comparator:se(s.order,s.orderBy),filters:n.state,dateError:l}),h=ae(r,s.page,s.rowsPerPage),o=!!n.state.name||n.state.status!=="all"||!!n.state.startDate&&!!n.state.endDate,u=!r.length&&o||!r.length,f=m.useCallback(a=>{A(a)},[h.length,s,d]),C=Q(),{mutate:v}=F({mutationFn:async({id:a,payload:S})=>(await y.patch(P.staff.edit+a,S),a),onSuccess:async a=>{R.success("Staff Has Been Modified!"),await C.invalidateQueries({queryKey:["staff",a]})},onSettled:async()=>{await C.invalidateQueries({queryKey:["staffs"]})},onError:a=>{console.log(a)}}),{mutate:A}=F({mutationFn:a=>y.delete(P.staff.delete+a),onSuccess:async a=>{const S=d.filter(k=>k.id!==a);R.success("Delete success!"),c(S),s.onUpdatePageDeleteRow(h.length)},onSettled:async()=>{await C.invalidateQueries({queryKey:["staffs"]})},onError:()=>{}}),I=m.useCallback(a=>{i.push(x.dashboard.staff.edit(a))},[i]);return e.jsx(_,{maxWidth:"xl",children:e.jsxs(E,{spacing:3,children:[e.jsx(ee,{links:[{name:"Dashboard",href:x.dashboard.root},{name:"Staff",href:x.dashboard.staff.root}],action:e.jsx(b,{permission:j.ADD_STAFF,children:e.jsx(D,{component:z,href:x.dashboard.staff.new,variant:"contained",startIcon:e.jsx(g,{icon:"mingcute:add-line"}),children:"Add New Staff"})})}),e.jsx(b,{permission:j.STAFF_LIST,children:e.jsxs($,{children:[e.jsx(Se,{filters:n,onResetPage:s.onResetPage,dateError:l}),o&&e.jsx(ye,{filters:n,totalResults:r.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(G,{sx:{position:"relative"},children:[e.jsx(ne,{dense:s.dense,numSelected:s.selected.length,rowCount:r.length}),e.jsx(J,{sx:{minHeight:444},children:e.jsxs(de,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(ce,{order:s.order,orderBy:s.orderBy,headLabel:Pe,rowCount:r.length}),e.jsxs(me,{children:[r.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(a=>e.jsx(Ce,{row:a,selected:s.selected.includes(a.id),onSelectRow:()=>s.onSelectRow(a.id),onDeleteRow:()=>f(a.id),onEditRow:()=>I(a.id),handler:v},a.id)),e.jsx(oe,{height:s.dense?56:76,emptyRows:re(s.page,s.rowsPerPage,r.length)}),e.jsx(ie,{notFound:u})]})]})})]}),e.jsx(he,{page:s.page,dense:s.dense,count:r.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})]})})};function Re({inputData:t,comparator:s,filters:i,dateError:d}){const{status:c,name:n,startDate:l,endDate:r}=i,h=t.map((o,u)=>[o,u]);return h.sort((o,u)=>{const f=s(o[0],u[0]);return f!==0?f:o[1]-u[1]}),t=h.map(o=>o[0]),n&&(t=t.filter(o=>o.id.toString().toLowerCase().indexOf(n.toLowerCase())!==-1||o.staffName.toLowerCase().indexOf(n.toLowerCase())!==-1)),c!=="all"&&(t=t.filter(o=>o.status===c)),d||l&&r&&(t=t.filter(o=>W(o.createdAt,l,r))),t}const Fe={title:`Staff list | Dashboard - ${X.site.name}`};function it(){const t=Y({queryKey:["staffs"],queryFn:async()=>{const{data:s}=await y.get(P.staff.list);return s}});return t.isPending||t.isLoading?e.jsx(U,{}):t.isError?e.jsx(Z,{route:x.dashboard.staff.root}):e.jsxs(e.Fragment,{children:[e.jsx(V,{children:e.jsxs("title",{children:[" ",Fe.title]})}),e.jsx(Te,{staffs:t.data})]})}export{it as default};

import{dn as V,g as z,r as d,i as R,dp as w,dm as y,dq as r,p as h,j as i,aB as N,S as J,T as I,B as b,l as L,I as $,b8 as F,e as A,dP as H}from"./index-oyszM3Nj.js";import{C as K}from"./custom-breadcrumbs-BfQvIxyX.js";import{z as m,u as O,t as U,a as W,F as n}from"./form-provider-DVH46um2.js";import{u as B}from"./useMutation-CrU_O3n6.js";import"./image-D4xzDEh_.js";import"./editor-BBBPXrhA.js";import{I as X}from"./InputAdornment-CcMUVLGV.js";const Y=m.object({firstName:m.string().min(1,{message:"Staff firstName is required!"}),password:m.string().min(1,{message:"Password is required!"}).min(8,{message:"Password must be at least 8 characters!"}),email:m.string().min(1,{message:"Email is required!"}),permissions:m.string().array().nonempty({message:"At least one permission is required!"}),isActive:m.boolean(),permissionsGroup:m.number()});function Z({currentStaff:s,appPermissions:a,appPermissionsGroup:l}){const j=V(),g=z(),[_,E]=d.useState(a),[T,C]=d.useState(!1),p=R(),x=d.useMemo(()=>({firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",phoneNumber:(s==null?void 0:s.phoneNumber)||"",email:(s==null?void 0:s.email)||"",password:(s==null?void 0:s.password)||"",isActive:(s==null?void 0:s.isActive)===void 0?!0:s==null?void 0:s.isActive,permissions:(s==null?void 0:s.permissions.map(e=>e.slug))||[],permissionsGroup:(s==null?void 0:s.permissionsGroup)||null}),[s]),v=O({resolver:U(Y),defaultValues:x}),{reset:t,watch:k,setValue:u,handleSubmit:G,control:S,formState:{isSubmitting:q}}=v;k(),d.useEffect(()=>{s&&t(x),a&&E(a)},[s,a,x,t]);const{mutate:M}=B({mutationFn:e=>w.post(y.staff.create,e),onSuccess:()=>{r.success("New Staff has been created successfully!"),j.invalidateQueries(["staff"]),t(),g.push(h.dashboard.staff.root)},onError:e=>{console.error(e),r.error("Failed to save staff. Please try again.")}}),{mutate:D}=B({mutationFn:({id:e,payload:o})=>w.patch(y.staff.edit+e,o),onSuccess:()=>{r.success("Staff updated successfully!");const{id:e}=s;j.invalidateQueries(["staff",e]),t(),g.push(h.dashboard.staff.root)},onError:e=>{console.error(e),r.error("Failed to edit staff. Please try again.")}}),P=G(async e=>{e.permissionsGroup!==0&&delete e.permissions;try{if(s!=null&&s.id){const{id:o}=s;await D({id:o,payload:e})}else await M(e)}catch(o){console.error(o)}});return i.jsxs(W,{methods:v,onSubmit:P,children:[i.jsx(N,{sx:{mb:4},children:i.jsxs(J,{spacing:4,sx:{p:3},children:[i.jsx(I,{variant:"h6",gutterBottom:!0,children:"Staff Details"}),i.jsxs(b,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(3, 1fr)"},children:[i.jsx(n.Text,{label:"First Name",name:"firstName"}),i.jsx(n.Text,{label:"Email",name:"email"}),i.jsx(n.Phone,{name:"phoneNumber",label:"Phone number"}),i.jsx(n.Text,{name:"password",label:"Password",placeholder:"8+ characters",type:p.value?"text":"password",InputLabelProps:{shrink:!0},InputProps:{endAdornment:i.jsx(X,{position:"end",children:i.jsx(L,{onClick:p.onToggle,edge:"end",children:i.jsx($,{icon:p.value?"solar:eye-bold":"solar:eye-closed-bold"})})})}}),(l==null?void 0:l.length)>0&&i.jsxs(n.Select,{name:"permissionsGroup",label:"Choose Permissions Group",sx:{width:420,textTransform:"capitalize"},onChange:e=>{const{value:o}=e.target;if(o){const Q=l.find(c=>c.id===o);u("permissions",Q.permissions.map(c=>c.slug)),u("permissionsGroup",o),C(!1)}},children:[l.map(e=>i.jsx(F,{value:e.id,children:`${e==null?void 0:e.name}`},e.id)),T&&i.jsx(F,{value:0,children:"Custom"})]})]})]})}),i.jsxs(N,{sx:{p:4},children:[i.jsx(I,{variant:"h6",gutterBottom:!0,sx:{mb:4},children:"Permissions"}),i.jsx(b,{display:"flex",justifyContent:"center",alignItems:"center",sx:{mb:4},children:i.jsx(n.MultiCheckbox,{name:"permissions",onClick:()=>{C(!0),u("permissionsGroup",0)},options:a.map(e=>({label:e.name,value:e.slug})),sx:{display:"grid",columnGap:4,rowGap:4,gridTemplateColumns:"repeat(4, 1fr)"}})}),s&&i.jsx(n.Switch,{name:"isActive",label:"Is Active?"}),i.jsxs(b,{display:"flex",justifyContent:"flex-end",mt:2,children:[i.jsx(A,{type:"submit",variant:"contained",disabled:q,children:"Submit"}),i.jsx(A,{variant:"outlined",onClick:()=>t(),sx:{ml:2},children:"Cancel"})]})]})]})}function ms({currentStaff:s,appPermissions:a,appPermissionsGroup:l}){return i.jsxs(H,{children:[i.jsx(K,{links:[{name:"Dashboard",href:h.dashboard.root},{name:"Staff",href:h.dashboard.staff.root},{name:"New Staff"}],sx:{mb:{xs:3,md:5}}}),i.jsx(Z,{currentStaff:s,appPermissions:a,appPermissionsGroup:l})]})}export{ms as S};

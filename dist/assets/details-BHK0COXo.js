import{j as s,S as t,B as i,e as c,o as F,dI as g,dJ as p,dH as u,dK as f,aD as b,ds as j,I as C,dy as M,T as E,aJ as q,e8 as H,p as x,G as m,ec as K,H as P,C as $}from"./index-s58VYgz3.js";import{u as L,E as N}from"./error-block-Cjpxpr3s.js";import{u as Q}from"./use-params-CEXzzucR.js";import{C as G}from"./custom-breadcrumbs-CvYJnLq0.js";import{u as T}from"./useMutation-DPA8wnZk.js";import{a as J,b as R,D as A}from"./DialogContent-BxNHtRW7.js";import{C as D}from"./CardHeader-D1mBolA2.js";import{z as y,u as O,t as V,a as z,F as U}from"./form-provider-Bc-Q3UnP.js";import"./image-EV8pe614.js";import"./editor-DBPzd_5b.js";import{T as W,t as X,a as Y,b as Z,c as _,d as k,e as ss}from"./TimelineSeparator-D_d-Ih_l.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./TextField-BCLnu4FQ.js";import"./FormControl-Dr-gs9Q7.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-BFqGQahW.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-ChuWYFNt.js";import"./Select-D5Vq4S1w.js";import"./Menu-Dwqwx6Um.js";import"./InputBase-DFq9tOKn.js";import"./FormHelperText-BMgUhmlR.js";import"./Rating-GXQcLGSf.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-wHQc-zyu.js";import"./RadioGroup-Dv2sLM7q.js";import"./FormGroup-qyoKISoi.js";import"./FormControlLabel-BGuqD-ec.js";import"./index-pxCRLdGp.js";import"./countries-DSLisFCy.js";import"./InputAdornment-Dr3MFrJT.js";import"./Autocomplete-BraHpgax.js";import"./Chip-xsDuSdC9.js";import"./country-select-CYeueISW.js";import"./Checkbox-BCverhNs.js";import"./upload-avatar-D-rSsmmB.js";import"./format-number-CB29iT6K.js";import"./DatePicker-8Awc3C9D.js";import"./ListItem-BTMMfISp.js";import"./MobileDateTimePicker-evv0i1Cn.js";import"./Tabs-XmHTv5fH.js";import"./KeyboardArrowRight-bR6kziGq.js";import"./index-C_b0vREI.js";const es=({open:e,onClose:r,handler:l})=>s.jsxs(J,{open:e,onClose:r,children:[s.jsx(R,{children:s.jsxs(t,{spacing:1,alignItems:"center",children:[s.jsx(i,{}),s.jsx("strong",{children:"Are you sure?"}),s.jsx("p",{children:"Do you want to mark seleted ticket as closed."})]})}),s.jsxs(A,{children:[s.jsx(c,{variant:"contained",onClick:l,children:"Confirm"}),s.jsx(c,{color:"inherit",variant:"outlined",onClick:r,children:"Cancel"})]})]});function rs({ticket:e}){const r=F(),l=g(),{mutate:d}=T({mutationFn:a=>p.patch(u.tickets.close+a,{status:"Closed"}),onSuccess:async()=>{f.success("Closed success!"),r.onFalse()},onSettled:async()=>{await l.invalidateQueries({queryKey:["tickets"]})},onError:a=>{}});return s.jsxs(s.Fragment,{children:[s.jsxs(b,{children:[s.jsx(D,{title:"Details"}),s.jsxs(t,{sx:{p:3},children:[s.jsxs(t,{direction:"row",justifyContent:"space-between",sx:{typography:"body2"},children:[s.jsxs(i,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[s.jsx(t,{direction:"row",sx:{typography:"subtitle2",marginBottom:1},children:s.jsx("div",{children:"Ticket Details"})}),s.jsxs(i,{sx:{color:"text.secondary"},children:["TICKET ID: ",e==null?void 0:e.id]}),s.jsxs(i,{sx:{color:"text.secondary"},children:["Member: ",`${e==null?void 0:e.member.firstName} ${e==null?void 0:e.member.lastName}`]}),s.jsxs(i,{sx:{color:"text.secondary"},children:["Topic: ",e==null?void 0:e.topic,"."]})]}),s.jsxs(i,{flexDirection:"column",alignItems:"center",gap:.5,sx:{display:"flex",width:"100%",p:1,borderRight:a=>`dashed 2px ${a.vars.palette.background.neutral}`,borderLeft:a=>`dashed 2px ${a.vars.palette.background.neutral}`},children:[s.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:s.jsx("div",{children:"Ticket Status"})}),s.jsx(i,{sx:{color:"text.secondary"},children:s.jsx(j,{variant:"soft",color:e.status==="Open"&&"info"||e.status==="Closed"&&"default"||"default",children:e.status})})]}),s.jsxs(i,{flexDirection:"column",alignItems:"center",sx:{p:1,display:"flex",width:"100%"},children:[s.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",gap:1,sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:s.jsx("div",{children:"Ticket Priority"})}),s.jsx(i,{sx:{color:"text.secondary"},children:s.jsx(j,{variant:"soft",color:(e==null?void 0:e.priority)==="Low"&&"success"||(e==null?void 0:e.priority)==="Medium"&&"warning"||(e==null?void 0:e.priority)==="Hight"&&"error"||"default",children:e==null?void 0:e.priority})})]})]}),s.jsx(i,{sx:{pt:5},children:s.jsx(c,{onClick:r.onTrue,disabled:e.status==="Closed",variant:"contained",startIcon:s.jsx(C,{icon:"carbon:checkmark-filled"}),children:"Mark as Closed"})})]})]}),s.jsx(es,{open:r.value,onClose:r.onFalse,handler:()=>d(e.id)})]})}const is=y.object({message:y.string().min(1,{message:"Name is required!"})}),ns=({ticket:e,messages:r})=>{const l={message:""},d=O({resolver:V(is),defaultValues:l}),{reset:a,handleSubmit:v,formState:{isSubmitting:as}}=d,h=g(),{mutate:w}=T({mutationFn:n=>p.post(u.tickets.createMessage,n),onSuccess:async()=>{f.success("Message Has Been Created!"),a()},onSettled:async()=>{const{id:n}=e;await h.invalidateQueries({queryKey:["tickets"]}),await h.invalidateQueries({queryKey:["tickets",n]})},onError:n=>{}}),I=v(async n=>{try{if(e.id){const o={...n};o.ticketId=e.id,w(o)}}catch(o){console.log(o),setErrorMsg(o instanceof Error?o.message:o)}}),S=s.jsxs(i,{sx:{pr:4,pl:4,pb:4,pt:2},children:[s.jsx(W,{sx:{p:0,m:0,[`& .${X.root}:before`]:{flex:0,padding:0}},children:s.jsx(M,{fillContent:!0,sx:{height:360},children:r==null?void 0:r.map((n,o)=>{const B=o===r.length-1;return s.jsxs(Y,{children:[s.jsxs(Z,{children:[s.jsx(_,{color:"primary"}),B?null:s.jsx(k,{})]}),s.jsx(ss,{children:s.jsxs(i,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(i,{children:[s.jsx(E,{variant:"subtitle2",children:n.createdBy.firstName}),s.jsx(i,{sx:{color:"text.disabled",typography:"caption",mt:.5},children:n.message})]}),s.jsx(i,{sx:{color:"text.disabled",typography:"caption"},children:q(n.createTime)})]})})]},n.id)})})}),s.jsx(z,{methods:d,onSubmit:I,children:s.jsxs(t,{justifyContent:"flex-end",spacing:1,sx:{marginTop:1},children:[s.jsx(t,{sx:{typography:"subtitle1",width:"100%",marginBottom:1},children:s.jsx("div",{children:"Send Reply:"})}),s.jsx(U.Text,{label:"Enter Description",name:"message",multiline:!0,rows:3,sx:{mb:2}}),s.jsx(i,{children:s.jsx(c,{type:"submit",variant:"contained",endIcon:s.jsx(C,{icon:"iconamoon:send-fill"}),children:"Send"})})]})})]});return s.jsxs(b,{children:[s.jsx(D,{title:"Previous Messages"}),S]})};function os({ticket:e}){return s.jsxs(H,{children:[s.jsx(G,{links:[{name:"Dashboard",href:x.dashboard.root},{name:"Tickets",href:x.dashboard.tickets.root},{name:"Ticket Details"}],sx:{mb:{xs:3,md:5}}}),s.jsxs(m,{container:!0,spacing:3,children:[s.jsx(m,{xs:12,md:9,children:s.jsx(t,{spacing:3,direction:{xs:"column-reverse",md:"column"},children:s.jsx(rs,{ticket:e})})}),s.jsx(m,{xs:12,md:3,children:s.jsx(ns,{ticket:e,messages:e==null?void 0:e.messages})})]})]})}const ts={title:`Ticket details | Dashboard - ${$.site.name}`};function ks(){const{id:e=""}=Q(),r=L({queryKey:["tickets",e],queryFn:async()=>{const{data:l}=await p.get(u.tickets.details+e);return l}});return r.isPending||r.isLoading?s.jsx(K,{}):r.isError?s.jsx(N,{route:x.dashboard.tickets.root}):s.jsxs(s.Fragment,{children:[s.jsx(P,{children:s.jsxs("title",{children:[" ",ts.title]})}),s.jsx(os,{ticket:r.data})]})}export{ks as default};

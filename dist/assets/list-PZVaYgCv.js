import{dn as K,Y as re,a3 as Le,j as e,L as Me,S as f,A as he,I as C,B as o,a8 as me,d0 as de,Q as Oe,bq as H,C as pe,e8 as ie,d7 as ce,ef as j,$ as R,cQ as Ve,b6 as Ee,db as Be,a6 as Fe,e4 as Q,a7 as P,e as Y,r as p,de as be,e3 as je,ed as ge,eb as qe,dp as ye,dq as O,dm as V,dr as fe,W as Ce,p as M,ea as He,a5 as _,cY as Te,v as se,dU as we,ec as Qe,b as Ne,dQ as Ke,cV as A,R as We,dT as G,dd as ze,H as _e}from"./index-88qAwG8P.js";import{u as J,E as ve}from"./error-block-BTff90qR.js";import{u as Pe}from"./useMutation-Bjm4Nnvr.js";import{C as Ge}from"./custom-breadcrumbs-x7W5GMPl.js";import{P as N}from"./permission-access-controller-BVvbpBzt.js";import{g as De,r as Ue,e as Ye}from"./utils-MBUcMVfY.js";import{u as Se}from"./use-table-BYPgfP9k.js";import{T as Je}from"./table-no-data-wFoKraSE.js";import{T as Xe}from"./table-empty-rows-6krMqYw2.js";import{T as oe,a as $e,b as Ae,c as Re}from"./table-head-custom-g2OgtrHv.js";import{T as Ze}from"./table-selected-action-DnALz1xy.js";import{T as Ie}from"./table-pagination-custom-Ds9-Dw8y.js";import{A as U}from"./app-widget-summary-DYEf84-y.js";import{b as E}from"./format-number-B8FPsWIV.js";import{C as et}from"./confirm-dialog-BdxUyq-O.js";import{T as v}from"./TableCell-Cl8UZGxf.js";import{A as tt}from"./AvatarGroup-CWqMds2i.js";import{u as st}from"./use-tabs-BvnvJIoS.js";import{S as ke}from"./Select-DFC-Q2QB.js";import{P as at,O as nt}from"./order-status-dialog-CoD1M8IM.js";import{Q as lt}from"./quotation-product-table-BPvAyC1U.js";import{C as rt}from"./CircularProgress-DIm-Ts9z.js";import{T as it,a as ot}from"./Tabs-gBKEx7yr.js";import{C as dt}from"./CardHeader-BiUdbdTy.js";import{T as ct}from"./TextField-CQpihH7F.js";import{I as ut}from"./InputAdornment-Bg-m_z4_.js";import{F as xt,a as ae,c as ne}from"./filters-result-B0DfRGbW.js";import{C as le}from"./Chip-yDeOg34u.js";import"./index-BBBOFUXR.js";import"./incrementer-button-BYzmwBWa.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-vgDCQT8r.js";import"./Checkbox-Cpc8f1GH.js";import"./TablePagination-CrnuwEMO.js";import"./KeyboardArrowRight-fE7_2VJ7.js";import"./LastPage-B6xWbdc0.js";import"./InputBase-DD8qHu7J.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-ts_MkIWE.js";import"./use-chart-CQlJjdjJ.js";import"./chart-legends-Cmehhq5p.js";import"./index-CySZofTa.js";import"./DialogContent-F9o-_CVT.js";import"./DialogTitle-CvyYkdF0.js";import"./Menu-BDUaDfAf.js";import"./form-provider-DSldc_Gv.js";import"./FormHelperText-DA7jizKd.js";import"./Rating-4WKJ8FeG.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-DKQnkQYm.js";import"./index-DZ-uLlaR.js";import"./Slider-Cdch2KEI.js";import"./FormControl-BXGEHd-f.js";import"./FormLabel-Ck5_RgM9.js";import"./RadioGroup-DZvtDFL6.js";import"./FormGroup-B0QesIKW.js";import"./utils-BDEKF9xP.js";import"./countries-DSLisFCy.js";import"./Autocomplete-Du1dNHWZ.js";import"./country-select-B-6neUw6.js";import"./InputLabel-B0kOUcWA.js";import"./upload-avatar-CSIBlxGF.js";import"./image-CkDsegDa.js";import"./DatePicker-C1aTSbY2.js";import"./ListItem-Bt-kWpW8.js";import"./MobileDateTimePicker-pEp8pQrB.js";import"./upload-box-ad-BK5SyPw0.js";import"./schema-helper-_nyXaTEe.js";import"./LoadingButton-CM47tPre.js";function ht({row:s,index:l,selected:r,onViewRow:g,onDeleteRow:t,onClickRow:d,isFullDisplay:n}){var D,I,T;const{t:u}=K("orders"),m=re(),i=re(),b=Le(),w=e.jsxs(oe,{hover:!0,selected:r,children:[e.jsx(v,{onClick:d,children:e.jsx(Me,{color:"inherit",onClick:g,underline:"always",sx:{cursor:"pointer"},children:(s==null?void 0:s.ref)||l||(s==null?void 0:s.id)})}),e.jsx(v,{onClick:d,children:e.jsxs(f,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(he,{sx:{bgcolor:"#00AB55"},alt:s.name,src:s.customer.avatar,children:e.jsx(C,{color:"white",icon:"fluent:person-20-filled",width:24})}),e.jsxs(f,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsx(o,{component:"span",sx:{textTransform:"capitalize"},children:s.customer.name}),e.jsx(o,{component:"span",sx:{color:"text.disabled"},children:s.customer.email})]})]})}),!n&&e.jsx(v,{onClick:d,children:e.jsx(me,{primary:de(s.orderDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(v,{align:"center",onClick:d,children:e.jsx(tt,{sx:{[`& .${Oe.avatar}`]:{width:24,height:24}},children:(D=s==null?void 0:s.productToOrder)==null?void 0:D.map(x=>{var y,S,$,k;return e.jsx(H,{title:`${(y=x==null?void 0:x.product)==null?void 0:y.name} | Quantity : ${x.quantity}`,children:e.jsx(he,{alt:(S=x==null?void 0:x.product)==null?void 0:S.name,src:`${pe.site.serverFileHost}${($=x==null?void 0:x.product)==null?void 0:$.image}`},x==null?void 0:x.id)},(k=x==null?void 0:x.product)==null?void 0:k.id)})})}),e.jsx(v,{onClick:d,children:E(ie(s.totalOrderAmount-s.totalOrderAmount*(s.discount/100),s.snapshotTaxPercentage))||"-"}),!n&&e.jsxs(v,{onClick:d,children:[(I=s.createdBy)==null?void 0:I.firstName," ",(T=s.createdBy)==null?void 0:T.lastName]}),!n&&e.jsx(v,{onClick:d,children:e.jsxs(ce,{variant:"soft",color:s.status===j.Ready&&"info"||s.status===j.InProcess&&"warning"||s.status===j.Delivered&&"success"||s.status===j.Canceled&&"error"||"default",children:[s.status===j.Draft&&`${u("listView.table.tableToolbar.selectMenu.draft")}`,s.status===j.InProcess&&`${u("listView.table.tableToolbar.selectMenu.processing")}`,s.status===j.Ready&&`${u("listView.table.tableToolbar.selectMenu.readyToDeliver")}`,s.status===j.Delivered&&`${u("listView.table.tableToolbar.selectMenu.delivered")}`,s.status===j.Canceled&&`${u("listView.table.tableToolbar.selectMenu.canceled")}`]})}),!n&&e.jsxs(v,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(R,{color:i.value?"inherit":"default",onClick:i.onToggle,sx:{...i.value&&{bgcolor:"action.hover"}},children:e.jsx(C,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(R,{color:b.open?"inherit":"default",onClick:b.onOpen,children:e.jsx(C,{icon:"eva:more-vertical-fill"})})]})]}),h=e.jsx(oe,{children:e.jsx(v,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(Ve,{in:i.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(Ee,{sx:{m:1.5},children:s.productToOrder.map(x=>e.jsxs(f,{direction:"row",alignItems:"center",sx:{p:y=>y.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:y=>`solid 2px ${y.vars.palette.background.neutral}`}},children:[e.jsx(me,{primary:x.product.name,secondary:x.sku,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs("div",{children:[x.quantity," "]}),e.jsx(o,{sx:{width:110,textAlign:"right"},children:E(x.snapshotProductPrice)})]},x.id))})})})});return e.jsxs(e.Fragment,{children:[w,h,e.jsx(Be,{open:b.open,anchorEl:b.anchorEl,onClose:b.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Fe,{children:[e.jsx(N,{permission:Q.VIEW_ORDER,children:e.jsxs(P,{onClick:()=>{g(),b.onClose()},children:[e.jsx(C,{icon:"solar:eye-bold"}),"View"]})}),s.status!==j.Canceled&&e.jsx(N,{permission:Q.DELETE_ORDER,children:e.jsxs(P,{onClick:()=>{m.onTrue(),b.onClose()},sx:{color:"warning.main"},children:[e.jsx(C,{icon:"solar:trash-bin-trash-bold"}),"Cancel"]})})]})}),e.jsx(et,{open:m.value,onClose:m.onFalse,title:"Cancel Order",content:"Are you sure want to cancel this order?",action:e.jsx(Y,{variant:"contained",color:"warning",onClick:()=>{t(),m.onFalse()},children:"Confirm Canceling"})})]})}const mt=({payments:s})=>{const l=Se({defaultOrderBy:"orderId",defaultRowsPerPage:5}),[r,g]=p.useState(s),{t}=K("orders"),d=be({name:"",status:"all",startDate:null,endDate:null}),n=[{id:"orderNumber",label:"#",width:40,align:"center"},{id:"date",label:`${t("detailsCard.table.header.date")}`},{id:"status",label:`${t("detailsCard.table.header.paymentType")}`,width:200,align:"center"},{id:"totalAmount",label:`${t("detailsCard.table.header.paidAmount")}`,width:200,align:"center"}];p.useEffect(()=>{g(s)},[s]);const u=je(d.state.startDate,d.state.endDate),m=pt({inputData:r,comparator:De(l.order,l.orderBy),filters:d.state,dateError:u}),[i,b]=p.useState("all"),w=p.useCallback(h=>{l.onResetPage(),d.setState({status:h.target.value}),b(h.target.value)},[d,l]);return e.jsxs(o,{display:"flex",flexDirection:"column",alignItems:"center",sx:{borderRadius:1,height:1,width:1,overflow:"hidden",border:h=>`solid 1px ${h.vars.palette.divider}`},children:[e.jsx(f,{spacing:2,justifyContent:{xs:"flex-end"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:1,width:1},children:e.jsxs(ke,{size:"small",sx:{width:200,textTransform:"capitalize"},value:i,onChange:w,children:[e.jsx(P,{value:"all",children:t("detailsCard.table.header.allPayments")}),e.jsx(P,{value:"Cash",children:t("detailsCard.table.header.cash")}),e.jsx(P,{value:"Card",children:t("detailsCard.table.header.card")}),e.jsx(P,{value:"Transfer",children:t("detailsCard.table.header.transfer")})]})}),e.jsx(o,{sx:{flex:1,width:1},children:e.jsxs($e,{size:"small",children:[e.jsx(Ae,{headLabel:n}),e.jsx(Re,{children:m.slice(l.page*l.rowsPerPage,l.page*l.rowsPerPage+l.rowsPerPage).map((h,D)=>e.jsxs(oe,{children:[e.jsxs(v,{align:"center",children:[" ",D+1||h.id," "]}),e.jsx(v,{children:de(h.paymentDate)}),e.jsx(v,{align:"center",children:e.jsx(ce,{variant:"soft",color:h.paymentType==="Cash"&&"info"||h.paymentType==="Card"&&"success"||h.paymentType==="Transfer"&&"default"||"default",children:h.paymentType})}),e.jsx(v,{align:"center",children:E(h==null?void 0:h.amount)})]},`${h.id}`))})]})}),e.jsx(Ie,{sx:{width:1},page:l.page,dense:!0,count:m.length,rowsPerPage:l.rowsPerPage,onPageChange:l.onChangePage,onRowsPerPageChange:l.onChangeRowsPerPage})]})};function pt({inputData:s,comparator:l,filters:r,dateError:g}){const{status:t,name:d,startDate:n,endDate:u}=r,m=s.map((i,b)=>[i,b]);return m.sort((i,b)=>{const w=l(i[0],b[0]);return w!==0?w:i[1]-b[1]}),s=m.map(i=>i[0]),t!=="all"&&(s=s.filter(i=>i.paymentType===t)),g||n&&u&&(s=s.filter(i=>ge(i.createdAt,n,u))),s}const bt=({selectedOrder:s,handleResize:l,handleClose:r,onViewOrder:g})=>{var W,z,a,L,ue,xe;const[t,d]=p.useState(s),{t:n}=K("orders"),u=[{value:"details",icon:e.jsx(C,{icon:"solar:eye-bold",width:24}),label:`${n("detailsCard.orderDetailsTab")}`},{value:"payments",icon:e.jsx(C,{icon:"solar:case-minimalistic-bold",width:24}),label:`${n("detailsCard.paymentsTab")}`}],m=st("details"),[i,b]=p.useState(u),w=qe();p.useEffect(()=>{s.id!==t.id&&d(s)},[t.id,s]),p.useEffect(()=>{const c=(s==null?void 0:s.status)!==j.Draft&&(s==null?void 0:s.status)!==j.Canceled?u:u.filter(te=>!["payments"].includes(te.value));b(c)},[s]);const h=re(),D=ye(),{mutate:I}=Pe({mutationFn:c=>O.post(V.payments.create,c),onSuccess:async c=>{fe.success(n("detailView.confirmDialog.newPaymentCreated")),h.onFalse()},onSettled:async()=>{await D.invalidateQueries({queryKey:["payments"]}),await D.invalidateQueries({queryKey:["order",t.id]})},onError:c=>{console.log(c)}}),T=Ce(),x=p.useCallback(c=>{T.replace(M.dashboard.quotation.details(c))},[T]),[y,S]=p.useState(!1),$=()=>{S(!0)},{isLoading:k}=J({queryKey:["download-order",t.id],queryFn:async()=>{const c=await O.get(V.order.downloadPdf+t.id,{responseType:"blob"}),te=window.URL.createObjectURL(new Blob([c.data])),q=document.createElement("a");return q.href=te,q.setAttribute("download",`Order-${t.ref}.pdf`),document.body.appendChild(q),q.click(),document.body.removeChild(q),S(!1),c.data},enabled:y,onSuccess:()=>{S(!1)},onError:c=>{console.error("Download failed:",c)}}),B=e.jsx(H,{title:n("detailsCard.tooltips.downloadTooltip"),children:e.jsx(R,{onClick:$,children:k?e.jsx(rt,{size:24,color:"inherit"}):e.jsx(C,{icon:"eva:cloud-download-fill",color:"error.main"})})}),X=e.jsxs(f,{alignItems:"flex-end",sx:{p:1,textAlign:"right",typography:"body2"},children:[e.jsxs(f,{direction:"row",children:[e.jsx(o,{sx:{color:"text.secondary"},children:n("detailsCard.subtotal")}),e.jsx(o,{sx:{width:160,typography:"subtitle2"},children:E(t==null?void 0:t.totalOrderAmount)||"-"})]}),e.jsxs(f,{direction:"row",children:[e.jsx(o,{sx:{color:"text.secondary"},children:n("detailsCard.discount")}),e.jsx(o,{sx:{width:160,...(t==null?void 0:t.discount)&&{color:"error.main"}},children:t!=null&&t.discount?`- ${t==null?void 0:t.discount}%`:"-"})]}),e.jsxs(f,{direction:"row",children:[e.jsxs(o,{sx:{color:"text.secondary"},children:[n("detailsCard.tax")," (",(t==null?void 0:t.snapshotTaxPercentage)||"0","%)"]}),e.jsx(o,{sx:{width:160},children:t!=null&&t.snapshotTaxPercentage?E(He((t==null?void 0:t.totalOrderAmount)-(t==null?void 0:t.totalOrderAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage)):"-"})]}),e.jsxs(f,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:n("detailsCard.total")}),e.jsx(o,{sx:{width:160},children:E(ie((t==null?void 0:t.totalOrderAmount)-(t==null?void 0:t.totalOrderAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage))||"-"})]})]}),Z=e.jsxs(f,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsxs(o,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",m:1},children:[e.jsxs(o,{flexDirection:"column",sx:{display:"flex"},children:[e.jsxs(o,{sx:{color:"text.secondary"},children:[n("detailsCard.orderRef"),": #",t==null?void 0:t.ref]}),e.jsxs(o,{sx:{color:"text.secondary"},children:[n("detailsCard.orderDate"),": ",de(t==null?void 0:t.orderDate)]})]}),e.jsx(o,{sx:{mr:2},children:e.jsxs(o,{sx:{color:"text.secondary"},children:[n("detailsCard.status"),e.jsxs(ce,{variant:"soft",color:(t==null?void 0:t.status)===j.Ready&&"info"||(t==null?void 0:t.status)===j.InProcess&&"warning"||(t==null?void 0:t.status)===j.Delivered&&"success"||(t==null?void 0:t.status)===j.Canceled&&"error"||"default",children:[(t==null?void 0:t.status)===j.Draft&&`${n("listView.table.tableToolbar.selectMenu.draft")}`,(t==null?void 0:t.status)===j.InProcess&&`${n("listView.table.tableToolbar.selectMenu.processing")}`,(t==null?void 0:t.status)===j.Ready&&`${n("listView.table.tableToolbar.selectMenu.readyToDeliver")}`,(t==null?void 0:t.status)===j.Delivered&&`${n("listView.table.tableToolbar.selectMenu.delivered")}`,(t==null?void 0:t.status)===j.Canceled&&`${n("listView.table.tableToolbar.selectMenu.canceled")}`]})]})}),((W=t==null?void 0:t.order)==null?void 0:W.id)&&e.jsx(o,{sx:{color:"text.secondary"},className:"print-hide",children:e.jsxs(Y,{variant:"contained",size:"small",startIcon:e.jsx(C,{icon:"heroicons-outline:external-link"}),onClick:()=>{t==null||t.quotation},children:[n("detailsCard.relatedToQuotation"),": #",(z=t==null?void 0:t.quotation)==null?void 0:z.ref]})})]}),e.jsxs(o,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsx(lt,{products:t==null?void 0:t.productToOrder,defaultRowsPerPage:t!=null&&t.notes?5:10}),e.jsx(_,{sx:{mt:1}})]}),X,(t==null?void 0:t.notes)&&e.jsxs(o,{children:[e.jsx(_,{}),e.jsx(f,{sx:{typography:"body2"},children:e.jsx(o,{sx:{p:1},children:e.jsxs(f,{sx:{typography:"subtitle2"},children:[e.jsxs("div",{children:[n("detailsCard.notes"),":"]}),e.jsx(o,{sx:{color:"text.secondary"},children:t==null?void 0:t.notes})]})})})]})]}),F=J({queryKey:["order",t.id],queryFn:async()=>{const{data:c}=await O.get(V.order.details+t.id);return d(c),c}}),ee=c=>c.isPending||c.isLoading?e.jsx(we,{}):c.isError?e.jsx(ve,{}):e.jsxs(f,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[(t==null?void 0:t.status)!==j.Draft&&(t==null?void 0:t.status)!==j.Canceled&&Math.round(ie(t.totalOrderAmount-t.totalOrderAmount*(t.discount/100),t==null?void 0:t.snapshotTaxPercentage)-t.orderPaymentAmount)>0&&e.jsxs(e.Fragment,{children:[e.jsx(o,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(o,{children:e.jsx(N,{permission:Q.ADD_PAYMENT,children:e.jsx(Y,{onClick:()=>h.onToggle(),variant:"contained",startIcon:e.jsx(C,{icon:"mingcute:add-line"}),children:n("detailsCard.newPayment")})})})}),e.jsx(_,{})]}),e.jsx(o,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(mt,{payments:F.data.payments})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(Te,{sx:{height:1,display:"flex",flexDirection:"column",width:1,transition:"all 2s ease-in-out"},children:[e.jsxs(it,{className:"print-hide ",value:m.value,onChange:m.onChange,sx:{px:3,boxShadow:c=>`inset 0 -2px 0 0 ${se(c.vars.palette.grey["500Channel"],.08)}`},children:[i.map(c=>e.jsx(ot,{icon:c.icon,value:c.value,label:c.label},c.value)),e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${se(w.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(R,{sx:{ml:1},onClick:l,children:e.jsx(C,{icon:"solar:full-screen-bold",width:24})})}),e.jsx(o,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${se(w.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(R,{sx:{ml:1},onClick:r,children:e.jsx(C,{icon:"solar:close-square-outline",width:24})})})]}),e.jsxs(o,{className:"print-top-margin print-padding",sx:{display:"flex",flexDirection:"column",position:"relative",flex:1},children:[e.jsx(dt,{sx:{pt:1},title:`${n("detailsCard.orderReference")}: ${t==null?void 0:t.ref}`,subheader:`${n("detailsCard.createdBy")}: ${(a=t.createdBy)==null?void 0:a.firstName} ${(L=t.createdBy)==null?void 0:L.lastName}`,action:e.jsx(f,{spacing:3,direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"},sx:{mb:{xs:3,md:5}},children:e.jsxs(f,{direction:"row",spacing:1,alignItems:"center",flexGrow:1,sx:{width:1},children:[e.jsx(H,{title:n("detailsCard.tooltips.viewTooltip"),children:e.jsx(R,{onClick:()=>{g(t.id)},children:e.jsx(C,{icon:"solar:eye-bold",color:"primary.main"})})}),((ue=t==null?void 0:t.quotation)==null?void 0:ue.id)&&e.jsx(H,{title:`${n("detailsCard.relatedToQuotation")}: #${(xe=t==null?void 0:t.quotation)==null?void 0:xe.ref}`,children:e.jsx(R,{onClick:()=>{var c;x((c=t==null?void 0:t.quotation)==null?void 0:c.id)},children:e.jsx(C,{icon:"heroicons-outline:external-link"})})}),B,e.jsx(H,{title:n("detailsCard.tooltips.printTooltip"),children:e.jsx(at,{order:t})})]})})}),e.jsx(_,{}),m.value==="details"&&Z,m.value==="payments"&&ee(F)]})]}),e.jsx(nt,{order:t,open:h.value,onClose:h.onFalse,handler:I})]})};function jt({filters:s,onResetPage:l}){const[r,g]=p.useState("all"),{t}=K("orders"),d=p.useCallback(u=>{l(),s.setState({name:u.target.value})},[s,l]),n=p.useCallback(u=>{l(),s.setState({status:u.target.value}),g(u.target.value)},[s,l]);return e.jsxs(f,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(ct,{sx:{width:420},value:s.state.name,onChange:d,placeholder:`${t("listView.table.tableToolbar.searchPlaceholder")}`,InputProps:{startAdornment:e.jsx(ut,{position:"start",children:e.jsx(C,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(ke,{sx:{width:420,textTransform:"capitalize"},value:r,onChange:n,children:[e.jsx(P,{value:"all",children:`${t("listView.table.tableToolbar.selectMenu.allOrders")}`}),e.jsx(P,{value:"Draft",children:`${t("listView.table.tableToolbar.selectMenu.draft")}`}),e.jsx(P,{value:"Canceled",children:`${t("listView.table.tableToolbar.selectMenu.canceled")}`}),e.jsx(P,{value:"InProcess",children:`${t("listView.table.tableToolbar.selectMenu.processing")}`}),e.jsx(P,{value:"Ready",children:`${t("listView.table.tableToolbar.selectMenu.readyToDeliver")}`}),e.jsx(P,{value:"Delivered",children:`${t("listView.table.tableToolbar.selectMenu.delivered")}`})]})]})}function gt({filters:s,totalResults:l,onResetPage:r,sx:g}){const t=p.useCallback(()=>{r(),s.setState({name:""})},[s,r]),d=p.useCallback(()=>{r(),s.setState({status:"all"})},[s,r]),n=p.useCallback(()=>{r(),s.setState({startDate:null,endDate:null})},[s,r]),u=p.useCallback(()=>{r(),s.onResetState()},[s,r]);return e.jsxs(xt,{totalResults:l,onReset:u,sx:g,children:[e.jsx(ae,{label:"Status:",isShow:s.state.status!=="all",children:e.jsx(le,{...ne,label:s.state.status,onDelete:d,sx:{textTransform:"capitalize"}})}),e.jsx(ae,{label:"Date:",isShow:!!(s.state.startDate&&s.state.endDate),children:e.jsx(le,{...ne,label:Qe(s.state.startDate,s.state.endDate),onDelete:n})}),e.jsx(ae,{label:"Keyword:",isShow:!!s.state.name,children:e.jsx(le,{...ne,label:s.state.name,onDelete:t})})]})}function yt({orders:s,analytics:l}){const{t:r}=K("orders"),g=[{id:"orderNumber",label:"#",width:88},{id:"name",label:r("listView.table.tableHeader.customer")},{id:"createdAt",label:r("listView.table.tableHeader.date"),width:140},{id:"totalQuantity",label:r("listView.table.tableHeader.items"),width:120,align:"center"},{id:"totalAmount",label:r("listView.table.tableHeader.price"),width:140},{id:"createdBy",label:r("listView.table.tableHeader.createdBy"),width:200},{id:"status",label:r("listView.table.tableHeader.status"),width:110},{id:"",width:88}],t=Se({defaultOrderBy:"orderId",defaultRowsPerPage:5}),d=Ce(),[n,u]=p.useState(),[m,i]=p.useState(!1),[b,w]=p.useState(g),h=Ne(),[D,I]=p.useState(()=>s),T=be({name:"",status:"all",startDate:null,endDate:null});p.useEffect(()=>{if(i(!1),I(s),n){const a=s.find(L=>L.id===n.id);u(a)}},[s]),p.useEffect(()=>{const a=n?g.filter(L=>!["createdAt","createdBy","status",""].includes(L.id)):g;w(a)},[n]);const x=je(T.state.startDate,T.state.endDate),y=ft({inputData:D,comparator:De(t.order,t.orderBy),filters:T.state,dateError:x}),S=Ue(y,t.page,t.rowsPerPage),$=!!T.state.name||T.state.status!=="all"||!!T.state.startDate&&!!T.state.endDate,k=!y.length&&$||!y.length,B=ye(),{mutate:X}=Pe({mutationFn:a=>O.delete(V.order.delete+a),onSuccess:async()=>{fe.success("Order Has Been Canceled!")},onSettled:async()=>{await B.invalidateQueries({queryKey:["orders"]}),await B.invalidateQueries({queryKey:["orders-status"]}),await B.invalidateQueries({queryKey:["orders","analytics"]})},onError:()=>{}}),Z=p.useCallback(a=>{X(a)},[S.length,t,D]),F=p.useCallback(a=>{d.replace(M.dashboard.order.details(a))},[d]),ee=()=>{i(!m)},W=()=>{u(null),i(!1)},z=a=>{u(a)};return e.jsx(Ke,{maxWidth:"xl",children:e.jsxs(A,{container:!0,spacing:3,children:[e.jsx(A,{xs:12,md:12,children:e.jsx(Ge,{links:[{name:`${r("listView.breadCrumbsPageRootTitle")}`,href:M.dashboard.root},{name:`${r("listView.breadCrumbsParentPageTitle")}`,href:M.dashboard.order.root},{name:`${r("listView.breadCrumbsPageTitle")}`}],action:e.jsx(N,{permission:Q.ADD_ORDER,children:e.jsx(Y,{component:We,href:M.dashboard.order.new,variant:"contained",startIcon:e.jsx(C,{icon:"mingcute:add-line"}),children:`${r("listView.addNewOrder")}`})})})}),e.jsxs(N,{permission:Q.LIST_ORDER,children:[e.jsx(A,{xs:12,md:3,children:e.jsx(U,{title:`${r("listView.statisticsWidgets.allOrders")}`,total:s.length,chart:{categories:l.data.lastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:l.data.lastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(A,{xs:12,md:3,children:e.jsx(U,{title:`${r("listView.statisticsWidgets.processingOrder")}`,total:l.data.analytics.InProcess,chart:{colors:[h.vars.palette.warning.light],categories:l.data.inProcessLastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:l.data.inProcessLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(A,{xs:12,md:3,children:e.jsx(U,{title:`${r("listView.statisticsWidgets.readyToDeliver")}`,total:l.data.analytics.Ready,chart:{colors:[h.vars.palette.info.main],categories:l.data.readyLastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:l.data.readyLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(A,{xs:12,md:3,children:e.jsx(U,{title:`${r("listView.statisticsWidgets.delivered")}`,total:l.data.analytics.Delivered,chart:{colors:[h.vars.palette.success.main],categories:l.data.deliveredLastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:l.data.deliveredLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),!m&&e.jsx(A,{xs:12,md:n?5:12,children:e.jsxs(Te,{children:[e.jsx(jt,{filters:T,onResetPage:t.onResetPage,dateError:x}),$&&e.jsx(gt,{filters:T,totalResults:y.length,onResetPage:t.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(o,{sx:{position:"relative"},children:[e.jsx(Ze,{dense:t.dense,numSelected:t.selected.length,rowCount:y.length}),e.jsx(ze,{sx:{minHeight:444},children:e.jsxs($e,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Ae,{order:t.order,orderBy:t.orderBy,headLabel:b,rowCount:y.length}),e.jsxs(Re,{children:[y.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage).map(a=>e.jsx(ht,{row:a,selected:t.selected.includes(a.id),onSelectRow:()=>t.onSelectRow(a.id),onDeleteRow:()=>Z(a.id),onViewRow:()=>F(a.id),onClickRow:()=>z(a),isFullDisplay:n},a.id)),e.jsx(Xe,{height:t.dense?56:76,emptyRows:Ye(t.page,t.rowsPerPage,y.length)}),e.jsx(Je,{notFound:k})]})]})})]}),e.jsx(Ie,{page:t.page,dense:t.dense,count:y.length,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onChangeDense:t.onChangeDense,onRowsPerPageChange:t.onChangeRowsPerPage})]})}),n&&e.jsx(o,{sx:{display:"flex",flex:1,p:1.5,transition:"all 2s ease-in-out"},children:e.jsx(bt,{selectedOrder:n,handleResize:ee,handleClose:W,onViewOrder:F})})]})]})})}function ft({inputData:s,comparator:l,filters:r,dateError:g}){const{status:t,name:d,startDate:n,endDate:u}=r,m=s==null?void 0:s.map((i,b)=>[i,b]);return m==null||m.sort((i,b)=>{const w=l(i[0],b[0]);return w!==0?w:i[1]-b[1]}),s=m==null?void 0:m.map(i=>i[0]),d&&(s=s.filter(i=>i.id.toString().toLowerCase().indexOf(d.toLowerCase())!==-1||i.customer.name.toLowerCase().indexOf(d.toLowerCase())!==-1||i.status.toLowerCase().indexOf(d.toLowerCase())!==-1||i.customer.email.toLowerCase().indexOf(d.toLowerCase())!==-1)),t!=="all"&&(s=s.filter(i=>i.status===t)),g||n&&u&&(s=s.filter(i=>ge(i.createTime,n,u))),s}const Ct={title:`Order list | Dashboard - ${pe.site.name}`};function qs(){const s=J({queryKey:["orders"],queryFn:async()=>{const{data:r}=await O.get(V.order.list);return r}}),l=J({queryKey:["orders","analytics"],queryFn:async()=>{const{data:r}=await O.get(V.order.analytics);return r}});return l.isLoading||s.isLoading?e.jsx(we,{}):s.isError||l.isError?e.jsx(ve,{route:M.dashboard.order.root}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{children:e.jsxs("title",{children:[" ",Ct.title]})}),e.jsx(yt,{orders:s.data,analytics:l})]})}export{qs as default};

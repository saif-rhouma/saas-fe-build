import{o as U,bO as Y,j as e,aJ as W,ds as G,w as Z,I as D,dw as ee,bQ as te,bR as x,em as A,e as M,r as p,dI as V,dJ as C,dH as b,dK as _,ec as N,p as P,D as se,S as B,B as q,T as ae,dy as J,l as oe,dz as ie,eo as re,e8 as ne,G as f,aD as le,ep as de,H as ce,C as me}from"./index-D9XQ5HZn.js";import{u as K,E as $}from"./error-block-w_O0iSRH.js";import{u as H}from"./useMutation-ts4flLpu.js";import{C as pe}from"./custom-breadcrumbs-CazdlgA0.js";import{P as O}from"./permission-access-controller-CBnTTSPg.js";import{u as ue,g as he,r as xe,T as ge,a as je,e as fe}from"./table-selected-action-KNwZffED.js";import{T as ye}from"./table-no-data-B6s3Ok4M.js";import{T as Ce,a as be,b as we,c as Te}from"./table-head-custom-CmnvuSVC.js";import{T as Se}from"./table-pagination-custom-Bx7mhuFH.js";import{A as L}from"./app-widget-summary-CXEYO0oT.js";import{C as De}from"./confirm-dialog-CY42tOB4.js";import{T as y}from"./TableCell-BQnM0xNZ.js";import{z as S,u as Pe,t as ve,a as Fe,F}from"./form-provider-CxGM2Unr.js";import{b as ke}from"./upload-avatar-AxagYmpF.js";import"./image--crxJX70.js";import"./editor-4sPkqXXa.js";import{a as Ie,b as Re,D as Ee}from"./DialogContent-COSPx22v.js";import{D as Le}from"./DialogTitle-CwAPclTX.js";import{L as Ae}from"./LoadingButton-EVY8EkwD.js";import{T as Be}from"./TextField-DX4sIYOy.js";import{I as qe}from"./InputAdornment-DzIVUKKm.js";import{S as Ke}from"./Select-DEn4EjE4.js";import{F as He,a as Oe,c as Me}from"./filters-result-DXLcu6yJ.js";import{C as Ne}from"./Chip-DtnMtqyD.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-DF3g1Q_L.js";import"./empty-content-Bkzy38Qy.js";import"./TablePagination-Daqijhxj.js";import"./KeyboardArrowRight-D9a5UIDu.js";import"./LastPage-C7MjNvcm.js";import"./InputBase-DsCQaGZz.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-CQyLNxlb.js";import"./format-number-B7RckPke.js";import"./use-chart-Bc_9USjC.js";import"./chart-legends-D-D5KtCU.js";import"./index-Ck2jm1rT.js";import"./FormHelperText-BUvJKjZo.js";import"./Rating-Dz1lJuYA.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-BZBxWU4Q.js";import"./FormControl-B_14xPvO.js";import"./FormLabel-ousI8yIh.js";import"./RadioGroup-BU5nUuP7.js";import"./FormGroup-Bfb8EGRU.js";import"./countries-DSLisFCy.js";import"./Autocomplete-CbHgTFzS.js";import"./country-select-CcbLyBYj.js";import"./InputLabel-DS6Prtxn.js";import"./DatePicker-CHI830Hp.js";import"./ListItem-DkD46tOc.js";import"./MobileDateTimePicker-Dp-kczs0.js";import"./Tabs-B9OWTzrp.js";import"./Menu-ChOTQt8U.js";import"./index-DaWlhWs_.js";import"./CircularProgress-Cg-Vm1oQ.js";const ze=({row:t,index:r,selected:s,onViewRow:c,onDeleteRow:m})=>{const n=U(),i=Y(),l=e.jsxs(Ce,{hover:!0,selected:s,children:[e.jsx(y,{children:r||t.id}),e.jsx(y,{children:W(t.createTime)}),e.jsx(y,{children:t.topic}),e.jsx(y,{children:e.jsx(G,{variant:"soft",color:t.priority==="Low"&&"success"||t.priority==="Medium"&&"warning"||t.priority==="Hight"&&"error"||"default",children:t.priority})}),e.jsx(y,{children:W(t.updateTime)}),e.jsx(y,{children:e.jsx(G,{variant:"soft",color:t.status==="Open"&&"info"||t.status==="Closed"&&"default"||"default",children:t.status})}),e.jsx(y,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(Z,{color:i.open?"inherit":"default",onClick:i.onOpen,children:e.jsx(D,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[l,e.jsx(ee,{open:i.open,anchorEl:i.anchorEl,onClose:i.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(te,{children:[e.jsxs(x,{onClick:()=>{c(),i.onClose()},children:[e.jsx(D,{icon:"solar:eye-bold"}),"View"]}),e.jsx(O,{permission:A.DELETE_TICKET,children:e.jsxs(x,{onClick:()=>{n.onTrue(),i.onClose()},sx:{color:"error.main"},children:[e.jsx(D,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})})]})}),e.jsx(De,{open:n.value,onClose:n.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(M,{variant:"contained",color:"error",onClick:m,children:"Delete"})})]})},Qe=S.object({topic:S.string().min(1,{message:"Topic is required!"}),description:S.string().min(1,{message:"Description is required!"}),memberId:S.number().min(1,{message:"Member is required!"}),priority:S.string().min(1,{message:"Priority is required!"})}),We=({currentTicket:t,open:r,onClose:s})=>{//! Upload Logic START
const c=p.useRef(),[m,n]=p.useState([]),[i,l]=p.useState(),g=p.useCallback(a=>{const h=a[0];l(()=>h)},[]),o=()=>{l(null)},u=V(),j={headers:{"content-type":"multipart/form-data"}};//! Upload Logic END
const{mutate:k}=H({mutationFn:a=>C.post(b.files.upload,a,j),onSuccess:async({data:a})=>{const{name:h}=a;if(h){const{current:Q}=c;Q.file=h,await v(Q)}return a},onSettled:async()=>{await u.invalidateQueries({queryKey:["tickets-images"]})},onError:a=>{console.log(a)}}),{mutate:v}=H({mutationFn:a=>C.post(b.tickets.create,a),onSuccess:async()=>{_.success("New Ticket Has Been Created!"),R()},onSettled:async()=>{await u.invalidateQueries({queryKey:["tickets"]}),c.current={},l(null),s()},onError:a=>{console.log(a)}}),I=p.useMemo(()=>({topic:(t==null?void 0:t.topic)||"",description:(t==null?void 0:t.description)||"",memberId:(t==null?void 0:t.memberId)||null,priority:(t==null?void 0:t.priority)||null}),[t]),w=Pe({resolver:ve(Qe),defaultValues:I}),{reset:R,watch:z,setValue:d,handleSubmit:T,formState:{isSubmitting:Xe}}=w,X=T(async a=>{try{if(i){c.current={...a};const h=new FormData;h.append("file",i),h.append("category","Ticket"),await k(h)}else await v(a)}catch(h){console.error(h)}}),E=K({queryKey:["members"],queryFn:async()=>{const{data:a}=await C.get(b.staff.list);return n(a),a}});return E.isPending||E.isLoading?e.jsx(N,{}):E.isError?e.jsx($,{route:P.dashboard.staff.root}):e.jsxs(Ie,{fullWidth:!0,maxWidth:"md",open:r,onClose:s,children:[e.jsx(Le,{children:"Add New Ticket"}),e.jsxs(Fe,{methods:w,onSubmit:X,children:[e.jsxs(Re,{children:[e.jsx(se,{}),e.jsxs(B,{spacing:2,sx:{pt:4,pb:1},children:[e.jsxs(q,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[e.jsx(F.Text,{fullWidth:!0,label:"Enter Topic",name:"topic",sx:{flexGrow:1}}),e.jsx(F.Text,{fullWidth:!0,label:"Description",name:"description",sx:{flexGrow:1}}),e.jsxs(F.Select,{name:"priority",label:"Select a Priority",sx:{width:420,textTransform:"capitalize"},children:[e.jsx(x,{value:"Low",children:"Low"}),e.jsx(x,{value:"Medium",children:"Medium"}),e.jsx(x,{value:"Hight",children:"Hight"})]}),e.jsx(F.Select,{name:"memberId",label:"Select a Member",sx:{width:420,textTransform:"capitalize"},children:m.map(a=>e.jsx(x,{value:a.id,children:`${a==null?void 0:a.firstName} ${a==null?void 0:a.lastName}`},a.id))})]}),e.jsx(q,{children:e.jsxs(B,{spacing:1.5,children:[e.jsx(ae,{variant:"subtitle2",children:"Attachments"}),e.jsx(J,{sx:{maxHeight:360,p:2},children:e.jsx(ke,{value:i,onDrop:g,onDelete:o})})]})})]})]}),e.jsxs(Ee,{children:[e.jsx(Ae,{type:"submit",variant:"contained",children:"Save"}),e.jsx(M,{color:"inherit",variant:"outlined",onClick:s,children:"Cancel"})]})]})]})};function Ge({filters:t,onResetPage:r}){const[s,c]=p.useState("all"),m=p.useCallback(i=>{r(),t.setState({name:i.target.value})},[t,r]),n=p.useCallback(i=>{r(),t.setState({status:i.target.value}),c(i.target.value)},[t,r]);return e.jsxs(B,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(Be,{sx:{width:420},value:t.state.name,onChange:m,placeholder:"Search Here...",InputProps:{startAdornment:e.jsx(qe,{position:"start",children:e.jsx(D,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(Ke,{sx:{width:420,textTransform:"capitalize"},value:s,onChange:n,children:[e.jsx(x,{value:"all",children:"All Tickets"}),e.jsx(x,{value:"Open",children:"Open Tickets"}),e.jsx(x,{value:"Closed",children:"Close Tickets"})]})]})}function Ue({filters:t,totalResults:r,onResetPage:s,sx:c}){const m=p.useCallback(()=>{s(),t.setState({name:""})},[t,s]),n=p.useCallback(()=>{s(),t.onResetState()},[t,s]);return e.jsx(He,{totalResults:r,onReset:n,sx:c,children:e.jsx(Oe,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(Ne,{...Me,label:t.state.name,onDelete:m})})})}const Ve=[{id:"ticketId",label:"#",width:140},{id:"date",label:"Date",width:280},{id:"topic",label:"Topic"},{id:"priority",label:"Priority"},{id:"lastUpdate",label:"Last Updated"},{id:"status",label:"Status"},{id:"",width:88}],_e=({tickets:t,analytics:r})=>{const s=ue({defaultOrderBy:"orderNumber"}),c=oe(),m=U(),[n,i]=p.useState(t),l=ie({name:"",status:"all",startDate:null,endDate:null});p.useEffect(()=>{i(t)},[t]);const g=re(l.state.startDate,l.state.endDate),o=Je({inputData:n,comparator:he(s.order,s.orderBy),filters:l.state,dateError:g}),u=xe(o,s.page,s.rowsPerPage),j=!!l.state.name||l.state.status!=="all"||!!l.state.startDate&&!!l.state.endDate,k=!o.length&&j||!o.length,v=p.useCallback(d=>{R(d)},[u.length,s,n]),I=p.useCallback(d=>{c.push(P.dashboard.tickets.details(d))},[c]),w=V(),{mutate:R}=H({mutationFn:d=>C.delete(b.tickets.delete+d),onSuccess:async()=>{const d=n.filter(T=>T.id!==id);_.success("Delete success!"),i(d),s.onUpdatePageDeleteRow(u.length)},onSettled:async()=>{await w.invalidateQueries({queryKey:["tickets"]}),await w.invalidateQueries({queryKey:["tickets","analytics"]})},onError:d=>{}}),z=()=>r.isPending||r.isLoading?e.jsx(f,{xs:12,md:12,children:e.jsx(N,{})}):e.jsxs(e.Fragment,{children:[e.jsx(f,{xs:12,md:4,children:e.jsx(L,{title:"All Tickets",total:t.length,chart:{}})}),e.jsx(f,{xs:12,md:4,children:e.jsx(L,{title:"Open Tickets",total:r.data.analytics.Open,chart:{}})}),e.jsx(f,{xs:12,md:4,children:e.jsx(L,{title:"Close Tickets",total:r.data.analytics.Closed,chart:{}})})]});return e.jsxs(e.Fragment,{children:[e.jsx(ne,{maxWidth:"xl",children:e.jsxs(f,{container:!0,spacing:3,children:[e.jsx(f,{xs:12,md:12,children:e.jsx(pe,{links:[{name:"Dashboard",href:P.dashboard.root},{name:"Ticket",href:P.dashboard.tickets.root}],action:e.jsx(O,{permission:A.ADD_TICKET,children:e.jsx(M,{onClick:()=>m.onToggle(),variant:"contained",startIcon:e.jsx(D,{icon:"mingcute:add-line"}),children:"Add New Ticket"})})})}),e.jsxs(O,{permission:A.TICKET_LIST,children:[z(),e.jsx(f,{xs:12,md:12,children:e.jsxs(le,{children:[e.jsx(Ge,{filters:l,onResetPage:s.onResetPage,dateError:g}),j&&e.jsx(Ue,{filters:l,totalResults:o.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(q,{sx:{position:"relative"},children:[e.jsx(ge,{dense:s.dense,numSelected:s.selected.length,rowCount:o.length}),e.jsx(J,{sx:{minHeight:444},children:e.jsxs(be,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(we,{order:s.order,orderBy:s.orderBy,headLabel:Ve,rowCount:o.length}),e.jsxs(Te,{children:[o.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map((d,T)=>e.jsx(ze,{row:d,index:s.page*s.rowsPerPage+T+1,selected:s.selected.includes(d.id),onSelectRow:()=>s.onSelectRow(d.id),onDeleteRow:()=>v(d.id),onViewRow:()=>I(d.id)},d.id)),e.jsx(je,{height:s.dense?56:76,emptyRows:fe(s.page,s.rowsPerPage,o.length)}),e.jsx(ye,{notFound:k})]})]})})]}),e.jsx(Se,{page:s.page,dense:s.dense,count:o.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})]})]})}),e.jsx(We,{open:m.value,onClose:m.onFalse})]})};function Je({inputData:t,comparator:r,filters:s,dateError:c}){const{status:m,name:n,startDate:i,endDate:l}=s,g=t.map((o,u)=>[o,u]);return g.sort((o,u)=>{const j=r(o[0],u[0]);return j!==0?j:o[1]-u[1]}),t=g.map(o=>o[0]),n&&(t=t.filter(o=>o.id.toString().indexOf(n.toLowerCase())!==-1||o.topic.toLowerCase().indexOf(n.toLowerCase())!==-1||o.priority.toLowerCase().indexOf(n.toLowerCase())!==-1)),m!=="all"&&(t=t.filter(o=>o.status===m)),c||i&&l&&(t=t.filter(o=>de(o.createdAt,i,l))),t}const $e={title:`Tickets list | Dashboard - ${me.site.name}`};function as(){const t=K({queryKey:["tickets"],queryFn:async()=>{const{data:s}=await C.get(b.tickets.list);return s}}),r=K({queryKey:["tickets","analytics"],queryFn:async()=>{const{data:s}=await C.get(b.tickets.analytics);return s}});return r.isLoading||t.isLoading?e.jsx(N,{}):t.isError||r.isError?e.jsx($,{route:P.dashboard.tickets.root}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{children:e.jsxs("title",{children:[" ",$e.title]})}),e.jsx(_e,{tickets:t.data,analytics:r})]})}export{as as default};

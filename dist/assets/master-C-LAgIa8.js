import{br as O,a3 as Se,Y,j as e,B as j,T as p,$ as ye,I as U,dc as je,a6 as be,a7 as G,e as q,r as m,dp as J,dq as C,dn as v,dr as K,a5 as te,S as T,a0 as pe,X as Te,C as M,bQ as Ce,cZ as z,dQ as ve,p as _,dU as Fe,H as we}from"./index-BqQARj70.js";import{u as Ee,E as De}from"./error-block-Cvsq6LVS.js";import{C as Pe}from"./custom-breadcrumbs-ryDpeVg5.js";import{z as g,u as R,t as X,a as Z,F as x}from"./form-provider-ccfU2XUN.js";import{h as Be}from"./utils-BkGDLkaZ.js";import{u as B}from"./useMutation-D9b-SBJX.js";import{f as ee}from"./format-number-BvEweN_e.js";import{b as qe,U as Le}from"./upload-avatar-rmFzksOv.js";import"./editor-QJd8noTi.js";import{s as $e}from"./schema-helper-BD6wlizp.js";import{C as ke}from"./confirm-dialog-D-kAfeIE.js";import"./image-D-bc4Fg4.js";import{a as se,b as re,D as ne}from"./DialogContent-Bu9AzrBB.js";import{D as ae}from"./DialogTitle-rK5KahkH.js";import{L as oe}from"./LoadingButton-F-RhBSUA.js";import{I as Ie}from"./InputAdornment-BfS4czl_.js";import{C as Ne}from"./CardHeader-DXB_c6fw.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./TextField-Ddc-2_B3.js";import"./FormControl-C8LIfacH.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-Cypnw6Fi.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-Dza6C49E.js";import"./Select-BcNE4CY6.js";import"./Menu-CyG4g8V9.js";import"./InputBase-ByUog9Qa.js";import"./FormHelperText-D7zaUcMu.js";import"./Rating-CRHSMtZR.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-CY1kJa8b.js";import"./RadioGroup-ChlGooHA.js";import"./FormGroup-CXDpwB7j.js";import"./FormControlLabel-DYa7_yhu.js";import"./index-ALNGUIW9.js";import"./countries-DSLisFCy.js";import"./Autocomplete-mVzVA2ZY.js";import"./Chip-DPBTbqGw.js";import"./country-select-BdT_Z9O2.js";import"./Checkbox-Bhx6CUcB.js";import"./DatePicker-Ce3HVs4j.js";import"./ListItem-D-3kOQEW.js";import"./MobileDateTimePicker-huLGYsGv.js";import"./Tabs-CmqXMWlF.js";import"./KeyboardArrowRight-CBFHahxG.js";import"./index-3on3wy4W.js";import"./CircularProgress-CnEecEq8.js";const ze=({text:t,onDelete:c,onEdit:l})=>{const{t:n}=O("setting"),a=Se(),d=Y(),h=e.jsx(j,{component:"li",sx:{"&:hover":{bgcolor:"action.hover"}},children:e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(p,{variant:"subtitle2",children:t}),e.jsx(ye,{color:a.open?"inherit":"default",onClick:a.onOpen,children:e.jsx(U,{icon:"eva:more-vertical-fill"})})]})});return e.jsxs(e.Fragment,{children:[h,e.jsx(je,{open:a.open,anchorEl:a.anchorEl,onClose:a.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(be,{children:[e.jsxs(G,{onClick:()=>{l(),a.onClose()},children:[e.jsx(U,{icon:"solar:pen-bold"}),`${n("masterSetting.editButton")}`]}),e.jsxs(G,{onClick:()=>{d.onTrue(),a.onClose()},children:[e.jsx(U,{icon:"solar:trash-bin-trash-bold"}),`${n("masterSetting.deleteButton")}`]})]})}),e.jsx(ke,{open:d.value,onClose:d.onFalse,title:n("masterSetting.dialogDelete.title"),content:n("masterSetting.dialogDelete.text"),action:e.jsx(q,{variant:"contained",color:"error",onClick:()=>{c(),d.onFalse()},children:n("masterSetting.dialogDelete.confirmDelete")})})]})},Me=g.object({description:g.string().min(1,{message:"Term is required!"})}),Oe=({application:t,idx:c,term:l,open:n,onClose:a})=>{const{t:d}=O("setting"),[h,b]=m.useState(t==null?void 0:t.terms),f=m.useMemo(()=>({description:l}),[l]),F=R({resolver:X(Me),defaultValues:f}),{reset:E,handleSubmit:L,formState:{isSubmitting:Q}}=F;m.useEffect(()=>{b(t==null?void 0:t.terms)},[n]),m.useEffect(()=>{E(f)},[f,E,t]);const $=L(async({description:u})=>{try{b(w=>{const I=[...w];I[c].description=u;const W={appId:t.id,terms:h};return i(W),I})}catch(w){console.log(w)}}),k=J(),{mutate:i}=B({mutationFn:u=>C.post(v.master.addTerm,u),onSuccess:async({data:u})=>{K.success(d("masterSetting.dialogEditTerm.editSuccess")),await k.invalidateQueries({queryKey:["account-application"]})},onSettled:()=>{a()},onError:u=>{console.log(u)}});return e.jsxs(se,{fullWidth:!0,maxWidth:"lg",open:n,onClose:a,children:[e.jsx(ae,{children:d("masterSetting.dialogEditTerm.title")}),e.jsx(te,{}),e.jsxs(Z,{methods:F,onSubmit:$,children:[e.jsx(re,{sx:{pt:1,mt:1},children:e.jsx(T,{spacing:2,children:e.jsx(x.Text,{label:d("masterSetting.dialogEditTerm.label"),type:"text",name:"description",sx:{mt:2},fullWidth:!0,placeholder:d("masterSetting.dialogEditTerm.placeholder"),inputProps:{maxLength:120}})})}),e.jsxs(ne,{children:[e.jsx(oe,{type:"submit",variant:"contained",children:d("masterSetting.dialogEditTerm.confirmButton")}),e.jsx(q,{color:"inherit",variant:"outlined",onClick:a,children:d("masterSetting.dialogEditTerm.closeButton")})]})]})]})},Qe=g.object({description:g.string().min(1,{message:"Term is required!"})}),Ve=({application:t,open:c,onClose:l})=>{const{t:n}=O("setting"),[a,d]=m.useState(t==null?void 0:t.terms),h=m.useMemo(()=>({description:""}),[]),b=R({resolver:X(Qe),defaultValues:h}),{reset:f,handleSubmit:F,formState:{isSubmitting:E}}=b;m.useEffect(()=>{d(t==null?void 0:t.terms)},[c]),m.useEffect(()=>{f(h)},[h,f,t]);const L=F(async i=>{try{(a==null?void 0:a.length)>=0?d(u=>[...u,{title:`Term${a==null?void 0:a.length}`,...i}]):d(u=>[{title:"Term0",...i}]),f(h)}catch(u){console.log(u)}}),Q=J(),{mutate:$}=B({mutationFn:i=>C.post(v.master.addTerm,i),onSuccess:async({data:i})=>{K.success(n("masterSetting.dialogCreateTerm.createSuccess")),await Q.invalidateQueries({queryKey:["account-application"]})},onSettled:()=>{l()},onError:i=>{console.log(i)}}),k=()=>{const i={appId:t.id,terms:a};$(i)};return e.jsxs(se,{fullWidth:!0,maxWidth:"lg",open:c,onClose:l,children:[e.jsx(ae,{children:n("masterSetting.dialogCreateTerm.title")}),e.jsx(te,{}),e.jsx(Z,{methods:b,onSubmit:L,children:e.jsx(re,{sx:{pt:1,mt:1},children:e.jsxs(T,{spacing:2,children:[e.jsx(j,{component:"ul",sx:{mb:1,pl:3,typography:"body2",listStyleType:"disc"},children:a==null?void 0:a.map((i,u)=>e.jsx(j,{component:"li",children:e.jsx(p,{variant:"subtitle2",children:i==null?void 0:i.description})},u))}),(a==null?void 0:a.length)<=6?e.jsx(x.Text,{label:n("masterSetting.dialogCreateTerm.label"),type:"text",name:"description",sx:{mt:2},fullWidth:!0,placeholder:n("masterSetting.dialogCreateTerm.placeholder"),inputProps:{maxLength:120},InputProps:{endAdornment:e.jsx(Ie,{position:"end",children:e.jsx(q,{color:"primary",onClick:L,sx:{mr:-.5},children:n("masterSetting.dialogCreateTerm.addButton")})})}}):e.jsx(pe,{severity:"warning",children:n("masterSetting.dialogCreateTerm.alert")})]})})}),e.jsxs(ne,{children:[e.jsx(oe,{type:"submit",variant:"contained",onClick:k,children:n("masterSetting.dialogCreateTerm.confirmButton")}),e.jsx(q,{color:"inherit",variant:"outlined",onClick:l,children:n("masterSetting.dialogCreateTerm.closeButton")})]})]})},He=g.object({name:g.string().min(1,{message:"Staff First Name is required!"}),description:g.string(),email:g.string().min(1,{message:"Email is required!"}).email({message:"Email must be a valid email address!"}),phoneNumber:$e.phoneNumber({isValidPhoneNumber:Be}),currencySymbol:g.string().min(1,{message:"Staff Last Name is required!"}),taxPercentage:g.number().min(1,{message:"Staff Last Name is required!"}),country:g.string().min(1,{message:"Country is required!"}),state:g.string(),street:g.string(),city:g.string(),district:g.string(),zipCode:g.string(),taxNumber:g.number().optional(),printerPOS:g.string().min(1,{message:"Printer POS is required!"})}),Ue=({applicationAccount:t,financial:c})=>{const l=m.useRef(t),{t:n}=O("setting"),[a,d]=m.useState(null),[h,b]=m.useState(null),f=Te(),F=Y(),E=Y(),[L,Q]=m.useState(),[$,k]=m.useState(),[i,u]=m.useState(t==null?void 0:t.terms);m.useEffect(()=>{t&&(u(t==null?void 0:t.terms),W(w),d(`${M.site.serverFileHost}${t.favicon}`),b(`${M.site.serverFileHost}${t.appLogo}`))},[t]);const w=m.useMemo(()=>{var r,o,S,y,D,P;const s={name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||"",email:(t==null?void 0:t.email)||"",phoneNumber:(t==null?void 0:t.phoneNumber)||"",currencySymbol:(t==null?void 0:t.currencySymbol)||"",taxPercentage:(t==null?void 0:t.taxPercentage)||"",country:((r=t==null?void 0:t.address)==null?void 0:r.country)||"",state:((o=t==null?void 0:t.address)==null?void 0:o.state)||"",city:((S=t==null?void 0:t.address)==null?void 0:S.city)||"",district:((y=t==null?void 0:t.address)==null?void 0:y.district)||"",zipCode:((D=t==null?void 0:t.address)==null?void 0:D.zipCode)||"",street:((P=t==null?void 0:t.address)==null?void 0:P.street)||"",printerPOS:(t==null?void 0:t.printerPOS)||""};return(t==null?void 0:t.taxNumber)==null||(s.taxNumber=parseInt(t==null?void 0:t.taxNumber,10)),s},[t]),I=R({resolver:X(He),defaultValues:w}),{reset:W,watch:We,setValue:Ye,handleSubmit:ie,control:_e,formState:{isSubmitting:Je}}=I,me=ie(async s=>{try{if(s.city||s.country||s.district||s.state||s.street||s.zipCode){const{country:r,state:o,city:S,district:y,zipCode:D,street:P}=s;s.address={country:r,state:o,city:S,district:y,zipCode:D,street:P},delete s.city,delete s.country,delete s.district,delete s.state,delete s.street,delete s.zipCode}if(l.current={...s},a&&h){const r=new FormData;r.append("file",a),r.append("category","AppAvatar");const o=new FormData;o.append("file",h),o.append("category","AppLogo"),await he({avatar:r,logo:o})}else if(a){const r=new FormData;r.append("file",a),r.append("category","AppAvatar"),await ue(r)}else if(h){const r=new FormData;r.append("file",h),r.append("category","AppLogo"),await xe(r)}else await H(s)}catch(r){console.error(r)}}),le=m.useCallback(s=>{const r=s[0];d(r)},[]),de=m.useCallback(s=>{const r=s[0];b(()=>r)},[]),ge=()=>{b(null)},V={headers:{"content-type":"multipart/form-data"}},A=m.useCallback(s=>{const r=document.querySelector("link[rel~='icon']")||document.createElement("link");r.type="image/x-icon",r.rel="icon",r.href=s,document.getElementsByTagName("head")[0].appendChild(r)},[]),N=J(),{mutate:ue}=B({mutationFn:s=>C.post(v.files.upload,s,V),onSuccess:async({data:s})=>{const{name:r}=s;if(r){const{current:o}=l;o.favicon=r,A(`${M.site.serverFileHost}${r}`),await H(o)}return s},onSettled:async()=>{await N.invalidateQueries({queryKey:["appAvatar-images"]})},onError:s=>{console.log(s)}}),{mutate:xe}=B({mutationFn:s=>C.post(v.files.upload,s,V),onSuccess:async({data:s})=>{const{name:r}=s;if(r){const{current:o}=l;o.appLogo=r,await H(o)}return s},onSettled:async()=>{await N.invalidateQueries({queryKey:["appAvatar-images"]})},onError:s=>{console.log(s)}}),{mutate:he}=B({mutationFn:async({avatar:s,logo:r})=>{const o=await C.post(v.files.upload,s,V),S=await C.post(v.files.upload,r,V);return{avatarRes:o,logoRes:S}},onSuccess:async({avatarRes:s,logoRes:r})=>{var D,P;const o=(D=s==null?void 0:s.data)==null?void 0:D.name,S=(P=r==null?void 0:r.data)==null?void 0:P.name,{current:y}=l;S&&(y.appLogo=S),o&&(y.favicon=o),A(`${M.site.serverFileHost}${o}`),await H(y)},onSettled:async()=>{await N.invalidateQueries({queryKey:["appAvatar-images"]})},onError:s=>{console.log(s)}}),{mutate:H}=B({mutationFn:s=>C.patch(v.master.edit,s),onSuccess:async({data:s})=>{var y;const{user:r,setState:o}=f;(y=r.userOwnedApps)!=null&&y.appLogo?r.userOwnedApps.appLogo=s.appLogo:r.applications.appLogo=s.appLogo,f.user={...r},o(f),K.success("Master Account Has Been Modified!");const{currencySymbol:S}=l.current;localStorage.setItem(Ce,S)},onSettled:async()=>{await N.invalidateQueries({queryKey:["account-application"]})},onError:s=>{console.log(s)}}),{mutate:ce}=B({mutationFn:s=>C.post(v.master.addTerm,s),onSuccess:async({data:s})=>{K.success("Master Account Has Been Modified!"),await N.invalidateQueries({queryKey:["account-application"]})},onError:s=>{console.log(s)}}),fe=s=>{const r=[...i];r.splice(s,1);const o={appId:t.id,terms:r};ce(o)};return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{methods:I,onSubmit:me,children:[e.jsx(z,{sx:{mb:4},children:e.jsxs(T,{spacing:2,sx:{p:3},children:[e.jsx(p,{variant:"h6",gutterBottom:!0,children:n("masterSetting.organizationDetails")}),e.jsxs(j,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(x.Text,{name:"name",label:n("masterSetting.organizationName")}),e.jsx(x.Phone,{name:"phoneNumber",label:n("masterSetting.phoneNumber")}),e.jsx(x.Text,{name:"email",label:n("masterSetting.email")}),e.jsx(x.Text,{name:"description",label:n("masterSetting.description")}),e.jsxs(T,{spacing:1.5,children:[e.jsx(p,{variant:"subtitle2",children:n("masterSetting.attachments")}),e.jsx(qe,{value:h,onDrop:de,onDelete:ge})]}),e.jsxs(T,{spacing:1.5,children:[e.jsx(p,{variant:"subtitle2",children:n("masterSetting.favicon")}),e.jsx(Le,{value:a,onDrop:le,validator:s=>s.size>1e6?{code:"file-too-large",message:`File is larger than ${ee(1e6)}`}:null,helperText:e.jsxs(p,{variant:"caption",sx:{mt:3,mx:"auto",display:"block",textAlign:"center",color:"text.disabled"},children:["Allowed *.jpeg, *.jpg, *.png, *.gif",e.jsx("br",{})," max size of ",ee(3145728)]})})]})]})]})}),e.jsx(z,{sx:{mb:4},children:e.jsxs(T,{spacing:2,sx:{p:3},children:[e.jsx(p,{variant:"h6",gutterBottom:!0,children:n("masterSetting.financeSetting")}),e.jsxs(j,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(x.Text,{name:"currencySymbol",label:n("masterSetting.currencySymbol")}),e.jsx(x.Text,{name:"taxPercentage",label:n("masterSetting.taxPercentage")})]})]})}),e.jsx(z,{sx:{mb:4},children:e.jsxs(T,{spacing:2,sx:{p:3},children:[e.jsx(p,{variant:"h6",gutterBottom:!0,children:n("masterSetting.firmAddress")}),e.jsxs(j,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(x.CountrySelect,{name:"country",label:n("masterSetting.country"),placeholder:n("masterSetting.country")}),e.jsx(x.Text,{name:"state",label:n("masterSetting.state")}),e.jsx(x.Text,{name:"city",label:n("masterSetting.city")}),e.jsx(x.Text,{name:"district",label:n("masterSetting.district")}),e.jsx(x.Text,{name:"zipCode",label:n("masterSetting.zipCode")}),e.jsx(x.Text,{name:"street",label:n("masterSetting.street")}),e.jsx(x.Text,{type:"number",name:"taxNumber",label:n("masterSetting.storeTaxNumber")})]})]})}),e.jsxs(z,{sx:{mb:4},children:[e.jsx(Ne,{title:n("masterSetting.termsAndConditions"),action:e.jsx(q,{size:"small",color:"primary",startIcon:e.jsx(U,{icon:"mingcute:add-line"}),onClick:F.onTrue,children:n("masterSetting.newTermButton")})}),e.jsx(T,{spacing:2,sx:{p:3},children:e.jsx(j,{component:"ul",sx:{mb:1,pl:3,typography:"body2",listStyleType:"disc"},children:i==null?void 0:i.map((s,r)=>e.jsx(ze,{text:s==null?void 0:s.description,onDelete:()=>{fe(r)},onEdit:()=>{k(r),Q(s==null?void 0:s.description),E.onTrue()}},r))})})]}),e.jsx(z,{sx:{mb:4},children:e.jsxs(T,{spacing:2,sx:{p:3},children:[e.jsx(p,{variant:"h6",gutterBottom:!0,children:n("masterSetting.otherSettings")}),e.jsx(j,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:e.jsxs(x.Select,{name:"printerPOS",label:n("masterSetting.printerPOS"),sx:{width:420,textTransform:"capitalize"},children:[e.jsx(G,{value:"A4",children:n("masterSetting.a4")}),e.jsx(G,{value:"Thermal",children:n("masterSetting.thermal")})]})})]})}),e.jsxs(j,{display:"flex",justifyContent:"flex-end",gap:2,mt:2,children:[e.jsx(q,{type:"submit",variant:"contained",children:n("masterSetting.saveChanges")}),e.jsx(q,{variant:"outlined",children:n("masterSetting.cancel")})]})]}),e.jsx(Ve,{application:t,open:F.value,onClose:F.onFalse}),e.jsx(Oe,{application:t,term:L,idx:$,open:E.value,onClose:E.onFalse})]})},Ge=({applicationAccount:t,financial:c})=>{const{t:l}=O("setting");return e.jsxs(ve,{children:[e.jsx(Pe,{links:[{name:`${l("masterSetting.breadCrumbsPageRootTitle")}`,href:_.dashboard.root},{name:`${l("masterSetting.breadCrumbsParentPageTitle")}`,href:_.dashboard.tools.root},{name:`${l("masterSetting.breadCrumbsPageTitle")}`}],sx:{mb:{xs:3,md:5}}}),e.jsx(Ue,{applicationAccount:t,financial:c})]})},Ke={title:`Tools | Dashboard - ${M.site.name}`};function Kt(){const t=Ee({queryKey:["account-application"],queryFn:async()=>{const{data:c}=await C.get(v.auth.application);return c}});return t.isLoading?e.jsx(Fe,{}):t.isError?e.jsx(De,{route:_.dashboard.tools.root}):e.jsxs(e.Fragment,{children:[e.jsx(we,{children:e.jsxs("title",{children:[" ",Ke.title]})}),e.jsx(Ge,{applicationAccount:t.data})]})}export{Kt as default};

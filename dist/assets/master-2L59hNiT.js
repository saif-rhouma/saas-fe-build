import{r as g,dI as V,dJ as b,dH as f,dK as J,d7 as _,j as r,aD as v,S as u,T as h,B as C,bR as T,e as B,e8 as $,p as N,ec as Z,H as W,C as X}from"./index-CcYGUVHj.js";import{u as M,E as R}from"./error-block-DrLwzfMU.js";import{C as Y}from"./custom-breadcrumbs-B2pKwILD.js";import{z as m,c,u as A,t as ee,a as re,F as i}from"./form-provider-CdJJxIi_.js";import{u as D}from"./useMutation-Cy6dNzJR.js";import{a as L}from"./format-number-DKjUSt8e.js";import{b as se,U as te}from"./upload-avatar-pih1cWPZ.js";import"./editor-CmrbN6Cg.js";import{s as ae}from"./schema-helper-DQrBur17.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./TextField-Q8D-fe1P.js";import"./FormControl-DyEi2am2.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-C9X7_uSi.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-Ct8Q-9i0.js";import"./Select-oUaPpSxi.js";import"./Menu-DMwTpGo6.js";import"./InputBase-D4Zcsm26.js";import"./FormHelperText-CaS0BGUe.js";import"./Rating-BJzZeIIm.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-BfGPK7NS.js";import"./RadioGroup-BKIHz0-8.js";import"./FormGroup-DkBXOvcX.js";import"./FormControlLabel-BEskPPUu.js";import"./index-SZ6SJdRJ.js";import"./countries-DSLisFCy.js";import"./InputAdornment--gMbc1oW.js";import"./Autocomplete-BoqBGuRO.js";import"./Chip-BF8Po0b7.js";import"./country-select-8WIzbqhk.js";import"./Checkbox-DgQwk_ps.js";import"./DatePicker-MBb6QCnS.js";import"./DialogContent-Blcxs__o.js";import"./ListItem-DhWHRhwD.js";import"./MobileDateTimePicker-DSMzaFF0.js";import"./Tabs-s_UE9AaI.js";import"./KeyboardArrowRight-u_Zt7Aff.js";import"./image-l-gE1IT4.js";import"./index-Bv3fybKl.js";const me=m.object({name:m.string().min(1,{message:"Staff First Name is required!"}),description:m.string(),email:m.string().min(1,{message:"Email is required!"}).email({message:"Email must be a valid email address!"}),phoneNumber:ae.phoneNumber({isValidPhoneNumber:c}),currencySymbol:m.string().min(1,{message:"Staff Last Name is required!"}),taxPercentage:m.number().min(1,{message:"Staff Last Name is required!"}),financialYear:m.number().min(1,{message:"Financial Year is required!"}),country:m.string().min(1,{message:"Country is required!"}),state:m.string(),street:m.string(),city:m.string(),district:m.string(),zipCode:m.string(),taxNumber:m.number(),printerPOS:m.string().min(1,{message:"Printer POS is required!"})}),ie=({applicationAccount:s,financial:y})=>{const d=g.useRef(s),[j,G]=g.useState(null),[S,P]=g.useState(null);g.useEffect(()=>{s&&O(q)},[s]);const q=g.useMemo(()=>{var e,t,a,n,l,o,x;return{name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",email:(s==null?void 0:s.email)||"",phoneNumber:(s==null?void 0:s.phoneNumber)||"",currencySymbol:(s==null?void 0:s.currencySymbol)||"",taxPercentage:(s==null?void 0:s.taxPercentage)||"",financialYear:((e=s==null?void 0:s.financialYear)==null?void 0:e.id)||"",country:((t=s==null?void 0:s.address)==null?void 0:t.country)||"",state:((a=s==null?void 0:s.address)==null?void 0:a.state)||"",city:((n=s==null?void 0:s.address)==null?void 0:n.city)||"",district:((l=s==null?void 0:s.address)==null?void 0:l.district)||"",zipCode:((o=s==null?void 0:s.address)==null?void 0:o.zipCode)||"",street:((x=s==null?void 0:s.address)==null?void 0:x.street)||"",taxNumber:(s==null?void 0:s.taxNumber)||0,printerPOS:(s==null?void 0:s.printerPOS)||""}},[s]),E=A({resolver:ee(me),defaultValues:q}),{reset:O,watch:le,setValue:oe,handleSubmit:U,control:xe,formState:{isSubmitting:ge}}=E,K=U(async e=>{try{if(e.city||e.country||e.district||e.state||e.street||e.zipCode){const{country:t,state:a,city:n,district:l,zipCode:o,street:x}=e;e.address={country:t,state:a,city:n,district:l,zipCode:o,street:x},delete e.city,delete e.country,delete e.district,delete e.state,delete e.street,delete e.zipCode}if(d.current={...e},j&&S){const t=new FormData;t.append("file",j),t.append("category","AppAvatar");const a=new FormData;a.append("file",S),a.append("category","AppLogo"),await Q({avatar:t,logo:a})}else if(j){const t=new FormData;t.append("file",j),t.append("category","AppAvatar"),await z(t)}else if(S){const t=new FormData;t.append("file",S),t.append("category","AppLogo"),await z(t)}else await w(e)}catch(t){console.error(t)}}),k=g.useCallback(e=>{const t=e[0];G(t)},[]),H=g.useCallback(e=>{const t=e[0];P(()=>t)},[]),I=()=>{P(null)},F={headers:{"content-type":"multipart/form-data"}},p=V(),{mutate:z}=D({mutationFn:e=>b.post(f.files.upload,e,F),onSuccess:async({data:e})=>{const{name:t}=e;if(t){const{current:a}=d;a.avatar=t,await w(a)}return e},onSettled:async()=>{await p.invalidateQueries({queryKey:["appAvatar-images"]})},onError:e=>{console.log(e)}}),{mutate:Q}=D({mutationFn:async({avatar:e,logo:t})=>{const a=await b.post(f.files.upload,e,F),n=await b.post(f.files.upload,t,F);return{avatarRes:a,logoRes:n}},onSuccess:async({avatarRes:e,logoRes:t})=>{var o,x;const a=(o=e==null?void 0:e.data)==null?void 0:o.name,n=(x=t==null?void 0:t.data)==null?void 0:x.name,{current:l}=d;n&&(l.appLogo=n),a&&(l.favicon=a),await w(l)},onSettled:async()=>{await p.invalidateQueries({queryKey:["appAvatar-images"]})},onError:e=>{console.log(e)}}),{mutate:w}=D({mutationFn:e=>b.patch(f.master.edit,e),onSuccess:async()=>{J.success("Master Account Has Been Modified!");const{currencySymbol:e}=d.current;localStorage.setItem(_,e)},onSettled:async()=>{await p.invalidateQueries({queryKey:["account-application"]})},onError:e=>{console.log(e)}});return r.jsxs(re,{methods:E,onSubmit:K,children:[r.jsx(v,{sx:{mb:4},children:r.jsxs(u,{spacing:2,sx:{p:3},children:[r.jsx(h,{variant:"h6",gutterBottom:!0,children:"Application Details"}),r.jsxs(C,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[r.jsx(i.Text,{name:"name",label:"Application Name"}),r.jsx(i.Phone,{name:"phoneNumber",label:"Phone number"}),r.jsx(i.Text,{name:"email",label:"Email address"}),r.jsx(i.Text,{name:"description",label:"Description"}),r.jsxs(u,{spacing:1.5,children:[r.jsx(h,{variant:"subtitle2",children:"Attachments"}),r.jsx(se,{value:S,onDrop:H,onDelete:I})]}),r.jsxs(u,{spacing:1.5,children:[r.jsx(h,{variant:"subtitle2",children:"Favicon"}),r.jsx(te,{value:j,onDrop:k,validator:e=>e.size>1e6?{code:"file-too-large",message:`File is larger than ${L(1e6)}`}:null,helperText:r.jsxs(h,{variant:"caption",sx:{mt:3,mx:"auto",display:"block",textAlign:"center",color:"text.disabled"},children:["Allowed *.jpeg, *.jpg, *.png, *.gif",r.jsx("br",{})," max size of ",L(3145728)]})})]})]})]})}),r.jsx(v,{sx:{mb:4},children:r.jsxs(u,{spacing:2,sx:{p:3},children:[r.jsx(h,{variant:"h6",gutterBottom:!0,children:"Finance Setting"}),r.jsxs(C,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(3, 1fr)"},children:[r.jsx(i.Text,{name:"currencySymbol",label:"Currency Symbol"}),r.jsx(i.Text,{name:"taxPercentage",label:"Tax Percentage"}),r.jsx(i.Select,{name:"financialYear",label:"Select a Financial Year",sx:{width:420,textTransform:"capitalize"},children:y.map(e=>r.jsx(T,{value:e==null?void 0:e.id,children:e==null?void 0:e.year},e==null?void 0:e.id))})]})]})}),r.jsx(v,{sx:{mb:4},children:r.jsxs(u,{spacing:2,sx:{p:3},children:[r.jsx(h,{variant:"h6",gutterBottom:!0,children:"Firm Address"}),r.jsxs(C,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[r.jsx(i.CountrySelect,{name:"country",label:"Country",placeholder:"Choose a country"}),r.jsx(i.Text,{name:"state",label:"State/region"}),r.jsx(i.Text,{name:"city",label:"City"}),r.jsx(i.Text,{name:"district",label:"District"}),r.jsx(i.Text,{name:"zipCode",label:"Zip/code"}),r.jsx(i.Text,{name:"street",label:"Address"}),r.jsx(i.Text,{type:"number",name:"taxNumber",label:"Store Tax Number"})]})]})}),r.jsx(v,{sx:{mb:4},children:r.jsxs(u,{spacing:2,sx:{p:3},children:[r.jsx(h,{variant:"h6",gutterBottom:!0,children:"Other Settings"}),r.jsx(C,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:r.jsxs(i.Select,{name:"printerPOS",label:"Printer POS",sx:{width:420,textTransform:"capitalize"},children:[r.jsx(T,{value:"A4",children:"A4"}),r.jsx(T,{value:"Thermal",children:"Thermal"})]})})]})}),r.jsxs(C,{display:"flex",justifyContent:"flex-end",gap:2,mt:2,children:[r.jsx(B,{type:"submit",variant:"contained",children:"Save Changes"}),r.jsx(B,{variant:"outlined",children:"Cancel"})]})]})},ne=({applicationAccount:s,financial:y})=>r.jsxs($,{children:[r.jsx(Y,{links:[{name:"Dashboard",href:N.dashboard.root},{name:"Tools",href:N.dashboard.tools.root},{name:"Master Settings"}],sx:{mb:{xs:3,md:5}}}),r.jsx(ie,{applicationAccount:s,financial:y})]}),de={title:`Tools | Dashboard - ${X.site.name}`};function sr(){const s=M({queryKey:["account-application"],queryFn:async()=>{const{data:d}=await b.get(f.auth.application);return d}}),y=M({queryKey:["financial-year"],queryFn:async()=>{const{data:d}=await b.get(f.financial.list);return d}});return y.isLoading||s.isLoading?r.jsx(Z,{}):s.isError?r.jsx(R,{route:N.dashboard.tools.root}):r.jsxs(r.Fragment,{children:[r.jsx(W,{children:r.jsxs("title",{children:[" ",de.title]})}),r.jsx(ne,{applicationAccount:s.data,financial:y.data})]})}export{sr as default};

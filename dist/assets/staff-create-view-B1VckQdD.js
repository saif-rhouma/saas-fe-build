import{dI as T,l as P,r as h,o as k,dJ as j,dH as g,dK as m,p as d,j as e,aD as y,S as q,T as w,B as x,w as D,I as G,e as v,e8 as M}from"./index-yGbCRgTb.js";import{C as Q}from"./custom-breadcrumbs-BVoeLH7h.js";import{z as i,u as V,t as J,a as R,F as t}from"./form-provider-DYU4Aza6.js";import{u as C}from"./useMutation-By1q-eS7.js";import"./image-DcD9e3NU.js";import"./editor-DVBR6pSL.js";import{I as z}from"./InputAdornment-CcIxSkvC.js";const H=i.object({firstName:i.string().min(1,{message:"Staff firstName is required!"}),password:i.string().min(1,{message:"Password is required!"}).min(8,{message:"Password must be at least 8 characters!"}),email:i.string().min(1,{message:"Email is required!"}),permissions:i.string().array().nonempty({message:"At least one permission is required!"}),isActive:i.boolean()});function K({currentStaff:s,appPermissions:o}){const c=T(),b=P(),[L,N]=h.useState(o),r=k(),p=h.useMemo(()=>({firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",phoneNumber:(s==null?void 0:s.phoneNumber)||"",email:(s==null?void 0:s.email)||"",password:(s==null?void 0:s.password)||"",isActive:s==null?void 0:s.isActive,permissions:(s==null?void 0:s.permissions.map(a=>a.slug))||[]}),[s]),u=V({resolver:J(H),defaultValues:p}),{reset:l,watch:O,setValue:U,handleSubmit:I,control:W,formState:{isSubmitting:F}}=u;h.useEffect(()=>{s&&l(p),o&&N(o)},[s,o,p,l]);const{mutate:E}=C({mutationFn:a=>j.post(g.staff.create,a),onSuccess:()=>{m.success("New Staff has been created successfully!"),c.invalidateQueries(["staff"]),l(),b.push(d.dashboard.staff.root)},onError:a=>{console.error(a),m.error("Failed to save staff. Please try again.")}}),{mutate:A}=C({mutationFn:({id:a,payload:n})=>j.patch(g.staff.edit+a,n),onSuccess:()=>{m.success("Staff updated successfully!");const{id:a}=s;c.invalidateQueries(["staff",a]),l(),b.push(d.dashboard.staff.root)},onError:a=>{console.error(a),m.error("Failed to edit staff. Please try again.")}}),B=I(async a=>{try{if(s!=null&&s.id){const{id:n}=s;await A({id:n,payload:a})}else await E(a)}catch(n){console.error(n)}});return e.jsxs(R,{methods:u,onSubmit:B,children:[e.jsx(y,{sx:{mb:4},children:e.jsxs(q,{spacing:4,sx:{p:3},children:[e.jsx(w,{variant:"h6",gutterBottom:!0,children:"Staff Details"}),e.jsxs(x,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(3, 1fr)"},children:[e.jsx(t.Text,{label:"First Name",name:"firstName"}),e.jsx(t.Text,{label:"Email",name:"email"}),e.jsx(t.Phone,{name:"phoneNumber",label:"Phone number"}),e.jsx(t.Text,{name:"password",label:"Password",placeholder:"8+ characters",type:r.value?"text":"password",InputLabelProps:{shrink:!0},InputProps:{endAdornment:e.jsx(z,{position:"end",children:e.jsx(D,{onClick:r.onToggle,edge:"end",children:e.jsx(G,{icon:r.value?"solar:eye-bold":"solar:eye-closed-bold"})})})}})]})]})}),e.jsxs(y,{sx:{p:4},children:[e.jsx(w,{variant:"h6",gutterBottom:!0,sx:{mb:4},children:"Permissions"}),e.jsx(x,{display:"flex",justifyContent:"center",alignItems:"center",sx:{mb:4},children:e.jsx(t.MultiCheckbox,{name:"permissions",options:o.map(a=>({label:a.name,value:a.slug})),sx:{display:"grid",columnGap:4,rowGap:4,gridTemplateColumns:"repeat(4, 1fr)"}})}),e.jsx(t.Switch,{name:"isActive",label:"Is Active?"}),e.jsxs(x,{display:"flex",justifyContent:"flex-end",mt:2,children:[e.jsx(v,{type:"submit",variant:"contained",disabled:F,children:"Submit"}),e.jsx(v,{variant:"outlined",onClick:()=>l(),sx:{ml:2},children:"Cancel"})]})]})]})}function ss({currentStaff:s,appPermissions:o}){return e.jsxs(M,{children:[e.jsx(Q,{links:[{name:"Dashboard",href:d.dashboard.root},{name:"Staff",href:d.dashboard.staff.root},{name:"New Staff"}],sx:{mb:{xs:3,md:5}}}),e.jsx(K,{currentStaff:s,appPermissions:o})]})}export{ss as S};

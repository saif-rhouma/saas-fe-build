import{em as M,r as u,i as S,aP as z,g as G,p as y,j as e,l as Q,I as g,dm as W,au as J,S as D,e as N,B as w,bx as X,aO as Y,A as Z,C as U,e2 as ee,aQ as se,aR as te,aS as $,e3 as O,aX as ae,ec as oe,dw as re,dP as ne,aB as ie,aV as le,ed as ce,dx as F,b5 as A,dy as L,dT as de,H as ue}from"./index-DT04UR_O.js";import{u as me,E as he}from"./error-block-BoCOKljz.js";import{u as H}from"./useMutation-BAtwb5WR.js";import{C as pe}from"./custom-breadcrumbs-DhAwakkx.js";import{P as V}from"./permission-access-controller-B9qE1dum.js";import{g as xe,r as ge,e as Ce}from"./utils-MBUcMVfY.js";import{u as je}from"./use-table-Dvx8L5Dy.js";import{T as be}from"./table-no-data-DSrhKKqU.js";import{T as fe}from"./table-empty-rows-CKpal-Jm.js";import{T as K,a as Te,b as ye,c as Pe}from"./table-head-custom-CK_1KHWF.js";import{T as we}from"./table-selected-action-BJNUh_jK.js";import{T as Se}from"./table-pagination-custom-p7IM4Ndp.js";import{a as ve}from"./format-number-Bl4e0oau.js";import{C as Re}from"./confirm-dialog-DR5RBP9s.js";import{T as b}from"./TableCell-BXVtmUZi.js";import{A as Ee}from"./AvatarGroup-y4qQUbTM.js";import{O as _}from"./order-customer-create-dialog-CjgxB4Z0.js";import{T as ke}from"./TextField-BjQsoMIa.js";import{I as Fe}from"./InputAdornment-Df-7KMx3.js";import{F as Ae,a as De,c as Oe}from"./filters-result-CIhkXI8P.js";import{C as Ve}from"./Chip-QNIqa7VZ.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-bso-Oats.js";import"./Checkbox-BU7EYPXc.js";import"./TablePagination-BV8aUVPa.js";import"./KeyboardArrowRight-DI6e2iIr.js";import"./LastPage-BaKUnPHk.js";import"./Select-C_-xEl5F.js";import"./Menu-BPDpcHu6.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-BM5GWnYp.js";import"./FormControlLabel-CvWNVptb.js";import"./DialogContent-D3trKXnB.js";import"./DialogTitle-BfjGdi3E.js";import"./form-provider-B7hZ-ssH.js";import"./FormHelperText-DdVZ689Y.js";import"./Rating-yEv_VYnC.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-ovNaHRWQ.js";import"./index-DFqQWiXf.js";import"./Slider-C2cpfGcN.js";import"./FormControl-CW9RfL9F.js";import"./FormLabel-D5kKRx-M.js";import"./RadioGroup-DtRipWnf.js";import"./FormGroup-BSMNbJJJ.js";import"./utils-CuXi_5LX.js";import"./index-aTkpnRqN.js";import"./countries-DSLisFCy.js";import"./Autocomplete-Btx_vR5S.js";import"./country-select-DDYiN-2v.js";import"./InputLabel-Dlp26u7k.js";import"./upload-avatar-DKfjcflR.js";import"./image-BC3--aR2.js";import"./DatePicker-B3mVQQbR.js";import"./ListItem-DytXkWka.js";import"./MobileDateTimePicker-BEdQjBBa.js";import"./Tabs-V8wu0P1d.js";import"./schema-helper-CV7wxzWO.js";import"./LoadingButton-CBaPP7po.js";import"./CircularProgress-DxjMVPSY.js";const Ie=({row:s,index:n,selected:t,onDeleteRow:d,onEditRow:m})=>{const{t:c}=M("customer"),[x,f]=u.useState((s==null?void 0:s.lastOrders.length)>0),C=S(),l=S(),o=z(),h=G(),v=a=>a?`${a==null?void 0:a.street} ${a==null?void 0:a.country}.`:" - ",p=u.useCallback(a=>{h.push(y.dashboard.order.details(a))},[h]),T=u.useCallback(a=>{h.push(y.dashboard.customers.details(a))},[h]),R=u.useCallback(a=>{h.push(y.dashboard.product.details(a))},[h]),I=e.jsxs(K,{hover:!0,selected:t,children:[e.jsx(b,{children:(s==null?void 0:s.ref)||n||(s==null?void 0:s.id)}),e.jsx(b,{children:s==null?void 0:s.name}),e.jsx(b,{children:s==null?void 0:s.email}),e.jsx(b,{children:s==null?void 0:s.phoneNumber}),e.jsx(b,{children:v(s==null?void 0:s.address)}),e.jsxs(b,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[x&&e.jsx(Q,{color:l.value?"inherit":"default",onClick:l.onToggle,sx:{...l.value&&{bgcolor:"action.hover"}},children:e.jsx(g,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(Q,{color:o.open?"inherit":"default",onClick:o.onOpen,children:e.jsx(g,{icon:"eva:more-vertical-fill"})})]})]}),B=e.jsx(K,{children:e.jsx(b,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(W,{in:l.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(J,{sx:{m:1.5},children:s==null?void 0:s.lastOrders.map((a,P)=>{var E;return P===5?e.jsx(D,{alignItems:"flex-end",sx:{p:r=>r.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:r=>`solid 2px ${r.vars.palette.background.neutral}`}},children:e.jsx(N,{variant:"contained",size:"small",endIcon:e.jsx(g,{icon:"heroicons-outline:external-link"}),onClick:()=>{T(s.id)},children:c("listView.tableActions.seeMore")})},a.id):e.jsxs(D,{direction:"row",alignItems:"center",sx:{p:r=>r.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:r=>`solid 2px ${r.vars.palette.background.neutral}`}},children:[e.jsxs(w,{onClick:()=>p(a==null?void 0:a.id),sx:{width:240,display:"flex",gap:1,alignItems:"center",cursor:"pointer",marginRight:5},children:[e.jsx(g,{icon:"heroicons-outline:external-link"}),e.jsx("span",{children:a==null?void 0:a.ref})]}),e.jsx(w,{sx:{width:"100%",color:"error.main",fontWeight:"bold"},children:e.jsx(Ee,{sx:{[`& .${X.avatar}`]:{width:24,height:24}},children:(E=a==null?void 0:a.productToOrder)==null?void 0:E.map(r=>{var k,i,j,q;return e.jsx(Y,{title:`${(k=r==null?void 0:r.product)==null?void 0:k.name} | Quantity : ${r.quantity}`,children:e.jsx(Z,{sx:{cursor:"pointer"},alt:(i=r==null?void 0:r.product)==null?void 0:i.name,src:`${U.site.serverFileHost}${(j=r==null?void 0:r.product)==null?void 0:j.image}`,onClick:()=>{R(s.id)}},r==null?void 0:r.id)},(q=r==null?void 0:r.product)==null?void 0:q.id)})})}),e.jsx(w,{sx:{width:200,textAlign:"right"},children:a==null?void 0:a.status}),e.jsx(w,{sx:{width:340,textAlign:"right"},children:ve(ee((a==null?void 0:a.totalOrderAmount)-(a==null?void 0:a.totalOrderAmount)*((a==null?void 0:a.discount)/100),a==null?void 0:a.snapshotTaxPercentage))||"-"})]},a.id)})})})})});return e.jsxs(e.Fragment,{children:[I,B,e.jsx(se,{open:o.open,anchorEl:o.anchorEl,onClose:o.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(te,{children:[e.jsxs($,{onClick:()=>{T(s.id),o.onClose()},children:[e.jsx(g,{icon:"solar:eye-bold"}),c("listView.tableActions.view")]}),e.jsx(V,{permission:O.EDIT_CUSTOMER,children:e.jsxs($,{onClick:()=>{m(),o.onClose()},children:[e.jsx(g,{icon:"solar:pen-bold"}),c("listView.tableActions.edit")]})}),e.jsx(V,{permission:O.DELETE_CUSTOMER,children:e.jsxs($,{onClick:()=>{C.onTrue(),o.onClose()},sx:{color:"error.main"},children:[e.jsx(g,{icon:"solar:trash-bin-trash-bold"}),c("listView.tableActions.delete")]})})]})}),e.jsx(Re,{open:C.value,onClose:C.onFalse,title:c("listView.tableActions.delete"),content:c("listView.messages.deleteDialogText"),action:e.jsx(N,{variant:"contained",color:"error",onClick:d,children:c("listView.tableActions.delete")})})]})};function Be({customer:s,open:n,onClose:t,handler:d}){return e.jsx(_,{customer:s,open:n,onClose:t,handler:d})}function $e({customer:s,open:n,onClose:t,handler:d}){return e.jsx(_,{customer:s,open:n,onClose:t,handler:d})}function Le({filters:s,onResetPage:n}){const{t}=M("customer"),d=u.useCallback(m=>{n(),s.setState({name:m.target.value})},[s,n]);return e.jsx(D,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(ke,{sx:{width:420},value:s.state.name,onChange:d,placeholder:`${t("listView.tableToolbar.searchPlaceholder")}`,InputProps:{startAdornment:e.jsx(Fe,{position:"start",children:e.jsx(g,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}function He({filters:s,totalResults:n,onResetPage:t,sx:d}){const m=u.useCallback(()=>{t(),s.setState({name:""})},[s,t]),c=u.useCallback(()=>{t(),s.onResetState()},[s,t]);return e.jsx(Ae,{totalResults:n,onReset:c,sx:d,children:e.jsx(De,{label:"Keyword:",isShow:!!s.state.name,children:e.jsx(Ve,{...Oe,label:s.state.name,onDelete:m})})})}const Ne=({customers:s})=>{const{t:n}=M("customer"),t=je({defaultOrderBy:"id"}),d=S(),m=S(),c=S(),[x,f]=u.useState(s),[C,l]=u.useState(),o=ae({name:"",status:"all",startDate:null,endDate:null}),h=[{id:"customerId",label:"#",width:88},{id:"name",label:`${n("listView.tableHeader.customerName")}`,width:220},{id:"email",label:`${n("listView.tableHeader.email")}`,width:220},{id:"phoneNumber",label:`${n("listView.tableHeader.phoneNumber")}`,width:120},{id:"address",label:`${n("listView.tableHeader.address")}`,width:120},{id:"",width:88}],v=oe(o.state.startDate,o.state.endDate),p=Me({inputData:x,comparator:xe(t.order,t.orderBy),filters:o.state,dateError:v});u.useEffect(()=>{f(s)},[s]);const T=ge(p,t.page,t.rowsPerPage),R=!!o.state.name||o.state.status!=="all"||!!o.state.startDate&&!!o.state.endDate,I=!p.length&&R||!p.length,B=u.useCallback(i=>{k(i)},[T.length,t,x]),a=u.useCallback(i=>{l(i),m.onToggle()},[T.length,t,x]),P=re(),{mutate:E}=H({mutationFn:i=>F.post(A.customers.create,i),onSuccess:async()=>{L.success(n("listView.messages.createSuccess"))},onSettled:async()=>{await P.invalidateQueries({queryKey:["customers"]}),d.onFalse()},onError:i=>{console.log(i)}}),{mutate:r}=H({mutationFn:({id:i,payload:j})=>F.patch(A.customers.edit+i,j),onSuccess:async()=>{L.success(n("listView.messages.editSuccess"))},onSettled:async()=>{await P.invalidateQueries({queryKey:["customers"]}),m.onFalse()},onError:i=>{console.log(i)}}),{mutate:k}=H({mutationFn:i=>F.delete(A.customers.delete+i),onSuccess:async()=>{const i=x.filter(j=>j.id!==id);L.success(n("listView.messages.deleteSuccess")),f(i),t.onUpdatePageDeleteRow(T.length),c.onFalse()},onSettled:async()=>{await P.invalidateQueries({queryKey:["customers"]}),c.onFalse()},onError:()=>{}});return e.jsxs(e.Fragment,{children:[e.jsx(ne,{maxWidth:"xl",children:e.jsxs(D,{spacing:3,children:[e.jsx(pe,{links:[{name:`${n("listView.pageRootTitle")}`,href:y.dashboard.root},{name:`${n("listView.pageTitle")}`,href:y.dashboard.customers.root}],action:e.jsx(V,{permission:O.ADD_CUSTOMER,children:e.jsx(N,{onClick:()=>d.onToggle(),variant:"contained",startIcon:e.jsx(g,{icon:"mingcute:add-line"}),children:n("listView.addNewCustomer")})})}),e.jsx(V,{permission:O.LIST_CUSTOMER,children:e.jsxs(ie,{children:[e.jsx(Le,{filters:o,onResetPage:t.onResetPage,dateError:v}),R&&e.jsx(He,{filters:o,totalResults:p.length,onResetPage:t.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(w,{sx:{position:"relative"},children:[e.jsx(we,{dense:t.dense,numSelected:t.selected.length,rowCount:p.length}),e.jsx(le,{sx:{minHeight:444},children:e.jsxs(Te,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(ye,{order:t.order,orderBy:t.orderBy,headLabel:h,rowCount:p.length}),e.jsxs(Pe,{children:[p.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage).map((i,j)=>e.jsx(Ie,{index:t.page*t.rowsPerPage+j+1,row:i,selected:t.selected.includes(i.id),onEditRow:()=>a(i),onDeleteRow:()=>B(i.id)},i.id)),e.jsx(fe,{height:t.dense?56:76,emptyRows:Ce(t.page,t.rowsPerPage,p.length)}),e.jsx(be,{notFound:I})]})]})})]}),e.jsx(Se,{page:t.page,dense:t.dense,count:p.length,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onChangeDense:t.onChangeDense,onRowsPerPageChange:t.onChangeRowsPerPage})]})})]})}),e.jsx($e,{open:d.value,onClose:d.onFalse,handler:E}),e.jsx(Be,{open:m.value,onClose:m.onFalse,handler:r,customer:C})]})};function Me({inputData:s,comparator:n,filters:t,dateError:d}){const{status:m,name:c,startDate:x,endDate:f}=t,C=s.map((l,o)=>[l,o]);return C.sort((l,o)=>{const h=n(l[0],o[0]);return h!==0?h:l[1]-o[1]}),s=C.map(l=>l[0]),c&&(s=s.filter(l=>{var o;return l.id.toString().toLowerCase().indexOf(c.toLowerCase())!==-1||l.name.toLowerCase().indexOf(c.toLowerCase())!==-1||l.email.toLowerCase().indexOf(c.toLowerCase())!==-1||((o=l.phoneNumber)==null?void 0:o.toString().toLowerCase().indexOf(c.toLowerCase()))!==-1})),d||x&&f&&(s=s.filter(l=>ce(l.createdAt,x,f))),s}const qe={title:`Customers list | Dashboard - ${U.site.name}`};function Ys(){const s=me({queryKey:["customers"],queryFn:async()=>(await F.get(A.customers.list)).data});return s.isPending||s.isLoading?e.jsx(de,{}):s.isError?e.jsx(he,{route:y.dashboard.customers.root}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{children:e.jsxs("title",{children:[" ",qe.title]})}),e.jsx(Ne,{customers:s.data})]})}export{Ys as default};

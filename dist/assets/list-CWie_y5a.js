import{i as se,aP as Re,j as e,L as Ie,S as f,A as oe,I as b,B as c,aT as ce,d0 as ie,aL as Oe,c9 as F,C as de,e8 as ae,d7 as le,el as v,l as R,cQ as ke,bR as Le,db as Ee,aR as Be,e3 as $,aS as T,e as G,r as h,de as xe,e2 as ue,ed as he,eb as Fe,dn as me,dp as q,dm as M,dq as pe,g as je,p as L,e1 as $e,ea as qe,am as W,cY as ge,v as J,dT as ye,ec as Me,e7 as Ne,b as Qe,dP as He,cV as A,R as Ve,dS as z,dd as Ke,H as We}from"./index-DGNYifC6.js";import{u as ne,E as fe}from"./error-block-C-2dSLgv.js";import{u as be}from"./useMutation-D2jYRQJx.js";import{C as ze}from"./custom-breadcrumbs-DRd75Eu9.js";import{P as N}from"./permission-access-controller-gNEhnvDe.js";import{g as Ce,r as Pe,e as _e}from"./utils-MBUcMVfY.js";import{u as ve}from"./use-table-BdfDjef1.js";import{T as Ge}from"./table-no-data-g6Kt-rwz.js";import{T as Ye}from"./table-empty-rows-Cv5LWG6e.js";import{T as re,a as Te,b as we,c as Se}from"./table-head-custom-B_NYvjkz.js";import{T as Je}from"./table-selected-action-onOGd8pI.js";import{T as De}from"./table-pagination-custom-hARormX0.js";import{A as _}from"./app-widget-summary-DcaDjT1L.js";import{b as E}from"./format-number-CWTAeVFz.js";import{C as Ue}from"./confirm-dialog-BqyKQ3gP.js";import{T as P}from"./TableCell-yuBVQ3lX.js";import{A as Xe}from"./AvatarGroup-BI_xr5DO.js";import{P as Ze}from"./react-pdf.browser-CL6TEYtb.js";import{u as et}from"./use-tabs-2y-ov5ek.js";import{P as tt,a as st,O as at}from"./order-status-dialog-Ci8KVlGm.js";import{S as Ae}from"./Select-C6ASwYR-.js";import{Q as nt}from"./quotation-product-table-DdU9zf5Q.js";import{C as rt}from"./CircularProgress-G9ssI8-f.js";import{T as it,a as lt}from"./Tabs-DFrMpOqw.js";import{C as ot}from"./CardHeader-BjTA_6Uz.js";import{T as ct}from"./TextField-mBdmr42_.js";import{I as dt}from"./InputAdornment-BmxkeBIP.js";import{F as xt,a as U,c as X}from"./filters-result-qXjWvH5F.js";import{C as Z}from"./Chip-B0Ybqywg.js";import"./index-QXgaSBze.js";import"./incrementer-button-CDQHn4ga.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-BxyTMYpw.js";import"./Checkbox-BIs_5AT0.js";import"./TablePagination-CkeykP08.js";import"./KeyboardArrowRight-DID8kgv4.js";import"./LastPage-Bqc8ZCDB.js";import"./InputBase-hrwLUnCD.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-C9O5_5-O.js";import"./use-chart-Pj-Qq-td.js";import"./chart-legends-7ADjs6rD.js";import"./index-BqPiDh_s.js";import"./DialogContent-B_Tr1w8s.js";import"./DialogTitle-DLN32Wnl.js";import"./___vite-browser-external_commonjs-proxy-BMLTqiA-.js";import"./form-provider-CJcfGRKn.js";import"./FormHelperText-CVQBffr0.js";import"./Rating-lF0e67mT.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-Bk0hVyX2.js";import"./Menu-BP2zLRER.js";import"./index-CPrvQNIh.js";import"./Slider-_mufNbtc.js";import"./FormControl-ozFyA-FQ.js";import"./FormLabel-B8Lxlqfe.js";import"./RadioGroup-CJB7uNqf.js";import"./FormGroup-RIR5D6xL.js";import"./utils-CGfCLUzb.js";import"./countries-DSLisFCy.js";import"./Autocomplete-De53pBeJ.js";import"./country-select-DDtqlvTv.js";import"./InputLabel-ZTJWG8jQ.js";import"./upload-avatar-Bt036TSz.js";import"./image-CNJbTuDT.js";import"./DatePicker-wZuhHZr0.js";import"./ListItem-CYQM3O-q.js";import"./MobileDateTimePicker-B6nPPnvp.js";import"./upload-box-ad-CPfdaLKU.js";import"./schema-helper-7KYonKRH.js";import"./LoadingButton-4-CBySOn.js";function ut({row:s,index:r,selected:a,onViewRow:m,onDeleteRow:t,onClickRow:o,isFullDisplay:d}){var S,D,C;const j=se(),p=se(),i=Re(),l=e.jsxs(re,{hover:!0,selected:a,children:[e.jsx(P,{onClick:o,children:e.jsx(Ie,{color:"inherit",onClick:m,underline:"always",sx:{cursor:"pointer"},children:(s==null?void 0:s.ref)||r||(s==null?void 0:s.id)})}),e.jsx(P,{onClick:o,children:e.jsxs(f,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(oe,{sx:{bgcolor:"#00AB55"},alt:s.name,src:s.customer.avatar,children:e.jsx(b,{color:"white",icon:"fluent:person-20-filled",width:24})}),e.jsxs(f,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsx(c,{component:"span",sx:{textTransform:"capitalize"},children:s.customer.name}),e.jsx(c,{component:"span",sx:{color:"text.disabled"},children:s.customer.email})]})]})}),!d&&e.jsx(P,{onClick:o,children:e.jsx(ce,{primary:ie(s.orderDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(P,{align:"center",onClick:o,children:e.jsx(Xe,{sx:{[`& .${Oe.avatar}`]:{width:24,height:24}},children:(S=s==null?void 0:s.productToOrder)==null?void 0:S.map(u=>{var g,I,w,O;return e.jsx(F,{title:`${(g=u==null?void 0:u.product)==null?void 0:g.name} | Quantity : ${u.quantity}`,children:e.jsx(oe,{alt:(I=u==null?void 0:u.product)==null?void 0:I.name,src:`${de.site.serverFileHost}${(w=u==null?void 0:u.product)==null?void 0:w.image}`},u==null?void 0:u.id)},(O=u==null?void 0:u.product)==null?void 0:O.id)})})}),e.jsx(P,{onClick:o,children:E(ae(s.totalOrderAmount-s.totalOrderAmount*(s.discount/100),s.snapshotTaxPercentage))||"-"}),!d&&e.jsxs(P,{onClick:o,children:[(D=s.createdBy)==null?void 0:D.firstName," ",(C=s.createdBy)==null?void 0:C.lastName]}),!d&&e.jsx(P,{onClick:o,children:e.jsx(le,{variant:"soft",color:s.status===v.Ready&&"info"||s.status===v.InProcess&&"warning"||s.status===v.Delivered&&"success"||s.status===v.Canceled&&"error"||"default",children:s.status})}),!d&&e.jsxs(P,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(R,{color:p.value?"inherit":"default",onClick:p.onToggle,sx:{...p.value&&{bgcolor:"action.hover"}},children:e.jsx(b,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(R,{color:i.open?"inherit":"default",onClick:i.onOpen,children:e.jsx(b,{icon:"eva:more-vertical-fill"})})]})]}),y=e.jsx(re,{children:e.jsx(P,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(ke,{in:p.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(Le,{sx:{m:1.5},children:s.productToOrder.map(u=>e.jsxs(f,{direction:"row",alignItems:"center",sx:{p:g=>g.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:g=>`solid 2px ${g.vars.palette.background.neutral}`}},children:[e.jsx(ce,{primary:u.product.name,secondary:u.sku,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs("div",{children:[u.quantity," "]}),e.jsx(c,{sx:{width:110,textAlign:"right"},children:E(u.snapshotProductPrice)})]},u.id))})})})});return e.jsxs(e.Fragment,{children:[l,y,e.jsx(Ee,{open:i.open,anchorEl:i.anchorEl,onClose:i.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Be,{children:[e.jsx(N,{permission:$.VIEW_ORDER,children:e.jsxs(T,{onClick:()=>{m(),i.onClose()},children:[e.jsx(b,{icon:"solar:eye-bold"}),"View"]})}),s.status!==v.Canceled&&e.jsx(N,{permission:$.DELETE_ORDER,children:e.jsxs(T,{onClick:()=>{j.onTrue(),i.onClose()},sx:{color:"warning.main"},children:[e.jsx(b,{icon:"solar:trash-bin-trash-bold"}),"Cancel"]})})]})}),e.jsx(Ue,{open:j.value,onClose:j.onFalse,title:"Cancel Order",content:"Are you sure want to cancel this order?",action:e.jsx(G,{variant:"contained",color:"warning",onClick:()=>{t(),j.onFalse()},children:"Confirm Canceling"})})]})}const ht=[{id:"orderNumber",label:"#",width:40,align:"center"},{id:"date",label:"Date"},{id:"status",label:"Payment Type",width:200,align:"center"},{id:"totalAmount",label:"	Paid Amount",width:200,align:"center"}],mt=({payments:s})=>{const r=ve({defaultOrderBy:"orderId",defaultRowsPerPage:5}),[a,m]=h.useState(s),t=xe({name:"",status:"all",startDate:null,endDate:null});h.useEffect(()=>{m(s)},[s]);const o=ue(t.state.startDate,t.state.endDate),d=pt({inputData:a,comparator:Ce(r.order,r.orderBy),filters:t.state,dateError:o});Pe(d,r.page,r.rowsPerPage),t.state.name||t.state.status!=="all"||t.state.startDate&&t.state.endDate;const[j,p]=h.useState("all");h.useCallback(l=>{r.onResetPage(),t.setState({name:l.target.value})},[t,r]);const i=h.useCallback(l=>{r.onResetPage(),t.setState({status:l.target.value}),p(l.target.value)},[t,r]);return e.jsxs(c,{display:"flex",flexDirection:"column",alignItems:"center",sx:{borderRadius:1,height:1,width:1,overflow:"hidden",border:l=>`solid 1px ${l.vars.palette.divider}`},children:[e.jsx(f,{spacing:2,justifyContent:{xs:"flex-end"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:1,width:1},children:e.jsxs(Ae,{size:"small",sx:{width:200,textTransform:"capitalize"},value:j,onChange:i,children:[e.jsx(T,{value:"all",children:"All Payments"}),e.jsx(T,{value:"Cash",children:"Cash"}),e.jsx(T,{value:"Card",children:"Card"}),e.jsx(T,{value:"Transfer",children:"Transfer"})]})}),e.jsx(c,{sx:{flex:1,width:1},children:e.jsxs(Te,{size:"small",children:[e.jsx(we,{headLabel:ht}),e.jsx(Se,{children:d.slice(r.page*r.rowsPerPage,r.page*r.rowsPerPage+r.rowsPerPage).map((l,y)=>e.jsxs(re,{children:[e.jsxs(P,{align:"center",children:[" ",y+1||l.id," "]}),e.jsx(P,{children:ie(l.paymentDate)}),e.jsx(P,{align:"center",children:e.jsx(le,{variant:"soft",color:l.paymentType==="Cash"&&"info"||l.paymentType==="Card"&&"success"||l.paymentType==="Transfer"&&"default"||"default",children:l.paymentType})}),e.jsx(P,{align:"center",children:E(l==null?void 0:l.amount)})]},`${l.id}`))})]})}),e.jsx(De,{sx:{width:1},page:r.page,dense:!0,count:d.length,rowsPerPage:r.rowsPerPage,onPageChange:r.onChangePage,onRowsPerPageChange:r.onChangeRowsPerPage})]})};function pt({inputData:s,comparator:r,filters:a,dateError:m}){const{status:t,name:o,startDate:d,endDate:j}=a,p=s.map((i,l)=>[i,l]);return p.sort((i,l)=>{const y=r(i[0],l[0]);return y!==0?y:i[1]-l[1]}),s=p.map(i=>i[0]),t!=="all"&&(s=s.filter(i=>i.paymentType===t)),m||d&&j&&(s=s.filter(i=>he(i.createdAt,d,j))),s}const ee=[{value:"details",icon:e.jsx(b,{icon:"solar:eye-bold",width:24}),label:"Details"},{value:"payments",icon:e.jsx(b,{icon:"solar:case-minimalistic-bold",width:24}),label:"Payments"}],jt=({selectedOrder:s,handleResize:r,handleClose:a,onViewOrder:m})=>{var k,Q,H,B,V,K;const[t,o]=h.useState(s),d=et("details"),[j,p]=h.useState(ee),i=Fe();h.useEffect(()=>{s.id!==t.id&&o(s)},[t.id,s]),h.useEffect(()=>{const x=(s==null?void 0:s.status)!==v.Draft&&(s==null?void 0:s.status)!==v.Canceled?ee:ee.filter(n=>!["payments"].includes(n.value));p(x)},[s]);const l=se(),y=me(),{mutate:S}=be({mutationFn:x=>q.post(M.payments.create,x),onSuccess:async x=>{pe.success("New Payment Has Been Created!"),l.onFalse()},onSettled:async()=>{await y.invalidateQueries({queryKey:["payments"]}),await y.invalidateQueries({queryKey:["order",t.id]})},onError:x=>{console.log(x)}}),D=je(),C=h.useCallback(x=>{D.replace(L.dashboard.quotation.details(x))},[D]),u=e.jsx($e,{children:e.jsx(Ze,{document:t?e.jsx(tt,{order:t}):e.jsx("span",{}),fileName:t==null?void 0:t.ref,style:{textDecoration:"none"},children:({loading:x})=>e.jsx(F,{title:"Download Pdf",children:e.jsx(R,{children:x?e.jsx(rt,{size:24,color:"inherit"}):e.jsx(b,{icon:"eva:cloud-download-fill"})})})})}),g=e.jsxs(f,{alignItems:"flex-end",sx:{p:1,textAlign:"right",typography:"body2"},children:[e.jsxs(f,{direction:"row",children:[e.jsx(c,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(c,{sx:{width:160,typography:"subtitle2"},children:E(t==null?void 0:t.totalOrderAmount)||"-"})]}),e.jsxs(f,{direction:"row",children:[e.jsx(c,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(c,{sx:{width:160,...(t==null?void 0:t.discount)&&{color:"error.main"}},children:t!=null&&t.discount?`- ${t==null?void 0:t.discount}%`:"-"})]}),e.jsxs(f,{direction:"row",children:[e.jsxs(c,{sx:{color:"text.secondary"},children:["Tax (",(t==null?void 0:t.snapshotTaxPercentage)||"0","%)"]}),e.jsx(c,{sx:{width:160},children:t!=null&&t.snapshotTaxPercentage?E(qe((t==null?void 0:t.totalOrderAmount)-(t==null?void 0:t.totalOrderAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage)):"-"})]}),e.jsxs(f,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:"Total"}),e.jsx(c,{sx:{width:160},children:E(ae((t==null?void 0:t.totalOrderAmount)-(t==null?void 0:t.totalOrderAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage))||"-"})]})]}),I=e.jsxs(f,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsxs(c,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",m:1},children:[e.jsxs(c,{flexDirection:"column",sx:{display:"flex"},children:[e.jsxs(c,{sx:{color:"text.secondary"},children:["Order Ref: #",t==null?void 0:t.ref]}),e.jsxs(c,{sx:{color:"text.secondary"},children:["Order Date: ",ie(t==null?void 0:t.orderDate)]})]}),e.jsx(c,{sx:{mr:2},children:e.jsxs(c,{sx:{color:"text.secondary"},children:["Status:"," ",e.jsx(le,{variant:"soft",color:(t==null?void 0:t.status)===v.Ready&&"info"||(t==null?void 0:t.status)===v.InProcess&&"warning"||(t==null?void 0:t.status)===v.Delivered&&"success"||(t==null?void 0:t.status)===v.Canceled&&"error"||"default",children:t==null?void 0:t.status})]})}),((k=t==null?void 0:t.order)==null?void 0:k.id)&&e.jsx(c,{sx:{color:"text.secondary"},className:"print-hide",children:e.jsxs(G,{variant:"contained",size:"small",startIcon:e.jsx(b,{icon:"heroicons-outline:external-link"}),onClick:()=>{t==null||t.quotation},children:["Related to Quotation: #",(Q=t==null?void 0:t.quotation)==null?void 0:Q.ref]})})]}),e.jsxs(c,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsx(nt,{products:t==null?void 0:t.productToOrder,defaultRowsPerPage:t!=null&&t.notes?5:10}),e.jsx(W,{sx:{mt:1}})]}),g,(t==null?void 0:t.notes)&&e.jsxs(c,{children:[e.jsx(W,{}),e.jsx(f,{sx:{typography:"body2"},children:e.jsx(c,{sx:{p:1},children:e.jsxs(f,{sx:{typography:"subtitle2"},children:[e.jsx("div",{children:"Notes:"}),e.jsx(c,{sx:{color:"text.secondary"},children:t==null?void 0:t.notes})]})})})]})]}),w=ne({queryKey:["order",t.id],queryFn:async()=>{const{data:x}=await q.get(M.order.details+t.id);return o(x),x}}),O=x=>x.isPending||x.isLoading?e.jsx(ye,{}):x.isError?e.jsx(fe,{}):e.jsxs(f,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[(t==null?void 0:t.status)!==v.Draft&&(t==null?void 0:t.status)!==v.Canceled&&Math.round(ae(t.totalOrderAmount-t.totalOrderAmount*(t.discount/100),t==null?void 0:t.snapshotTaxPercentage)-t.orderPaymentAmount)>0&&e.jsxs(e.Fragment,{children:[e.jsx(c,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(c,{children:e.jsx(N,{permission:$.ADD_PAYMENT,children:e.jsx(G,{onClick:()=>l.onToggle(),variant:"contained",startIcon:e.jsx(b,{icon:"mingcute:add-line"}),children:"New Payment"})})})}),e.jsx(W,{})]}),e.jsx(c,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(mt,{payments:w.data.payments})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(ge,{sx:{height:1,display:"flex",flexDirection:"column",width:1,transition:"all 2s ease-in-out"},children:[e.jsxs(it,{className:"print-hide ",value:d.value,onChange:d.onChange,sx:{px:3,boxShadow:x=>`inset 0 -2px 0 0 ${J(x.vars.palette.grey["500Channel"],.08)}`},children:[j.map(x=>e.jsx(lt,{icon:x.icon,value:x.value,label:x.label},x.value)),e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${J(i.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(R,{sx:{ml:1},onClick:r,children:e.jsx(b,{icon:"solar:full-screen-bold",width:24})})}),e.jsx(c,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${J(i.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(R,{sx:{ml:1},onClick:a,children:e.jsx(b,{icon:"solar:close-square-outline",width:24})})})]}),e.jsxs(c,{className:"print-top-margin print-padding",sx:{display:"flex",flexDirection:"column",position:"relative",flex:1},children:[e.jsx(ot,{sx:{pt:1},title:`Order Reference: ${t==null?void 0:t.ref}`,subheader:`Created By : ${(H=t.createdBy)==null?void 0:H.firstName} ${(B=t.createdBy)==null?void 0:B.lastName}`,action:e.jsx(f,{spacing:3,direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"},sx:{mb:{xs:3,md:5}},children:e.jsxs(f,{direction:"row",spacing:1,alignItems:"center",flexGrow:1,sx:{width:1},children:[e.jsx(F,{title:"View",children:e.jsx(R,{onClick:()=>{m(t.id)},children:e.jsx(b,{icon:"solar:eye-bold"})})}),((V=t==null?void 0:t.quotation)==null?void 0:V.id)&&e.jsx(F,{title:`Related to Quotation: #${(K=t==null?void 0:t.quotation)==null?void 0:K.ref}`,children:e.jsx(R,{onClick:()=>{var x;C((x=t==null?void 0:t.quotation)==null?void 0:x.id)},children:e.jsx(b,{icon:"heroicons-outline:external-link"})})}),u,e.jsx(F,{title:"Print",children:e.jsx(st,{order:t})})]})})}),e.jsx(W,{}),d.value==="details"&&I,d.value==="payments"&&O(w)]})]}),e.jsx(at,{order:t,open:l.value,onClose:l.onFalse,handler:S})]})};function gt({filters:s,onResetPage:r}){const[a,m]=h.useState("all"),t=h.useCallback(d=>{r(),s.setState({name:d.target.value})},[s,r]),o=h.useCallback(d=>{r(),s.setState({status:d.target.value}),m(d.target.value)},[s,r]);return e.jsxs(f,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(ct,{sx:{width:420},value:s.state.name,onChange:t,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(dt,{position:"start",children:e.jsx(b,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(Ae,{sx:{width:420,textTransform:"capitalize"},value:a,onChange:o,children:[e.jsx(T,{value:"all",children:"All Orders"}),e.jsx(T,{value:"Draft",children:"Draft"}),e.jsx(T,{value:"Canceled",children:"Canceled"}),e.jsx(T,{value:"InProcess",children:"Processing"}),e.jsx(T,{value:"Ready",children:"Ready To Deliver"}),e.jsx(T,{value:"Delivered",children:"Delivered"})]})]})}function yt({filters:s,totalResults:r,onResetPage:a,sx:m}){const t=h.useCallback(()=>{a(),s.setState({name:""})},[s,a]),o=h.useCallback(()=>{a(),s.setState({status:"all"})},[s,a]),d=h.useCallback(()=>{a(),s.setState({startDate:null,endDate:null})},[s,a]),j=h.useCallback(()=>{a(),s.onResetState()},[s,a]);return e.jsxs(xt,{totalResults:r,onReset:j,sx:m,children:[e.jsx(U,{label:"Status:",isShow:s.state.status!=="all",children:e.jsx(Z,{...X,label:s.state.status,onDelete:o,sx:{textTransform:"capitalize"}})}),e.jsx(U,{label:"Date:",isShow:!!(s.state.startDate&&s.state.endDate),children:e.jsx(Z,{...X,label:Me(s.state.startDate,s.state.endDate),onDelete:d})}),e.jsx(U,{label:"Keyword:",isShow:!!s.state.name,children:e.jsx(Z,{...X,label:s.state.name,onDelete:t})})]})}const te=[{id:"orderNumber",label:"#",width:88},{id:"name",label:"Customer"},{id:"createdAt",label:"Date",width:140},{id:"totalQuantity",label:"Items",width:120,align:"center"},{id:"totalAmount",label:"Price",width:140},{id:"createdBy",label:"Created By",width:200},{id:"status",label:"Status",width:110},{id:"",width:88}];function ft({orders:s,analytics:r}){const a=ve({defaultOrderBy:"orderId"}),{t:m}=Ne("orders"),t=je(),[o,d]=h.useState(),[j,p]=h.useState(!1),[i,l]=h.useState(te),y=Qe(),[S,D]=h.useState(()=>s),C=xe({name:"",status:"all",startDate:null,endDate:null});h.useEffect(()=>{if(p(!1),D(s),o){const n=s.find(Y=>Y.id===o.id);d(n)}},[s]),h.useEffect(()=>{const n=o?te.filter(Y=>!["createdAt","createdBy","status",""].includes(Y.id)):te;l(n)},[o]);const u=ue(C.state.startDate,C.state.endDate),g=bt({inputData:S,comparator:Ce(a.order,a.orderBy),filters:C.state,dateError:u}),I=Pe(g,a.page,a.rowsPerPage),w=!!C.state.name||C.state.status!=="all"||!!C.state.startDate&&!!C.state.endDate,O=!g.length&&w||!g.length,k=me(),{mutate:Q}=be({mutationFn:n=>q.delete(M.order.delete+n),onSuccess:async()=>{pe.success("Order Has Been Canceled!")},onSettled:async()=>{await k.invalidateQueries({queryKey:["orders"]}),await k.invalidateQueries({queryKey:["orders-status"]}),await k.invalidateQueries({queryKey:["orders","analytics"]})},onError:()=>{}}),H=h.useCallback(n=>{Q(n)},[I.length,a,S]),B=h.useCallback(n=>{t.replace(L.dashboard.order.details(n))},[t]),V=()=>{p(!j)},K=()=>{d(null),p(!1)},x=n=>{d(n)};return e.jsx(He,{maxWidth:"xl",children:e.jsxs(A,{container:!0,spacing:3,children:[e.jsx(A,{xs:12,md:12,children:e.jsx(ze,{links:[{name:`${m("listView.breadCrumbsPageRootTitle")}`,href:L.dashboard.root},{name:`${m("listView.breadCrumbsParentPageTitle")}`,href:L.dashboard.order.root},{name:`${m("listView.breadCrumbsPageTitle")}`}],action:e.jsx(N,{permission:$.ADD_ORDER,children:e.jsx(G,{component:Ve,href:L.dashboard.order.new,variant:"contained",startIcon:e.jsx(b,{icon:"mingcute:add-line"}),children:`${m("listView.addNewOrder")}`})})})}),e.jsxs(N,{permission:$.LIST_ORDER,children:[e.jsx(A,{xs:12,md:3,children:e.jsx(_,{title:`${m("listView.statisticsWidgets.allOrders")}`,total:s.length,chart:{categories:r.data.lastSixMonth.map(n=>z(n==null?void 0:n.inMonth)),series:r.data.lastSixMonth.map(n=>n==null?void 0:n.ClaimsPerMonth)}})}),e.jsx(A,{xs:12,md:3,children:e.jsx(_,{title:`${m("listView.statisticsWidgets.processingOrder")}`,total:r.data.analytics.InProcess,chart:{colors:[y.vars.palette.warning.light],categories:r.data.inProcessLastSixMonth.map(n=>z(n==null?void 0:n.inMonth)),series:r.data.inProcessLastSixMonth.map(n=>n==null?void 0:n.ClaimsPerMonth)}})}),e.jsx(A,{xs:12,md:3,children:e.jsx(_,{title:`${m("listView.statisticsWidgets.readyToDeliver")}`,total:r.data.analytics.Ready,chart:{colors:[y.vars.palette.info.main],categories:r.data.readyLastSixMonth.map(n=>z(n==null?void 0:n.inMonth)),series:r.data.readyLastSixMonth.map(n=>n==null?void 0:n.ClaimsPerMonth)}})}),e.jsx(A,{xs:12,md:3,children:e.jsx(_,{title:`${m("listView.statisticsWidgets.delivered")}`,total:r.data.analytics.Delivered,chart:{colors:[y.vars.palette.success.main],categories:r.data.deliveredLastSixMonth.map(n=>z(n==null?void 0:n.inMonth)),series:r.data.deliveredLastSixMonth.map(n=>n==null?void 0:n.ClaimsPerMonth)}})}),!j&&e.jsx(A,{xs:12,md:o?5:12,children:e.jsxs(ge,{children:[e.jsx(gt,{filters:C,onResetPage:a.onResetPage,dateError:u}),w&&e.jsx(yt,{filters:C,totalResults:g.length,onResetPage:a.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(c,{sx:{position:"relative"},children:[e.jsx(Je,{dense:a.dense,numSelected:a.selected.length,rowCount:g.length}),e.jsx(Ke,{sx:{minHeight:444},children:e.jsxs(Te,{size:a.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(we,{order:a.order,orderBy:a.orderBy,headLabel:i,rowCount:g.length}),e.jsxs(Se,{children:[g.slice(a.page*a.rowsPerPage,a.page*a.rowsPerPage+a.rowsPerPage).map(n=>e.jsx(ut,{row:n,selected:a.selected.includes(n.id),onSelectRow:()=>a.onSelectRow(n.id),onDeleteRow:()=>H(n.id),onViewRow:()=>B(n.id),onClickRow:()=>x(n),isFullDisplay:o},n.id)),e.jsx(Ye,{height:a.dense?56:76,emptyRows:_e(a.page,a.rowsPerPage,g.length)}),e.jsx(Ge,{notFound:O})]})]})})]}),e.jsx(De,{page:a.page,dense:a.dense,count:g.length,rowsPerPage:a.rowsPerPage,onPageChange:a.onChangePage,onChangeDense:a.onChangeDense,onRowsPerPageChange:a.onChangeRowsPerPage})]})}),o&&e.jsx(c,{sx:{display:"flex",flex:1,p:1.5,transition:"all 2s ease-in-out"},children:e.jsx(jt,{selectedOrder:o,handleResize:V,handleClose:K,onViewOrder:B})})]})]})})}function bt({inputData:s,comparator:r,filters:a,dateError:m}){const{status:t,name:o,startDate:d,endDate:j}=a,p=s==null?void 0:s.map((i,l)=>[i,l]);return p==null||p.sort((i,l)=>{const y=r(i[0],l[0]);return y!==0?y:i[1]-l[1]}),s=p==null?void 0:p.map(i=>i[0]),o&&(s=s.filter(i=>i.id.toString().toLowerCase().indexOf(o.toLowerCase())!==-1||i.customer.name.toLowerCase().indexOf(o.toLowerCase())!==-1||i.status.toLowerCase().indexOf(o.toLowerCase())!==-1||i.customer.email.toLowerCase().indexOf(o.toLowerCase())!==-1)),t!=="all"&&(s=s.filter(i=>i.status===t)),m||d&&j&&(s=s.filter(i=>he(i.createTime,d,j))),s}const Ct={title:`Order list | Dashboard - ${de.site.name}`};function Hs(){const s=ne({queryKey:["orders"],queryFn:async()=>{const{data:a}=await q.get(M.order.list);return a}}),r=ne({queryKey:["orders","analytics"],queryFn:async()=>{const{data:a}=await q.get(M.order.analytics);return a}});return r.isLoading||s.isLoading?e.jsx(ye,{}):s.isError||r.isError?e.jsx(fe,{route:L.dashboard.order.root}):e.jsxs(e.Fragment,{children:[e.jsx(We,{children:e.jsxs("title",{children:[" ",Ct.title]})}),e.jsx(ft,{orders:s.data,analytics:r})]})}export{Hs as default};

import{i as F,aP as H,j as e,d0 as v,d7 as D,e as b,I as x,l as V,db as J,aR as Q,aS as g,e3 as y,r as p,S as z,g as M,de as _,e2 as W,p as f,dn as G,dP as U,cV as h,cY as Y,B as $,dd as X,ed as Z,dp as k,dm as w,dq as ee,dT as I,H as te,C as se}from"./index-DGNYifC6.js";import{u as R,E as ae}from"./error-block-C-2dSLgv.js";import{u as oe}from"./useMutation-D2jYRQJx.js";import{d as re}from"./download-file-DSINbUAG.js";import{C as ie}from"./custom-breadcrumbs-DRd75Eu9.js";import{P}from"./permission-access-controller-gNEhnvDe.js";import{g as ne,r as le,e as ce}from"./utils-MBUcMVfY.js";import{u as de}from"./use-table-BdfDjef1.js";import{T as me}from"./table-no-data-g6Kt-rwz.js";import{T as pe}from"./table-empty-rows-Cv5LWG6e.js";import{T as ue,a as he,b as xe,c as je}from"./table-head-custom-B_NYvjkz.js";import{T as ge}from"./table-selected-action-onOGd8pI.js";import{T as Ce}from"./table-pagination-custom-hARormX0.js";import{A as T}from"./app-widget-summary-DcaDjT1L.js";import{C as fe}from"./confirm-dialog-BqyKQ3gP.js";import{T as u}from"./TableCell-yuBVQ3lX.js";import{T as Te}from"./tickets-create-dialog-BBdT1a2l.js";import{T as be}from"./TextField-mBdmr42_.js";import{I as ye}from"./InputAdornment-BmxkeBIP.js";import{S as ke}from"./Select-C6ASwYR-.js";import{F as we,a as Pe,c as Se}from"./filters-result-qXjWvH5F.js";import{C as ve}from"./Chip-B0Ybqywg.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-BxyTMYpw.js";import"./Checkbox-BIs_5AT0.js";import"./TablePagination-CkeykP08.js";import"./KeyboardArrowRight-DID8kgv4.js";import"./LastPage-Bqc8ZCDB.js";import"./InputBase-hrwLUnCD.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-C9O5_5-O.js";import"./format-number-CWTAeVFz.js";import"./use-chart-Pj-Qq-td.js";import"./chart-legends-7ADjs6rD.js";import"./index-BqPiDh_s.js";import"./DialogContent-B_Tr1w8s.js";import"./DialogTitle-DLN32Wnl.js";import"./form-provider-CJcfGRKn.js";import"./FormHelperText-CVQBffr0.js";import"./Rating-lF0e67mT.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-Bk0hVyX2.js";import"./Menu-BP2zLRER.js";import"./index-CPrvQNIh.js";import"./Slider-_mufNbtc.js";import"./FormControl-ozFyA-FQ.js";import"./FormLabel-B8Lxlqfe.js";import"./RadioGroup-CJB7uNqf.js";import"./FormGroup-RIR5D6xL.js";import"./utils-CGfCLUzb.js";import"./countries-DSLisFCy.js";import"./Autocomplete-De53pBeJ.js";import"./country-select-DDtqlvTv.js";import"./InputLabel-ZTJWG8jQ.js";import"./upload-avatar-Bt036TSz.js";import"./image-CNJbTuDT.js";import"./DatePicker-wZuhHZr0.js";import"./ListItem-CYQM3O-q.js";import"./MobileDateTimePicker-B6nPPnvp.js";import"./Tabs-DFrMpOqw.js";import"./upload-box-ad-CPfdaLKU.js";import"./LoadingButton-4-CBySOn.js";import"./CircularProgress-G9ssI8-f.js";const De=({row:t,index:o,selected:s,onViewRow:c,onViewFileRow:d,onDeleteRow:l,onViewQuotationRow:m})=>{const i=F();console.log("---> row",JSON.parse(t.quotation).ref);const n=H(),a=e.jsxs(ue,{hover:!0,selected:s,children:[e.jsx(u,{children:o||t.id}),e.jsx(u,{children:v(t.createTime)}),e.jsx(u,{children:t.topic}),e.jsx(u,{children:e.jsx(D,{variant:"soft",color:t.priority==="Low"&&"success"||t.priority==="Medium"&&"warning"||t.priority==="Hight"&&"error"||"default",children:t.priority})}),e.jsx(u,{children:v(t.updateTime)}),e.jsx(u,{children:JSON.parse(t.quotation).ref?e.jsxs(b,{variant:"contained",size:"small",startIcon:e.jsx(x,{icon:"heroicons-outline:external-link"}),onClick:()=>{JSON.parse(t.quotation).id&&m(JSON.parse(t.quotation).id)},children:["#",JSON.parse(t.quotation).ref]}):"-"}),e.jsx(u,{children:e.jsx(D,{variant:"soft",color:t.status==="Open"&&"info"||t.status==="Closed"&&"default"||"default",children:t.status})}),e.jsx(u,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(V,{color:n.open?"inherit":"default",onClick:n.onOpen,children:e.jsx(x,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[a,e.jsx(J,{open:n.open,anchorEl:n.anchorEl,onClose:n.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Q,{children:[(t==null?void 0:t.file)&&e.jsxs(g,{onClick:()=>{d(),n.onClose()},children:[e.jsx(x,{icon:"solar:cloud-download-bold"}),"Download"]}),e.jsxs(g,{onClick:()=>{c(),n.onClose()},children:[e.jsx(x,{icon:"solar:eye-bold"}),"View"]}),e.jsx(P,{permission:y.DELETE_TICKET,children:e.jsxs(g,{onClick:()=>{i.onTrue(),n.onClose()},sx:{color:"error.main"},children:[e.jsx(x,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})})]})}),e.jsx(fe,{open:i.value,onClose:i.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(b,{variant:"contained",color:"error",onClick:l,children:"Delete"})})]})};function Re({filters:t,onResetPage:o}){const[s,c]=p.useState("all"),d=p.useCallback(m=>{o(),t.setState({name:m.target.value})},[t,o]),l=p.useCallback(m=>{o(),t.setState({status:m.target.value}),c(m.target.value)},[t,o]);return e.jsxs(z,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(be,{sx:{width:420},value:t.state.name,onChange:d,placeholder:"Search Here...",InputProps:{startAdornment:e.jsx(ye,{position:"start",children:e.jsx(x,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(ke,{sx:{width:420,textTransform:"capitalize"},value:s,onChange:l,children:[e.jsx(g,{value:"all",children:"All Tickets"}),e.jsx(g,{value:"Open",children:"Open Tickets"}),e.jsx(g,{value:"Closed",children:"Close Tickets"})]})]})}function Fe({filters:t,totalResults:o,onResetPage:s,sx:c}){const d=p.useCallback(()=>{s(),t.setState({name:""})},[t,s]),l=p.useCallback(()=>{s(),t.onResetState()},[t,s]);return e.jsx(we,{totalResults:o,onReset:l,sx:c,children:e.jsx(Pe,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(ve,{...Se,label:t.state.name,onDelete:d})})})}const Ie=[{id:"ticketId",label:"#",width:140},{id:"date",label:"Date",width:280},{id:"topic",label:"Topic"},{id:"priority",label:"Priority"},{id:"lastUpdate",label:"Last Updated"},{id:"related",label:"Related"},{id:"status",label:"Status"},{id:"",width:88}],Ee=({tickets:t,analytics:o})=>{const s=de({defaultOrderBy:"orderNumber"}),c=M(),d=F(),[l,m]=p.useState(t),i=_({name:"",status:"all",startDate:null,endDate:null});p.useEffect(()=>{m(t)},[t]);const n=W(i.state.startDate,i.state.endDate),a=Le({inputData:l,comparator:ne(s.order,s.orderBy),filters:i.state,dateError:n}),j=le(a,s.page,s.rowsPerPage),C=!!i.state.name||i.state.status!=="all"||!!i.state.startDate&&!!i.state.endDate,E=!a.length&&C||!a.length,L=p.useCallback(r=>{q(r)},[j.length,s,l]),A=p.useCallback(r=>{c.push(f.dashboard.tickets.details(r))},[c]),O=p.useCallback(r=>{c.push(f.dashboard.quotation.details(r))},[c]),S=G(),B=r=>{re(r)},{mutate:q}=oe({mutationFn:r=>k.delete(w.tickets.delete+r),onSuccess:async()=>{ee.success("Delete success!"),await S.invalidateQueries({queryKey:["tickets"]}),await S.invalidateQueries({queryKey:["tickets","analytics"]})},onSettled:async()=>{},onError:r=>{}}),N=()=>o.isPending||o.isLoading?e.jsx(h,{xs:12,md:12,children:e.jsx(I,{})}):e.jsxs(e.Fragment,{children:[e.jsx(h,{xs:12,md:4,children:e.jsx(T,{title:"All Tickets",total:t.length,chart:{}})}),e.jsx(h,{xs:12,md:4,children:e.jsx(T,{title:"Open Tickets",total:o.data.analytics.Open,chart:{}})}),e.jsx(h,{xs:12,md:4,children:e.jsx(T,{title:"Close Tickets",total:o.data.analytics.Closed,chart:{}})})]});return e.jsxs(e.Fragment,{children:[e.jsx(U,{maxWidth:"xl",children:e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{xs:12,md:12,children:e.jsx(ie,{links:[{name:"Dashboard",href:f.dashboard.root},{name:"Ticket",href:f.dashboard.tickets.root}],action:e.jsx(P,{permission:y.ADD_TICKET,children:e.jsx(b,{onClick:()=>d.onToggle(),variant:"contained",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),children:"New Ticket"})})})}),e.jsxs(P,{permission:y.TICKET_LIST,children:[N(),e.jsx(h,{xs:12,md:12,children:e.jsxs(Y,{children:[e.jsx(Re,{filters:i,onResetPage:s.onResetPage,dateError:n}),C&&e.jsx(Fe,{filters:i,totalResults:a.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs($,{sx:{position:"relative"},children:[e.jsx(ge,{dense:s.dense,numSelected:s.selected.length,rowCount:a.length}),e.jsx(X,{sx:{minHeight:444},children:e.jsxs(he,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(xe,{order:s.order,orderBy:s.orderBy,headLabel:Ie,rowCount:a.length}),e.jsxs(je,{children:[a.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map((r,K)=>e.jsx(De,{row:r,index:s.page*s.rowsPerPage+K+1,selected:s.selected.includes(r.id),onSelectRow:()=>s.onSelectRow(r.id),onDeleteRow:()=>L(r.id),onViewRow:()=>A(r.id),onViewFileRow:()=>B(r.file),onViewQuotationRow:O},r.id)),e.jsx(pe,{height:s.dense?56:76,emptyRows:ce(s.page,s.rowsPerPage,a.length)}),e.jsx(me,{notFound:E})]})]})})]}),e.jsx(Ce,{page:s.page,dense:s.dense,count:a.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})]})]})}),e.jsx(Te,{open:d.value,onClose:d.onFalse})]})};function Le({inputData:t,comparator:o,filters:s,dateError:c}){const{status:d,name:l,startDate:m,endDate:i}=s,n=t.map((a,j)=>[a,j]);return n.sort((a,j)=>{const C=o(a[0],j[0]);return C!==0?C:a[1]-j[1]}),t=n.map(a=>a[0]),l&&(t=t.filter(a=>a.id.toString().indexOf(l.toLowerCase())!==-1||a.topic.toLowerCase().indexOf(l.toLowerCase())!==-1||a.priority.toLowerCase().indexOf(l.toLowerCase())!==-1)),d!=="all"&&(t=t.filter(a=>a.status===d)),c||m&&i&&(t=t.filter(a=>Z(a.createdAt,m,i))),t}const Ae={title:`Tickets list | Dashboard - ${se.site.name}`};function Wt(){const t=R({queryKey:["tickets"],queryFn:async()=>{const{data:s}=await k.get(w.tickets.list);return s}}),o=R({queryKey:["tickets","analytics"],queryFn:async()=>{const{data:s}=await k.get(w.tickets.analytics);return s}});return o.isLoading||t.isLoading?e.jsx(I,{}):t.isError||o.isError?e.jsx(ae,{route:f.dashboard.tickets.root}):e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsxs("title",{children:[" ",Ae.title]})}),e.jsx(Ee,{tickets:t.data,analytics:o})]})}export{Wt as default};

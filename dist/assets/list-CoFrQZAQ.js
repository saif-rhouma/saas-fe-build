import{br as K,Y as ie,a3 as ke,j as e,L as Le,S as f,A as he,I as C,B as d,a8 as me,d1 as de,Q as Me,bq as H,C as pe,e8 as re,d8 as ce,ef as j,$ as R,cR as Ee,b6 as Oe,dc as Be,a6 as Fe,e4 as Q,a7 as P,e as Y,r as p,df as be,e3 as je,ed as ge,eb as qe,dp as ye,dq as M,dn as E,dr as fe,W as Ce,p as L,ea as He,a5 as _,cZ as we,v as se,dU as Te,ec as Qe,b as Ne,dQ as Ke,cW as A,R as We,dT as G,de as ze,H as _e}from"./index-3kUlxXkm.js";import{u as J,E as ve}from"./error-block-BTCpMwIj.js";import{u as Pe}from"./useMutation-DWyFExRk.js";import{C as Ge}from"./custom-breadcrumbs-CQM3hT8w.js";import{P as N}from"./permission-access-controller-6Z2YefAG.js";import{g as De,r as Ue,e as Ye}from"./utils-MBUcMVfY.js";import{u as Se}from"./use-table-9MzCtmNE.js";import{T as Je}from"./table-no-data-DRMtffow.js";import{T as Ze}from"./table-empty-rows-R6XLgnwX.js";import{T as oe,a as $e,b as Ae,c as Re}from"./table-head-custom-Bzh_BuNQ.js";import{T as Xe}from"./table-selected-action-77MIBAPT.js";import{T as Ie}from"./table-pagination-custom-HAHTP3sF.js";import{A as U}from"./app-widget-summary-DvCSfQFK.js";import{b as O}from"./format-number-CFuBAOSh.js";import{C as et}from"./confirm-dialog-DcDyWDMb.js";import{T as v}from"./TableCell-YgDy_fKI.js";import{A as tt}from"./AvatarGroup-DZ0cD606.js";import{u as st}from"./use-tabs-B9ArrO3C.js";import{S as Ve}from"./Select-DOB8r047.js";import{P as at,O as nt}from"./order-status-dialog-Dhf_4DkA.js";import{Q as lt}from"./quotation-product-table-CToYXclt.js";import{C as it}from"./CircularProgress-CZhO4lMk.js";import{T as rt,a as ot}from"./Tabs-Cs2uCeCP.js";import{C as dt}from"./CardHeader-Dma4zJfI.js";import{T as ct}from"./TextField-Ff9PgcBD.js";import{I as xt}from"./InputAdornment-Ug97Thua.js";import{F as ut,a as ae,c as ne}from"./filters-result-CHuN9x5s.js";import{C as le}from"./Chip-yUQfyewU.js";import"./index-DSmIvarc.js";import"./incrementer-button-DlaR23JU.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-DygIpP7Y.js";import"./Checkbox-BPHZ30Zu.js";import"./TablePagination-CVcJMlXd.js";import"./KeyboardArrowRight-o7aJmcRm.js";import"./LastPage-FHI8cfYQ.js";import"./InputBase-Df4WeLlJ.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-DWtRb9VA.js";import"./use-chart-DR3Yq8HK.js";import"./chart-legends-DGgXzBpn.js";import"./index-BySBJlbP.js";import"./DialogContent-BZuUPSmG.js";import"./DialogTitle-DD3683-9.js";import"./Menu-CsXXwNKW.js";import"./form-provider-Ddj1YnLe.js";import"./FormHelperText-47ensrNn.js";import"./Rating-BWS0RvVN.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-BMX_0Xq6.js";import"./index-nrKetuMS.js";import"./Slider-Dlywp6Zb.js";import"./FormControl-BaWzc8Dl.js";import"./FormLabel-CX5M124t.js";import"./RadioGroup-D6FwwOLi.js";import"./FormGroup-DHewWmvb.js";import"./utils-NIylK1Um.js";import"./countries-DSLisFCy.js";import"./Autocomplete-CuAKdGKX.js";import"./country-select-i0JEsBFQ.js";import"./InputLabel-Df2ESQnA.js";import"./upload-avatar-BbAzKhJK.js";import"./image-BEDFCDEn.js";import"./DatePicker-vbOob6Xb.js";import"./ListItem-CBu29PKK.js";import"./MobileDateTimePicker-DlpjHwQr.js";import"./upload-box-ad-C5ekRHFU.js";import"./schema-helper-pKPnN3t8.js";import"./LoadingButton-BtwwM36s.js";function ht({row:s,index:l,selected:i,onViewRow:g,onDeleteRow:t,onClickRow:c,isFullDisplay:n}){var D,I,w;const{t:o}=K("orders"),m=ie(),r=ie(),b=ke(),T=e.jsxs(oe,{hover:!0,selected:i,children:[e.jsx(v,{onClick:c,children:e.jsx(Le,{color:"inherit",onClick:g,underline:"always",sx:{cursor:"pointer"},children:(s==null?void 0:s.ref)||l||(s==null?void 0:s.id)})}),e.jsx(v,{onClick:c,children:e.jsxs(f,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(he,{sx:{bgcolor:"#00AB55"},alt:s.name,src:s.customer.avatar,children:e.jsx(C,{color:"white",icon:"fluent:person-20-filled",width:24})}),e.jsxs(f,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsx(d,{component:"span",sx:{textTransform:"capitalize"},children:s.customer.name}),e.jsx(d,{component:"span",sx:{color:"text.disabled"},children:s.customer.email})]})]})}),!n&&e.jsx(v,{onClick:c,children:e.jsx(me,{primary:de(s.orderDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(v,{align:"center",onClick:c,children:e.jsx(tt,{sx:{[`& .${Me.avatar}`]:{width:24,height:24}},children:(D=s==null?void 0:s.productToOrder)==null?void 0:D.map(u=>{var y,S,$,V;return e.jsx(H,{title:`${(y=u==null?void 0:u.product)==null?void 0:y.name} | Quantity : ${u.quantity}`,children:e.jsx(he,{alt:(S=u==null?void 0:u.product)==null?void 0:S.name,src:`${pe.site.serverFileHost}${($=u==null?void 0:u.product)==null?void 0:$.image}`},u==null?void 0:u.id)},(V=u==null?void 0:u.product)==null?void 0:V.id)})})}),e.jsx(v,{onClick:c,children:O(re(s.totalOrderAmount-s.totalOrderAmount*(s.discount/100),s.snapshotTaxPercentage))||"-"}),!n&&e.jsxs(v,{onClick:c,children:[(I=s.createdBy)==null?void 0:I.firstName," ",(w=s.createdBy)==null?void 0:w.lastName]}),!n&&e.jsx(v,{onClick:c,children:e.jsxs(ce,{variant:"soft",color:s.status===j.Ready&&"info"||s.status===j.InProcess&&"warning"||s.status===j.Delivered&&"success"||s.status===j.Canceled&&"error"||"default",children:[s.status===j.Draft&&`${o("listView.table.tableToolbar.selectMenu.draft")}`,s.status===j.InProcess&&`${o("listView.table.tableToolbar.selectMenu.processing")}`,s.status===j.Ready&&`${o("listView.table.tableToolbar.selectMenu.readyToDeliver")}`,s.status===j.Delivered&&`${o("listView.table.tableToolbar.selectMenu.delivered")}`,s.status===j.Canceled&&`${o("listView.table.tableToolbar.selectMenu.canceled")}`]})}),!n&&e.jsxs(v,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(R,{color:r.value?"inherit":"default",onClick:r.onToggle,sx:{...r.value&&{bgcolor:"action.hover"}},children:e.jsx(C,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(R,{color:b.open?"inherit":"default",onClick:b.onOpen,children:e.jsx(C,{icon:"eva:more-vertical-fill"})})]})]}),h=e.jsx(oe,{children:e.jsx(v,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(Ee,{in:r.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(Oe,{sx:{m:1.5},children:s.productToOrder.map(u=>e.jsxs(f,{direction:"row",alignItems:"center",sx:{p:y=>y.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:y=>`solid 2px ${y.vars.palette.background.neutral}`}},children:[e.jsx(me,{primary:u.product.name,secondary:u.sku,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs("div",{children:[u.quantity," "]}),e.jsx(d,{sx:{width:110,textAlign:"right"},children:O(u.snapshotProductPrice)})]},u.id))})})})});return e.jsxs(e.Fragment,{children:[T,h,e.jsx(Be,{open:b.open,anchorEl:b.anchorEl,onClose:b.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Fe,{children:[e.jsx(N,{permission:Q.VIEW_ORDER,children:e.jsxs(P,{onClick:()=>{g(),b.onClose()},children:[e.jsx(C,{icon:"solar:eye-bold"}),o("listView.table.tableActions.view")]})}),s.status!==j.Canceled&&e.jsx(N,{permission:Q.DELETE_ORDER,children:e.jsxs(P,{onClick:()=>{m.onTrue(),b.onClose()},sx:{color:"warning.main"},children:[e.jsx(C,{icon:"solar:trash-bin-trash-bold"}),o("listView.table.tableActions.cancel")]})})]})}),e.jsx(et,{open:m.value,onClose:m.onFalse,title:o("listView.messages.dialogCancel.title"),content:o("listView.messages.dialogCancel.text"),action:e.jsx(Y,{variant:"contained",color:"warning",onClick:()=>{t(),m.onFalse()},children:o("listView.messages.dialogCancel.confirmButton")})})]})}const mt=({payments:s})=>{const l=Se({defaultOrderBy:"orderId",defaultRowsPerPage:5}),[i,g]=p.useState(s),{t}=K("orders"),c=be({name:"",status:"all",startDate:null,endDate:null}),n=[{id:"orderNumber",label:"#",width:40,align:"center"},{id:"date",label:`${t("detailsCard.table.header.date")}`},{id:"status",label:`${t("detailsCard.table.header.paymentType")}`,width:200,align:"center"},{id:"totalAmount",label:`${t("detailsCard.table.header.paidAmount")}`,width:200,align:"center"}];p.useEffect(()=>{g(s)},[s]);const o=je(c.state.startDate,c.state.endDate),m=pt({inputData:i,comparator:De(l.order,l.orderBy),filters:c.state,dateError:o}),[r,b]=p.useState("all"),T=p.useCallback(h=>{l.onResetPage(),c.setState({status:h.target.value}),b(h.target.value)},[c,l]);return e.jsxs(d,{display:"flex",flexDirection:"column",alignItems:"center",sx:{borderRadius:1,height:1,width:1,overflow:"hidden",border:h=>`solid 1px ${h.vars.palette.divider}`},children:[e.jsx(f,{spacing:2,justifyContent:{xs:"flex-end"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:1,width:1},children:e.jsxs(Ve,{size:"small",sx:{width:200,textTransform:"capitalize"},value:r,onChange:T,children:[e.jsx(P,{value:"all",children:t("detailsCard.table.header.allPayments")}),e.jsx(P,{value:"Cash",children:t("detailsCard.table.header.cash")}),e.jsx(P,{value:"Card",children:t("detailsCard.table.header.card")}),e.jsx(P,{value:"Transfer",children:t("detailsCard.table.header.transfer")})]})}),e.jsx(d,{sx:{flex:1,width:1},children:e.jsxs($e,{size:"small",children:[e.jsx(Ae,{headLabel:n}),e.jsx(Re,{children:m.slice(l.page*l.rowsPerPage,l.page*l.rowsPerPage+l.rowsPerPage).map((h,D)=>e.jsxs(oe,{children:[e.jsxs(v,{align:"center",children:[" ",D+1||h.id," "]}),e.jsx(v,{children:de(h.paymentDate)}),e.jsx(v,{align:"center",children:e.jsx(ce,{variant:"soft",color:h.paymentType==="Cash"&&"info"||h.paymentType==="Card"&&"success"||h.paymentType==="Transfer"&&"default"||"default",children:h.paymentType})}),e.jsx(v,{align:"center",children:O(h==null?void 0:h.amount)})]},`${h.id}`))})]})}),e.jsx(Ie,{sx:{width:1},page:l.page,dense:!0,count:m.length,rowsPerPage:l.rowsPerPage,onPageChange:l.onChangePage,onRowsPerPageChange:l.onChangeRowsPerPage})]})};function pt({inputData:s,comparator:l,filters:i,dateError:g}){const{status:t,name:c,startDate:n,endDate:o}=i,m=s.map((r,b)=>[r,b]);return m.sort((r,b)=>{const T=l(r[0],b[0]);return T!==0?T:r[1]-b[1]}),s=m.map(r=>r[0]),t!=="all"&&(s=s.filter(r=>r.paymentType===t)),g||n&&o&&(s=s.filter(r=>ge(r.createdAt,n,o))),s}const bt=({selectedOrder:s,handleResize:l,handleClose:i,onViewOrder:g})=>{var W,z,a,k,xe,ue;const[t,c]=p.useState(s),{t:n}=K("orders"),o=[{value:"details",icon:e.jsx(C,{icon:"solar:eye-bold",width:24}),label:`${n("detailsCard.orderDetailsTab")}`},{value:"payments",icon:e.jsx(C,{icon:"solar:case-minimalistic-bold",width:24}),label:`${n("detailsCard.paymentsTab")}`}],m=st("details"),[r,b]=p.useState(o),T=qe();p.useEffect(()=>{s.id!==t.id&&c(s)},[t.id,s]),p.useEffect(()=>{const x=(s==null?void 0:s.status)!==j.Draft&&(s==null?void 0:s.status)!==j.Canceled?o:o.filter(te=>!["payments"].includes(te.value));b(x)},[s]);const h=ie(),D=ye(),{mutate:I}=Pe({mutationFn:x=>M.post(E.payments.create,x),onSuccess:async x=>{fe.success(n("detailView.confirmDialog.newPaymentCreated")),h.onFalse()},onSettled:async()=>{await D.invalidateQueries({queryKey:["payments"]}),await D.invalidateQueries({queryKey:["order",t.id]})},onError:x=>{console.log(x)}}),w=Ce(),u=p.useCallback(x=>{w.replace(L.dashboard.quotation.details(x))},[w]),[y,S]=p.useState(!1),$=()=>{S(!0)},{isLoading:V}=J({queryKey:["download-order",t.id],queryFn:async()=>{const x=await M.get(E.order.downloadPdf+t.id,{responseType:"blob"}),te=window.URL.createObjectURL(new Blob([x.data])),q=document.createElement("a");return q.href=te,q.setAttribute("download",`Order-${t.ref}.pdf`),document.body.appendChild(q),q.click(),document.body.removeChild(q),S(!1),x.data},enabled:y,onSuccess:()=>{S(!1)},onError:x=>{console.error("Download failed:",x)}}),B=e.jsx(H,{title:n("detailsCard.tooltips.downloadTooltip"),children:e.jsx(R,{onClick:$,children:V?e.jsx(it,{size:24,color:"inherit"}):e.jsx(C,{icon:"eva:cloud-download-fill",color:"error.main"})})}),Z=e.jsxs(f,{alignItems:"flex-end",sx:{p:1,textAlign:"right",typography:"body2"},children:[e.jsxs(f,{direction:"row",children:[e.jsx(d,{sx:{color:"text.secondary"},children:n("detailsCard.subtotal")}),e.jsx(d,{sx:{width:160,typography:"subtitle2"},children:O(t==null?void 0:t.totalOrderAmount)||"-"})]}),e.jsxs(f,{direction:"row",children:[e.jsx(d,{sx:{color:"text.secondary"},children:n("detailsCard.discount")}),e.jsx(d,{sx:{width:160,...(t==null?void 0:t.discount)&&{color:"error.main"}},children:t!=null&&t.discount?`- ${t==null?void 0:t.discount}%`:"-"})]}),e.jsxs(f,{direction:"row",children:[e.jsxs(d,{sx:{color:"text.secondary"},children:[n("detailsCard.tax")," (",(t==null?void 0:t.snapshotTaxPercentage)||"0","%)"]}),e.jsx(d,{sx:{width:160},children:t!=null&&t.snapshotTaxPercentage?O(He((t==null?void 0:t.totalOrderAmount)-(t==null?void 0:t.totalOrderAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage)):"-"})]}),e.jsxs(f,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:n("detailsCard.total")}),e.jsx(d,{sx:{width:160},children:O(re((t==null?void 0:t.totalOrderAmount)-(t==null?void 0:t.totalOrderAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage))||"-"})]})]}),X=e.jsxs(f,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsxs(d,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",m:1},children:[e.jsxs(d,{flexDirection:"column",sx:{display:"flex"},children:[e.jsxs(d,{sx:{color:"text.secondary"},children:[n("detailsCard.orderRef"),": #",t==null?void 0:t.ref]}),e.jsxs(d,{sx:{color:"text.secondary"},children:[n("detailsCard.orderDate"),": ",de(t==null?void 0:t.orderDate)]})]}),e.jsx(d,{sx:{mr:2},children:e.jsxs(d,{sx:{color:"text.secondary"},children:[n("detailsCard.status"),e.jsxs(ce,{variant:"soft",color:(t==null?void 0:t.status)===j.Ready&&"info"||(t==null?void 0:t.status)===j.InProcess&&"warning"||(t==null?void 0:t.status)===j.Delivered&&"success"||(t==null?void 0:t.status)===j.Canceled&&"error"||"default",children:[(t==null?void 0:t.status)===j.Draft&&`${n("listView.table.tableToolbar.selectMenu.draft")}`,(t==null?void 0:t.status)===j.InProcess&&`${n("listView.table.tableToolbar.selectMenu.processing")}`,(t==null?void 0:t.status)===j.Ready&&`${n("listView.table.tableToolbar.selectMenu.readyToDeliver")}`,(t==null?void 0:t.status)===j.Delivered&&`${n("listView.table.tableToolbar.selectMenu.delivered")}`,(t==null?void 0:t.status)===j.Canceled&&`${n("listView.table.tableToolbar.selectMenu.canceled")}`]})]})}),((W=t==null?void 0:t.order)==null?void 0:W.id)&&e.jsx(d,{sx:{color:"text.secondary"},className:"print-hide",children:e.jsxs(Y,{variant:"contained",size:"small",startIcon:e.jsx(C,{icon:"heroicons-outline:external-link"}),onClick:()=>{t==null||t.quotation},children:[n("detailsCard.relatedToQuotation"),": #",(z=t==null?void 0:t.quotation)==null?void 0:z.ref]})})]}),e.jsxs(d,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsx(lt,{products:t==null?void 0:t.productToOrder,defaultRowsPerPage:t!=null&&t.notes?5:10}),e.jsx(_,{sx:{mt:1}})]}),Z,(t==null?void 0:t.notes)&&e.jsxs(d,{children:[e.jsx(_,{}),e.jsx(f,{sx:{typography:"body2"},children:e.jsx(d,{sx:{p:1},children:e.jsxs(f,{sx:{typography:"subtitle2"},children:[e.jsxs("div",{children:[n("detailsCard.notes"),":"]}),e.jsx(d,{sx:{color:"text.secondary"},children:t==null?void 0:t.notes})]})})})]})]}),F=J({queryKey:["order",t.id],queryFn:async()=>{const{data:x}=await M.get(E.order.details+t.id);return c(x),x}}),ee=x=>x.isPending||x.isLoading?e.jsx(Te,{}):x.isError?e.jsx(ve,{}):e.jsxs(f,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[(t==null?void 0:t.status)!==j.Draft&&(t==null?void 0:t.status)!==j.Canceled&&Math.round(re(t.totalOrderAmount-t.totalOrderAmount*(t.discount/100),t==null?void 0:t.snapshotTaxPercentage)-t.orderPaymentAmount)>0&&e.jsxs(e.Fragment,{children:[e.jsx(d,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(d,{children:e.jsx(N,{permission:Q.ADD_PAYMENT,children:e.jsx(Y,{onClick:()=>h.onToggle(),variant:"contained",startIcon:e.jsx(C,{icon:"mingcute:add-line"}),children:n("detailsCard.newPayment")})})})}),e.jsx(_,{})]}),e.jsx(d,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(mt,{payments:F.data.payments})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(we,{sx:{height:1,display:"flex",flexDirection:"column",width:1,transition:"all 2s ease-in-out"},children:[e.jsxs(rt,{className:"print-hide ",value:m.value,onChange:m.onChange,sx:{px:3,boxShadow:x=>`inset 0 -2px 0 0 ${se(x.vars.palette.grey["500Channel"],.08)}`},children:[r.map(x=>e.jsx(ot,{icon:x.icon,value:x.value,label:x.label},x.value)),e.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${se(T.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(R,{sx:{ml:1},onClick:l,children:e.jsx(C,{icon:"solar:full-screen-bold",width:24})})}),e.jsx(d,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${se(T.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(R,{sx:{ml:1},onClick:i,children:e.jsx(C,{icon:"solar:close-square-outline",width:24})})})]}),e.jsxs(d,{className:"print-top-margin print-padding",sx:{display:"flex",flexDirection:"column",position:"relative",flex:1},children:[e.jsx(dt,{sx:{pt:1},title:`${n("detailsCard.orderReference")}: ${t==null?void 0:t.ref}`,subheader:`${n("detailsCard.createdBy")}: ${(a=t.createdBy)==null?void 0:a.firstName} ${(k=t.createdBy)==null?void 0:k.lastName}`,action:e.jsx(f,{spacing:3,direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"},sx:{mb:{xs:3,md:5}},children:e.jsxs(f,{direction:"row",spacing:1,alignItems:"center",flexGrow:1,sx:{width:1},children:[e.jsx(H,{title:n("detailsCard.tooltips.viewTooltip"),children:e.jsx(R,{onClick:()=>{g(t.id)},children:e.jsx(C,{icon:"solar:eye-bold",color:"primary.main"})})}),((xe=t==null?void 0:t.quotation)==null?void 0:xe.id)&&e.jsx(H,{title:`${n("detailsCard.relatedToQuotation")}: #${(ue=t==null?void 0:t.quotation)==null?void 0:ue.ref}`,children:e.jsx(R,{onClick:()=>{var x;u((x=t==null?void 0:t.quotation)==null?void 0:x.id)},children:e.jsx(C,{icon:"heroicons-outline:external-link"})})}),B,e.jsx(H,{title:n("detailsCard.tooltips.printTooltip"),children:e.jsx(at,{order:t})})]})})}),e.jsx(_,{}),m.value==="details"&&X,m.value==="payments"&&ee(F)]})]}),e.jsx(nt,{order:t,open:h.value,onClose:h.onFalse,handler:I})]})};function jt({filters:s,onResetPage:l}){const[i,g]=p.useState("all"),{t}=K("orders"),c=p.useCallback(o=>{l(),s.setState({name:o.target.value})},[s,l]),n=p.useCallback(o=>{l(),s.setState({status:o.target.value}),g(o.target.value)},[s,l]);return e.jsxs(f,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(ct,{sx:{width:420},value:s.state.name,onChange:c,placeholder:`${t("listView.table.tableToolbar.searchPlaceholder")}`,InputProps:{startAdornment:e.jsx(xt,{position:"start",children:e.jsx(C,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(Ve,{sx:{width:420,textTransform:"capitalize"},value:i,onChange:n,children:[e.jsx(P,{value:"all",children:`${t("listView.table.tableToolbar.selectMenu.allOrders")}`}),e.jsx(P,{value:"Draft",children:`${t("listView.table.tableToolbar.selectMenu.draft")}`}),e.jsx(P,{value:"Canceled",children:`${t("listView.table.tableToolbar.selectMenu.canceled")}`}),e.jsx(P,{value:"InProcess",children:`${t("listView.table.tableToolbar.selectMenu.processing")}`}),e.jsx(P,{value:"Ready",children:`${t("listView.table.tableToolbar.selectMenu.readyToDeliver")}`}),e.jsx(P,{value:"Delivered",children:`${t("listView.table.tableToolbar.selectMenu.delivered")}`})]})]})}function gt({filters:s,totalResults:l,onResetPage:i,sx:g}){const t=p.useCallback(()=>{i(),s.setState({name:""})},[s,i]),c=p.useCallback(()=>{i(),s.setState({status:"all"})},[s,i]),n=p.useCallback(()=>{i(),s.setState({startDate:null,endDate:null})},[s,i]),o=p.useCallback(()=>{i(),s.onResetState()},[s,i]);return e.jsxs(ut,{totalResults:l,onReset:o,sx:g,children:[e.jsx(ae,{label:"Status:",isShow:s.state.status!=="all",children:e.jsx(le,{...ne,label:s.state.status,onDelete:c,sx:{textTransform:"capitalize"}})}),e.jsx(ae,{label:"Date:",isShow:!!(s.state.startDate&&s.state.endDate),children:e.jsx(le,{...ne,label:Qe(s.state.startDate,s.state.endDate),onDelete:n})}),e.jsx(ae,{label:"Keyword:",isShow:!!s.state.name,children:e.jsx(le,{...ne,label:s.state.name,onDelete:t})})]})}function yt({orders:s,analytics:l}){const{t:i}=K("orders"),g=[{id:"orderNumber",label:"#",width:88},{id:"name",label:i("listView.table.tableHeader.customer")},{id:"createdAt",label:i("listView.table.tableHeader.date"),width:140},{id:"totalQuantity",label:i("listView.table.tableHeader.items"),width:120,align:"center"},{id:"totalAmount",label:i("listView.table.tableHeader.price"),width:140},{id:"createdBy",label:i("listView.table.tableHeader.createdBy"),width:200},{id:"status",label:i("listView.table.tableHeader.status"),width:110},{id:"",width:88}],t=Se({defaultOrderBy:"orderId",defaultRowsPerPage:5}),c=Ce(),[n,o]=p.useState(),[m,r]=p.useState(!1),[b,T]=p.useState(g),h=Ne(),[D,I]=p.useState(()=>s),w=be({name:"",status:"all",startDate:null,endDate:null});p.useEffect(()=>{if(r(!1),I(s),n){const a=s.find(k=>k.id===n.id);o(a)}},[s]),p.useEffect(()=>{const a=n?g.filter(k=>!["createdAt","createdBy","status",""].includes(k.id)):g;T(a)},[n]);const u=je(w.state.startDate,w.state.endDate),y=ft({inputData:D,comparator:De(t.order,t.orderBy),filters:w.state,dateError:u}),S=Ue(y,t.page,t.rowsPerPage),$=!!w.state.name||w.state.status!=="all"||!!w.state.startDate&&!!w.state.endDate,V=!y.length&&$||!y.length,B=ye(),{mutate:Z}=Pe({mutationFn:a=>M.delete(E.order.delete+a),onSuccess:async()=>{fe.success(i("listView.messages.toastMessages.cancelSuccess")),await B.invalidateQueries({queryKey:["orders"]}),await B.invalidateQueries({queryKey:["orders-status"]}),await B.invalidateQueries({queryKey:["orders","analytics"]})},onError:()=>{}}),X=p.useCallback(a=>{Z(a)},[S.length,t,D]),F=p.useCallback(a=>{c.replace(L.dashboard.order.details(a))},[c]),ee=()=>{r(!m)},W=()=>{o(null),r(!1)},z=a=>{o(a)};return e.jsx(Ke,{maxWidth:"xl",children:e.jsxs(A,{container:!0,spacing:3,children:[e.jsx(A,{xs:12,md:12,children:e.jsx(Ge,{links:[{name:`${i("listView.breadCrumbsPageRootTitle")}`,href:L.dashboard.root},{name:`${i("listView.breadCrumbsParentPageTitle")}`,href:L.dashboard.order.root},{name:`${i("listView.breadCrumbsPageTitle")}`}],action:e.jsx(N,{permission:Q.ADD_ORDER,children:e.jsx(Y,{component:We,href:L.dashboard.order.new,variant:"contained",startIcon:e.jsx(C,{icon:"mingcute:add-line"}),children:`${i("listView.addNewOrder")}`})})})}),e.jsxs(N,{permission:Q.LIST_ORDER,children:[e.jsx(A,{xs:12,md:3,children:e.jsx(U,{title:`${i("listView.statisticsWidgets.allOrders")}`,total:s.length,chart:{categories:l.data.lastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:l.data.lastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(A,{xs:12,md:3,children:e.jsx(U,{title:`${i("listView.statisticsWidgets.processingOrder")}`,total:l.data.analytics.InProcess,chart:{colors:[h.vars.palette.warning.light],categories:l.data.inProcessLastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:l.data.inProcessLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(A,{xs:12,md:3,children:e.jsx(U,{title:`${i("listView.statisticsWidgets.readyToDeliver")}`,total:l.data.analytics.Ready,chart:{colors:[h.vars.palette.info.main],categories:l.data.readyLastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:l.data.readyLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),e.jsx(A,{xs:12,md:3,children:e.jsx(U,{title:`${i("listView.statisticsWidgets.delivered")}`,total:l.data.analytics.Delivered,chart:{colors:[h.vars.palette.success.main],categories:l.data.deliveredLastSixMonth.map(a=>G(a==null?void 0:a.inMonth)),series:l.data.deliveredLastSixMonth.map(a=>a==null?void 0:a.ClaimsPerMonth)}})}),!m&&e.jsx(A,{xs:12,md:n?5:12,children:e.jsxs(we,{children:[e.jsx(jt,{filters:w,onResetPage:t.onResetPage,dateError:u}),$&&e.jsx(gt,{filters:w,totalResults:y.length,onResetPage:t.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(d,{sx:{position:"relative"},children:[e.jsx(Xe,{dense:t.dense,numSelected:t.selected.length,rowCount:y.length}),e.jsx(ze,{sx:{minHeight:444},children:e.jsxs($e,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Ae,{order:t.order,orderBy:t.orderBy,headLabel:b,rowCount:y.length}),e.jsxs(Re,{children:[y.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage).map(a=>e.jsx(ht,{row:a,selected:t.selected.includes(a.id),onSelectRow:()=>t.onSelectRow(a.id),onDeleteRow:()=>X(a.id),onViewRow:()=>F(a.id),onClickRow:()=>z(a),isFullDisplay:n},a.id)),e.jsx(Ze,{height:t.dense?56:76,emptyRows:Ye(t.page,t.rowsPerPage,y.length)}),e.jsx(Je,{notFound:V})]})]})})]}),e.jsx(Ie,{page:t.page,dense:t.dense,count:y.length,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onChangeDense:t.onChangeDense,onRowsPerPageChange:t.onChangeRowsPerPage})]})}),n&&e.jsx(d,{sx:{display:"flex",flex:1,p:1.5,transition:"all 2s ease-in-out"},children:e.jsx(bt,{selectedOrder:n,handleResize:ee,handleClose:W,onViewOrder:F})})]})]})})}function ft({inputData:s,comparator:l,filters:i,dateError:g}){const{status:t,name:c,startDate:n,endDate:o}=i,m=s==null?void 0:s.map((r,b)=>[r,b]);return m==null||m.sort((r,b)=>{const T=l(r[0],b[0]);return T!==0?T:r[1]-b[1]}),s=m==null?void 0:m.map(r=>r[0]),c&&(s=s.filter(r=>r.id.toString().toLowerCase().indexOf(c.toLowerCase())!==-1||r.customer.name.toLowerCase().indexOf(c.toLowerCase())!==-1||r.status.toLowerCase().indexOf(c.toLowerCase())!==-1||r.customer.email.toLowerCase().indexOf(c.toLowerCase())!==-1)),t!=="all"&&(s=s.filter(r=>r.status===t)),g||n&&o&&(s=s.filter(r=>ge(r.createTime,n,o))),s}const Ct={title:`Order list | Dashboard - ${pe.site.name}`};function qs(){const s=J({queryKey:["orders"],queryFn:async()=>{const{data:i}=await M.get(E.order.list);return i}}),l=J({queryKey:["orders","analytics"],queryFn:async()=>{const{data:i}=await M.get(E.order.analytics);return i}});return l.isLoading||s.isLoading?e.jsx(Te,{}):s.isError||l.isError?e.jsx(ve,{route:L.dashboard.order.root}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{children:e.jsxs("title",{children:[" ",Ct.title]})}),e.jsx(yt,{orders:s.data,analytics:l})]})}export{qs as default};

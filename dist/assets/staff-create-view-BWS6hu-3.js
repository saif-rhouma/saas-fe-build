import{dI as V,l as z,r as d,o as J,dJ as v,dH as y,dK as r,p as h,j as o,aD as N,S as P,T as I,B as b,w as H,I as K,bR as F,e as A,e8 as L}from"./index-D-ZKGqTU.js";import{C as $}from"./custom-breadcrumbs-Ce0SsF19.js";import{z as m,u as O,t as U,a as W,F as n}from"./form-provider-L0KFjUTq.js";import{u as E}from"./useMutation-DZH4G1UV.js";import"./image-CX1CYgjP.js";import"./editor-CzmUVphq.js";import{I as X}from"./InputAdornment-B2x29rol.js";const Y=m.object({firstName:m.string().min(1,{message:"Staff firstName is required!"}),password:m.string().min(1,{message:"Password is required!"}).min(8,{message:"Password must be at least 8 characters!"}),email:m.string().min(1,{message:"Email is required!"}),permissions:m.string().array().nonempty({message:"At least one permission is required!"}),isActive:m.boolean(),permissionsGroup:m.number()});function Z({currentStaff:s,appPermissions:a,appPermissionsGroup:l}){const j=V(),g=z(),[_,T]=d.useState(a),[B,w]=d.useState(!1),x=J(),p=d.useMemo(()=>({firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",phoneNumber:(s==null?void 0:s.phoneNumber)||"",email:(s==null?void 0:s.email)||"",password:(s==null?void 0:s.password)||"",isActive:(s==null?void 0:s.isActive)===void 0?!0:s==null?void 0:s.isActive,permissions:(s==null?void 0:s.permissions.map(e=>e.slug))||[],permissionsGroup:(s==null?void 0:s.permissionsGroup)||null}),[s]),C=O({resolver:U(Y),defaultValues:p}),{reset:t,watch:k,setValue:u,handleSubmit:G,control:S,formState:{isSubmitting:q}}=C;k(),d.useEffect(()=>{s&&t(p),a&&T(a)},[s,a,p,t]);const{mutate:D}=E({mutationFn:e=>v.post(y.staff.create,e),onSuccess:()=>{r.success("New Staff has been created successfully!"),j.invalidateQueries(["staff"]),t(),g.push(h.dashboard.staff.root)},onError:e=>{console.error(e),r.error("Failed to save staff. Please try again.")}}),{mutate:M}=E({mutationFn:({id:e,payload:i})=>v.patch(y.staff.edit+e,i),onSuccess:()=>{r.success("Staff updated successfully!");const{id:e}=s;j.invalidateQueries(["staff",e]),t(),g.push(h.dashboard.staff.root)},onError:e=>{console.error(e),r.error("Failed to edit staff. Please try again.")}}),Q=G(async e=>{e.permissionsGroup!==0&&delete e.permissions;try{if(s!=null&&s.id){const{id:i}=s;await M({id:i,payload:e})}else await D(e)}catch(i){console.error(i)}});return o.jsxs(W,{methods:C,onSubmit:Q,children:[o.jsx(N,{sx:{mb:4},children:o.jsxs(P,{spacing:4,sx:{p:3},children:[o.jsx(I,{variant:"h6",gutterBottom:!0,children:"Staff Details"}),o.jsxs(b,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(3, 1fr)"},children:[o.jsx(n.Text,{label:"First Name",name:"firstName"}),o.jsx(n.Text,{label:"Email",name:"email"}),o.jsx(n.Phone,{name:"phoneNumber",label:"Phone number"}),o.jsx(n.Text,{name:"password",label:"Password",placeholder:"8+ characters",type:x.value?"text":"password",InputLabelProps:{shrink:!0},InputProps:{endAdornment:o.jsx(X,{position:"end",children:o.jsx(H,{onClick:x.onToggle,edge:"end",children:o.jsx(K,{icon:x.value?"solar:eye-bold":"solar:eye-closed-bold"})})})}}),(l==null?void 0:l.length)>0&&o.jsxs(n.Select,{name:"permissionsGroup",label:"Choose Permissions Group",sx:{width:420,textTransform:"capitalize"},onChange:e=>{const{value:i}=e.target;if(i){const R=l.find(c=>c.id===i);u("permissions",R.permissions.map(c=>c.slug)),u("permissionsGroup",i),w(!1)}},children:[l.map(e=>o.jsx(F,{value:e.id,children:`${e==null?void 0:e.name}`},e.id)),B&&o.jsx(F,{value:0,children:"Custom"})]})]})]})}),o.jsxs(N,{sx:{p:4},children:[o.jsx(I,{variant:"h6",gutterBottom:!0,sx:{mb:4},children:"Permissions"}),o.jsx(b,{display:"flex",justifyContent:"center",alignItems:"center",sx:{mb:4},children:o.jsx(n.MultiCheckbox,{name:"permissions",onClick:()=>{w(!0),u("permissionsGroup",0)},options:a.map(e=>({label:e.name,value:e.slug})),sx:{display:"grid",columnGap:4,rowGap:4,gridTemplateColumns:"repeat(4, 1fr)"}})}),s&&o.jsx(n.Switch,{name:"isActive",label:"Is Active?"}),o.jsxs(b,{display:"flex",justifyContent:"flex-end",mt:2,children:[o.jsx(A,{type:"submit",variant:"contained",disabled:q,children:"Submit"}),o.jsx(A,{variant:"outlined",onClick:()=>t(),sx:{ml:2},children:"Cancel"})]})]})]})}function ms({currentStaff:s,appPermissions:a,appPermissionsGroup:l}){return o.jsxs(L,{children:[o.jsx($,{links:[{name:"Dashboard",href:h.dashboard.root},{name:"Staff",href:h.dashboard.staff.root},{name:"New Staff"}],sx:{mb:{xs:3,md:5}}}),o.jsx(Z,{currentStaff:s,appPermissions:a,appPermissionsGroup:l})]})}export{ms as S};

import{r as g,dN as I,dO as b,dM as f,dP as $,db as _,j as e,aH as C,S as u,T as h,B as F,bL as T,e as z,ed as J,p as N,eh as Z,H as W,C as X}from"./index-BPQkDe0s.js";import{u as B,E as R}from"./error-block-Db9supFO.js";import{C as Y}from"./custom-breadcrumbs-BIW9VTmo.js";import{b as c,U as A}from"./upload-avatar-CesV9ZGt.js";import{a as L}from"./format-number-9dwzKsgZ.js";import{z as m,b as ee,u as re,t as se,F as te}from"./form-provider-Csxs3POq.js";import{u as D}from"./useMutation-BoBY0b1e.js";import{F as i}from"./fields-uLHuWF6F.js";import"./editor-JwZorNGg.js";import{s as ae}from"./schema-helper-CODNJXI3.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./FormHelperText-CPxcDFA-.js";import"./formControlState-Dq1zat_P.js";import"./index-DGJW8Nhg.js";import"./image-C7AA7Kgf.js";import"./TextField-Bi7NVwCq.js";import"./FormControl-bKQXC1dH.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-AqbAhnGZ.js";import"./FormLabel-8bz6Jicd.js";import"./Select-9Xhy8-ut.js";import"./Menu-DGoJy9BJ.js";import"./InputBase-CPrPQ_RD.js";import"./countries-DSLisFCy.js";import"./InputAdornment-Ck59aR0s.js";import"./Rating-CpW9817X.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-Cn-68b2h.js";import"./RadioGroup-DbSLazbi.js";import"./FormGroup-CC5xoKev.js";import"./FormControlLabel-CkOEQNeq.js";import"./Autocomplete-lg4xc3Dx.js";import"./Chip-ALPNHt2t.js";import"./country-select-Bo5KTiYN.js";import"./Checkbox-DYdkvSfk.js";import"./DatePicker-BGXln9IR.js";import"./DialogContent-p3i0msBI.js";import"./ListItem-BApUg4RM.js";import"./MobileDateTimePicker-dEpBlYqw.js";import"./index-DhCxhDCC.js";const me=m.object({name:m.string().min(1,{message:"Staff First Name is required!"}),description:m.string(),email:m.string().min(1,{message:"Email is required!"}).email({message:"Email must be a valid email address!"}),phoneNumber:ae.phoneNumber({isValidPhoneNumber:ee}),currencySymbol:m.string().min(1,{message:"Staff Last Name is required!"}),taxPercentage:m.number().min(1,{message:"Staff Last Name is required!"}),financialYear:m.number().min(1,{message:"Financial Year is required!"}),country:m.string().min(1,{message:"Country is required!"}),state:m.string(),street:m.string(),city:m.string(),district:m.string(),zipCode:m.string(),taxNumber:m.number(),printerPOS:m.string().min(1,{message:"Printer POS is required!"})}),ie=({applicationAccount:s,financial:y})=>{const l=g.useRef(s),[j,O]=g.useState(null),[S,P]=g.useState(null);g.useEffect(()=>{s&&G(q)},[s]);const q=g.useMemo(()=>{var r,t,a,n,d,o,x;return{name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",email:(s==null?void 0:s.email)||"",phoneNumber:(s==null?void 0:s.phoneNumber)||"",currencySymbol:(s==null?void 0:s.currencySymbol)||"",taxPercentage:(s==null?void 0:s.taxPercentage)||"",financialYear:((r=s==null?void 0:s.financialYear)==null?void 0:r.id)||"",country:((t=s==null?void 0:s.address)==null?void 0:t.country)||"",state:((a=s==null?void 0:s.address)==null?void 0:a.state)||"",city:((n=s==null?void 0:s.address)==null?void 0:n.city)||"",district:((d=s==null?void 0:s.address)==null?void 0:d.district)||"",zipCode:((o=s==null?void 0:s.address)==null?void 0:o.zipCode)||"",street:((x=s==null?void 0:s.address)==null?void 0:x.street)||"",taxNumber:(s==null?void 0:s.taxNumber)||0,printerPOS:(s==null?void 0:s.printerPOS)||""}},[s]),E=re({resolver:se(me),defaultValues:q}),{reset:G,watch:oe,setValue:xe,handleSubmit:U,control:ge,formState:{isSubmitting:he}}=E,k=U(async r=>{try{if(r.city||r.country||r.district||r.state||r.street||r.zipCode){const{country:t,state:a,city:n,district:d,zipCode:o,street:x}=r;r.address={country:t,state:a,city:n,district:d,zipCode:o,street:x},delete r.city,delete r.country,delete r.district,delete r.state,delete r.street,delete r.zipCode}if(l.current={...r},j&&S){const t=new FormData;t.append("file",j),t.append("category","AppAvatar");const a=new FormData;a.append("file",S),a.append("category","AppLogo"),await V({avatar:t,logo:a})}else if(j){const t=new FormData;t.append("file",j),t.append("category","AppAvatar"),await M(t)}else if(S){const t=new FormData;t.append("file",S),t.append("category","AppLogo"),await M(t)}else await w(r)}catch(t){console.error(t)}}),K=g.useCallback(r=>{const t=r[0];O(t)},[]),H=g.useCallback(r=>{const t=r[0];P(()=>t)},[]),Q=()=>{P(null)},v={headers:{"content-type":"multipart/form-data"}},p=I(),{mutate:M}=D({mutationFn:r=>b.post(f.files.upload,r,v),onSuccess:async({data:r})=>{const{name:t}=r;if(t){const{current:a}=l;a.avatar=t,await w(a)}return r},onSettled:async()=>{await p.invalidateQueries({queryKey:["appAvatar-images"]})},onError:r=>{console.log(r)}}),{mutate:V}=D({mutationFn:async({avatar:r,logo:t})=>{const a=await b.post(f.files.upload,r,v),n=await b.post(f.files.upload,t,v);return{avatarRes:a,logoRes:n}},onSuccess:async({avatarRes:r,logoRes:t})=>{var o,x;const a=(o=r==null?void 0:r.data)==null?void 0:o.name,n=(x=t==null?void 0:t.data)==null?void 0:x.name,{current:d}=l;n&&(d.appLogo=n),a&&(d.favicon=a),console.log("----> payload",d),await w(d)},onSettled:async()=>{await p.invalidateQueries({queryKey:["appAvatar-images"]})},onError:r=>{console.log(r)}}),{mutate:w}=D({mutationFn:r=>b.patch(f.master.edit,r),onSuccess:async()=>{$.success("Master Account Has Been Modified!");const{currencySymbol:r}=l.current;localStorage.setItem(_,r)},onSettled:async()=>{await p.invalidateQueries({queryKey:["account-application"]})},onError:r=>{console.log(r)}});return e.jsx(e.Fragment,{children:e.jsxs(te,{methods:E,onSubmit:k,children:[e.jsx(C,{sx:{mb:4},children:e.jsxs(u,{spacing:2,sx:{p:3},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"Application Details"}),e.jsxs(F,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(i.Text,{name:"name",label:"Application Name"}),e.jsx(i.Phone,{name:"phoneNumber",label:"Phone number"}),e.jsx(i.Text,{name:"email",label:"Email address"}),e.jsx(i.Text,{name:"description",label:"Description"}),e.jsxs(u,{spacing:1.5,children:[e.jsx(h,{variant:"subtitle2",children:"Attachments"}),e.jsx(c,{value:S,onDrop:H,onDelete:Q})]}),e.jsxs(u,{spacing:1.5,children:[e.jsx(h,{variant:"subtitle2",children:"Favicon"}),e.jsx(A,{value:j,onDrop:K,validator:r=>r.size>1e6?{code:"file-too-large",message:`File is larger than ${L(1e6)}`}:null,helperText:e.jsxs(h,{variant:"caption",sx:{mt:3,mx:"auto",display:"block",textAlign:"center",color:"text.disabled"},children:["Allowed *.jpeg, *.jpg, *.png, *.gif",e.jsx("br",{})," max size of ",L(3145728)]})})]})]})]})}),e.jsx(C,{sx:{mb:4},children:e.jsxs(u,{spacing:2,sx:{p:3},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"Finance Setting"}),e.jsxs(F,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(3, 1fr)"},children:[e.jsx(i.Text,{name:"currencySymbol",label:"Currency Symbol"}),e.jsx(i.Text,{name:"taxPercentage",label:"Tax Percentage"}),e.jsx(i.Select,{name:"financialYear",label:"Select a Financial Year",sx:{width:420,textTransform:"capitalize"},children:y.map(r=>e.jsx(T,{value:r==null?void 0:r.id,children:r==null?void 0:r.year},r==null?void 0:r.id))})]})]})}),e.jsx(C,{sx:{mb:4},children:e.jsxs(u,{spacing:2,sx:{p:3},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"Firm Address"}),e.jsxs(F,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(i.CountrySelect,{name:"country",label:"Country",placeholder:"Choose a country"}),e.jsx(i.Text,{name:"state",label:"State/region"}),e.jsx(i.Text,{name:"city",label:"City"}),e.jsx(i.Text,{name:"district",label:"District"}),e.jsx(i.Text,{name:"zipCode",label:"Zip/code"}),e.jsx(i.Text,{name:"street",label:"Address"}),e.jsx(i.Text,{type:"number",name:"taxNumber",label:"Store Tax Number"})]})]})}),e.jsx(C,{sx:{mb:4},children:e.jsxs(u,{spacing:2,sx:{p:3},children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"Other Settings"}),e.jsx(F,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:e.jsxs(i.Select,{name:"printerPOS",label:"Printer POS",sx:{width:420,textTransform:"capitalize"},children:[e.jsx(T,{value:"A4",children:"A4"}),e.jsx(T,{value:"Thermal",children:"Thermal"})]})})]})}),e.jsxs(F,{display:"flex",justifyContent:"flex-end",gap:2,mt:2,children:[e.jsx(z,{type:"submit",variant:"contained",children:"Save Changes"}),e.jsx(z,{variant:"outlined",children:"Cancel"})]})]})})},ne=({applicationAccount:s,financial:y})=>e.jsxs(J,{children:[e.jsx(Y,{links:[{name:"Dashboard",href:N.dashboard.root},{name:"Tools",href:N.dashboard.tools.root},{name:"Master Settings"}],sx:{mb:{xs:3,md:5}}}),e.jsx(ie,{applicationAccount:s,financial:y})]}),de=ne,le={title:`Tools | Dashboard - ${X.site.name}`};function sr(){const s=B({queryKey:["account-application"],queryFn:async()=>{const{data:l}=await b.get(f.auth.application);return l}}),y=B({queryKey:["financial-year"],queryFn:async()=>{const{data:l}=await b.get(f.financial.list);return l}});return y.isLoading||s.isLoading?e.jsx(Z,{}):s.isError?e.jsx(R,{route:N.dashboard.tools.root}):e.jsxs(e.Fragment,{children:[e.jsx(W,{children:e.jsxs("title",{children:[" ",le.title]})}),e.jsx(de,{applicationAccount:s.data,financial:y.data})]})}export{sr as default};

import{r as l,i as P,j as s,S as t,B as i,ee as G,e8 as U,d0 as z,d7 as J,e as y,I as n,am as O,g as M,p as d,dn as Y,dP as W,cV as R,cY as X,e3 as b,c9 as x,l as p,v as Z,dp as T,dm as w,dq as E,dT as q,H as ee,C as se}from"./index-DBAnnifB.js";import{u as re,E as ie}from"./error-block-I6x1Hy75.js";import{u as te}from"./use-params-DEx6JbuU.js";import{l as ne}from"./index-JU6SrAG_.js";import{u as A}from"./useMutation-DLdc3eWl.js";import{u as ae}from"./use-tabs-VslulDr8.js";import{b as g}from"./format-number-DHkj0q5I.js";import{C as oe}from"./custom-breadcrumbs-DBItHaBE.js";import{P as C}from"./permission-access-controller-Dti4v_dk.js";import{T as le}from"./tickets-create-dialog-D9HqaqUy.js";import{R as de}from"./reminder-create-dialog-QHjOVrKF.js";import{Q as ce,a as me}from"./quotation-reminder-table-3qHTNe93.js";import{Q as xe}from"./quotation-product-table-bgPa4QVx.js";import{C as pe}from"./CardHeader-Vz8vospd.js";import{T as he,a as je}from"./Tabs-D1nVhLuN.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./form-provider-C9WrYleO.js";import"./TextField-Cnf5s-_6.js";import"./FormControl-BL4Ls0ff.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-B6YlaWfN.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-qH7g1y9y.js";import"./Select-Cs1GmroI.js";import"./Menu-CWYUzvJj.js";import"./InputBase-Dk2d0D5e.js";import"./FormHelperText-DbwQqqnD.js";import"./Rating-DsIJUcaL.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-CpxSiSi_.js";import"./index-B9zhif9o.js";import"./Slider-BALWrmvq.js";import"./RadioGroup-C_0xPGj6.js";import"./FormGroup-ZuySfzWi.js";import"./FormControlLabel-BLHOqcns.js";import"./utils-C3i7epmT.js";import"./index-BHbW1OCY.js";import"./countries-DSLisFCy.js";import"./InputAdornment-kj6j4mRM.js";import"./Autocomplete-Bk7RHyx1.js";import"./Chip-DfL_ynnF.js";import"./country-select-SNPz2g0K.js";import"./Checkbox-C9zyd1yT.js";import"./upload-avatar-CgBNTr-y.js";import"./image-V4smZB5P.js";import"./DatePicker-WvioqOmJ.js";import"./DialogContent-BOG7TMWB.js";import"./ListItem-CRRiYsyQ.js";import"./MobileDateTimePicker-kmTIkQgP.js";import"./upload-box-ad-ynGRG7AK.js";import"./DialogTitle-m6FUYnnv.js";import"./LoadingButton-CunA2jBP.js";import"./CircularProgress-DeUuXNKO.js";import"./schema-helper-CvPOGW5C.js";import"./utils-MBUcMVfY.js";import"./use-table-_0b8U19R.js";import"./table-head-custom-oTVXNsWX.js";import"./TableCell-D0tRcJwU.js";import"./table-pagination-custom-CSBoVDUr.js";import"./TablePagination-CtzltUxB.js";import"./KeyboardArrowRight-tacz4Y6j.js";import"./LastPage-BC27tdqq.js";import"./table-empty-rows-6TIBM6gU.js";import"./AvatarGroup-KOO4AQi4.js";const ue=[{value:"details",icon:s.jsx(n,{icon:"solar:eye-bold",width:24}),label:"Details"},{value:"tickets",icon:s.jsx(n,{icon:"solar:case-minimalistic-bold",width:24}),label:"Tickets"},{value:"reminders",icon:s.jsx(n,{icon:"solar:calendar-bold",width:24}),label:"Reminders"}];function fe({currentQuotation:o}){var k,Q,D,I;const[e,h]=l.useState(o),a=ae("details"),v=l.useRef();l.useEffect(()=>{h(o)},[o]);const N=ne.useReactToPrint({content:()=>v.current}),j=P(),u=P(),S=s.jsxs(t,{alignItems:"flex-end",sx:{pr:3,pl:3,pb:3,textAlign:"right",typography:"body2"},children:[s.jsxs(t,{direction:"row",children:[s.jsx(i,{sx:{color:"text.secondary"},children:"Subtotal"}),s.jsx(i,{sx:{width:160,typography:"subtitle2"},children:g(e==null?void 0:e.totalAmount)||"-"})]}),s.jsxs(t,{direction:"row",children:[s.jsx(i,{sx:{color:"text.secondary"},children:"Discount"}),s.jsx(i,{sx:{width:160,...(e==null?void 0:e.discount)&&{color:"error.main"}},children:e!=null&&e.discount?`- ${e==null?void 0:e.discount}%`:"-"})]}),s.jsxs(t,{direction:"row",children:[s.jsxs(i,{sx:{color:"text.secondary"},children:["Tax (",(e==null?void 0:e.snapshotTaxPercentage)||"0","%)"]}),s.jsx(i,{sx:{width:160},children:e!=null&&e.snapshotTaxPercentage?g(G((e==null?void 0:e.totalAmount)-(e==null?void 0:e.totalAmount)*((e==null?void 0:e.discount)/100),e==null?void 0:e.snapshotTaxPercentage)):"-"})]}),s.jsxs(t,{direction:"row",sx:{typography:"subtitle1"},children:[s.jsx("div",{children:"Total"}),s.jsx(i,{sx:{width:160},children:g(U((e==null?void 0:e.totalAmount)-(e==null?void 0:e.totalAmount)*((e==null?void 0:e.discount)/100),e==null?void 0:e.snapshotTaxPercentage))||"-"})]})]}),B=s.jsxs(t,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[s.jsxs(i,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",m:1},children:[s.jsxs(i,{flexDirection:"column",sx:{display:"flex"},children:[s.jsxs(i,{sx:{color:"text.secondary"},children:["Quotation Ref: #",e==null?void 0:e.ref]}),s.jsxs(i,{sx:{color:"text.secondary"},children:["Quotation Date: ",z(e==null?void 0:e.quotationDate)]})]}),s.jsx(i,{sx:{mr:2},children:s.jsxs(i,{sx:{color:"text.secondary"},children:["Status:"," ",s.jsx(J,{variant:"soft",color:(e==null?void 0:e.status)==="Confirmed"&&"info"||(e==null?void 0:e.status)==="Converted"&&"success"||(e==null?void 0:e.status)==="Canceled"&&"error"||"default",children:e==null?void 0:e.status})]})}),((k=e==null?void 0:e.order)==null?void 0:k.id)&&s.jsx(i,{sx:{color:"text.secondary"},className:"print-hide",children:s.jsxs(y,{variant:"contained",size:"small",startIcon:s.jsx(n,{icon:"heroicons-outline:external-link"}),onClick:()=>{const{id:r}=e==null?void 0:e.order;r&&V(r)},children:["Related to Order: #",(Q=e==null?void 0:e.order)==null?void 0:Q.ref]})})]}),(e==null?void 0:e.notes)&&s.jsxs(i,{children:[s.jsx(O,{}),s.jsx(t,{sx:{typography:"body2"},children:s.jsx(i,{sx:{p:1},children:s.jsxs(t,{sx:{typography:"subtitle2"},children:[s.jsx("div",{children:"Notes:"}),s.jsx(i,{sx:{color:"text.secondary"},children:e==null?void 0:e.notes})]})})})]})]}),F=s.jsxs(s.Fragment,{children:[s.jsx(i,{sx:{pr:3,pl:3,mb:3,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:s.jsx(xe,{products:e==null?void 0:e.productToQuotation,defaultRowsPerPage:10})}),S]}),H=s.jsx(t,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:s.jsx(i,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:s.jsx(ce,{tickets:e.tickets})})}),K=s.jsx(t,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:s.jsx(i,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:s.jsx(me,{reminders:e==null?void 0:e.reminders})})}),c=M(),L=l.useCallback(r=>{c.push(d.dashboard.quotation.edit(r))},[c]),V=l.useCallback(r=>{c.push(d.dashboard.order.details(r))},[c]),m=Y(),{mutate:_}=A({mutationFn:r=>T.post(w.quotation.createOrder,r),onSuccess:async({data:r})=>{E.success("Order Has Been Created!");const{id:f}=e;await m.invalidateQueries({queryKey:["quotations"]}),await m.invalidateQueries({queryKey:["quotation",f]})},onError:r=>{console.log(r)}}),{mutate:$}=A({mutationFn:r=>T.patch(w.quotation.editStatus+r,{status:"Confirmed"}),onSuccess:async({data:r})=>{E.success("Quotation Has Been Confirmed!");const{id:f}=e;await m.invalidateQueries({queryKey:["quotations"]}),await m.invalidateQueries({queryKey:["quotation",f]})},onError:r=>{console.log(r)}});return s.jsxs(W,{children:[s.jsx(oe,{links:[{name:"Dashboard",href:d.dashboard.root},{name:"Quotation",href:d.dashboard.quotation.root},{name:"Quotation Details"}],sx:{mb:{xs:3,md:5}}}),s.jsx(R,{container:!0,spacing:3,children:s.jsx(R,{xs:12,md:12,children:s.jsxs(X,{ref:v,children:[s.jsx("style",{jsx:!0,children:`
              .print-title {
                display: none; /* Hide on screen */
              }

              @media print {
                html,
                body {
                  height: initial !important;
                  overflow: initial !important;
                }
                .print-title {
                  display: block; /* Show only when printing */
                }
                .print-hide {
                  display: none; /* Hide on screen */
                }
                .print-padding {
                  padding: 5px;
                }
                .print-top-margin {
                  margin-top: 40px;
                }
              }
            `}),s.jsxs(t,{direction:{md:"column",p:3},className:"print-top-margin print-padding",children:[s.jsx(pe,{sx:{pt:1},title:e==null?void 0:e.name,subheader:`Quotation for Customer : ${(D=e==null?void 0:e.customer)==null?void 0:D.name}`,action:s.jsx(t,{className:"print-hide",spacing:3,direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"},sx:{mb:{xs:3,md:5}},children:s.jsxs(t,{direction:"row",spacing:1,flexGrow:1,sx:{width:1},children:[s.jsx(C,{permission:b.EDIT_QUOTATION,children:(e==null?void 0:e.status)==="Draft"&&s.jsx(x,{title:"Edit",children:s.jsx(p,{onClick:()=>{L(e==null?void 0:e.id)},children:s.jsx(n,{icon:"solar:pen-bold"})})})}),(e==null?void 0:e.status)==="Created"&&s.jsx(x,{title:"Confirm",children:s.jsx(p,{onClick:()=>{$(e==null?void 0:e.id)},children:s.jsx(n,{icon:"line-md:confirm-circle-filled"})})}),s.jsx(C,{permission:b.CONVERT_QUOTATION_TO_ORDER,children:!((I=e==null?void 0:e.order)!=null&&I.id)&&(e==null?void 0:e.status)==="Draft"&&s.jsx(x,{title:"Convert to Order",children:s.jsx(p,{onClick:()=>{_({quotationId:e==null?void 0:e.id})},children:s.jsx(n,{icon:"solar:restart-circle-bold"})})})}),s.jsx(C,{permission:b.PRINT_QUOTATION,children:s.jsx(x,{title:"Print",children:s.jsx(p,{onClick:()=>{a.setValue("details"),N()},children:s.jsx(n,{icon:"solar:printer-minimalistic-bold"})})})})]})})}),B,s.jsx(O,{sx:{mt:3}}),s.jsxs(he,{value:a.value,className:"print-hide",onChange:a.onChange,sx:{px:3,mb:3,boxShadow:r=>`inset 0 -2px 0 0 ${Z(r.vars.palette.grey["500Channel"],.08)}`},children:[ue.map(r=>s.jsx(je,{icon:r.icon,value:r.value,label:r.label},r.value)),a.value==="tickets"&&s.jsx(i,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx(y,{onClick:()=>j.onToggle(),variant:"outlined",startIcon:s.jsx(n,{icon:"mingcute:add-line"}),children:"New Ticket"})}),a.value==="reminders"&&s.jsx(i,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx(y,{onClick:()=>u.onToggle(),variant:"outlined",startIcon:s.jsx(n,{icon:"mingcute:add-line"}),children:"New Reminder"})})]}),a.value==="details"&&F,a.value==="tickets"&&H,a.value==="reminders"&&K]})]})})}),s.jsx(le,{open:j.value,onClose:j.onFalse,quotation:e}),s.jsx(de,{open:u.value,onClose:u.onFalse,quotation:e})]})}const ye={title:`Quotation details | Dashboard - ${se.site.name}`};function Rs(){const{id:o=""}=te(),e=re({queryKey:["quotation",o],queryFn:async()=>{const{data:h}=await T.get(w.quotation.details+o);return h}});return e.isPending||e.isLoading?s.jsx(q,{}):e.isError?s.jsx(ie,{route:d.dashboard.order.root}):s.jsxs(s.Fragment,{children:[s.jsx(ee,{children:s.jsxs("title",{children:[" ",ye.title]})}),s.jsx(fe,{currentQuotation:e.data})]})}export{Rs as default};

import{dJ as q,r as u,C as N,w as J,j as n,B as E,cp as X,e as Y,I as Q,S as j,aH as Z,eb as tt,T as st,bL as nt,H as et}from"./index-lMp9zap6.js";import{u as at,a as w,c as F,p as ot,r as rt,g as it,D as lt,M as ct,S as K,h as dt,v as ut,K as mt,T as xt,b as pt,d as L}from"./sortable.esm-DwpaWs5o.js";import{u as ft,m as T}from"./index-B6dvdy-Z.js";import{E as ht}from"./empty-content-v04S0NJf.js";import{k as kt,K as Ct,a as gt,c as bt,b as yt}from"./utils-DYql5Ggd.js";import{K as jt}from"./kanban-task-item-HJ1LKZJu.js";import{T as It}from"./TextField-BEm0Gfgz.js";import{C as St}from"./ClickAwayListener-C6ds15AF.js";import{F as vt}from"./FormControlLabel-CSqTNcaw.js";import"./ListItem-Eefms6HN.js";import"./AvatarGroup-DL-rnc4_.js";import"./InputBase-D6UR9yYG.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./Skeleton-RWGZjAwW.js";import"./image-7Gw8g56m.js";import"./FormControl-BFlCQpvi.js";import"./InputLabel-D2FT-Pcv.js";import"./FormLabel-CKyhTT_V.js";import"./Select-DE7_tqxX.js";import"./Menu-Di83eYAm.js";import"./FormHelperText-CiWaMPMf.js";const O=!1,v=`${N.site.serverUrl}/api/orders-status`,wt={revalidateIfStale:O,revalidateOnFocus:O,revalidateOnReconnect:O};function Ot(){const{data:t,isLoading:a,error:r,isValidating:l}=ft(v,q,wt);return u.useMemo(()=>{const C=(t==null?void 0:t.board.tasks)??{},p=(t==null?void 0:t.board.columns)??[];return{board:{tasks:C,columns:p},boardLoading:a,boardError:r,boardValidating:l,boardEmpty:!a&&!p.length}},[t==null?void 0:t.board.columns,t==null?void 0:t.board.tasks,r,a,l])}async function Tt(t){T(v,a=>{const{board:r}=a,l=[...r.columns,t],m={...r.tasks,[t.id]:[]};return{...a,board:{...r,columns:l,tasks:m}}},!1)}async function Et(t){T(v,a=>{const{board:r}=a;return{...a,board:{...r,columns:t}}},!1)}async function A(t){T(v,a=>{const{board:r}=a;return{...a,board:{...r,tasks:t}}},!1)}function Ft(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const a=Math.random()*16|0;return(t==="x"?a:a&3|8).toString(16)})}function Kt({sx:t,...a}){const[r,l]=u.useState(""),m=J(),C=u.useCallback(c=>{l(c.target.value)},[]),p=u.useCallback(async()=>{try{const c={id:Ft(),name:r.trim()?r:"Untitled"};Tt(c),l(""),m.onFalse()}catch(c){console.error(c)}},[r,m]),k=u.useCallback(c=>{c.key==="Enter"&&p()},[p]),b=u.useCallback(()=>{l(""),m.onFalse()},[m]);return n.jsxs(n.Fragment,{children:[n.jsx(E,{sx:{width:"var(--column-width)",flex:"0 0 auto",...t},...a,children:m.value?n.jsx(St,{onClickAway:b,children:n.jsx(It,{autoFocus:!0,fullWidth:!0,placeholder:"Untitled",value:r,onChange:C,onKeyUp:k,helperText:"Press Enter to create the column.",sx:{[`& .${X.input}`]:{typography:"h6"}}})}):n.jsx(Y,{fullWidth:!0,size:"large",color:"inherit",variant:"outlined",startIcon:n.jsx(Q,{icon:"mingcute:add-line",sx:{mr:-.5}}),onClick:m.onTrue,children:"Add column"})}),n.jsx(E,{sx:{width:"1px",flexShrink:0}})]})}const D="placeholder",B={"--item-gap":"16px","--item-radius":"12px","--column-gap":"24px","--column-width":"336px","--column-radius":"16px","--column-padding":"20px 16px 16px 16px"};function Lt(){const{board:t,boardLoading:a,boardEmpty:r}=Ot(),[l,m]=u.useState(!0),C=u.useRef(!1),p=u.useRef(null),[k,b]=u.useState(null),c=t.columns.map(s=>s.id),H=k?c.includes(k):!1,M=at(w(pt,{activationConstraint:{distance:5}}),w(xt,{activationConstraint:{distance:5}}),w(mt,{coordinateGetter:bt})),P=u.useCallback(s=>{var i;if(k&&k in t.tasks)return F({...s,droppableContainers:s.droppableContainers.filter(f=>f.id in t.tasks)});const e=ot(s),x=e.length>0?e:rt(s);let o=it(x,"id");if(o!=null){if(o in t.tasks){const f=t.tasks[o].map(d=>d.id);f.length>0&&(o=(i=F({...s,droppableContainers:s.droppableContainers.filter(d=>d.id!==o&&f.includes(d.id))})[0])==null?void 0:i.id)}return p.current=o,[{id:o}]}return C.current&&(p.current=k),p.current?[{id:p.current}]:[]},[k,t==null?void 0:t.tasks]),I=s=>s in t.tasks?s:Object.keys(t.tasks).find(e=>t.tasks[e].map(x=>x.id).includes(s));u.useEffect(()=>{requestAnimationFrame(()=>{C.current=!1})},[]);const R=({active:s})=>{b(s.id)},V=({active:s,over:e})=>{const x=e==null?void 0:e.id;if(x==null||s.id in t.tasks)return;const o=I(x),i=I(s.id);if(!(!o||!i)&&i!==o){const f=t.tasks[i].map(y=>y.id),d=t.tasks[o].map(y=>y.id),g=d.indexOf(x),S=f.indexOf(s.id);let h;if(x in t.tasks)h=d.length+1;else{const _=e&&s.rect.current.translated&&s.rect.current.translated.top>e.rect.top+e.rect.height?1:0;h=g>=0?g+_:d.length+1}C.current=!0;const G={...t.tasks,[i]:t.tasks[i].filter(y=>y.id!==s.id),[o]:[...t.tasks[o].slice(0,h),t.tasks[i][S],...t.tasks[o].slice(h,t.tasks[o].length)]};A(G)}},U=({active:s,over:e})=>{if(s.id in t.tasks&&(e!=null&&e.id)){const f=c.indexOf(s.id),d=c.indexOf(e.id),g=L(t.columns,f,d);Et(g)}const x=I(s.id);if(!x){b(null);return}const o=e==null?void 0:e.id;if(o==null){b(null);return}const i=I(o);if(i){const f=t.tasks[x].map(h=>h.id),d=t.tasks[i].map(h=>h.id),g=f.indexOf(s.id),S=d.indexOf(o);if(g!==S){const h={...t.tasks,[i]:L(t.tasks[i],g,S)};A(h)}}b(null)},W=n.jsx(j,{direction:"row",alignItems:"flex-start",sx:{gap:"var(--column-gap)"},children:n.jsx(yt,{})}),z=n.jsx(ht,{filled:!0,sx:{py:10,maxHeight:{md:480}}}),$=n.jsxs(lt,{id:"dnd-kanban",sensors:M,collisionDetection:P,measuring:{droppable:{strategy:ct.Always}},onDragStart:R,onDragOver:V,onDragEnd:U,children:[n.jsx(j,{sx:{flex:"1 1 auto",overflowX:"auto"},children:n.jsx(j,{sx:{pb:3,display:"unset",...l&&{minHeight:0,display:"flex",flex:"1 1 auto"}},children:n.jsx(j,{direction:"row",sx:{gap:"var(--column-gap)",...l&&{minHeight:0,flex:"1 1 auto",[`& .${kt.columnList}`]:{...Z,flex:"1 1 auto"}}},children:n.jsxs(K,{items:[...c,D],strategy:dt,children:[t==null?void 0:t.columns.map(s=>n.jsx(Ct,{column:s,tasks:t.tasks[s.id],children:n.jsx(K,{items:t.tasks[s.id],strategy:ut,children:t.tasks[s.id].map(e=>n.jsx(jt,{task:e,columnId:s.id,disabled:H},e.id))})},s.id)),n.jsx(Kt,{id:D})]})})})}),n.jsx(gt,{columns:t==null?void 0:t.columns,tasks:t==null?void 0:t.tasks,activeId:k,sx:B})]});return n.jsxs(tt,{maxWidth:!1,sx:{...B,pb:0,pl:{sm:3},pr:{sm:0},flex:"1 1 0",display:"flex",overflow:"hidden",flexDirection:"column"},children:[n.jsxs(j,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{pr:{sm:3},mb:{xs:3,md:5}},children:[n.jsx(st,{variant:"h4",children:"Kanban"}),n.jsx(vt,{label:"Column fixed",labelPlacement:"start",control:n.jsx(nt,{checked:l,onChange:s=>{m(s.target.checked)},inputProps:{id:"column-fixed-switch"}})})]}),a?W:n.jsx(n.Fragment,{children:r?z:$})]})}const At={title:`Kanban | Dashboard - ${N.site.name}`};function ns(){return n.jsxs(n.Fragment,{children:[n.jsx(et,{children:n.jsxs("title",{children:[" ",At.title]})}),n.jsx(Lt,{})]})}export{ns as default};

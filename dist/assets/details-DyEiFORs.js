import{j as e,B as i,S as r,T as L,ez as H,du as B,ep as T,e as j,I as $,aF as A,aL as O,dB as W,r as p,w as P,dL as G,eA as M,eB as I,eb as z,p as v,G as b,dM as f,dK as g,dN as D,ef as Y,H as _,C as J}from"./index-Bm3rBIkL.js";import{u as V,E as X}from"./error-block-BO5MDXKX.js";import{u as U}from"./use-params-D5wlM2Nh.js";import"./chart-legends-xQs1SOOA.js";import{l as Z}from"./index-BxF87Dkb.js";import{u as w}from"./useMutation-BPy7H-1h.js";import{C as ee}from"./confirm-dialog-CdiBdWQ6.js";import{C as te}from"./custom-breadcrumbs-DgyWxDBR.js";import{b as m}from"./format-number-zZ3CkgDh.js";import{P as S}from"./permission-access-controller-Bd1g1bvY.js";import{T as se}from"./TextField-Zaq0_UQI.js";import{T as ie,t as ne,a as re,b as oe,c as ae,d as le,e as ce}from"./TimelineSeparator-DUUTQz3y.js";import{C as F}from"./CardHeader-jSMq8N2-.js";import{O as de}from"./order-product-table-SjCI86fJ.js";import{O as xe}from"./order-payment-details-dialog-YwSzaOrr.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./index-I76JgJ8L.js";import"./DialogContent-adXfkuCx.js";import"./DialogTitle-3zwXmVtf.js";import"./FormControl-Dpp_E6i1.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-XKr5fbZR.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-CW4sUJth.js";import"./Select-BbFY65UU.js";import"./Menu-BCmDYN65.js";import"./InputBase-CLwZiNSB.js";import"./FormHelperText-D4MtsGiu.js";import"./table-head-custom-fAI8azNC.js";import"./TableCell-DwZUj5h4.js";import"./Checkbox-DZc8qiZw.js";import"./incrementer-button-alnZ2NIc.js";import"./form-provider-BVzxbRNt.js";import"./Rating-DDX-0-qU.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-B_eq4lpY.js";import"./index-DJLOkwgj.js";import"./Slider-DEF2K-nH.js";import"./RadioGroup-CcFDuSjI.js";import"./FormGroup-C2nO5a7k.js";import"./FormControlLabel-3udn0dpo.js";import"./countries-DSLisFCy.js";import"./InputAdornment-C5fdA_pt.js";import"./Autocomplete-uJqWLfO9.js";import"./Chip-wb6jkBj9.js";import"./country-select-dI5VfxcM.js";import"./upload-avatar-CklA5cX-.js";import"./image-BvWqJKQA.js";import"./DatePicker-BFbM1AIt.js";import"./ListItem-B8LRzQux.js";import"./MobileDateTimePicker-BrtExEWs.js";import"./schema-helper-A2yd0njb.js";import"./LoadingButton-qKaJGA43.js";import"./CircularProgress-msI0ykgU.js";const pe=({order:o,payments:t,dialog:c,handleApproveOrder:n,handlePrint:h})=>{const a=e.jsxs(i,{sx:{pr:4,pl:4,pb:4,pt:2},children:[e.jsx(i,{sx:{mb:2},children:e.jsx(se,{size:"small",fullWidth:!0})}),e.jsx(r,{sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:e.jsx("div",{children:"Payments"})}),e.jsx(ie,{sx:{p:0,m:0,[`& .${ne.root}:before`]:{flex:0,padding:0}},children:t==null?void 0:t.map((d,l)=>{const x=l===0,u=l===t.length-1;return e.jsxs(re,{children:[e.jsxs(oe,{children:[e.jsx(ae,{color:x&&"primary"||"grey"}),u?null:e.jsx(le,{})]}),e.jsx(ce,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(i,{children:[e.jsx(L,{variant:"subtitle2",children:m(d.amount)}),e.jsx(i,{sx:{color:"text.disabled",typography:"caption",mt:.5},children:H(d.paymentDate)})]}),e.jsx(B,{color:"success",children:d.paymentType})]})})]},d.id)})}),e.jsxs(r,{justifyContent:"flex-end",spacing:1.5,sx:{marginTop:2},children:[e.jsx(S,{permission:T.ADD_PAYMENT,children:e.jsx(j,{variant:"contained",onClick:()=>c.onTrue(),children:"Add Payment"})}),(o==null?void 0:o.status)==="Draft"&&e.jsx(j,{variant:"outlined",onClick:()=>{n(o.id)},children:"Approve"}),e.jsx(S,{permission:T.PRINT_ORDER,children:e.jsxs(j,{variant:"outlined",color:"info",onClick:()=>h(),children:[e.jsx($,{icon:"solar:printer-minimalistic-bold"}),e.jsx("span",{style:{margin:4},children:"Print Invoice"})]})})]})]});return e.jsxs(A,{children:[e.jsx(F,{title:"Product Addons"}),a]})};function me({taxes:o,order:t,shipping:c,discount:n,subtotal:h,customer:a,totalAmount:d}){const l=e.jsxs(r,{spacing:2,alignItems:"flex-end",sx:{p:3,textAlign:"right",typography:"body2"},children:[e.jsxs(r,{direction:"row",children:[e.jsx(i,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(i,{sx:{width:160,typography:"subtitle2"},children:m(h)||"-"})]}),e.jsxs(r,{direction:"row",children:[e.jsx(i,{sx:{color:"text.secondary"},children:"Addon"}),e.jsx(i,{sx:{width:160,...c&&{color:"error.main"}},children:c?`- ${m(c)}`:"-"})]}),e.jsxs(r,{direction:"row",children:[e.jsx(i,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(i,{sx:{width:160,...n&&{color:"error.main"}},children:n?`- ${m(n)}`:"-"})]}),e.jsxs(r,{direction:"row",children:[e.jsx(i,{sx:{color:"text.secondary"},children:"Tax (0%)"}),e.jsx(i,{sx:{width:160},children:o?m(o):"-"})]}),e.jsxs(r,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:"Gross Total"}),e.jsx(i,{sx:{width:160},children:m(d)||"-"})]})]});return e.jsxs(A,{children:[e.jsx(r,{justifyContent:"center",alignItems:"center",children:e.jsxs("h1",{className:"print-title",children:["Order REF: #ORD-",t.id]})}),e.jsx("style",{jsx:!0,children:`
        .print-title {
          display: none; /* Hide on screen */
        }

        @media print {
          .print-title {
            display: block; /* Show only when printing */
          }
          .print-hide {
            display: none; /* Hide on screen */
          }
        }
      `}),e.jsx(F,{className:"print-hide",title:"Details"}),e.jsxs(r,{direction:"row",justifyContent:"space-between",sx:{p:3,typography:"body2"},children:[e.jsxs(i,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[e.jsx(r,{direction:"row",sx:{typography:"subtitle2",marginBottom:1},children:e.jsx("div",{children:"Order Details"})}),e.jsxs(i,{sx:{color:"text.secondary"},children:["ORDER ID: #ORD-",t.id]}),e.jsxs(i,{sx:{color:"text.secondary"},children:["Order Date: ",O(t.orderDate)]}),e.jsxs(i,{sx:{color:"text.secondary"},children:["Delivery Date: ",t.deliveryDate?O(t.deliveryDate):e.jsx("span",{children:" - "})]})]}),e.jsxs(i,{flexDirection:"column",gap:.5,sx:{display:"flex",width:"100%",p:1,borderRight:x=>`dashed 2px ${x.vars.palette.background.neutral}`,borderLeft:x=>`dashed 2px ${x.vars.palette.background.neutral}`},children:[e.jsx(r,{display:"flex",justifyContent:"center",alignItems:"center",sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:e.jsx("div",{children:"NFCAC"})}),e.jsxs(i,{sx:{color:"text.secondary"},children:["Status :"," ",e.jsx(B,{variant:"soft",color:(t==null?void 0:t.status)==="Ready"&&"info"||(t==null?void 0:t.status)==="InProcess"&&"warning"||(t==null?void 0:t.status)==="Delivered"&&"success"||"default",children:t==null?void 0:t.status})]}),e.jsxs(i,{sx:{color:"text.secondary"},children:["TAX: ",a==null?void 0:a.taxNumber]})]}),e.jsxs(i,{flexDirection:"column",alignItems:"center",sx:{p:1,display:"flex",width:"100%"},children:[e.jsx(r,{display:"flex",alignItems:"center",gap:1,sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:e.jsx("div",{children:"Invoice To"})}),e.jsx(i,{sx:{color:"text.secondary"},children:a==null?void 0:a.name}),e.jsxs(i,{sx:{color:"text.secondary"},children:["Tel: ",a==null?void 0:a.phoneNumber]})]})]}),e.jsx(W,{children:e.jsx(i,{fullWidth:!0,alignItems:"center",sx:{p:3,borderBottom:x=>`dashed 2px ${x.vars.palette.background.neutral}`},children:e.jsx(de,{products:t.productToOrder,isDetail:!0})})}),l,(t==null?void 0:t.notes)&&e.jsx(r,{justifyContent:"space-between",sx:{p:3,typography:"body2"},children:e.jsxs(i,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[e.jsx(r,{sx:{typography:"subtitle2",marginBottom:1},children:e.jsx("div",{children:"Notes:"})}),e.jsx(i,{sx:{color:"text.secondary"},children:t==null?void 0:t.notes})]})})]})}function he({currentOrder:o}){var C;const[t,c]=p.useState(o),[n,h]=p.useState(),a=p.useRef(),d=P(),l=G(),[x,u]=p.useState([]),y=P(),E=M();p.useEffect(()=>{c(o)},[o]),p.useEffect(()=>{const s=I(t==null?void 0:t.payments,"paymentDate");u(s)},[t==null?void 0:t.payments]);const{mutate:k}=w({mutationFn:s=>f.post(g.payments.create,s),onSuccess:async s=>{D.success("New Payment Has Been Created!");const{data:Q}=s,K=I([...x,Q],"paymentDate");u(K)},onSettled:async()=>{await l.invalidateQueries({queryKey:["payments"]});const{id:s}=t;await l.invalidateQueries({queryKey:["order",s]}),d.onFalse()},onError:s=>{console.log(s)}}),{mutate:R}=w({mutationFn:s=>f.get(g.order.approve+s),onSuccess:async({data:s})=>{s!=null&&s.length?(y.onTrue(),h(s)):(D.success("Order Has Been Approved!"),c(s))},onSettled:async()=>{const{id:s}=t;await l.invalidateQueries({queryKey:["orders"]}),await l.invalidateQueries({queryKey:["orders","analytics"]}),await l.invalidateQueries({queryKey:["order",s]})},onError:s=>{console.log(s)}}),{mutate:q}=w({mutationFn:s=>f.post(g.order.createPlans,s),onSuccess:async({data:s})=>{D.success("Order Has Been Approved!"),c(s),y.onFalse()},onSettled:async()=>{const{id:s}=t;await l.invalidateQueries({queryKey:["orders"]}),await l.invalidateQueries({queryKey:["orders","analytics"]}),await l.invalidateQueries({queryKey:["order",s]})},onError:s=>{console.log(s)}}),N=Z.useReactToPrint({content:()=>a.current});return e.jsxs(e.Fragment,{children:[e.jsxs(z,{children:[e.jsx(te,{links:[{name:"Dashboard",href:v.dashboard.root},{name:"Order",href:v.dashboard.order.root},{name:"Order Details"}],sx:{mb:{xs:3,md:5}}}),e.jsxs(b,{container:!0,spacing:3,children:[e.jsx(b,{xs:12,md:9,children:e.jsx(r,{ref:a,spacing:3,direction:{xs:"column-reverse",md:"column"},children:e.jsx(me,{order:t,customer:t==null?void 0:t.customer,taxes:(C=t==null?void 0:t.customer)==null?void 0:C.customer,shipping:t==null?void 0:t.shipping,discount:t==null?void 0:t.discount,subtotal:t==null?void 0:t.subtotal,totalAmount:t==null?void 0:t.totalOrderAmount})})}),e.jsx(b,{xs:12,md:3,children:e.jsx(pe,{order:t,payments:x,dialog:d,handleApproveOrder:R,handlePrint:N})})]}),e.jsx(xe,{order:t,open:d.value,onClose:d.onFalse,handler:k})]}),e.jsx(ee,{open:y.value,onClose:y.onFalse,title:"Out of Stock",content:e.jsxs(e.Fragment,{children:[e.jsx(i,{children:"Products are out of Stock! do you want to create plans?"}),e.jsxs(i,{sx:{mt:1,mb:1},children:["You need to create ",e.jsx("span",{style:{fontWeight:"bold"},children:n==null?void 0:n.length})," :"]}),n==null?void 0:n.map(s=>e.jsxs(i,{children:["Plan for ",e.jsx("span",{style:{fontWeight:"bold"},children:s.product.name})," because is missing"," ",e.jsx("span",{style:{fontWeight:"bold",color:`${E.vars.palette.error.light}`},children:s.missingQuantity}),"."]}))]}),action:e.jsx(j,{variant:"contained",color:"error",onClick:()=>{q(n)},children:(n==null?void 0:n.length)>1?"Create Plans":"Create Plan"})})]})}const ue={title:`Order details | Dashboard - ${J.site.name}`};function ft(){const{id:o=""}=U(),t=V({queryKey:["order",o],queryFn:async()=>{const{data:c}=await f.get(g.order.details+o);return c}});return t.isPending||t.isLoading?e.jsx(Y,{}):t.isError?e.jsx(X,{route:v.dashboard.order.root}):e.jsxs(e.Fragment,{children:[e.jsx(_,{children:e.jsxs("title",{children:[" ",ue.title]})}),e.jsx(he,{currentOrder:t.data})]})}export{ft as default};

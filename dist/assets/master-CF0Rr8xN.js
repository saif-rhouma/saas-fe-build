import{r as d,C as p,dI as Y,dJ as u,dH as h,dK as J,d7 as _,j as s,aD as T,S as y,T as g,B as S,bR as L,e as B,e8 as Z,p as N,ec as W,H as X}from"./index-yGbCRgTb.js";import{u as M,E as R}from"./error-block-DTJA4qog.js";import{C as A}from"./custom-breadcrumbs-BVoeLH7h.js";import{z as n,c as ee,u as re,t as se,a as te,F as i}from"./form-provider-DYU4Aza6.js";import{u as D}from"./useMutation-By1q-eS7.js";import{a as O}from"./format-number-CldpmeB4.js";import{b as ae,U as ne}from"./upload-avatar-C2G_2g_c.js";import"./editor-DVBR6pSL.js";import{s as ie}from"./schema-helper-vooul8SF.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./TextField-HI4be0gE.js";import"./FormControl-BZpoYGsF.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-DnqBfGRt.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-CZqAmIUK.js";import"./Select-q90WBvXR.js";import"./Menu-BP741PyP.js";import"./InputBase-DgymrakP.js";import"./FormHelperText-Dnev79N5.js";import"./Rating-3onsWGCC.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-CzzVUG04.js";import"./RadioGroup-81h_beeC.js";import"./FormGroup-ClqLJ3mg.js";import"./FormControlLabel-C9PyVvR2.js";import"./index-R0SYIoas.js";import"./countries-DSLisFCy.js";import"./InputAdornment-CcIxSkvC.js";import"./Autocomplete-C25PC4l8.js";import"./Chip-Di1iaus5.js";import"./country-select-CxHEhT0K.js";import"./Checkbox-CLReM-9f.js";import"./DatePicker-5fPzc3RP.js";import"./DialogContent-DMTZhSCC.js";import"./ListItem-CzWKnPSR.js";import"./MobileDateTimePicker-BclKweyT.js";import"./Tabs-CyyRymLB.js";import"./KeyboardArrowRight-gA8WWooR.js";import"./image-DcD9e3NU.js";import"./index-CCt0SICN.js";const me=n.object({name:n.string().min(1,{message:"Staff First Name is required!"}),description:n.string(),email:n.string().min(1,{message:"Email is required!"}).email({message:"Email must be a valid email address!"}),phoneNumber:ie.phoneNumber({isValidPhoneNumber:ee}),currencySymbol:n.string().min(1,{message:"Staff Last Name is required!"}),taxPercentage:n.number().min(1,{message:"Staff Last Name is required!"}),country:n.string().min(1,{message:"Country is required!"}),state:n.string(),street:n.string(),city:n.string(),district:n.string(),zipCode:n.string(),taxNumber:n.number(),printerPOS:n.string().min(1,{message:"Printer POS is required!"})}),oe=({applicationAccount:r,financial:f})=>{const m=d.useRef(r),[b,q]=d.useState(null),[j,E]=d.useState(null);d.useEffect(()=>{r&&(k(P),q(`${p.site.serverFileHost}${r.favicon}`),E(`${p.site.serverFileHost}${r.appLogo}`))},[r]);const P=d.useMemo(()=>{var e,t,a,o,l,x;return{name:(r==null?void 0:r.name)||"",description:(r==null?void 0:r.description)||"",email:(r==null?void 0:r.email)||"",phoneNumber:(r==null?void 0:r.phoneNumber)||"",currencySymbol:(r==null?void 0:r.currencySymbol)||"",taxPercentage:(r==null?void 0:r.taxPercentage)||"",country:((e=r==null?void 0:r.address)==null?void 0:e.country)||"",state:((t=r==null?void 0:r.address)==null?void 0:t.state)||"",city:((a=r==null?void 0:r.address)==null?void 0:a.city)||"",district:((o=r==null?void 0:r.address)==null?void 0:o.district)||"",zipCode:((l=r==null?void 0:r.address)==null?void 0:l.zipCode)||"",street:((x=r==null?void 0:r.address)==null?void 0:x.street)||"",taxNumber:(r==null?void 0:r.taxNumber)||0,printerPOS:(r==null?void 0:r.printerPOS)||""}},[r]),c=re({resolver:se(me),defaultValues:P}),{reset:k,watch:xe,setValue:ge,handleSubmit:$,control:ue,formState:{isSubmitting:he}}=c,G=$(async e=>{try{if(e.city||e.country||e.district||e.state||e.street||e.zipCode){const{country:t,state:a,city:o,district:l,zipCode:x,street:w}=e;e.address={country:t,state:a,city:o,district:l,zipCode:x,street:w},delete e.city,delete e.country,delete e.district,delete e.state,delete e.street,delete e.zipCode}if(m.current={...e},b&&j){const t=new FormData;t.append("file",b),t.append("category","AppAvatar");const a=new FormData;a.append("file",j),a.append("category","AppLogo"),await V({avatar:t,logo:a})}else if(b){const t=new FormData;t.append("file",b),t.append("category","AppAvatar"),await I(t)}else if(j){const t=new FormData;t.append("file",j),t.append("category","AppLogo"),await Q(t)}else await C(e)}catch(t){console.error(t)}}),H=d.useCallback(e=>{const t=e[0];q(t)},[]),U=d.useCallback(e=>{const t=e[0];E(()=>t)},[]),K=()=>{E(null)},v={headers:{"content-type":"multipart/form-data"}},z=d.useCallback(e=>{const t=document.querySelector("link[rel~='icon']")||document.createElement("link");t.type="image/x-icon",t.rel="icon",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)},[]),F=Y(),{mutate:I}=D({mutationFn:e=>u.post(h.files.upload,e,v),onSuccess:async({data:e})=>{const{name:t}=e;if(t){const{current:a}=m;a.favicon=t,z(`${p.site.serverFileHost}${t}`),await C(a)}return e},onSettled:async()=>{await F.invalidateQueries({queryKey:["appAvatar-images"]})},onError:e=>{console.log(e)}}),{mutate:Q}=D({mutationFn:e=>u.post(h.files.upload,e,v),onSuccess:async({data:e})=>{const{name:t}=e;if(t){const{current:a}=m;a.appLogo=t,await C(a)}return e},onSettled:async()=>{await F.invalidateQueries({queryKey:["appAvatar-images"]})},onError:e=>{console.log(e)}}),{mutate:V}=D({mutationFn:async({avatar:e,logo:t})=>{const a=await u.post(h.files.upload,e,v),o=await u.post(h.files.upload,t,v);return{avatarRes:a,logoRes:o}},onSuccess:async({avatarRes:e,logoRes:t})=>{var x,w;const a=(x=e==null?void 0:e.data)==null?void 0:x.name,o=(w=t==null?void 0:t.data)==null?void 0:w.name,{current:l}=m;o&&(l.appLogo=o),a&&(l.favicon=a),z(`${p.site.serverFileHost}${a}`),await C(l)},onSettled:async()=>{await F.invalidateQueries({queryKey:["appAvatar-images"]})},onError:e=>{console.log(e)}}),{mutate:C}=D({mutationFn:e=>u.patch(h.master.edit,e),onSuccess:async()=>{J.success("Master Account Has Been Modified!");const{currencySymbol:e}=m.current;localStorage.setItem(_,e)},onSettled:async()=>{await F.invalidateQueries({queryKey:["account-application"]})},onError:e=>{console.log(e)}});return s.jsxs(te,{methods:c,onSubmit:G,children:[s.jsx(T,{sx:{mb:4},children:s.jsxs(y,{spacing:2,sx:{p:3},children:[s.jsx(g,{variant:"h6",gutterBottom:!0,children:"Organization Details"}),s.jsxs(S,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[s.jsx(i.Text,{name:"name",label:"Organization Name"}),s.jsx(i.Phone,{name:"phoneNumber",label:"Phone number"}),s.jsx(i.Text,{name:"email",label:"Email address"}),s.jsx(i.Text,{name:"description",label:"Description"}),s.jsxs(y,{spacing:1.5,children:[s.jsx(g,{variant:"subtitle2",children:"Attachments"}),s.jsx(ae,{value:j,onDrop:U,onDelete:K})]}),s.jsxs(y,{spacing:1.5,children:[s.jsx(g,{variant:"subtitle2",children:"Favicon"}),s.jsx(ne,{value:b,onDrop:H,validator:e=>e.size>1e6?{code:"file-too-large",message:`File is larger than ${O(1e6)}`}:null,helperText:s.jsxs(g,{variant:"caption",sx:{mt:3,mx:"auto",display:"block",textAlign:"center",color:"text.disabled"},children:["Allowed *.jpeg, *.jpg, *.png, *.gif",s.jsx("br",{})," max size of ",O(3145728)]})})]})]})]})}),s.jsx(T,{sx:{mb:4},children:s.jsxs(y,{spacing:2,sx:{p:3},children:[s.jsx(g,{variant:"h6",gutterBottom:!0,children:"Finance Setting"}),s.jsxs(S,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[s.jsx(i.Text,{name:"currencySymbol",label:"Currency Symbol"}),s.jsx(i.Text,{name:"taxPercentage",label:"Tax Percentage"})]})]})}),s.jsx(T,{sx:{mb:4},children:s.jsxs(y,{spacing:2,sx:{p:3},children:[s.jsx(g,{variant:"h6",gutterBottom:!0,children:"Firm Address"}),s.jsxs(S,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[s.jsx(i.CountrySelect,{name:"country",label:"Country",placeholder:"Choose a country"}),s.jsx(i.Text,{name:"state",label:"State/region"}),s.jsx(i.Text,{name:"city",label:"City"}),s.jsx(i.Text,{name:"district",label:"District"}),s.jsx(i.Text,{name:"zipCode",label:"Zip/code"}),s.jsx(i.Text,{name:"street",label:"Address"}),s.jsx(i.Text,{type:"number",name:"taxNumber",label:"Store Tax Number"})]})]})}),s.jsx(T,{sx:{mb:4},children:s.jsxs(y,{spacing:2,sx:{p:3},children:[s.jsx(g,{variant:"h6",gutterBottom:!0,children:"Other Settings"}),s.jsx(S,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:s.jsxs(i.Select,{name:"printerPOS",label:"Printer POS",sx:{width:420,textTransform:"capitalize"},children:[s.jsx(L,{value:"A4",children:"A4"}),s.jsx(L,{value:"Thermal",children:"Thermal"})]})})]})}),s.jsxs(S,{display:"flex",justifyContent:"flex-end",gap:2,mt:2,children:[s.jsx(B,{type:"submit",variant:"contained",children:"Save Changes"}),s.jsx(B,{variant:"outlined",children:"Cancel"})]})]})},le=({applicationAccount:r,financial:f})=>s.jsxs(Z,{children:[s.jsx(A,{links:[{name:"Dashboard",href:N.dashboard.root},{name:"Settings",href:N.dashboard.tools.root},{name:"Master Settings"}],sx:{mb:{xs:3,md:5}}}),s.jsx(oe,{applicationAccount:r,financial:f})]}),de={title:`Tools | Dashboard - ${p.site.name}`};function ar(){const r=M({queryKey:["account-application"],queryFn:async()=>{const{data:m}=await u.get(h.auth.application);return m}}),f=M({queryKey:["financial-year"],queryFn:async()=>{const{data:m}=await u.get(h.financial.list);return m}});return f.isLoading||r.isLoading?s.jsx(W,{}):r.isError?s.jsx(R,{route:N.dashboard.tools.root}):s.jsxs(s.Fragment,{children:[s.jsx(X,{children:s.jsxs("title",{children:[" ",de.title]})}),s.jsx(le,{applicationAccount:r.data,financial:f.data})]})}export{ar as default};

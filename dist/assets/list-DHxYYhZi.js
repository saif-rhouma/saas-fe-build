import{Y as J,br as Y,a3 as Se,j as e,L as De,S as g,A as je,I as x,B as l,a8 as be,d1 as re,Q as Qe,bq as D,C as Ce,e8 as ge,d8 as ye,e9 as h,$ as w,cR as Ie,b6 as $e,dc as Ae,a6 as Ee,e4 as I,a7 as E,e as K,r as m,dq as R,dn as V,dp as Te,dr as G,ea as Re,a5 as _,eb as Ve,W as we,p as Q,cZ as ve,v as ee,dU as le,ec as Oe,df as Le,e3 as Be,dQ as Fe,cW as se,R as He,de as Ne,ed as Me,H as _e}from"./index-BrVky5Gg.js";import{u as ie,E as oe}from"./error-block-FcQeBxj7.js";import{u as z}from"./useMutation-CE0P_ta-.js";import{C as Ke}from"./custom-breadcrumbs-BF1juKa-.js";import{P as $}from"./permission-access-controller-mr8Vt4iB.js";import{g as Ue,r as We,e as Ge}from"./utils-MBUcMVfY.js";import{u as ze}from"./use-table-DPRJgMt8.js";import{T as Je}from"./table-no-data-ofQRfbzC.js";import{T as Ye}from"./table-empty-rows-B-BeiqOV.js";import{T as fe,a as Ze,b as Xe,c as qe}from"./table-head-custom-CKQJMo0x.js";import{T as es}from"./table-selected-action-BfNIYfsW.js";import{T as ss}from"./table-pagination-custom-DhUmgRwP.js";import{b as U}from"./format-number-BYcftzxu.js";import{C as ts}from"./confirm-dialog-c4Hh23mN.js";import{T as S}from"./TableCell-VebxIpQE.js";import{A as as}from"./AvatarGroup-BskNT-rd.js";import{l as ns}from"./index-BlcMAjKx.js";import{u as rs}from"./use-tabs-DImOCbVe.js";import{P as ls,Q as is,a as os}from"./print-quotation-details-template-DfwAZpGK.js";import{Q as ds}from"./quotation-product-table-CAjoVN6W.js";import{T as cs}from"./tickets-create-dialog-D8RfKpwu.js";import{R as xs}from"./reminder-create-dialog-JaobCYjo.js";import{C as ms}from"./CircularProgress-BTXCWzN0.js";import{T as hs,a as us}from"./Tabs-BKfmXuvi.js";import{C as ps}from"./CardHeader-DEDB19_Z.js";import{T as js}from"./TextField-BzhmS018.js";import{I as bs}from"./InputAdornment-DEzDbK1Q.js";import{S as fs}from"./Select-6IXk9lW0.js";import{F as Cs,a as te,c as ae}from"./filters-result-BvtajXRg.js";import{C as ne}from"./Chip-DP4Tp82d.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-TcyibYvM.js";import"./Checkbox-CQHPQqdR.js";import"./TablePagination-B0Hol92q.js";import"./KeyboardArrowRight-Bg2_dmW-.js";import"./LastPage-CTqN6DYn.js";import"./InputBase-C8xLxBIT.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-0HOCsOrO.js";import"./DialogContent-Bneue424.js";import"./DialogTitle-5kRkAohy.js";import"./form-provider-IGnvse7Q.js";import"./FormHelperText-DFhB8bFU.js";import"./Rating-Hlni2mlB.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-DG5O80Yq.js";import"./Menu-DD-zT_J0.js";import"./index-rYiI9UdX.js";import"./Slider-MS8qHiiX.js";import"./FormControl-DZf5wqQ9.js";import"./FormLabel-ChyBHZVN.js";import"./RadioGroup-D0Qu_fwA.js";import"./FormGroup-DxT7LmQ0.js";import"./utils-lkMXEcUg.js";import"./index-Yn_vEU-0.js";import"./countries-DSLisFCy.js";import"./Autocomplete-CdBrZWYz.js";import"./country-select-BuZykQim.js";import"./InputLabel-Dec_12dS.js";import"./upload-avatar-DQ7Fanyq.js";import"./image-C-59YYlQ.js";import"./DatePicker-B1JNPBiT.js";import"./ListItem-CVfDDPgr.js";import"./MobileDateTimePicker-DDuapApM.js";import"./upload-box-ad-BtwdQlbF.js";import"./LoadingButton-a60uG7nr.js";import"./schema-helper-DBRyPFKX.js";function gs({row:t,index:n,selected:d,onViewRow:r,onClickRow:s,onEditRow:j,onDeleteRow:b,isFullDisplay:u}){var P,y,F;const p=J(),{t:i}=Y("quotations"),f=J(),C=Se(),v=e.jsxs(fe,{hover:!0,selected:d,children:[e.jsx(S,{onClick:s,children:e.jsx(De,{color:"inherit",onClick:r,underline:"always",sx:{cursor:"pointer"},children:(t==null?void 0:t.ref)||n||(t==null?void 0:t.id)})}),e.jsx(S,{onClick:s,children:e.jsxs(g,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(je,{sx:{bgcolor:"#00AB55"},alt:t.name,src:t.customer.avatar,children:e.jsx(x,{color:"white",icon:"fluent:person-20-filled",width:24})}),e.jsxs(g,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsx(l,{component:"span",children:t.name}),e.jsx(l,{component:"span",sx:{color:"text.disabled"},children:t.customer.name})]})]})}),e.jsx(S,{onClick:s,children:e.jsx(be,{primary:re(t.quotationDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(S,{align:"center",onClick:s,children:e.jsx(as,{sx:{[`& .${Qe.avatar}`]:{width:24,height:24}},children:(P=t==null?void 0:t.productToQuotation)==null?void 0:P.map(c=>{var k,O,L,A;return e.jsx(D,{title:`${(k=c==null?void 0:c.product)==null?void 0:k.name} | Quantity : ${c.quantity}`,children:e.jsx(je,{alt:(O=c==null?void 0:c.product)==null?void 0:O.name,src:`${Ce.site.serverFileHost}${(L=c==null?void 0:c.product)==null?void 0:L.image}`},c==null?void 0:c.id)},(A=c==null?void 0:c.product)==null?void 0:A.id)})})}),e.jsxs(S,{onClick:s,children:[U(ge((t==null?void 0:t.totalAmount)-(t==null?void 0:t.totalAmount)*((t==null?void 0:t.discount)/100),t==null?void 0:t.snapshotTaxPercentage))||"-"," "]}),!u&&e.jsxs(S,{onClick:s,children:[(y=t.createdBy)==null?void 0:y.firstName," ",(F=t.createdBy)==null?void 0:F.lastName]}),!u&&e.jsx(S,{onClick:s,children:e.jsxs(ye,{variant:"soft",color:t.status===h.Confirmed&&"info"||t.status===h.Converted&&"success"||t.status===h.Canceled&&"error"||"default",children:[t.status===h.Created&&`${i("listView.table.tableToolbar.selectMenu.created")}`,t.status===h.Confirmed&&`${i("listView.table.tableToolbar.selectMenu.confirmed")}`,t.status===h.Converted&&`${i("listView.table.tableToolbar.selectMenu.converted")}`,t.status===h.Canceled&&`${i("listView.table.tableToolbar.selectMenu.canceled")}`]})}),!u&&e.jsxs(S,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(w,{color:f.value?"inherit":"default",onClick:f.onToggle,sx:{...f.value&&{bgcolor:"action.hover"}},children:e.jsx(x,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(w,{color:C.open?"inherit":"default",onClick:C.onOpen,children:e.jsx(x,{icon:"eva:more-vertical-fill"})})]})]}),T=e.jsx(fe,{children:e.jsx(S,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(Ie,{in:f.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx($e,{sx:{m:1.5},children:t.productToQuotation.map(c=>e.jsxs(g,{direction:"row",alignItems:"center",sx:{p:k=>k.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:k=>`solid 2px ${k.vars.palette.background.neutral}`}},children:[e.jsx(be,{primary:c.product.name,secondary:c.sku,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs("div",{children:[c.quantity," "]}),e.jsx(l,{sx:{width:110,textAlign:"right"},children:U(c.snapshotProductPrice)})]},c.id))})})})});return e.jsxs(e.Fragment,{children:[v,T,e.jsx(Ae,{open:C.open,anchorEl:C.anchorEl,onClose:C.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Ee,{children:[e.jsx($,{permission:I.VIEW_QUOTATION,children:e.jsxs(E,{onClick:()=>{r(),C.onClose()},children:[e.jsx(x,{icon:"solar:eye-bold"}),`${i("listView.table.tableActions.view")}`]})}),(t==null?void 0:t.status)===h.Created&&e.jsx($,{permission:I.EDIT_QUOTATION,children:e.jsxs(E,{onClick:()=>{j(),C.onClose()},children:[e.jsx(x,{icon:"solar:pen-bold"}),`${i("listView.table.tableActions.edit")}`]})}),t.status!==h.Canceled&&t.status!==h.Converted&&e.jsx($,{permission:I.DELETE_QUOTATION,children:e.jsxs(E,{onClick:()=>{p.onTrue(),C.onClose()},sx:{color:"warning.main"},children:[e.jsx(x,{icon:"solar:trash-bin-trash-bold"}),`${i("listView.table.tableActions.cancel")}`]})})]})}),e.jsx(ts,{open:p.value,onClose:p.onFalse,title:i("listView.messages.dialogCancel.title"),content:i("listView.messages.dialogCancel.text"),action:e.jsx(K,{variant:"contained",color:"warning",onClick:()=>{b(),p.onFalse()},children:i("listView.messages.dialogCancel.confirmButton")})})]})}const ys=({selectedQuotation:t,handleResize:n,handleClose:d})=>{var ce,xe,me,he,ue,pe;const{t:r}=Y("quotations"),[s,j]=m.useState(t),b=ie({queryKey:["quotation",s.id],queryFn:async()=>{const{data:a}=await R.get(V.quotation.details+s.id);return j(a),a}}),u=[{value:"details",icon:e.jsx(x,{icon:"solar:eye-bold",width:24}),label:`${r("detailsCard.quotationDetailsTab")}`},{value:"tickets",icon:e.jsx(x,{icon:"solar:case-minimalistic-bold",width:24}),label:`${r("detailsCard.ticketsTab")}`},{value:"reminders",icon:e.jsx(x,{icon:"solar:calendar-bold",width:24}),label:`${r("detailsCard.remindersTab")}`}];m.useEffect(()=>{t.id!==s.id&&j(t)},[s.id,t]);const p=Te(),{mutate:i}=z({mutationFn:a=>R.post(V.quotation.createOrder,a),onSuccess:async({data:a})=>{G.success("Order Has Been Created!");const{id:N}=s;await p.invalidateQueries({queryKey:["quotations"]}),await p.invalidateQueries({queryKey:["quotation",N]})},onError:a=>{console.log(a)}}),{mutate:f}=z({mutationFn:a=>R.post(V.quotation.share,a),onSuccess:async({data:a})=>{G.success("Quotation has been sended to the customer.")},onError:a=>{console.log(a)}}),{mutate:C}=z({mutationFn:a=>R.patch(V.quotation.editStatus+a,{status:h.Confirmed}),onSuccess:async({data:a})=>{G.success("Quotation Has Been Confirmed!");const{id:N}=s;await p.invalidateQueries({queryKey:["quotations"]}),await p.invalidateQueries({queryKey:["quotation",N]})},onError:a=>{console.log(a)}}),v=rs("details"),[T,P]=m.useState(!1),y=()=>{P(!0)},{data:F,isLoading:c,error:k}=ie({queryKey:["download-quotation",s.id],queryFn:async()=>{const a=await R.get(V.quotation.downloadPdf+s.id,{responseType:"blob"}),N=window.URL.createObjectURL(new Blob([a.data])),M=document.createElement("a");return M.href=N,M.setAttribute("download",`Quotation-${s.ref}.pdf`),document.body.appendChild(M),M.click(),document.body.removeChild(M),P(!1),a.data},enabled:T,onSuccess:()=>{P(!1)},onError:a=>{console.error("Download failed:",a)}}),O=e.jsx(D,{title:r("detailsCard.tooltips.downloadTooltip"),children:e.jsx(w,{onClick:y,children:c?e.jsx(ms,{size:24,color:"inherit"}):e.jsx(x,{icon:"eva:cloud-download-fill",color:"error.main"})})}),L=e.jsxs(g,{alignItems:"flex-end",sx:{p:1,textAlign:"right",typography:"body2"},children:[e.jsxs(g,{direction:"row",children:[e.jsx(l,{sx:{color:"text.secondary"},children:r("detailsCard.subtotal")}),e.jsx(l,{sx:{width:160,typography:"subtitle2"},children:U(s==null?void 0:s.totalAmount)||"-"})]}),e.jsxs(g,{direction:"row",children:[e.jsx(l,{sx:{color:"text.secondary"},children:r("detailsCard.discount")}),e.jsx(l,{sx:{width:160,...(s==null?void 0:s.discount)&&{color:"error.main"}},children:s!=null&&s.discount?`- ${s==null?void 0:s.discount}%`:"-"})]}),e.jsxs(g,{direction:"row",children:[e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.tax")," (",(s==null?void 0:s.snapshotTaxPercentage)||"0","%)"]}),e.jsx(l,{sx:{width:160},children:s!=null&&s.snapshotTaxPercentage?U(Re((s==null?void 0:s.totalAmount)-(s==null?void 0:s.totalAmount)*((s==null?void 0:s.discount)/100),s==null?void 0:s.snapshotTaxPercentage)):"-"})]}),e.jsxs(g,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx("div",{children:r("detailsCard.total")}),e.jsx(l,{sx:{width:160},children:U(ge((s==null?void 0:s.totalAmount)-(s==null?void 0:s.totalAmount)*((s==null?void 0:s.discount)/100),s==null?void 0:s.snapshotTaxPercentage))||"-"})]})]}),A=J(),H=J(),Z=e.jsxs(g,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsxs(l,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",m:1},children:[e.jsxs(l,{flexDirection:"column",sx:{display:"flex"},children:[e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.quotationRef")," #",s==null?void 0:s.ref]}),e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.quotationDate")," ",re(s==null?void 0:s.quotationDate)]}),e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.quotationExpiry")," ",re(s==null?void 0:s.expiredDate)]})]}),e.jsx(l,{sx:{mr:2},children:e.jsxs(l,{sx:{color:"text.secondary"},children:[r("detailsCard.status"),e.jsxs(ye,{variant:"soft",color:(s==null?void 0:s.status)===h.Confirmed&&"info"||(s==null?void 0:s.status)===h.Converted&&"success"||(s==null?void 0:s.status)===h.Canceled&&"error"||"default",children:[(s==null?void 0:s.status)===h.Created&&`${r("listView.table.tableToolbar.selectMenu.created")}`,(s==null?void 0:s.status)===h.Confirmed&&`${r("listView.table.tableToolbar.selectMenu.confirmed")}`,(s==null?void 0:s.status)===h.Converted&&`${r("listView.table.tableToolbar.selectMenu.converted")}`,(s==null?void 0:s.status)===h.Canceled&&`${r("listView.table.tableToolbar.selectMenu.canceled")}`]})]})}),((ce=s==null?void 0:s.order)==null?void 0:ce.id)&&e.jsx(l,{sx:{color:"text.secondary"},className:"print-hide",children:e.jsxs(K,{variant:"contained",size:"small",startIcon:e.jsx(x,{icon:"heroicons-outline:external-link"}),onClick:()=>{const{id:a}=s==null?void 0:s.order;a&&B(a)},children:[r("detailsCard.relatedToQuotation")," #",(xe=s==null?void 0:s.order)==null?void 0:xe.ref]})})]}),e.jsxs(l,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsx(ds,{products:s==null?void 0:s.productToQuotation,defaultRowsPerPage:s!=null&&s.notes?5:10}),e.jsx(_,{sx:{mt:1}})]}),L,(s==null?void 0:s.notes)&&e.jsxs(l,{children:[e.jsx(_,{}),e.jsx(g,{sx:{typography:"body2"},children:e.jsx(l,{sx:{p:1},children:e.jsxs(g,{sx:{typography:"subtitle2"},children:[e.jsxs("div",{children:[r("detailsCard.notes"),":"]}),e.jsx(l,{sx:{color:"text.secondary"},children:s==null?void 0:s.notes})]})})})]})]}),X=a=>a.isPending||a.isLoading?e.jsx(le,{}):a.isError?e.jsx(oe,{}):e.jsxs(g,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsx(l,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(l,{children:e.jsx($,{permission:I.ADD_TICKET,children:e.jsx(K,{onClick:()=>A.onToggle(),variant:"contained",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),children:r("detailsCard.newTicket")})})})}),e.jsx(_,{}),e.jsx(l,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(is,{tickets:b.data.tickets})})]}),q=a=>a.isPending||a.isLoading?e.jsx(le,{}):a.isError?e.jsx(oe,{}):e.jsxs(g,{sx:{display:"flex",flex:1,pb:3,pr:3,pl:3,typography:"body2"},children:[e.jsx(l,{sx:{display:"flex",width:"100%",alignItems:"center",m:2},children:e.jsx(l,{children:e.jsx($,{permission:I.ADD_REMINDER,children:e.jsx(K,{onClick:()=>H.onToggle(),variant:"contained",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),children:r("detailsCard.newReminder")})})})}),e.jsx(_,{}),e.jsx(l,{sx:{flex:1,mt:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsx(os,{reminders:b.data.reminders})})]}),W=Ve(),o=we(),B=m.useCallback(a=>{o.push(Q.dashboard.order.details(a))},[o]),Pe=m.useCallback(a=>{o.push(Q.dashboard.quotation.details(a))},[o]),ke=m.useCallback(a=>{o.push(Q.dashboard.quotation.edit(a))},[o]),de=m.useRef();return ns.useReactToPrint({content:()=>de.current}),e.jsxs(e.Fragment,{children:[e.jsxs(ve,{ref:de,sx:{height:1,display:"flex",flexDirection:"column",width:1,transition:"all 2s ease-in-out"},children:[e.jsx("style",{jsx:!0,children:`
          .print-title {
            display: none; /* Hide on screen */
          }

          @media print {
            html,
            body {
              height: initial !important;
              overflow: initial !important;
            }
            .print-title {
              display: block; /* Show only when printing */
            }
            .print-hide {
              display: none; /* Hide on screen */
            }
            .print-padding {
              padding: 5px;
            }
            .print-top-margin {
              margin-top: 40px;
            }
          }
        `}),e.jsxs(hs,{className:"print-hide ",value:v.value,onChange:v.onChange,sx:{px:3,boxShadow:a=>`inset 0 -2px 0 0 ${ee(a.vars.palette.grey["500Channel"],.08)}`},children:[u.map(a=>e.jsx(us,{icon:a.icon,value:a.value,label:a.label},a.value)),e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${ee(W.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(w,{sx:{ml:1},onClick:n,children:e.jsx(x,{icon:"solar:full-screen-bold",width:24})})}),e.jsx(l,{marginLeft:"auto",sx:{display:"flex",justifyContent:"center",alignItems:"center",borderLeft:`solid 1px ${ee(W.vars.palette.grey["500Channel"],.16)}`},children:e.jsx(w,{sx:{ml:1},onClick:d,children:e.jsx(x,{icon:"solar:close-square-outline",width:24})})})]}),e.jsxs(l,{className:"print-top-margin print-padding",sx:{display:"flex",flexDirection:"column",position:"relative",flex:1},children:[e.jsx(ps,{sx:{pt:1},title:s==null?void 0:s.name,subheader:`Quotation for Customer : ${(me=s==null?void 0:s.customer)==null?void 0:me.name}`,action:e.jsx(g,{spacing:3,className:"print-hide",direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"},sx:{mb:{xs:3,md:5}},children:e.jsxs(g,{direction:"row",spacing:1,flexGrow:1,sx:{width:1},children:[e.jsx(D,{title:"View",children:e.jsx(w,{onClick:()=>{Pe(s==null?void 0:s.id)},children:e.jsx(x,{icon:"solar:eye-bold",color:"primary.main"})})}),(s==null?void 0:s.status)===h.Created&&e.jsx(D,{title:"Edit",children:e.jsx(w,{onClick:()=>{ke(s==null?void 0:s.id)},children:e.jsx(x,{icon:"solar:pen-bold",color:"warning.main"})})}),(s==null?void 0:s.status)===h.Created&&e.jsx(D,{title:"Confirm",children:e.jsx(w,{onClick:()=>{C(s==null?void 0:s.id)},children:e.jsx(x,{icon:"line-md:confirm-circle-filled"})})}),e.jsx($,{permission:I.CONVERT_QUOTATION_TO_ORDER,children:!((he=s==null?void 0:s.order)!=null&&he.id)&&((s==null?void 0:s.status)===h.Created||(s==null?void 0:s.status)===h.Confirmed)&&e.jsx(D,{title:"Convert to Order",children:e.jsx(w,{onClick:()=>{i({quotationId:s==null?void 0:s.id})},children:e.jsx(x,{icon:"solar:restart-circle-bold"})})})}),((ue=s==null?void 0:s.order)==null?void 0:ue.id)&&e.jsx(D,{title:`Related to Order: #${(pe=s==null?void 0:s.order)==null?void 0:pe.ref}`,children:e.jsx(w,{onClick:()=>{var a;B((a=s==null?void 0:s.order)==null?void 0:a.id)},children:e.jsx(x,{icon:"heroicons-outline:external-link"})})}),O,e.jsx($,{permission:I.PRINT_QUOTATION,children:e.jsx(D,{title:"Print",children:e.jsx(ls,{quotation:s})})}),e.jsx(D,{title:"Send To the Customer",children:e.jsx(w,{onClick:()=>{f({id:s.id})},children:e.jsx(x,{icon:"iconamoon:send-fill",color:"info.main"})})})]})})}),e.jsx(_,{}),v.value==="details"&&Z,v.value==="tickets"&&X(b),v.value==="reminders"&&q(b)]})]}),e.jsx(cs,{open:A.value,onClose:A.onFalse,quotation:s}),e.jsx(xs,{open:H.value,onClose:H.onFalse,quotation:s})]})};function Ts({filters:t,onResetPage:n}){const[d,r]=m.useState("all"),{t:s}=Y("quotations"),j=m.useCallback(u=>{n(),t.setState({name:u.target.value})},[t,n]),b=m.useCallback(u=>{n(),t.setState({status:u.target.value}),r(u.target.value)},[t,n]);return e.jsxs(g,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(js,{sx:{width:420},value:t.state.name,onChange:j,placeholder:`${s("listView.table.tableToolbar.searchPlaceholder")}`,InputProps:{startAdornment:e.jsx(bs,{position:"start",children:e.jsx(x,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(fs,{sx:{width:420,textTransform:"capitalize"},value:d,onChange:b,children:[e.jsx(E,{value:"all",children:`${s("listView.table.tableToolbar.selectMenu.allQuotations")}`}),e.jsx(E,{value:"Created",children:`${s("listView.table.tableToolbar.selectMenu.created")}`}),e.jsx(E,{value:"Confirmed",children:`${s("listView.table.tableToolbar.selectMenu.confirmed")}`}),e.jsx(E,{value:"Canceled",children:`${s("listView.table.tableToolbar.selectMenu.canceled")}`}),e.jsx(E,{value:"Converted",children:`${s("listView.table.tableToolbar.selectMenu.converted")}`})]})]})}function ws({filters:t,totalResults:n,onResetPage:d,sx:r}){const s=m.useCallback(()=>{d(),t.setState({name:""})},[t,d]),j=m.useCallback(()=>{d(),t.setState({status:"all"})},[t,d]),b=m.useCallback(()=>{d(),t.setState({startDate:null,endDate:null})},[t,d]),u=m.useCallback(()=>{d(),t.onResetState()},[t,d]);return e.jsxs(Cs,{totalResults:n,onReset:u,sx:r,children:[e.jsx(te,{label:"Status:",isShow:t.state.status!=="all",children:e.jsx(ne,{...ae,label:t.state.status,onDelete:j,sx:{textTransform:"capitalize"}})}),e.jsx(te,{label:"Date:",isShow:!!(t.state.startDate&&t.state.endDate),children:e.jsx(ne,{...ae,label:Oe(t.state.startDate,t.state.endDate),onDelete:b})}),e.jsx(te,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(ne,{...ae,label:t.state.name,onDelete:s})})]})}function vs({quotations:t}){const n=ze({defaultOrderBy:"orderId",defaultRowsPerPage:5}),{t:d}=Y("quotations"),[r,s]=m.useState(),[j,b]=m.useState(!1),u=[{id:"ref",label:"#",width:88},{id:"details",label:`${d("listView.table.tableHeader.details")}`},{id:"createdAt",label:`${d("listView.table.tableHeader.date")}`,width:140},{id:"totalQuantity",label:`${d("listView.table.tableHeader.items")}`,width:120,align:"center"},{id:"totalAmount",label:`${d("listView.table.tableHeader.price")}`,width:140},{id:"createdBy",label:`${d("listView.table.tableHeader.createdBy")}`,width:200},{id:"status",label:`${d("listView.table.tableHeader.status")}`,width:110},{id:"",width:88}],[p,i]=m.useState(u),f=we(),[C,v]=m.useState(()=>t),T=Le({name:"",status:"all",startDate:null,endDate:null});m.useEffect(()=>{if(b(!1),v(t),r){const o=t.find(B=>B.id===r.id);s(o)}},[t]),m.useEffect(()=>{const o=r?u.filter(B=>!["createdBy","status",""].includes(B.id)):u;i(o)},[r]);const P=Be(T.state.startDate,T.state.endDate),y=Ps({inputData:C,comparator:Ue(n.order,n.orderBy),filters:T.state,dateError:P}),F=We(y,n.page,n.rowsPerPage),c=!!T.state.name||T.state.status!=="all"||!!T.state.startDate&&!!T.state.endDate,k=!y.length&&c||!y.length,O=Te(),{mutate:L}=z({mutationFn:o=>R.delete(V.quotation.delete+o),onSuccess:async()=>{G.success("Order Has Been Canceled!")},onSettled:async()=>{await O.invalidateQueries({queryKey:["quotations"]})},onError:()=>{}}),A=m.useCallback(o=>{L(o)},[F.length,n,C]),H=m.useCallback(o=>{f.replace(Q.dashboard.quotation.details(o))},[f]),Z=m.useCallback(o=>{f.replace(Q.dashboard.quotation.edit(o))},[f]),X=()=>{b(!j)},q=()=>{s(null),b(!1)},W=o=>{s(o)};return e.jsx(Fe,{maxWidth:"xl",children:e.jsxs(se,{container:!0,spacing:3,children:[e.jsx(se,{xs:12,md:12,children:e.jsx(Ke,{links:[{name:`${d("listView.breadCrumbsPageRootTitle")}`,href:Q.dashboard.root},{name:`${d("listView.breadCrumbsParentPageTitle")}`,href:Q.dashboard.quotation.root},{name:`${d("listView.breadCrumbsPageTitle")}`}],action:e.jsx($,{permission:I.ADD_QUOTATION,children:e.jsx(K,{component:He,href:Q.dashboard.quotation.new,variant:"contained",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),children:`${d("listView.addNewQuotation")}`})})})}),e.jsxs($,{permission:I.LIST_QUOTATION,children:[!j&&e.jsx(se,{xs:12,md:r?5:12,children:e.jsxs(ve,{children:[e.jsx(Ts,{filters:T,onResetPage:n.onResetPage,dateError:P}),c&&e.jsx(ws,{filters:T,totalResults:y.length,onResetPage:n.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(l,{sx:{position:"relative"},children:[e.jsx(es,{dense:n.dense,numSelected:n.selected.length,rowCount:y.length}),e.jsx(Ne,{sx:{minHeight:444},children:e.jsxs(Ze,{size:n.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Xe,{order:n.order,orderBy:n.orderBy,headLabel:p,rowCount:y.length}),e.jsxs(qe,{children:[y.slice(n.page*n.rowsPerPage,n.page*n.rowsPerPage+n.rowsPerPage).map(o=>e.jsx(gs,{row:o,selected:n.selected.includes(o.id),onSelectRow:()=>n.onSelectRow(o.id),onDeleteRow:()=>A(o.id),onViewRow:()=>H(o.id),onEditRow:()=>Z(o.id),onClickRow:()=>W(o),isFullDisplay:r},o.id)),e.jsx(Ye,{height:n.dense?56:76,emptyRows:Ge(n.page,n.rowsPerPage,y.length)}),e.jsx(Je,{notFound:k})]})]})})]}),e.jsx(ss,{page:n.page,dense:n.dense,count:y.length,rowsPerPage:n.rowsPerPage,onPageChange:n.onChangePage,onChangeDense:n.onChangeDense,onRowsPerPageChange:n.onChangeRowsPerPage})]})}),r&&e.jsx(l,{sx:{display:"flex",flex:1,p:1.5,transition:"all 2s ease-in-out"},children:e.jsx(ys,{selectedQuotation:r,handleResize:X,handleClose:q})})]})]})})}function Ps({inputData:t,comparator:n,filters:d,dateError:r}){const{status:s,name:j,startDate:b,endDate:u}=d,p=t==null?void 0:t.map((i,f)=>[i,f]);return p==null||p.sort((i,f)=>{const C=n(i[0],f[0]);return C!==0?C:i[1]-f[1]}),t=p==null?void 0:p.map(i=>i[0]),j&&(t=t.filter(i=>i.id.toString().toLowerCase().indexOf(j.toLowerCase())!==-1||i.customer.name.toLowerCase().indexOf(j.toLowerCase())!==-1||i.status.toLowerCase().indexOf(j.toLowerCase())!==-1||i.customer.email.toLowerCase().indexOf(j.toLowerCase())!==-1)),s!=="all"&&(t=t.filter(i=>i.status===s)),r||b&&u&&(t=t.filter(i=>Me(i.createTime,b,u))),t}const ks={title:`Quotation list | Dashboard - ${Ce.site.name}`};function _t(){const t=ie({queryKey:["quotations"],queryFn:async()=>{const{data:n}=await R.get(V.quotation.list);return n}});return t.isLoading?e.jsx(le,{}):t.isError?e.jsx(oe,{route:Q.dashboard.quotation.root}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{children:e.jsxs("title",{children:[" ",ks.title]})}),e.jsx(vs,{quotations:t.data})]})}export{_t as default};

import{j as t,B as i,T as W,en as z,d7 as Q,S as o,el as r,e8 as K,e3 as F,e as P,I as u,cY as $,h as G,g as M,r as d,p as O,ea as Y,i as R,e1 as _,c9 as C,l as k,d0 as A,eo as J,dn as U,eb as X,ep as N,dP as Z,cV as q,dp as w,dm as T,dq as I,dT as tt,H as st,C as et}from"./index-DGNYifC6.js";import{u as nt,E as it}from"./error-block-C-2dSLgv.js";import{u as at}from"./use-params-DreKWGUv.js";import"./chart-legends-7ADjs6rD.js";import{P as lt}from"./react-pdf.browser-CL6TEYtb.js";import{P as ot,a as ct,b as rt,O as xt}from"./order-status-dialog-Ci8KVlGm.js";import{l as pt}from"./index-QXgaSBze.js";import{u as E}from"./useMutation-D2jYRQJx.js";import{C as dt}from"./confirm-dialog-BqyKQ3gP.js";import{C as mt}from"./custom-breadcrumbs-DRd75Eu9.js";import{b as v}from"./format-number-CWTAeVFz.js";import{P as B}from"./permission-access-controller-gNEhnvDe.js";import{T as ht,t as ut,a as jt,b as yt,c as ft,d as gt,e as bt}from"./TimelineSeparator-BP-k2w59.js";import{C as H}from"./CardHeader-BjTA_6Uz.js";import{O as Dt}from"./order-product-table-DGLUEJ3J.js";import{C as Ct}from"./CircularProgress-G9ssI8-f.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./index-BqPiDh_s.js";import"./___vite-browser-external_commonjs-proxy-BMLTqiA-.js";import"./form-provider-CJcfGRKn.js";import"./TextField-mBdmr42_.js";import"./FormControl-ozFyA-FQ.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-ZTJWG8jQ.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-B8Lxlqfe.js";import"./Select-C6ASwYR-.js";import"./Menu-BP2zLRER.js";import"./InputBase-hrwLUnCD.js";import"./FormHelperText-CVQBffr0.js";import"./Rating-lF0e67mT.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-Bk0hVyX2.js";import"./index-CPrvQNIh.js";import"./Slider-_mufNbtc.js";import"./RadioGroup-CJB7uNqf.js";import"./FormGroup-RIR5D6xL.js";import"./FormControlLabel-C9O5_5-O.js";import"./utils-CGfCLUzb.js";import"./countries-DSLisFCy.js";import"./InputAdornment-BmxkeBIP.js";import"./Autocomplete-De53pBeJ.js";import"./Chip-B0Ybqywg.js";import"./country-select-DDtqlvTv.js";import"./Checkbox-BIs_5AT0.js";import"./upload-avatar-Bt036TSz.js";import"./image-CNJbTuDT.js";import"./DatePicker-wZuhHZr0.js";import"./DialogContent-B_Tr1w8s.js";import"./ListItem-CYQM3O-q.js";import"./MobileDateTimePicker-B6nPPnvp.js";import"./Tabs-DFrMpOqw.js";import"./KeyboardArrowRight-DID8kgv4.js";import"./upload-box-ad-CPfdaLKU.js";import"./schema-helper-7KYonKRH.js";import"./DialogTitle-DLN32Wnl.js";import"./LoadingButton-4-CBySOn.js";import"./table-head-custom-B_NYvjkz.js";import"./TableCell-yuBVQ3lX.js";import"./incrementer-button-CDQHn4ga.js";const wt=({order:s,payments:e,dialog:a,handleApproveOrder:l,handlePrint:y})=>{const j=t.jsxs(i,{sx:{pr:4,pl:4,pb:4,pt:2},children:[t.jsx(ht,{sx:{p:0,m:0,[`& .${ut.root}:before`]:{flex:0,padding:0}},children:e==null?void 0:e.map((x,c)=>{const m=c===0,h=c===e.length-1;return t.jsxs(jt,{children:[t.jsxs(yt,{children:[t.jsx(ft,{color:m&&"primary"||"grey"}),h?null:t.jsx(gt,{})]}),t.jsx(bt,{children:t.jsxs(i,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs(i,{children:[t.jsx(W,{variant:"subtitle2",children:v(x.amount)}),t.jsx(i,{sx:{color:"text.disabled",typography:"caption",mt:.5},children:z(x.paymentDate)})]}),t.jsx(Q,{color:"success",children:x.paymentType})]})})]},x.id)})}),t.jsx(o,{justifyContent:"flex-end",spacing:1.5,sx:{marginTop:2},children:(s==null?void 0:s.status)!==r.Draft&&(s==null?void 0:s.status)!==r.Canceled&&(Math.round(K(s.totalOrderAmount-s.totalOrderAmount*(s.discount/100),s==null?void 0:s.snapshotTaxPercentage)-s.orderPaymentAmount)>0?t.jsx(B,{permission:F.ADD_PAYMENT,children:t.jsx(P,{variant:"contained",onClick:()=>a.onTrue(),startIcon:t.jsx(u,{icon:"mingcute:add-line"}),children:"New Payment"})}):t.jsx(P,{variant:"contained",color:"success",sx:{cursor:"not-allowed"},startIcon:t.jsx(u,{icon:"solar:check-read-bold-duotone"}),children:"Payed"}))})]});return t.jsxs($,{children:[(e==null?void 0:e.length)>0&&t.jsx(H,{title:"Payments"}),j]})};function Tt({order:s,discount:e,customer:a,totalAmount:l,handleApproveOrder:y,handlePrint:j}){var f,g,b,D;const{user:x}=G(),c=M(),m=d.useCallback(n=>{c.replace(O.dashboard.quotation.details(n))},[c]),h=t.jsxs(o,{spacing:2,alignItems:"flex-end",sx:{p:3,textAlign:"right",typography:"body2"},children:[t.jsxs(o,{direction:"row",children:[t.jsx(i,{sx:{color:"text.secondary"},children:"Subtotal"}),t.jsx(i,{sx:{width:160,typography:"subtitle2"},children:v(l)||"-"})]}),t.jsxs(o,{direction:"row",children:[t.jsx(i,{sx:{color:"text.secondary"},children:"Discount"}),t.jsx(i,{sx:{width:160,...e&&{color:"error.main"}},children:e?`- ${e}%`:"-"})]}),t.jsxs(o,{direction:"row",children:[t.jsxs(i,{sx:{color:"text.secondary"},children:["Tax (",(s==null?void 0:s.snapshotTaxPercentage)||"0","%)"]}),t.jsx(i,{sx:{width:160},children:s!=null&&s.snapshotTaxPercentage?v(Y(l-l*(e/100),s==null?void 0:s.snapshotTaxPercentage)):"-"})]}),t.jsxs(o,{direction:"row",sx:{typography:"subtitle1"},children:[t.jsx("div",{children:"Total"}),t.jsx(i,{sx:{width:160},children:v(K(l-l*(e/100),s==null?void 0:s.snapshotTaxPercentage))||"-"})]})]}),p=R(),S=t.jsx(_,{children:t.jsx(lt,{document:s?t.jsx(ot,{order:s}):t.jsx("span",{}),fileName:s==null?void 0:s.ref,style:{textDecoration:"none"},children:({loading:n})=>t.jsx(C,{title:"Download Pdf",children:t.jsx(k,{children:n?t.jsx(Ct,{size:24,color:"inherit"}):t.jsx(u,{icon:"eva:cloud-download-fill"})})})})});return t.jsxs(t.Fragment,{children:[t.jsxs($,{children:[t.jsx(o,{justifyContent:"center",alignItems:"center",children:t.jsxs("h1",{className:"print-title",children:["Order REF: #",s.ref]})}),t.jsx("style",{jsx:!0,children:`
          .print-title {
            display: none; /* Hide on screen */
          }

          @media print {
            .print-title {
              display: block; /* Show only when printing */
            }
            .print-hide {
              display: none; /* Hide on screen */
            }
            html,
            body {
              height: initial !important;
              overflow: initial !important;
            }

            .scrollableDiv {
              width: 100%;
              height: 100% !important;
              overflow: visible;
            }
          }
        `}),t.jsx(H,{className:"print-hide",title:"Details",subheader:((f=s==null?void 0:s.quotation)==null?void 0:f.id)&&`Related to Quotation: #${(g=s==null?void 0:s.quotation)==null?void 0:g.ref}`,action:t.jsx(o,{className:"print-hide",children:t.jsxs(o,{direction:"row",spacing:1,flexGrow:1,children:[((b=s==null?void 0:s.quotation)==null?void 0:b.id)&&t.jsx(C,{title:`Related to Quotation: #${(D=s==null?void 0:s.quotation)==null?void 0:D.ref}`,children:t.jsx(k,{onClick:()=>{var n;m((n=s==null?void 0:s.quotation)==null?void 0:n.id)},children:t.jsx(u,{icon:"heroicons-outline:external-link"})})}),(s==null?void 0:s.status)!==r.Draft&&(s==null?void 0:s.status)!==r.Canceled&&t.jsx(C,{title:"Change Order Status",children:t.jsx(k,{onClick:()=>p.onToggle(),children:t.jsx(u,{icon:"tabler:status-change"})})}),S,t.jsx(B,{permission:F.PRINT_ORDER,children:t.jsx(C,{title:"Print",children:t.jsx(ct,{order:s})})}),t.jsx(B,{permission:F.APPROVE_ORDER,children:(s==null?void 0:s.status)===r.Draft&&t.jsx(P,{variant:"contained",size:"medium",color:"primary",startIcon:t.jsx(u,{icon:"solar:check-square-bold"}),onClick:()=>{y(s.id)},children:"Approve"})})]})})}),t.jsxs(o,{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(3, 1fr)",md:"repeat(3, 1fr)",lg:"repeat(3, 1fr)"},sx:{p:2,typography:"body2"},children:[t.jsxs(i,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[t.jsx(o,{display:"flex",gap:1,sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:t.jsx("div",{children:"Order Details"})}),t.jsxs(i,{sx:{color:"text.secondary"},children:["ORDER ID: #",s.ref]}),t.jsxs(i,{sx:{color:"text.secondary"},children:["Order Date: ",A(s.orderDate)]}),t.jsxs(i,{sx:{color:"text.secondary"},children:["Delivery Date: ",s.deliveryDate?A(s.deliveryDate):t.jsx("span",{children:" - "})]})]}),t.jsxs(i,{flexDirection:"column",sx:{display:"flex",width:1,p:1,borderRight:n=>`dashed 2px ${n.vars.palette.background.neutral}`,borderLeft:n=>`dashed 2px ${n.vars.palette.background.neutral}`},children:[t.jsx(o,{display:"flex",justifyContent:"center",sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:t.jsx("div",{children:J(x)})}),t.jsxs(i,{sx:{color:"text.secondary"},children:["Status:"," ",t.jsx(Q,{variant:"soft",color:(s==null?void 0:s.status)===r.Ready&&"info"||(s==null?void 0:s.status)===r.InProcess&&"warning"||(s==null?void 0:s.status)===r.Delivered&&"success"||(s==null?void 0:s.status)===r.Canceled&&"error"||"default",children:s==null?void 0:s.status})]}),t.jsxs(i,{sx:{color:"text.secondary"},children:["Tax/Vat: ",a==null?void 0:a.taxNumber]})]}),t.jsxs(i,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[t.jsx(o,{display:"flex",gap:1,sx:{typography:"subtitle2",width:"100%",marginBottom:1},children:t.jsx("div",{children:"Order To"})}),t.jsxs(i,{sx:{color:"text.secondary",textTransform:"capitalize"},children:["Customer: ",a==null?void 0:a.name]}),t.jsxs(i,{sx:{color:"text.secondary"},children:["Tel: ",a==null?void 0:a.phoneNumber]})]})]}),t.jsx(i,{fullWidth:!0,alignItems:"center",sx:{p:2,borderBottom:n=>`dashed 2px ${n.vars.palette.background.neutral}`},children:t.jsx(Dt,{products:s.productToOrder,isDetail:!0})}),h,(s==null?void 0:s.notes)&&t.jsx(o,{justifyContent:"space-between",sx:{p:3,typography:"body2"},children:t.jsxs(i,{flexDirection:"column",sx:{display:"flex",width:"100%",p:1},children:[t.jsx(o,{sx:{typography:"subtitle2",marginBottom:1},children:t.jsx("div",{children:"Notes:"})}),t.jsx(i,{sx:{color:"text.secondary"},children:s==null?void 0:s.notes})]})})]}),t.jsx(rt,{currentOrder:s,open:p.value,onClose:p.onFalse})]})}function vt({currentOrder:s}){const[e,a]=d.useState(s),[l,y]=d.useState(),j=d.useRef(),x=R(),c=U(),[m,h]=d.useState([]),p=R(),S=X();d.useEffect(()=>{a(s)},[s]),d.useEffect(()=>{const n=N(e==null?void 0:e.payments,"paymentDate");h(n)},[e==null?void 0:e.payments]);const{mutate:f}=E({mutationFn:n=>w.post(T.payments.create,n),onSuccess:async n=>{I.success("New Payment Has Been Created!");const{data:L}=n,V=N([...m,L],"paymentDate");h(V)},onSettled:async()=>{await c.invalidateQueries({queryKey:["payments"]});const{id:n}=e;await c.invalidateQueries({queryKey:["order",n]}),x.onFalse()},onError:n=>{console.log(n)}}),{mutate:g}=E({mutationFn:n=>w.get(T.order.approve+n),onSuccess:async({data:n})=>{n!=null&&n.length?(p.onTrue(),y(n)):(I.success("Order Has Been Approved!"),a(n))},onSettled:async()=>{const{id:n}=e;await c.invalidateQueries({queryKey:["orders"]}),await c.invalidateQueries({queryKey:["orders","analytics"]}),await c.invalidateQueries({queryKey:["order",n]})},onError:n=>{console.log(n)}}),{mutate:b}=E({mutationFn:n=>w.post(T.order.createPlans,n),onSuccess:async({data:n})=>{I.success("Order Has Been Approved!"),a(n),p.onFalse()},onSettled:async()=>{const{id:n}=e;await c.invalidateQueries({queryKey:["orders"]}),await c.invalidateQueries({queryKey:["orders","analytics"]}),await c.invalidateQueries({queryKey:["order",n]})},onError:n=>{console.log(n)}}),D=pt.useReactToPrint({content:()=>j.current});return t.jsxs(t.Fragment,{children:[t.jsxs(Z,{children:[t.jsx(mt,{links:[{name:"Dashboard",href:O.dashboard.root},{name:"Orders",href:O.dashboard.order.root},{name:"Order Details"}],sx:{mb:{xs:3,md:5}}}),t.jsxs(q,{container:!0,spacing:3,children:[t.jsx(q,{xs:12,md:(e==null?void 0:e.status)!==r.Draft&&(e==null?void 0:e.status)!==r.Canceled?9:12,children:t.jsx(o,{ref:j,spacing:3,direction:{xs:"column-reverse",md:"column"},children:t.jsx(Tt,{order:e,customer:e==null?void 0:e.customer,discount:e==null?void 0:e.discount,totalAmount:e==null?void 0:e.totalOrderAmount,handleApproveOrder:g,handlePrint:D})})}),(e==null?void 0:e.status)!==r.Draft&&(e==null?void 0:e.status)!==r.Canceled&&t.jsx(q,{xs:12,md:3,children:t.jsx(wt,{order:e,payments:m,dialog:x})})]}),t.jsx(xt,{order:e,open:x.value,onClose:x.onFalse,handler:f})]}),t.jsx(dt,{open:p.value,onClose:p.onFalse,title:"Out of Stock",content:t.jsxs(t.Fragment,{children:[t.jsx(i,{children:"Products are out of Stock! do you want to create plans?"}),t.jsxs(i,{sx:{mt:1,mb:1},children:["You need to create ",t.jsx("span",{style:{fontWeight:"bold"},children:l==null?void 0:l.length})," :"]}),l==null?void 0:l.map(n=>t.jsxs(i,{children:["Plan for ",t.jsx("span",{style:{fontWeight:"bold"},children:n.product.name})," because is missing"," ",t.jsx("span",{style:{fontWeight:"bold",color:`${S.vars.palette.error.light}`},children:n.missingQuantity}),"."]}))]}),action:t.jsx(P,{variant:"contained",color:"error",onClick:()=>{b(l)},children:(l==null?void 0:l.length)>1?"Create Plans":"Create Plan"})})]})}const Pt={title:`Order details | Dashboard - ${et.site.name}`};function Bs(){const{id:s=""}=at(),e=nt({queryKey:["order",s],queryFn:async()=>{const{data:a}=await w.get(T.order.details+s);return a}});return e.isPending||e.isLoading?t.jsx(tt,{}):e.isError?t.jsx(it,{route:O.dashboard.order.root}):t.jsxs(t.Fragment,{children:[t.jsx(st,{children:t.jsxs("title",{children:[" ",Pt.title]})}),t.jsx(vt,{currentOrder:e.data})]})}export{Bs as default};

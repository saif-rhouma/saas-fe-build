import{r as d,C as S,dI as V,dJ as h,dH as u,dK as Y,d7 as J,j as s,aD as T,S as g,T as x,B as j,bR as L,e as M,e8 as _,p as N,ec as Z,H as W}from"./index-D-ZKGqTU.js";import{u as X,E as R}from"./error-block-CQIWskvv.js";import{C as A}from"./custom-breadcrumbs-Ce0SsF19.js";import{z as m,c as ee,u as re,t as se,a as te,F as n}from"./form-provider-L0KFjUTq.js";import{u as D}from"./useMutation-DZH4G1UV.js";import{a as O}from"./format-number-7nwGld6g.js";import{b as ae,U as me}from"./upload-avatar-C3B5eTLv.js";import"./editor-CzmUVphq.js";import{s as ne}from"./schema-helper-DuuayT54.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./TextField-DhW8zjJC.js";import"./FormControl-n1s9FAXz.js";import"./utils-DoM3o7-Q.js";import"./InputLabel-CCRBBEhV.js";import"./formControlState-Dq1zat_P.js";import"./FormLabel-C9Vfi2q1.js";import"./Select-B6atPAS4.js";import"./Menu-BvjNAHEG.js";import"./InputBase-B9hwN3-B.js";import"./FormHelperText-BHlZRpvh.js";import"./Rating-C-gTF_lZ.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-Buv_oatH.js";import"./RadioGroup-Bz4MgZrq.js";import"./FormGroup-CwleoAMr.js";import"./FormControlLabel-5B8r8hjw.js";import"./index-D0kJtIpB.js";import"./countries-DSLisFCy.js";import"./InputAdornment-B2x29rol.js";import"./Autocomplete-C74LI-Rt.js";import"./Chip-CYchvRo_.js";import"./country-select-CBbXG_H4.js";import"./Checkbox-XoXkZxXm.js";import"./DatePicker-BiJlOuDh.js";import"./DialogContent-CKRoYUkD.js";import"./ListItem-CbBrCKNq.js";import"./MobileDateTimePicker-CIeUS7kl.js";import"./Tabs-BAzl82ph.js";import"./KeyboardArrowRight-DzNmTPM2.js";import"./image-CX1CYgjP.js";import"./index-Bb5BZvNl.js";const ie=m.object({name:m.string().min(1,{message:"Staff First Name is required!"}),description:m.string(),email:m.string().min(1,{message:"Email is required!"}).email({message:"Email must be a valid email address!"}),phoneNumber:ne.phoneNumber({isValidPhoneNumber:ee}),currencySymbol:m.string().min(1,{message:"Staff Last Name is required!"}),taxPercentage:m.number().min(1,{message:"Staff Last Name is required!"}),country:m.string().min(1,{message:"Country is required!"}),state:m.string(),street:m.string(),city:m.string(),district:m.string(),zipCode:m.string(),taxNumber:m.number(),printerPOS:m.string().min(1,{message:"Printer POS is required!"})}),oe=({applicationAccount:r,financial:p})=>{const y=d.useRef(r),[f,P]=d.useState(null),[b,E]=d.useState(null);d.useEffect(()=>{r&&(k(q),P(`${S.site.serverFileHost}${r.favicon}`),E(`${S.site.serverFileHost}${r.appLogo}`))},[r]);const q=d.useMemo(()=>{var e,t,a,i,o,l;return{name:(r==null?void 0:r.name)||"",description:(r==null?void 0:r.description)||"",email:(r==null?void 0:r.email)||"",phoneNumber:(r==null?void 0:r.phoneNumber)||"",currencySymbol:(r==null?void 0:r.currencySymbol)||"",taxPercentage:(r==null?void 0:r.taxPercentage)||"",country:((e=r==null?void 0:r.address)==null?void 0:e.country)||"",state:((t=r==null?void 0:r.address)==null?void 0:t.state)||"",city:((a=r==null?void 0:r.address)==null?void 0:a.city)||"",district:((i=r==null?void 0:r.address)==null?void 0:i.district)||"",zipCode:((o=r==null?void 0:r.address)==null?void 0:o.zipCode)||"",street:((l=r==null?void 0:r.address)==null?void 0:l.street)||"",taxNumber:(r==null?void 0:r.taxNumber)||0,printerPOS:(r==null?void 0:r.printerPOS)||""}},[r]),z=re({resolver:se(ie),defaultValues:q}),{reset:k,watch:xe,setValue:ge,handleSubmit:$,control:he,formState:{isSubmitting:ue}}=z,G=$(async e=>{try{if(e.city||e.country||e.district||e.state||e.street||e.zipCode){const{country:t,state:a,city:i,district:o,zipCode:l,street:w}=e;e.address={country:t,state:a,city:i,district:o,zipCode:l,street:w},delete e.city,delete e.country,delete e.district,delete e.state,delete e.street,delete e.zipCode}if(y.current={...e},f&&b){const t=new FormData;t.append("file",f),t.append("category","AppAvatar");const a=new FormData;a.append("file",b),a.append("category","AppLogo"),await Q({avatar:t,logo:a})}else if(f){const t=new FormData;t.append("file",f),t.append("category","AppAvatar"),await K(t)}else if(b){const t=new FormData;t.append("file",b),t.append("category","AppLogo"),await I(t)}else await C(e)}catch(t){console.error(t)}}),H=d.useCallback(e=>{const t=e[0];P(t)},[]),U=d.useCallback(e=>{const t=e[0];E(()=>t)},[]),c=()=>{E(null)},v={headers:{"content-type":"multipart/form-data"}},B=d.useCallback(e=>{const t=document.querySelector("link[rel~='icon']")||document.createElement("link");t.type="image/x-icon",t.rel="icon",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)},[]),F=V(),{mutate:K}=D({mutationFn:e=>h.post(u.files.upload,e,v),onSuccess:async({data:e})=>{const{name:t}=e;if(t){const{current:a}=y;a.favicon=t,B(`${S.site.serverFileHost}${t}`),await C(a)}return e},onSettled:async()=>{await F.invalidateQueries({queryKey:["appAvatar-images"]})},onError:e=>{console.log(e)}}),{mutate:I}=D({mutationFn:e=>h.post(u.files.upload,e,v),onSuccess:async({data:e})=>{const{name:t}=e;if(t){const{current:a}=y;a.appLogo=t,await C(a)}return e},onSettled:async()=>{await F.invalidateQueries({queryKey:["appAvatar-images"]})},onError:e=>{console.log(e)}}),{mutate:Q}=D({mutationFn:async({avatar:e,logo:t})=>{const a=await h.post(u.files.upload,e,v),i=await h.post(u.files.upload,t,v);return{avatarRes:a,logoRes:i}},onSuccess:async({avatarRes:e,logoRes:t})=>{var l,w;const a=(l=e==null?void 0:e.data)==null?void 0:l.name,i=(w=t==null?void 0:t.data)==null?void 0:w.name,{current:o}=y;i&&(o.appLogo=i),a&&(o.favicon=a),B(`${S.site.serverFileHost}${a}`),await C(o)},onSettled:async()=>{await F.invalidateQueries({queryKey:["appAvatar-images"]})},onError:e=>{console.log(e)}}),{mutate:C}=D({mutationFn:e=>h.patch(u.master.edit,e),onSuccess:async()=>{Y.success("Master Account Has Been Modified!");const{currencySymbol:e}=y.current;localStorage.setItem(J,e)},onSettled:async()=>{await F.invalidateQueries({queryKey:["account-application"]})},onError:e=>{console.log(e)}});return s.jsxs(te,{methods:z,onSubmit:G,children:[s.jsx(T,{sx:{mb:4},children:s.jsxs(g,{spacing:2,sx:{p:3},children:[s.jsx(x,{variant:"h6",gutterBottom:!0,children:"Organization Details"}),s.jsxs(j,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[s.jsx(n.Text,{name:"name",label:"Organization Name"}),s.jsx(n.Phone,{name:"phoneNumber",label:"Phone number"}),s.jsx(n.Text,{name:"email",label:"Email address"}),s.jsx(n.Text,{name:"description",label:"Description"}),s.jsxs(g,{spacing:1.5,children:[s.jsx(x,{variant:"subtitle2",children:"Attachments"}),s.jsx(ae,{value:b,onDrop:U,onDelete:c})]}),s.jsxs(g,{spacing:1.5,children:[s.jsx(x,{variant:"subtitle2",children:"Favicon"}),s.jsx(me,{value:f,onDrop:H,validator:e=>e.size>1e6?{code:"file-too-large",message:`File is larger than ${O(1e6)}`}:null,helperText:s.jsxs(x,{variant:"caption",sx:{mt:3,mx:"auto",display:"block",textAlign:"center",color:"text.disabled"},children:["Allowed *.jpeg, *.jpg, *.png, *.gif",s.jsx("br",{})," max size of ",O(3145728)]})})]})]})]})}),s.jsx(T,{sx:{mb:4},children:s.jsxs(g,{spacing:2,sx:{p:3},children:[s.jsx(x,{variant:"h6",gutterBottom:!0,children:"Finance Setting"}),s.jsxs(j,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[s.jsx(n.Text,{name:"currencySymbol",label:"Currency Symbol"}),s.jsx(n.Text,{name:"taxPercentage",label:"Tax Percentage"})]})]})}),s.jsx(T,{sx:{mb:4},children:s.jsxs(g,{spacing:2,sx:{p:3},children:[s.jsx(x,{variant:"h6",gutterBottom:!0,children:"Firm Address"}),s.jsxs(j,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[s.jsx(n.CountrySelect,{name:"country",label:"Country",placeholder:"Choose a country"}),s.jsx(n.Text,{name:"state",label:"State/region"}),s.jsx(n.Text,{name:"city",label:"City"}),s.jsx(n.Text,{name:"district",label:"District"}),s.jsx(n.Text,{name:"zipCode",label:"Zip/code"}),s.jsx(n.Text,{name:"street",label:"Address"}),s.jsx(n.Text,{type:"number",name:"taxNumber",label:"Store Tax Number"})]})]})}),s.jsx(T,{sx:{mb:4},children:s.jsxs(g,{spacing:2,sx:{p:3},children:[s.jsx(x,{variant:"h6",gutterBottom:!0,children:"Other Settings"}),s.jsx(j,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:s.jsxs(n.Select,{name:"printerPOS",label:"Printer POS",sx:{width:420,textTransform:"capitalize"},children:[s.jsx(L,{value:"A4",children:"A4"}),s.jsx(L,{value:"Thermal",children:"Thermal"})]})})]})}),s.jsxs(j,{display:"flex",justifyContent:"flex-end",gap:2,mt:2,children:[s.jsx(M,{type:"submit",variant:"contained",children:"Save Changes"}),s.jsx(M,{variant:"outlined",children:"Cancel"})]})]})},de=({applicationAccount:r,financial:p})=>s.jsxs(_,{children:[s.jsx(A,{links:[{name:"Dashboard",href:N.dashboard.root},{name:"Settings",href:N.dashboard.tools.root},{name:"Master Settings"}],sx:{mb:{xs:3,md:5}}}),s.jsx(oe,{applicationAccount:r,financial:p})]}),le={title:`Tools | Dashboard - ${S.site.name}`};function ar(){const r=X({queryKey:["account-application"],queryFn:async()=>{const{data:p}=await h.get(u.auth.application);return p}});return r.isLoading?s.jsx(Z,{}):r.isError?s.jsx(R,{route:N.dashboard.tools.root}):s.jsxs(s.Fragment,{children:[s.jsx(W,{children:s.jsxs("title",{children:[" ",le.title]})}),s.jsx(de,{applicationAccount:r.data})]})}export{ar as default};

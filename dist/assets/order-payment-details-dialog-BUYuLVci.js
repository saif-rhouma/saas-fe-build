import{r as x,dn as k,dp as q,dm as B,ek as E,j as e,am as d,S as i,B as s,T as n,d0 as D,e3 as v,aS as m,I as R,e as L}from"./index-CmdkfqKS.js";import{z as y,u as M,t as Q,a as U,F as u}from"./form-provider-DrNjnJOg.js";import{u as W}from"./useMutation-CzRT85lE.js";import{b as h}from"./format-number-CpJwq28e.js";import{a as z}from"./upload-avatar-DL75aXAD.js";import"./image-n6arU1a7.js";import"./editor-CFV9i_63.js";import{s as H}from"./schema-helper-UGzp3Z51.js";import{a as K,b as N,D as V}from"./DialogContent-Dk5OBRXK.js";import{D as _}from"./DialogTitle-BioDnUJV.js";import{L as J}from"./LoadingButton-CR1m5No3.js";const X=y.object({amount:y.number().min(1,{message:"Amount is required!"}),paymentDate:H.date({message:{required_error:"Start date is required!"}}),paymentType:y.string().min(1,{message:"Payment Type is required!"})}),ce=({order:a,payment:w,open:C,onClose:j,handler:f})=>{const p=x.useRef(w),[l,c]=x.useState(),T=x.useCallback(t=>{const r=t[0];c(()=>r)},[]),S=()=>{c(null)},P=k(),A={headers:{"content-type":"multipart/form-data"}},{mutate:F}=W({mutationFn:t=>q.post(B.files.upload,t,A),onSuccess:async({data:t})=>{const{name:r}=t;if(r){const{current:o}=p;o.attachments=r,await f(o)}return t},onSettled:async()=>{c(null),p.current={},await P.invalidateQueries({queryKey:["payments-images"]})},onError:t=>{console.log(t)}}),G={amount:0,paymentType:"",paymentDate:E()},g=M({resolver:Q(X),defaultValues:G}),{reset:b,handleSubmit:O,formState:{isSubmitting:Y}}=g,I=O(async t=>{try{const r={...t,orderId:a.id,customerId:a.customer.id};if(l){p.current={...r};const o=new FormData;o.append("file",l),o.append("category","Payment"),await F(o)}else await f(r);b()}catch(r){console.log(r)}});return e.jsxs(K,{fullWidth:!0,maxWidth:"lg",open:C,onClose:j,children:[e.jsx(_,{children:"Add Payment"}),e.jsxs(U,{methods:g,onSubmit:I,children:[e.jsxs(N,{children:[e.jsx(d,{}),e.jsxs(i,{spacing:1,sx:{pt:1,pb:1},children:[e.jsxs(s,{display:"flex",children:[e.jsx(n,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Customer Name:"}),e.jsx(n,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:a.customer.name})]}),e.jsxs(s,{display:"flex",children:[e.jsx(n,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Order ID:"}),e.jsx(n,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:a.ref})]}),e.jsxs(s,{display:"flex",children:[e.jsx(n,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Order Date:"}),e.jsx(n,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:D(a.orderDate)})]}),e.jsxs(s,{display:"flex",children:[e.jsx(n,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Delivery Date:"}),e.jsx(n,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:a.deliveryDate?D(a.deliveryDate):e.jsx("span",{children:" - "})})]})]}),e.jsx(d,{}),e.jsxs(i,{spacing:1,sx:{pt:1,pb:1},children:[e.jsxs(s,{display:"flex",children:[e.jsx(n,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Order Amount:"}),e.jsx(n,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:h(v(a.totalOrderAmount-a.totalOrderAmount*(a.discount/100),a==null?void 0:a.snapshotTaxPercentage))||"-"})]}),e.jsxs(s,{display:"flex",children:[e.jsx(n,{component:"span",variant:"body2",sx:{flexGrow:1,color:"text.secondary"},children:"Paid Amount:"}),e.jsx(n,{component:"span",variant:"body2",sx:{color:"text.secondary"},children:h(a.orderPaymentAmount)||"-"})]})]}),e.jsx(d,{}),e.jsx(i,{spacing:1,sx:{pt:2,pb:2},children:e.jsxs(s,{display:"flex",children:[e.jsx(n,{component:"span",variant:"subtitle1",sx:{flexGrow:1},children:"Balance:"}),e.jsx(n,{component:"span",variant:"subtitle1",children:h(v(a.totalOrderAmount-a.totalOrderAmount*(a.discount/100),a==null?void 0:a.snapshotTaxPercentage)-a.orderPaymentAmount)||"-"})]})}),e.jsx(d,{}),e.jsxs(i,{spacing:2,sx:{pt:4,pb:1},children:[e.jsxs(s,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[e.jsx(u.Text,{type:"number",name:"amount",label:"Paid Amount",sx:{flexGrow:1}}),e.jsx(u.DatePicker,{name:"paymentDate",label:"Date",sx:{flexGrow:1}})]}),e.jsxs(s,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[e.jsx(s,{children:e.jsxs(u.Select,{name:"paymentType",label:"Payment Type",children:[e.jsx(m,{value:"Cash",children:"Cash"}),e.jsx(m,{value:"Transfer",children:"Transfer"}),e.jsx(m,{value:"Card",children:"Card"})]})}),e.jsxs(i,{spacing:1.5,flexDirection:"row",sx:{height:"56px"},children:[e.jsx(z,{onDrop:T,sx:{height:"auto"}}),l&&e.jsxs(i,{flexDirection:"row",spacing:1,justifyContent:"center",alignItems:"center",sx:{typography:"body2",color:"error.main",cursor:"pointer",border:"solid 1px rgba(0,0,0,0)",p:1,"&:hover":{border:"solid 1px",borderColor:"error.main",borderRadius:1.5}},onClick:S,children:[e.jsx(R,{icon:"solar:trash-bin-trash-bold"}),e.jsx(s,{children:e.jsxs(s,{spacing:3,children:[e.jsx(n,{component:"span",variant:"subtitle2",sx:{flexGrow:1,mr:1},children:"Filename:"}),e.jsx("span",{children:l.name})]})})]})]})]})]})]}),e.jsxs(V,{children:[e.jsx(J,{type:"submit",variant:"contained",children:"Save"}),e.jsx(L,{color:"inherit",variant:"outlined",onClick:()=>{b(),c(null),j()},children:"Cancel"})]})]})]})};export{ce as O};

import{w as A,bG as Y,j as e,aL as Q,du as U,y as Z,I as S,dz as ee,bI as te,bJ as x,ep as B,e as O,r as p,dL as V,dM as C,dK as b,dN as _,ef as z,p as D,D as se,S as q,B as K,T as ae,dB as $,o as oe,dC as ie,er as re,eb as ne,G as f,aF as le,es as de,H as ce,C as me}from"./index-Bm3rBIkL.js";import{u as H,E as J}from"./error-block-BO5MDXKX.js";import{u as M}from"./useMutation-BPy7H-1h.js";import{C as pe}from"./custom-breadcrumbs-DgyWxDBR.js";import{P as N}from"./permission-access-controller-Bd1g1bvY.js";import{u as ue,g as he,r as xe,T as ge,a as je,e as fe}from"./table-selected-action-FGFYoCf9.js";import{T as ye}from"./table-no-data-C5ESOE9S.js";import{T as Ce,a as be,b as we,c as Te}from"./table-head-custom-fAI8azNC.js";import{T as Se}from"./table-pagination-custom-B5OCrP_3.js";import{A as R}from"./app-widget-summary-BwDusN7H.js";import{C as De}from"./confirm-dialog-CdiBdWQ6.js";import{T as y}from"./TableCell-DwZUj5h4.js";import{z as T,u as ve,t as Pe,a as Fe,F as P}from"./form-provider-BVzxbRNt.js";import{b as ke}from"./upload-avatar-CklA5cX-.js";import"./image-BvWqJKQA.js";import"./editor-B_eq4lpY.js";import{a as Ie,b as Le,D as Ee}from"./DialogContent-adXfkuCx.js";import{D as Re}from"./DialogTitle-3zwXmVtf.js";import{L as Ae}from"./LoadingButton-qKaJGA43.js";import{T as Be}from"./TextField-Zaq0_UQI.js";import{I as qe}from"./InputAdornment-C5fdA_pt.js";import{S as Ke}from"./Select-BbFY65UU.js";import{F as He,a as Me,c as Ne}from"./filters-result-VXglGh15.js";import{C as Oe}from"./Chip-wb6jkBj9.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-DZc8qiZw.js";import"./empty-content-Bj3fPw3b.js";import"./TablePagination-xS2VmU8P.js";import"./LastPage-Bo5KhWUM.js";import"./InputBase-CLwZiNSB.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-3udn0dpo.js";import"./format-number-zZ3CkgDh.js";import"./use-chart-g96WCI3z.js";import"./chart-legends-xQs1SOOA.js";import"./index-I76JgJ8L.js";import"./FormHelperText-D4MtsGiu.js";import"./Rating-DDX-0-qU.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-DEF2K-nH.js";import"./FormControl-Dpp_E6i1.js";import"./FormLabel-CW4sUJth.js";import"./RadioGroup-CcFDuSjI.js";import"./FormGroup-C2nO5a7k.js";import"./countries-DSLisFCy.js";import"./Autocomplete-uJqWLfO9.js";import"./country-select-dI5VfxcM.js";import"./InputLabel-XKr5fbZR.js";import"./DatePicker-BFbM1AIt.js";import"./ListItem-B8LRzQux.js";import"./MobileDateTimePicker-BrtExEWs.js";import"./Menu-BCmDYN65.js";import"./index-DJLOkwgj.js";import"./CircularProgress-msI0ykgU.js";const ze=({row:t,selected:r,onViewRow:s,onDeleteRow:m})=>{const n=A();A();const i=Y(),l=e.jsxs(Ce,{hover:!0,selected:r,children:[e.jsx(y,{children:t.id}),e.jsx(y,{children:Q(t.createTime)}),e.jsx(y,{children:t.topic}),e.jsx(y,{children:e.jsx(U,{variant:"soft",color:t.priority==="Low"&&"success"||t.priority==="Medium"&&"warning"||t.priority==="Hight"&&"error"||"default",children:t.priority})}),e.jsx(y,{children:Q(t.updateTime)}),e.jsx(y,{children:e.jsx(U,{variant:"soft",color:t.status==="Open"&&"info"||t.status==="Closed"&&"default"||"default",children:t.status})}),e.jsx(y,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(Z,{color:i.open?"inherit":"default",onClick:i.onOpen,children:e.jsx(S,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[l,e.jsx(ee,{open:i.open,anchorEl:i.anchorEl,onClose:i.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(te,{children:[e.jsxs(x,{onClick:()=>{s(),i.onClose()},children:[e.jsx(S,{icon:"solar:eye-bold"}),"View"]}),e.jsx(N,{permission:B.DELETE_TICKET,children:e.jsxs(x,{onClick:()=>{n.onTrue(),i.onClose()},sx:{color:"error.main"},children:[e.jsx(S,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})})]})}),e.jsx(De,{open:n.value,onClose:n.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(O,{variant:"contained",color:"error",onClick:m,children:"Delete"})})]})},We=T.object({topic:T.string().min(1,{message:"Topic is required!"}),description:T.string().min(1,{message:"Description is required!"}),memberId:T.number().min(1,{message:"Member is required!"}),priority:T.string().min(1,{message:"Priority is required!"})}),Ge=({currentTicket:t,open:r,onClose:s})=>{//! Upload Logic START
const m=p.useRef(),[n,i]=p.useState([]),[l,d]=p.useState(),g=p.useCallback(a=>{const h=a[0];d(()=>h)},[]),o=()=>{d(null)},u=V(),j={headers:{"content-type":"multipart/form-data"}};//! Upload Logic END
const{mutate:F}=M({mutationFn:a=>C.post(b.files.upload,a,j),onSuccess:async({data:a})=>{const{name:h}=a;if(h){const{current:G}=m;G.file=h,await v(G)}return a},onSettled:async()=>{await u.invalidateQueries({queryKey:["tickets-images"]})},onError:a=>{console.log(a)}}),{mutate:v}=M({mutationFn:a=>C.post(b.tickets.create,a),onSuccess:async()=>{_.success("New Ticket Has Been Created!"),I()},onSettled:async()=>{await u.invalidateQueries({queryKey:["tickets"]}),m.current={},d(null),s()},onError:a=>{console.log(a)}}),k=p.useMemo(()=>({topic:(t==null?void 0:t.topic)||"",description:(t==null?void 0:t.description)||"",memberId:(t==null?void 0:t.memberId)||null,priority:(t==null?void 0:t.priority)||null}),[t]),w=ve({resolver:Pe(We),defaultValues:k}),{reset:I,watch:W,setValue:c,handleSubmit:L,formState:{isSubmitting:Xe}}=w,X=L(async a=>{try{if(l){m.current={...a};const h=new FormData;h.append("file",l),h.append("category","Ticket"),await F(h)}else await v(a)}catch(h){console.error(h)}}),E=H({queryKey:["members"],queryFn:async()=>{const{data:a}=await C.get(b.staff.list);return i(a),a}});return E.isPending||E.isLoading?e.jsx(z,{}):E.isError?e.jsx(J,{route:D.dashboard.staff.root}):e.jsxs(Ie,{fullWidth:!0,maxWidth:"md",open:r,onClose:s,children:[e.jsx(Re,{children:"Add New Ticket"}),e.jsxs(Fe,{methods:w,onSubmit:X,children:[e.jsxs(Le,{children:[e.jsx(se,{}),e.jsxs(q,{spacing:2,sx:{pt:4,pb:1},children:[e.jsxs(K,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[e.jsx(P.Text,{fullWidth:!0,label:"Enter Topic",name:"topic",sx:{flexGrow:1}}),e.jsx(P.Text,{fullWidth:!0,label:"Description",name:"description",sx:{flexGrow:1}}),e.jsxs(P.Select,{name:"priority",label:"Select a Priority",sx:{width:420,textTransform:"capitalize"},children:[e.jsx(x,{value:"Low",children:"Low"}),e.jsx(x,{value:"Medium",children:"Medium"}),e.jsx(x,{value:"Hight",children:"Hight"})]}),e.jsx(P.Select,{name:"memberId",label:"Select a Member",sx:{width:420,textTransform:"capitalize"},children:n.map(a=>e.jsx(x,{value:a.id,children:`${a==null?void 0:a.firstName} ${a==null?void 0:a.lastName}`},a.id))})]}),e.jsx(K,{children:e.jsxs(q,{spacing:1.5,children:[e.jsx(ae,{variant:"subtitle2",children:"Attachments"}),e.jsx($,{sx:{maxHeight:360,p:2},children:e.jsx(ke,{value:l,onDrop:g,onDelete:o})})]})})]})]}),e.jsxs(Ee,{children:[e.jsx(Ae,{type:"submit",variant:"contained",children:"Save"}),e.jsx(O,{color:"inherit",variant:"outlined",onClick:s,children:"Cancel"})]})]})]})};function Qe({filters:t,onResetPage:r}){const[s,m]=p.useState("all"),n=p.useCallback(l=>{r(),t.setState({name:l.target.value})},[t,r]),i=p.useCallback(l=>{r(),t.setState({status:l.target.value}),m(l.target.value)},[t,r]);return e.jsxs(q,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(Be,{sx:{width:420},value:t.state.name,onChange:n,placeholder:"Search Here...",InputProps:{startAdornment:e.jsx(qe,{position:"start",children:e.jsx(S,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(Ke,{sx:{width:420,textTransform:"capitalize"},value:s,onChange:i,children:[e.jsx(x,{value:"all",children:"All Tickets"}),e.jsx(x,{value:"Open",children:"Open Tickets"}),e.jsx(x,{value:"Closed",children:"Close Tickets"})]})]})}function Ue({filters:t,totalResults:r,onResetPage:s,sx:m}){const n=p.useCallback(()=>{s(),t.setState({name:""})},[t,s]),i=p.useCallback(()=>{s(),t.onResetState()},[t,s]);return e.jsx(He,{totalResults:r,onReset:i,sx:m,children:e.jsx(Me,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(Oe,{...Ne,label:t.state.name,onDelete:n})})})}const Ve=[{id:"ticketId",label:"#",width:140},{id:"date",label:"Date",width:280},{id:"topic",label:"Topic"},{id:"priority",label:"Priority"},{id:"lastUpdate",label:"Last Updated"},{id:"status",label:"Status"},{id:"",width:88}],_e=({tickets:t,analytics:r})=>{const s=ue({defaultOrderBy:"orderNumber"}),m=oe(),n=A(),[i,l]=p.useState(t),d=ie({name:"",status:"all",startDate:null,endDate:null});p.useEffect(()=>{l(t)},[t]);const g=re(d.state.startDate,d.state.endDate),o=$e({inputData:i,comparator:he(s.order,s.orderBy),filters:d.state,dateError:g}),u=xe(o,s.page,s.rowsPerPage),j=!!d.state.name||d.state.status!=="all"||!!d.state.startDate&&!!d.state.endDate,F=!o.length&&j||!o.length,v=p.useCallback(c=>{I(c)},[u.length,s,i]),k=p.useCallback(c=>{m.push(D.dashboard.tickets.details(c))},[m]),w=V(),{mutate:I}=M({mutationFn:c=>C.delete(b.tickets.delete+c),onSuccess:async()=>{const c=i.filter(L=>L.id!==id);_.success("Delete success!"),l(c),s.onUpdatePageDeleteRow(u.length)},onSettled:async()=>{await w.invalidateQueries({queryKey:["tickets"]}),await w.invalidateQueries({queryKey:["tickets","analytics"]})},onError:c=>{}}),W=()=>r.isPending||r.isLoading?e.jsx(f,{xs:12,md:12,children:e.jsx(z,{})}):e.jsxs(e.Fragment,{children:[e.jsx(f,{xs:12,md:4,children:e.jsx(R,{title:"All Tickets",total:t.length,chart:{}})}),e.jsx(f,{xs:12,md:4,children:e.jsx(R,{title:"Open Tickets",total:r.data.analytics.Open,chart:{}})}),e.jsx(f,{xs:12,md:4,children:e.jsx(R,{title:"Close Tickets",total:r.data.analytics.Closed,chart:{}})})]});return e.jsxs(e.Fragment,{children:[e.jsx(ne,{maxWidth:"xl",children:e.jsxs(f,{container:!0,spacing:3,children:[e.jsx(f,{xs:12,md:12,children:e.jsx(pe,{links:[{name:"Dashboard",href:D.dashboard.root},{name:"Ticket",href:D.dashboard.tickets.root}],action:e.jsx(N,{permission:B.ADD_TICKET,children:e.jsx(O,{onClick:()=>n.onToggle(),variant:"contained",startIcon:e.jsx(S,{icon:"mingcute:add-line"}),children:"Add New Ticket"})})})}),e.jsxs(N,{permission:B.TICKET_LIST,children:[W(),e.jsx(f,{xs:12,md:12,children:e.jsxs(le,{children:[e.jsx(Qe,{filters:d,onResetPage:s.onResetPage,dateError:g}),j&&e.jsx(Ue,{filters:d,totalResults:o.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(K,{sx:{position:"relative"},children:[e.jsx(ge,{dense:s.dense,numSelected:s.selected.length,rowCount:o.length}),e.jsx($,{sx:{minHeight:444},children:e.jsxs(be,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(we,{order:s.order,orderBy:s.orderBy,headLabel:Ve,rowCount:o.length}),e.jsxs(Te,{children:[o.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(c=>e.jsx(ze,{row:c,selected:s.selected.includes(c.id),onSelectRow:()=>s.onSelectRow(c.id),onDeleteRow:()=>v(c.id),onViewRow:()=>k(c.id)},c.id)),e.jsx(je,{height:s.dense?56:76,emptyRows:fe(s.page,s.rowsPerPage,o.length)}),e.jsx(ye,{notFound:F})]})]})})]}),e.jsx(Se,{page:s.page,dense:s.dense,count:o.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})]})]})}),e.jsx(Ge,{open:n.value,onClose:n.onFalse})]})};function $e({inputData:t,comparator:r,filters:s,dateError:m}){const{status:n,name:i,startDate:l,endDate:d}=s,g=t.map((o,u)=>[o,u]);return g.sort((o,u)=>{const j=r(o[0],u[0]);return j!==0?j:o[1]-u[1]}),t=g.map(o=>o[0]),i&&(t=t.filter(o=>o.id.toString().indexOf(i.toLowerCase())!==-1||o.topic.toLowerCase().indexOf(i.toLowerCase())!==-1||o.priority.toLowerCase().indexOf(i.toLowerCase())!==-1)),n!=="all"&&(t=t.filter(o=>o.status===n)),m||l&&d&&(t=t.filter(o=>de(o.createdAt,l,d))),t}const Je={title:`Tickets list | Dashboard - ${me.site.name}`};function ts(){const t=H({queryKey:["tickets"],queryFn:async()=>{const{data:s}=await C.get(b.tickets.list);return s}}),r=H({queryKey:["tickets","analytics"],queryFn:async()=>{const{data:s}=await C.get(b.tickets.analytics);return s}});return r.isLoading||t.isLoading?e.jsx(z,{}):t.isError||r.isError?e.jsx(J,{route:D.dashboard.tickets.root}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{children:e.jsxs("title",{children:[" ",Je.title]})}),e.jsx(_e,{tickets:t.data,analytics:r})]})}export{ts as default};

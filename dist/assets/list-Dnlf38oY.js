import{w as R,bG as H,j as e,L as G,S as w,A as W,B as v,aK as k,aL as J,du as V,y as O,I as j,dj as $,aB as z,dz as U,bI as _,bJ as y,e as F,r as m,ep as X,o as Y,b as Z,dC as ee,eq as te,dL as ae,p as b,eb as se,G as g,R as re,ee as C,aF as oe,dB as ne,er as le,dM as L,dK as I,dN as ie,ef as de,H as ce,C as pe}from"./index-C-IhHuTJ.js";import{u as M,E as me}from"./error-block-BR6CrtTz.js";import{u as he}from"./useMutation-CsQJW4rY.js";import{C as ue}from"./custom-breadcrumbs-uFAKtVA_.js";import{u as xe,g as ge,r as je,T as ye,a as be,e as Ce}from"./table-selected-action-BOiNrM4L.js";import{T as fe}from"./table-no-data-CPZHThY_.js";import{T as A,a as we,b as ve,c as Se}from"./table-head-custom-c1vpDJbN.js";import{T as Pe}from"./table-pagination-custom-RNRyjqlB.js";import{A as f}from"./app-widget-summary-CtMHYyvl.js";import{b as B}from"./format-number-DBz3y1Zx.js";import{C as De}from"./confirm-dialog-CKBnhmtr.js";import{T as x}from"./TableCell-YKx_Gzup.js";import{T as Te}from"./TextField-9UQBwjuM.js";import{I as Re}from"./InputAdornment-epef3vq8.js";import{S as Le}from"./Select-aS6O7ajU.js";import{F as Ie,a as P,c as D}from"./filters-result-CL5afXpK.js";import{C as T}from"./Chip-DE7nSvgd.js";import"./order-payment-details-dialog-afyOy_y4.js";import"./incrementer-button-DdfFaMBt.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-OM-b9iKh.js";import"./empty-content-CHLoRVuk.js";import"./TablePagination-CKbxZQl-.js";import"./LastPage-C_sr1jh1.js";import"./InputBase-T30htlau.js";import"./formControlState-Dq1zat_P.js";import"./utils-DoM3o7-Q.js";import"./FormControlLabel-BpukUZ1g.js";import"./use-chart-oEDOJJQN.js";import"./chart-legends-BzrDaW1w.js";import"./index-DW-YGTnX.js";import"./DialogContent-7B2ADHjp.js";import"./DialogTitle-DncFMmYB.js";import"./FormControl-Cqn5KMTu.js";import"./InputLabel-Di_kJ4FW.js";import"./FormLabel-Cjr_5zdF.js";import"./FormHelperText-Bk0TYkV4.js";import"./Menu-CrioubDI.js";import"./form-provider-CBudI90v.js";import"./Rating-aPX_sh3H.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-D_zyis-v.js";import"./index-BbzwuQnk.js";import"./Slider-DLXe-CaB.js";import"./RadioGroup-CONsuzNK.js";import"./FormGroup-DsmEYSPW.js";import"./countries-DSLisFCy.js";import"./Autocomplete-NiW7S513.js";import"./country-select-CMj3wYaW.js";import"./upload-avatar-BSr4Zgme.js";import"./image-Bf3dx3WP.js";import"./DatePicker-DCzcHVvE.js";import"./ListItem-DoDVqw_C.js";import"./MobileDateTimePicker-BipeM__l.js";import"./schema-helper-BFbJmRWY.js";import"./LoadingButton-Ecj7QQSO.js";import"./CircularProgress-x3I-4L2K.js";function ke({row:t,selected:r,onViewRow:a,onSelectRow:h,onDeleteRow:c}){const i=R(),l=R(),n=H(),p=e.jsxs(A,{hover:!0,selected:r,children:[e.jsx(x,{children:e.jsx(G,{color:"inherit",onClick:a,underline:"always",sx:{cursor:"pointer"},children:t.id})}),e.jsx(x,{children:e.jsxs(w,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(W,{alt:t.customer.name,src:t.customer.avatar}),e.jsxs(w,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsx(v,{component:"span",children:t.customer.name}),e.jsx(v,{component:"span",sx:{color:"text.disabled"},children:t.customer.email})]})]})}),e.jsx(x,{children:e.jsx(k,{primary:J(t.orderDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsxs(x,{align:"center",children:[" ",t.totalOrderAmount," "]}),e.jsxs(x,{children:[" ",B(t.totalOrderAmount)," "]}),e.jsx(x,{children:e.jsx(V,{variant:"soft",color:t.status==="Ready"&&"info"||t.status==="InProcess"&&"warning"||t.status==="Delivered"&&"success"||"default",children:t.status})}),e.jsxs(x,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(O,{color:l.value?"inherit":"default",onClick:l.onToggle,sx:{...l.value&&{bgcolor:"action.hover"}},children:e.jsx(j,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(O,{color:n.open?"inherit":"default",onClick:n.onOpen,children:e.jsx(j,{icon:"eva:more-vertical-fill"})})]})]}),o=e.jsx(A,{children:e.jsx(x,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx($,{in:l.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(z,{sx:{m:1.5},children:t.productToOrder.map(d=>e.jsxs(w,{direction:"row",alignItems:"center",sx:{p:u=>u.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:u=>`solid 2px ${u.vars.palette.background.neutral}`}},children:[e.jsx(k,{primary:d.product.name,secondary:d.sku,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs("div",{children:["x",d.quantity," "]}),e.jsx(v,{sx:{width:110,textAlign:"right"},children:B(d.product.price)})]},d.id))})})})});return e.jsxs(e.Fragment,{children:[p,o,e.jsx(U,{open:n.open,anchorEl:n.anchorEl,onClose:n.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(_,{children:[e.jsxs(y,{onClick:()=>{a(),n.onClose()},children:[e.jsx(j,{icon:"solar:eye-bold"}),"View"]}),e.jsxs(y,{onClick:()=>{i.onTrue(),n.onClose()},sx:{color:"error.main"},children:[e.jsx(j,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),e.jsx(De,{open:i.value,onClose:i.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(F,{variant:"contained",color:"error",onClick:c,children:"Delete"})})]})}function Oe({filters:t,onResetPage:r}){const[a,h]=m.useState("all"),c=m.useCallback(l=>{r(),t.setState({name:l.target.value})},[t,r]),i=m.useCallback(l=>{r(),t.setState({status:l.target.value}),h(l.target.value)},[t,r]);return e.jsxs(w,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:[e.jsx(Te,{sx:{width:420},value:t.state.name,onChange:c,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(Re,{position:"start",children:e.jsx(j,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(Le,{sx:{width:420,textTransform:"capitalize"},value:a,onChange:i,children:[e.jsx(y,{value:"all",children:"All Orders"}),e.jsx(y,{value:"InProcess",children:"Processing"}),e.jsx(y,{value:"Ready",children:"Ready To Deliver"}),e.jsx(y,{value:"Delivered",children:"Delivered"})]})]})}function Me({filters:t,totalResults:r,onResetPage:a,sx:h}){const c=m.useCallback(()=>{a(),t.setState({name:""})},[t,a]),i=m.useCallback(()=>{a(),t.setState({status:"all"})},[t,a]),l=m.useCallback(()=>{a(),t.setState({startDate:null,endDate:null})},[t,a]),n=m.useCallback(()=>{a(),t.onResetState()},[t,a]);return e.jsxs(Ie,{totalResults:r,onReset:n,sx:h,children:[e.jsx(P,{label:"Status:",isShow:t.state.status!=="all",children:e.jsx(T,{...D,label:t.state.status,onDelete:i,sx:{textTransform:"capitalize"}})}),e.jsx(P,{label:"Date:",isShow:!!(t.state.startDate&&t.state.endDate),children:e.jsx(T,{...D,label:X(t.state.startDate,t.state.endDate),onDelete:l})}),e.jsx(P,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(T,{...D,label:t.state.name,onDelete:c})})]})}const Ae=[{id:"orderNumber",label:"#",width:88},{id:"name",label:"Customer"},{id:"createdAt",label:"Date",width:140},{id:"totalQuantity",label:"Items",width:120,align:"center"},{id:"totalAmount",label:"Price",width:140},{id:"status",label:"Status",width:110},{id:"",width:88}];function Be({orders:t,analytics:r}){const a=xe({defaultOrderBy:"orderId"}),h=Y(),c=Z();R();const[i,l]=m.useState(()=>t),n=ee({name:"",status:"all",startDate:null,endDate:null});m.useEffect(()=>{l(t)},[t]);const p=te(n.state.startDate,n.state.endDate),o=Fe({inputData:i,comparator:ge(a.order,a.orderBy),filters:n.state,dateError:p}),d=je(o,a.page,a.rowsPerPage),u=!!n.state.name||n.state.status!=="all"||!!n.state.startDate&&!!n.state.endDate,E=!o.length&&u||!o.length,S=ae(),{mutate:q}=he({mutationFn:s=>L.delete(I.order.delete+s),onSuccess:async()=>{const s=i.filter(Q=>Q.id!==id);ie.success("Delete success!"),l(s),a.onUpdatePageDeleteRow(d.length)},onSettled:async()=>{await S.invalidateQueries({queryKey:["orders"]}),await S.invalidateQueries({queryKey:["orders-status"]}),await S.invalidateQueries({queryKey:["orders","analytics"]})},onError:()=>{}}),K=m.useCallback(s=>{q(s)},[d.length,a,i]),N=m.useCallback(s=>{h.replace(b.dashboard.order.details(s))},[h]);return e.jsx(se,{maxWidth:"xl",children:e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{xs:12,md:12,children:e.jsx(ue,{links:[{name:"Dashboard",href:b.dashboard.root},{name:"Order",href:b.dashboard.order.root},{name:"List"}],action:e.jsx(F,{component:re,href:b.dashboard.order.new,variant:"contained",startIcon:e.jsx(j,{icon:"mingcute:add-line"}),children:"New Order"})})}),e.jsx(g,{xs:12,md:3,children:e.jsx(f,{title:"All Orders",total:t.length,chart:{categories:r.data.lastSixMonth.map(s=>C(s==null?void 0:s.inMonth)),series:r.data.lastSixMonth.map(s=>s==null?void 0:s.ClaimsPerMonth)}})}),e.jsx(g,{xs:12,md:3,children:e.jsx(f,{title:"Processing Order",total:r.data.analytics.InProcess,chart:{colors:[c.vars.palette.warning.light],categories:r.data.inProcessLastSixMonth.map(s=>C(s==null?void 0:s.inMonth)),series:r.data.inProcessLastSixMonth.map(s=>s==null?void 0:s.ClaimsPerMonth)}})}),e.jsx(g,{xs:12,md:3,children:e.jsx(f,{title:"Ready To Deliver Order",total:r.data.analytics.Ready,chart:{colors:[c.vars.palette.info.main],categories:r.data.readyLastSixMonth.map(s=>C(s==null?void 0:s.inMonth)),series:r.data.readyLastSixMonth.map(s=>s==null?void 0:s.ClaimsPerMonth)}})}),e.jsx(g,{xs:12,md:3,children:e.jsx(f,{title:"Delivered",total:r.data.analytics.Delivered,chart:{colors:[c.vars.palette.success.main],categories:r.data.deliveredLastSixMonth.map(s=>C(s==null?void 0:s.inMonth)),series:r.data.deliveredLastSixMonth.map(s=>s==null?void 0:s.ClaimsPerMonth)}})}),e.jsx(g,{xs:12,md:12,children:e.jsxs(oe,{children:[e.jsx(Oe,{filters:n,onResetPage:a.onResetPage,dateError:p}),u&&e.jsx(Me,{filters:n,totalResults:o.length,onResetPage:a.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(v,{sx:{position:"relative"},children:[e.jsx(ye,{dense:a.dense,numSelected:a.selected.length,rowCount:o.length}),e.jsx(ne,{sx:{minHeight:444},children:e.jsxs(we,{size:a.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(ve,{order:a.order,orderBy:a.orderBy,headLabel:Ae,rowCount:o.length}),e.jsxs(Se,{children:[o.slice(a.page*a.rowsPerPage,a.page*a.rowsPerPage+a.rowsPerPage).map(s=>e.jsx(ke,{row:s,selected:a.selected.includes(s.id),onSelectRow:()=>a.onSelectRow(s.id),onDeleteRow:()=>K(s.id),onViewRow:()=>N(s.id)},s.id)),e.jsx(be,{height:a.dense?56:76,emptyRows:Ce(a.page,a.rowsPerPage,o.length)}),e.jsx(fe,{notFound:E})]})]})})]}),e.jsx(Pe,{page:a.page,dense:a.dense,count:o.length,rowsPerPage:a.rowsPerPage,onPageChange:a.onChangePage,onChangeDense:a.onChangeDense,onRowsPerPageChange:a.onChangeRowsPerPage})]})})]})})}function Fe({inputData:t,comparator:r,filters:a,dateError:h}){const{status:c,name:i,startDate:l,endDate:n}=a,p=t==null?void 0:t.map((o,d)=>[o,d]);return p==null||p.sort((o,d)=>{const u=r(o[0],d[0]);return u!==0?u:o[1]-d[1]}),t=p==null?void 0:p.map(o=>o[0]),i&&(t=t.filter(o=>o.id.toString().toLowerCase().indexOf(i.toLowerCase())!==-1||o.customer.name.toLowerCase().indexOf(i.toLowerCase())!==-1||o.customer.email.toLowerCase().indexOf(i.toLowerCase())!==-1)),c!=="all"&&(t=t.filter(o=>o.status===c)),h||l&&n&&(t=t.filter(o=>le(o.createTime,l,n))),t}const Ee={title:`Order list | Dashboard - ${pe.site.name}`};function Gt(){const t=M({queryKey:["orders"],queryFn:async()=>{const{data:a}=await L.get(I.order.list);return a}}),r=M({queryKey:["orders","analytics"],queryFn:async()=>{const{data:a}=await L.get(I.order.analytics);return a}});return r.isLoading||t.isLoading?e.jsx(de,{}):t.isError||r.isError?e.jsx(me,{route:b.dashboard.order.root}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{children:e.jsxs("title",{children:[" ",Ee.title]})}),e.jsx(Be,{orders:t.data,analytics:r})]})}export{Gt as default};

import{w as j,bG as z,j as e,aL as Y,y as O,I as b,dz as W,bI as G,ep as w,bJ as J,e as R,bM as x,r as p,D as L,S as B,dC as V,er as U,dL as $,eb as X,p as I,aF as Z,B as ee,dB as te,dM as y,dK as f,dN as S,ef as ae,H as se,C as re}from"./index-Bm3rBIkL.js";import{u as oe,E as ne}from"./error-block-BO5MDXKX.js";import{u as T}from"./useMutation-BPy7H-1h.js";import{C as ie}from"./custom-breadcrumbs-DgyWxDBR.js";import{P as A}from"./permission-access-controller-Bd1g1bvY.js";import{u as le,g as de,r as ce,T as me,a as pe,e as ue}from"./table-selected-action-FGFYoCf9.js";import{T as he}from"./table-no-data-C5ESOE9S.js";import{T as xe,a as ge,b as je,c as ye}from"./table-head-custom-fAI8azNC.js";import{T as fe}from"./table-pagination-custom-B5OCrP_3.js";import{C as be}from"./confirm-dialog-CdiBdWQ6.js";import{T as g}from"./TableCell-DwZUj5h4.js";import{z as Ce,u as De,t as Fe,a as Pe,F as E}from"./form-provider-BVzxbRNt.js";import"./image-BvWqJKQA.js";import"./editor-B_eq4lpY.js";import{s as v}from"./schema-helper-A2yd0njb.js";import{a as Se,b as Te,D as Ee}from"./DialogContent-adXfkuCx.js";import{D as ve}from"./DialogTitle-3zwXmVtf.js";import{L as we}from"./LoadingButton-qKaJGA43.js";import{T as Ie}from"./TextField-Zaq0_UQI.js";import{I as Ae}from"./InputAdornment-C5fdA_pt.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-DZc8qiZw.js";import"./empty-content-Bj3fPw3b.js";import"./TablePagination-xS2VmU8P.js";import"./LastPage-Bo5KhWUM.js";import"./Select-BbFY65UU.js";import"./Menu-BCmDYN65.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-CLwZiNSB.js";import"./FormControlLabel-3udn0dpo.js";import"./FormHelperText-D4MtsGiu.js";import"./Rating-DDX-0-qU.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-DEF2K-nH.js";import"./FormControl-Dpp_E6i1.js";import"./FormLabel-CW4sUJth.js";import"./RadioGroup-CcFDuSjI.js";import"./FormGroup-C2nO5a7k.js";import"./index-I76JgJ8L.js";import"./countries-DSLisFCy.js";import"./Autocomplete-uJqWLfO9.js";import"./Chip-wb6jkBj9.js";import"./country-select-dI5VfxcM.js";import"./InputLabel-XKr5fbZR.js";import"./upload-avatar-CklA5cX-.js";import"./format-number-zZ3CkgDh.js";import"./DatePicker-BFbM1AIt.js";import"./ListItem-B8LRzQux.js";import"./MobileDateTimePicker-BrtExEWs.js";import"./index-DJLOkwgj.js";import"./CircularProgress-msI0ykgU.js";const Re=({row:t,selected:a,onDeleteRow:n,onEditRow:o})=>{const l=j(),s=z(),d=e.jsxs(xe,{hover:!0,selected:a,children:[e.jsx(g,{children:t==null?void 0:t.year}),e.jsx(g,{children:Y(t==null?void 0:t.startDate)}),e.jsx(g,{children:Y(t==null?void 0:t.endDate)}),e.jsx(g,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(O,{color:s.open?"inherit":"default",onClick:s.onOpen,children:e.jsx(b,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[d,e.jsx(W,{open:s.open,anchorEl:s.anchorEl,onClose:s.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsx(G,{children:e.jsx(A,{permission:w.EDIT_FINANCIAL_YEAR,children:e.jsxs(J,{onClick:()=>{o(),s.onClose()},children:[e.jsx(b,{icon:"solar:pen-bold"}),"Edit"]})})})}),e.jsx(be,{open:l.value,onClose:l.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(R,{variant:"contained",color:"error",onClick:n,children:"Delete"})})]})},Be=Ce.object({year:v.date({message:{required_error:"Year is required!"}}),startDate:v.date({message:{required_error:"Start date is required!"}}),endDate:v.date({message:{required_error:"End date is required!"}})}),k=({financial:t,open:a,onClose:n,handler:o})=>{const l={year:(t==null?void 0:t.year)||x(),startDate:(t==null?void 0:t.startDate)||x(),endDate:(t==null?void 0:t.endDate)||x()};p.useEffect(()=>{t&&u(l)},[t]);const[s,d]=p.useState(""),i=De({resolver:Fe(Be),defaultValues:l}),{reset:u,handleSubmit:m,formState:{isSubmitting:h}}=i,C=m(async D=>{try{const c={...D};c.year=x(c.year).format("YYYY"),t?await o({id:t.id,payload:c}):await o(c),u()}catch(c){console.log(c),d(c instanceof Error?c.message:c)}});return e.jsxs(Se,{fullWidth:!0,open:a,onClose:n,children:[e.jsx(ve,{children:"Add Financial"}),e.jsx(L,{}),!!s&&e.jsx(Alert,{severity:"error",sx:{mb:3},children:s}),e.jsxs(Pe,{methods:i,onSubmit:C,children:[e.jsx(Te,{children:e.jsxs(B,{spacing:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(1, 1fr)",lg:"repeat1, 1fr)"},children:[e.jsx(E.DatePicker,{views:["year"],format:"YYYY",label:"Year",name:"year",sx:{mt:2}}),e.jsx(E.DatePicker,{fullWidth:!0,label:"Start Date",name:"startDate",sx:{mt:2}}),e.jsx(E.DatePicker,{fullWidth:!0,label:"End Date",name:"endDate",sx:{mt:2}})]})}),e.jsx(L,{sx:{pt:1,mt:1}}),e.jsxs(Ee,{children:[e.jsx(we,{type:"submit",variant:"contained",children:t?"Save Changes":"Save"}),e.jsx(R,{color:"inherit",variant:"outlined",onClick:n,children:"Cancel"})]})]})]})},Ye=({financial:t,open:a,onClose:n,handler:o})=>e.jsx(k,{financial:t,open:a,onClose:n,handler:o});function Le({filters:t,onResetPage:a,options:n}){const o=p.useCallback(l=>{a(),t.setState({name:l.target.value})},[t,a]);return e.jsx(B,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(Ie,{sx:{width:420},value:t.state.name,onChange:o,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(Ae,{position:"start",children:e.jsx(b,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}const ke=[{id:"year",label:"Year",width:140},{id:"startDate",label:"Start Date"},{id:"endDate",label:"End Date"},{id:"",width:88}];function qe({financialYears:t}){const a=le({defaultOrderBy:"orderNumber"}),n=j(),o=j(),l=j(),[s,d]=p.useState(t),i=V({name:""}),u=U(i.state.startDate,i.state.endDate);p.useEffect(()=>{d(t)},[t]);const m=Ne({inputData:s,comparator:de(a.order,a.orderBy),filters:i.state}),h=ce(m,a.page,a.rowsPerPage),C=!!i.state.name||i.state.status!=="all"||!!i.state.startDate&&!!i.state.endDate,D=!m.length&&C||!m.length,c=p.useCallback(r=>{H(r)},[h.length,a,s]),[q,N]=p.useState(),_=p.useCallback(r=>{N(r),o.onToggle()},[h.length,a,s]),F=$(),{mutate:H}=T({mutationFn:r=>y.delete(f.financial.delete+r),onSuccess:async r=>{const P=s.filter(Q=>Q.id!==r);S.success("Delete success!"),d(P),a.onUpdatePageDeleteRow(h.length),l.onFalse()},onSettled:async()=>{await F.invalidateQueries({queryKey:["financial-year"]}),l.onFalse()},onError:()=>{}}),{mutate:M}=T({mutationFn:r=>y.post(f.financial.create,r),onSuccess:async()=>{S.success("New Financial Year Has Been Created!")},onSettled:async()=>{await F.invalidateQueries({queryKey:["financial-year"]}),n.onFalse()},onError:r=>{console.log(r)}}),{mutate:K}=T({mutationFn:({id:r,payload:P})=>y.patch(f.financial.edit+r,P),onSuccess:async()=>{S.success("Financial Year Has Been Modified!")},onSettled:async()=>{await F.invalidateQueries({queryKey:["financial-year"]}),o.onFalse()},onError:r=>{console.log(r)}});return e.jsxs(X,{children:[e.jsxs(B,{spacing:3,children:[e.jsx(ie,{links:[{name:"Dashboard",href:I.dashboard.root},{name:"Tools",href:I.dashboard.tools.root},{name:"Financial Year"}],sx:{mb:{xs:3,md:5}},action:e.jsx(A,{permission:w.ADD_FINANCIAL_YEAR,children:e.jsx(R,{onClick:()=>n.onToggle(),variant:"contained",startIcon:e.jsx(b,{icon:"mingcute:add-line"}),children:"Add Financial Year"})})}),e.jsx(A,{permission:w.FINANCIAL_LIST,children:e.jsxs(Z,{children:[e.jsx(Le,{filters:i,onResetPage:a.onResetPage,dateError:u}),e.jsxs(ee,{sx:{position:"relative"},children:[e.jsx(me,{dense:a.dense,numSelected:a.selected.length,rowCount:m.length}),e.jsx(te,{sx:{minHeight:444},children:e.jsxs(ge,{size:a.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(je,{order:a.order,orderBy:a.orderBy,headLabel:ke,rowCount:m.length}),e.jsxs(ye,{children:[m.slice(a.page*a.rowsPerPage,a.page*a.rowsPerPage+a.rowsPerPage).map(r=>e.jsx(Re,{row:r,selected:a.selected.includes(r.id),onEditRow:()=>_(r),onDeleteRow:()=>c(r.id)},r.id)),e.jsx(pe,{height:a.dense?56:76,emptyRows:ue(a.page,a.rowsPerPage,m.length)}),e.jsx(he,{notFound:D})]})]})})]}),e.jsx(fe,{page:a.page,dense:a.dense,count:m.length,rowsPerPage:a.rowsPerPage,onPageChange:a.onChangePage,onChangeDense:a.onChangeDense,onRowsPerPageChange:a.onChangeRowsPerPage})]})})]}),e.jsx(k,{open:n.value,onClose:n.onFalse,handler:M}),e.jsx(Ye,{financial:q,open:o.value,onClose:o.onFalse,handler:K})]})}function Ne({inputData:t,comparator:a,filters:n}){const{name:o}=n,l=t.map((s,d)=>[s,d]);return l.sort((s,d)=>{const i=a(s[0],d[0]);return i!==0?i:s[1]-d[1]}),t=l.map(s=>s[0]),o&&(t=t.filter(s=>s.year.toLowerCase().indexOf(o.toLowerCase())!==-1)),t}const _e={title:`Tools | Dashboard - ${re.site.name}`};function Ht(){const t=oe({queryKey:["financial-year"],queryFn:async()=>{const{data:a}=await y.get(f.financial.list);return a}});return t.isPending||t.isLoading?e.jsx(ae,{}):t.isError?e.jsx(ne,{route:I.dashboard.tools.root}):e.jsxs(e.Fragment,{children:[e.jsx(se,{children:e.jsxs("title",{children:[" ",_e.title]})}),e.jsx(qe,{financialYears:t.data})]})}export{Ht as default};

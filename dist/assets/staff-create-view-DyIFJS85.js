import{dL as B,o as P,r as h,w as q,dM as g,dK as j,dN as l,p as d,j as e,aF as y,S as k,T as N,B as x,y as G,I as M,e as w,eb as D}from"./index-C-IhHuTJ.js";import{C as L}from"./custom-breadcrumbs-uFAKtVA_.js";import{z as o,u as Q,t as V,a as R,F as t}from"./form-provider-CBudI90v.js";import{u as v}from"./useMutation-CsQJW4rY.js";import"./image-Bf3dx3WP.js";import"./editor-D_zyis-v.js";import{I as z}from"./InputAdornment-epef3vq8.js";const J=o.object({firstName:o.string().min(1,{message:"Staff firstName is required!"}),lastName:o.string().min(1,{message:"Staff lastName is required!"}),password:o.string().min(1,{message:"Password is required!"}).min(8,{message:"Password must be at least 8 characters!"}),email:o.string().min(1,{message:"Email is required!"}),phoneNumber:o.string().min(1,{message:"Phone Number is required!"}),permissions:o.string().array().nonempty({message:"At least one permission is required!"}),isActive:o.boolean()});function K({currentStaff:s,appPermissions:i}){const c=B(),u=P(),[H,C]=h.useState(i),r=q(),p=h.useMemo(()=>({firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",phoneNumber:(s==null?void 0:s.phoneNumber)||"",email:(s==null?void 0:s.email)||"",password:(s==null?void 0:s.password)||"",isActive:(s==null?void 0:s.isActive)||!0,permissions:(s==null?void 0:s.permissions.map(a=>a.slug))||[]}),[s]),b=Q({resolver:V(J),defaultValues:p}),{reset:m,watch:O,setValue:U,handleSubmit:F,control:W,formState:{isSubmitting:I}}=b;h.useEffect(()=>{s&&m(p),i&&C(i)},[s,i,p,m]);const{mutate:E}=v({mutationFn:a=>g.post(j.staff.create,a),onSuccess:()=>{l.success("New Staff has been created successfully!"),c.invalidateQueries(["staff"]),m(),u.push(d.dashboard.staff.root)},onError:a=>{console.error(a),l.error("Failed to save staff. Please try again.")}}),{mutate:T}=v({mutationFn:({id:a,payload:n})=>g.patch(j.staff.edit+a,n),onSuccess:()=>{l.success("Staff updated successfully!");const{id:a}=s;c.invalidateQueries(["staff",a]),m(),u.push(d.dashboard.staff.root)},onError:a=>{console.error(a),l.error("Failed to edit staff. Please try again.")}}),A=F(async a=>{try{if(s!=null&&s.id){const{id:n}=s;await T({id:n,payload:a})}else await E(a)}catch(n){console.error(n)}});return e.jsxs(R,{methods:b,onSubmit:A,children:[e.jsx(y,{sx:{mb:4},children:e.jsxs(k,{spacing:4,sx:{p:3},children:[e.jsx(N,{variant:"h6",gutterBottom:!0,children:"Staff Details"}),e.jsxs(x,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(3, 1fr)"},children:[e.jsx(t.Text,{label:"First Name",name:"firstName"}),e.jsx(t.Text,{label:"Last Name",name:"lastName"}),e.jsx(t.Phone,{name:"phoneNumber",label:"Phone number"}),e.jsx(t.Text,{label:"Email",name:"email"}),e.jsx(t.Text,{name:"password",label:"Password",placeholder:"8+ characters",type:r.value?"text":"password",InputLabelProps:{shrink:!0},InputProps:{endAdornment:e.jsx(z,{position:"end",children:e.jsx(G,{onClick:r.onToggle,edge:"end",children:e.jsx(M,{icon:r.value?"solar:eye-bold":"solar:eye-closed-bold"})})})}})]})]})}),e.jsxs(y,{sx:{p:4},children:[e.jsx(N,{variant:"h6",gutterBottom:!0,sx:{mb:4},children:"Permissions"}),e.jsx(x,{display:"flex",justifyContent:"center",alignItems:"center",sx:{mb:4},children:e.jsx(t.MultiCheckbox,{name:"permissions",options:i.map(a=>({label:a.name,value:a.slug})),sx:{display:"grid",columnGap:4,rowGap:4,gridTemplateColumns:"repeat(4, 1fr)"}})}),e.jsx(t.Switch,{name:"isActive",label:"Is Active?"}),e.jsxs(x,{display:"flex",justifyContent:"flex-end",mt:2,children:[e.jsx(w,{type:"submit",variant:"contained",disabled:I,children:"Submit"}),e.jsx(w,{variant:"outlined",onClick:()=>m(),sx:{ml:2},children:"Cancel"})]})]})]})}function ss({currentStaff:s,appPermissions:i}){return e.jsxs(D,{children:[e.jsx(L,{links:[{name:"Dashboard",href:d.dashboard.root},{name:"Staff",href:d.dashboard.staff.root},{name:"New Staff"}],sx:{mb:{xs:3,md:5}}}),e.jsx(K,{currentStaff:s,appPermissions:i})]})}export{ss as S};

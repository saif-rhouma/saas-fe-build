import{w as F,bI as Y,j as e,aN as $,y as z,I as f,dB as U,bK as _,bL as L,e as N,r as h,dN as Q,dO as b,dM as w,bO as C,D as J,S as E,B as H,T as X,dD as V,dE as Z,er as ee,ed as te,p as R,aH as se,es as oe,dP as q,eh as ae,H as ie,C as ne}from"./index-C2cM-DBs.js";import{u as re,E as le}from"./error-block-Beq63EG2.js";import{u as v}from"./useMutation-COmH0tpK.js";import{C as de}from"./custom-breadcrumbs--nSnnPdf.js";import{u as ce,g as me,r as pe,T as he,a as ue,e as xe}from"./table-selected-action-DWceq44n.js";import{T as ge}from"./table-no-data-CW8mts6A.js";import{T as fe,a as je,b as Ce,c as be}from"./table-head-custom-DDkWjoUi.js";import{T as we}from"./table-pagination-custom-DIp1A-kw.js";import{C as De}from"./confirm-dialog-Dt-1J2Vi.js";import{T as P}from"./TableCell-BcDGB2Q3.js";import{z as A,u as ye,t as Te,F as Pe}from"./form-provider-CLORH2Dm.js";import{b as Se}from"./upload-avatar-OInrLzQK.js";import"./image-CAg2ZcR_.js";import{F as S}from"./fields-BDiywkX5.js";import"./editor-BI5ptJ30.js";import{s as K}from"./schema-helper-BxubE0SK.js";import{a as Fe,b as ve,D as Ee}from"./DialogContent-BpSW4FhH.js";import{D as Be}from"./DialogTitle-DddmK_y9.js";import{L as Ie}from"./LoadingButton-C7S0WlDO.js";import{T as ke}from"./TextField-CfPa8tf7.js";import{I as Le}from"./InputAdornment-nAtlisNJ.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./Checkbox-k7mydEE9.js";import"./empty-content-s5rnlcMr.js";import"./TablePagination-ihJAWnwP.js";import"./LastPage-Bf1N2SjU.js";import"./Select-BbsMkxhi.js";import"./Menu-IfQzjKGx.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-BLNKgjL-.js";import"./FormControlLabel-CjAWsVO-.js";import"./index-DqEqkcv6.js";import"./countries-DSLisFCy.js";import"./format-number-B33p9vL5.js";import"./FormHelperText-CRGkNn8K.js";import"./Rating-CBpe5Nat.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-vNG1DJM-.js";import"./FormControl-CiDtqBG4.js";import"./FormLabel-DnduTJzv.js";import"./RadioGroup-COXiBNW9.js";import"./FormGroup-pWlzYSFu.js";import"./Autocomplete-Dls-OWLW.js";import"./Chip-C1uF1Tma.js";import"./country-select-D13_g16H.js";import"./InputLabel-DLkxXyQ2.js";import"./DatePicker-DDCPQeC5.js";import"./ListItem-BfmlJSaG.js";import"./MobileDateTimePicker--hVS8Apv.js";import"./index-9mfm1ewC.js";import"./CircularProgress-CfhTfJpo.js";const qe=({row:t,selected:s,onViewRow:d,onDeleteRow:n,onEditRow:m})=>{const r=F(),i=Y(),c=e.jsxs(fe,{hover:!0,selected:s,children:[e.jsx(P,{children:t.id}),e.jsx(P,{children:$(t.reminderDate)}),e.jsx(P,{children:t.title}),e.jsx(P,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(z,{color:i.open?"inherit":"default",onClick:i.onOpen,children:e.jsx(f,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[c,e.jsx(U,{open:i.open,anchorEl:i.anchorEl,onClose:i.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(_,{children:[(t==null?void 0:t.file)&&e.jsxs(L,{onClick:()=>{d(),i.onClose()},children:[e.jsx(f,{icon:"solar:cloud-download-bold"}),"Download"]}),e.jsxs(L,{onClick:()=>{m(),i.onClose()},children:[e.jsx(f,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(L,{onClick:()=>{r.onTrue(),i.onClose()},sx:{color:"error.main"},children:[e.jsx(f,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),e.jsx(De,{open:r.value,onClose:r.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(N,{variant:"contained",color:"error",onClick:n,children:"Delete"})})]})},Ae=A.object({title:A.string().min(1,{message:"title is required!"}),description:A.string().min(1,{message:"Description is required!"}),date:K.date({message:{required_error:"Date is required!"}}),time:K.date({message:{required_error:"Time is required!"}})}),G=({currentReminder:t,open:s,onClose:d,handler:n})=>{const m=h.useRef(t);//! Upload Logic START
const[r,i]=h.useState(),c=h.useCallback(l=>{const o=l[0];i(()=>o)},[]),x=()=>{i(null)},a=Q(),u={headers:{"content-type":"multipart/form-data"}},{mutate:g}=v({mutationFn:l=>b.post(w.files.upload,l,u),onSuccess:async({data:l})=>{const{name:o}=l;if(o){const{current:p}=m;p.file=o,delete p.time,delete p.date,t?await n({id:t.id,payload:p}):await n(p)}return l},onSettled:async()=>{i(null),await a.invalidateQueries({queryKey:["reminders-images"]})},onError:l=>{console.log(l)}});//! Upload Logic END
const D=h.useMemo(()=>({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",date:(t==null?void 0:t.reminderDate)||C(),time:(t==null?void 0:t.reminderDate)||C()}),[t]);h.useEffect(()=>{t&&T(D)},[t]);const y=ye({resolver:Te(Ae),defaultValues:D}),{reset:T,watch:O,setValue:M,handleSubmit:j,formState:{isSubmitting:W}}=y,B=j(async l=>{try{const o=C(l.date).format("YYYY-MM-DD"),p=C(l.time).format("HH:mm:ss"),I=C(`${o}T${p}`).toISOString();if(l.reminderDate=I,r){m.current={...l};const k=new FormData;k.append("file",r),k.append("category","Reminder"),await g(k)}else t?await n({id:t.id,payload:l}):await n(l);d(),m.current={},T()}catch(o){console.error(o)}});return e.jsxs(Fe,{fullWidth:!0,maxWidth:"md",open:s,onClose:d,children:[e.jsx(Be,{children:t?"Edit Reminder":"Add Reminder"}),e.jsxs(Pe,{methods:y,onSubmit:B,children:[e.jsxs(ve,{children:[e.jsx(J,{}),e.jsxs(E,{spacing:2,sx:{pt:4,pb:1},children:[e.jsxs(H,{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(1, 1fr)",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)"},children:[e.jsx(S.DatePicker,{fullWidth:!0,label:"Date",name:"date",sx:{flexGrow:1}}),e.jsx(S.TimePicker,{label:"Time",name:"time",sx:{flexGrow:1}}),e.jsx(S.Text,{fullWidth:!0,name:"title",label:"Title",sx:{flexGrow:1}}),e.jsx(S.Text,{fullWidth:!0,name:"description",label:"Description",sx:{flexGrow:1}})]}),e.jsx(H,{children:e.jsxs(E,{spacing:1.5,children:[e.jsx(X,{variant:"subtitle2",children:"Attachments"}),e.jsx(V,{sx:{maxHeight:360,p:2},children:e.jsx(Se,{value:r,onDrop:c,onDelete:x})})]})})]})]}),e.jsxs(Ee,{children:[e.jsx(Ie,{type:"submit",variant:"contained",children:t?"Save Changes":"Save"}),e.jsx(N,{color:"inherit",variant:"outlined",onClick:d,children:"Cancel"})]})]})]})},He=({reminder:t,open:s,onClose:d,handler:n})=>e.jsx(G,{currentReminder:t,open:s,onClose:d,handler:n});function Re({filters:t,onResetPage:s,options:d}){const n=h.useCallback(m=>{s(),t.setState({name:m.target.value})},[t,s]);return e.jsx(E,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(ke,{sx:{width:420},value:t.state.name,onChange:n,placeholder:"Search customer or order number...",InputProps:{startAdornment:e.jsx(Le,{position:"start",children:e.jsx(f,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}const Ne=[{id:"reminderId",label:"#",width:140},{id:"date",label:"Date",width:280},{id:"title",label:"Title"},{id:"",width:88}],Oe=({reminders:t})=>{const s=ce({defaultOrderBy:"orderNumber"}),d=F(),n=F(),m=F(),[r,i]=h.useState(t),c=Z({name:"",status:"all",startDate:null,endDate:null}),x=ee(c.state.startDate,c.state.endDate);h.useEffect(()=>{i(t)},[t]);const a=We({inputData:r,comparator:me(s.order,s.orderBy),filters:c.state,dateError:x}),u=pe(a,s.page,s.rowsPerPage),g=!!c.state.name||c.state.status!=="all"||!!c.state.startDate&&!!c.state.endDate,D=!a.length&&g||!a.length,y=h.useCallback(o=>{W(o)},[u.length,s,r]),[T,O]=h.useState(),M=h.useCallback(o=>{O(o),n.onToggle()},[u.length,s,r]),j=Q(),{mutate:W}=v({mutationFn:o=>b.delete(w.reminders.delete+o),onSuccess:async o=>{const p=r.filter(I=>I.id!==o);q.success("Delete success!"),i(p),s.onUpdatePageDeleteRow(u.length),m.onFalse()},onSettled:async()=>{await j.invalidateQueries({queryKey:["reminders"]}),m.onFalse()},onError:()=>{}}),{mutate:B}=v({mutationFn:o=>b.post(w.reminders.create,o),onSuccess:async()=>{q.success("New Reminder Has Been Created!")},onSettled:async()=>{await j.invalidateQueries({queryKey:["reminders"]}),d.onClose()},onError:o=>{console.log(o)}}),{mutate:l}=v({mutationFn:({id:o,payload:p})=>b.patch(w.reminders.edit+o,p),onSuccess:async()=>{q.success("New Reminder Has Been Modified!")},onSettled:async()=>{await j.invalidateQueries({queryKey:["reminders"]}),n.onClose()},onError:o=>{console.log(o)}});return e.jsxs(e.Fragment,{children:[e.jsx(te,{maxWidth:"xl",children:e.jsxs(E,{spacing:3,children:[e.jsx(de,{links:[{name:"Dashboard",href:R.dashboard.root},{name:"Reminders",href:R.dashboard.reminders.root}],action:e.jsx(N,{onClick:()=>d.onToggle(),variant:"contained",startIcon:e.jsx(f,{icon:"mingcute:add-line"}),children:"Add Reminder"})}),e.jsxs(se,{children:[e.jsx(Re,{filters:c,onResetPage:s.onResetPage,dateError:x}),e.jsxs(H,{sx:{position:"relative"},children:[e.jsx(he,{dense:s.dense,numSelected:s.selected.length,rowCount:a.length}),e.jsx(V,{sx:{minHeight:444},children:e.jsxs(je,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Ce,{order:s.order,orderBy:s.orderBy,headLabel:Ne,rowCount:a.length}),e.jsxs(be,{children:[a.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(o=>e.jsx(qe,{row:o,selected:s.selected.includes(o.id),onEditRow:()=>M(o),onDeleteRow:()=>y(o.id),onViewRow:()=>handleViewRow(o.id)},o.id)),e.jsx(ue,{height:s.dense?56:76,emptyRows:xe(s.page,s.rowsPerPage,a.length)}),e.jsx(ge,{notFound:D})]})]})})]}),e.jsx(we,{page:s.page,dense:s.dense,count:a.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})]})}),e.jsx(G,{open:d.value,onClose:d.onFalse,handler:B}),e.jsx(He,{reminder:T,open:n.value,onClose:n.onFalse,handler:l})]})},Me=Oe;function We({inputData:t,comparator:s,filters:d,dateError:n}){const{status:m,name:r,startDate:i,endDate:c}=d,x=t.map((a,u)=>[a,u]);return x.sort((a,u)=>{const g=s(a[0],u[0]);return g!==0?g:a[1]-u[1]}),t=x.map(a=>a[0]),r&&(t=t.filter(a=>a.id.toString().toLowerCase().indexOf(r.toLowerCase())!==-1||a.title.toLowerCase().indexOf(r.toLowerCase())!==-1||a.description.toLowerCase().indexOf(r.toLowerCase())!==-1)),m!=="all"&&(t=t.filter(a=>a.status===m)),n||i&&c&&(t=t.filter(a=>oe(a.createdAt,i,c))),t}const Ke={title:`Reminders list | Dashboard - ${ne.site.name}`};function Qt(){const t=re({queryKey:["reminders"],queryFn:async()=>{const{data:s}=await b.get(w.reminders.list);return s}});return t.isPending||t.isLoading?e.jsx(ae,{}):t.isError?e.jsx(le,{route:R.dashboard.reminders.root}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:e.jsxs("title",{children:[" ",Ke.title]})}),e.jsx(Me,{reminders:t.data})]})}export{Qt as default};

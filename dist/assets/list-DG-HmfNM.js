import{r as P,o as E,bO as _,j as e,S as k,A as z,C as L,B as C,ds as K,w as O,I as f,dh as M,az as Q,aI as W,ew as $,dw as G,bQ as V,em as R,bR as q,e as U,l as w,dz as J,eo as X,p as y,dI as Y,e8 as Z,G as S,R as ee,aD as te,cM as se,dy as re,ep as oe,dJ as B,dH as F,dK as ae,ec as ne,H as ie}from"./index-DCM0dqKu.js";import{u as H,E as le}from"./error-block-DeCjSF4t.js";import"./product-review-new-form-BWQw19aP.js";import"./index-BRWDmL20.js";import"./image-DskMD1i2.js";import"./color-preview-BVNm9jJp.js";import{u as de}from"./useMutation-D2La3F2r.js";import{C as ce}from"./custom-breadcrumbs-IetWuDPQ.js";import{P as v}from"./permission-access-controller-BgXcwVE8.js";import{u as pe,g as me,r as ue,T as he,a as xe,e as ge}from"./table-selected-action-7WjA_XRC.js";import{T as je}from"./table-no-data-DG1YJIcm.js";import{T as N,a as fe,b as Pe,c as be}from"./table-head-custom-BoFwl8d4.js";import{T as Ce}from"./table-pagination-custom-COA0RpS-.js";import{b as A}from"./format-number-BQ7t0qkw.js";import{C as ye}from"./confirm-dialog-BBBRv5VF.js";import{T as j}from"./TableCell-COeTtVrZ.js";import{T as Te}from"./TextField-n063yImk.js";import{I as De}from"./InputAdornment-DO0FXlwx.js";import{P as Re}from"./product-table-filters-result-Epa2S_A_.js";import"./form-provider-CsXzZQi6.js";import"./editor-DskST7D0.js";import"./incrementer-button-CC-rEf7B.js";import"./carousel-progress-bar-Go7QvEqy.js";import"./html-to-markdown-DAs27kOg.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./product-Item-button-DxaDdbMO.js";import"./upload-avatar-QqSqRao9.js";import"./FormHelperText-DqZjaKA5.js";import"./formControlState-Dq1zat_P.js";import"./index-BdcQkSNX.js";import"./DialogContent-BFR1QZgD.js";import"./DialogTitle-DthX4Z2k.js";import"./LoadingButton-CNUTqo8f.js";import"./CircularProgress-CObVdEvj.js";import"./AccordionSummary-Dl_TwcP0.js";import"./Checkbox-bK399IpG.js";import"./empty-content-CBh9MUbL.js";import"./TablePagination-DnPqO4b4.js";import"./KeyboardArrowRight-CIlbmAZJ.js";import"./LastPage-DhTfx2BG.js";import"./Select-BfBEUDqV.js";import"./Menu-DUao5Yoh.js";import"./utils-DoM3o7-Q.js";import"./InputBase-DTC7mqIN.js";import"./FormControlLabel-DzI7o2_A.js";import"./FormControl-CzeO_UtU.js";import"./InputLabel-D4P0yivD.js";import"./FormLabel-sPKOeIzp.js";import"./filters-result-CbksVm1D.js";import"./Chip-B7AXZfmm.js";import"./Rating-bGgbH5MB.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-DbZp1IuP.js";import"./RadioGroup-Dwnhy8-J.js";import"./FormGroup-B2wxUdmP.js";import"./countries-DSLisFCy.js";import"./Autocomplete-B8SRK5t2.js";import"./country-select-D81VscAm.js";import"./DatePicker-BHh4WHnP.js";import"./ListItem-BlYb29G3.js";import"./MobileDateTimePicker-B4xWrI2C.js";import"./Tabs-D0Tq82TW.js";import"./index-BWYPRE2-.js";const ve=({row:t,index:l,taxPercentage:s,selected:u,onDeleteRow:h,onEditRow:c})=>{var T;const[x,i]=P.useState((t==null?void 0:t.productToOrder.filter(o=>{var d;return((d=o==null?void 0:o.order)==null?void 0:d.status)==="Delivered"}).length)>0),p=E(),r=E(),n=_(),g=e.jsxs(N,{hover:!0,selected:u,children:[e.jsx(j,{children:l||(t==null?void 0:t.id)}),e.jsx(j,{children:e.jsxs(k,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(z,{alt:t==null?void 0:t.name,src:L.site.serverFileHost+((t==null?void 0:t.image)||L.site.defaultImgPlaceHolder)}),e.jsx(C,{component:"span",children:t==null?void 0:t.name})]})}),e.jsx(j,{children:A(t==null?void 0:t.price)}),e.jsxs(j,{align:"center",children:[" ",((T=t==null?void 0:t.stock)==null?void 0:T.quantity)||"0"," "]}),e.jsx(j,{children:e.jsx(K,{variant:"soft",color:t.isActive===!0&&"success"||t.isActive===!1&&"error"||"default",children:t!=null&&t.isActive?"ACTIVE":"INACTIVE"})}),e.jsxs(j,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[x&&e.jsx(O,{color:r.value?"inherit":"default",onClick:r.onToggle,sx:{...r.value&&{bgcolor:"action.hover"}},children:e.jsx(f,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(O,{color:n.open?"inherit":"default",onClick:n.onOpen,children:e.jsx(f,{icon:"eva:more-vertical-fill"})})]})]}),I=e.jsx(N,{children:e.jsx(j,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(M,{in:r.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(Q,{sx:{m:1.5},children:t==null?void 0:t.productToOrder.filter(o=>{var d;return((d=o==null?void 0:o.order)==null?void 0:d.status)==="Delivered"}).map(o=>{var d,D,a,m;return e.jsxs(k,{direction:"row",alignItems:"center",sx:{p:b=>b.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:b=>`solid 2px ${b.vars.palette.background.neutral}`}},children:[e.jsx(W,{primary:`${(d=o==null?void 0:o.order)==null?void 0:d.ref}`,secondary:o.sku,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs(C,{sx:{color:"error.main",fontWeight:"bold"},children:["x",o.quantity," ",e.jsx("span",{style:{color:"#000",fontWeight:"400"},children:`(${A(o.quantity*((t==null?void 0:t.price)||0))})`})]}),e.jsx(C,{sx:{width:140,textAlign:"right"},children:(D=o.order)==null?void 0:D.status}),e.jsx(C,{sx:{width:140,textAlign:"right"},children:A($(((a=o.order)==null?void 0:a.totalOrderAmount)-((m=o.order)==null?void 0:m.discount),s))||"-"})]},o.id)})})})})});return e.jsxs(e.Fragment,{children:[g,I,e.jsx(G,{open:n.open,anchorEl:n.anchorEl,onClose:n.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(V,{children:[e.jsx(v,{permission:R.EDIT_PRODUCT,children:e.jsxs(q,{onClick:()=>{c(t.id),n.onClose()},children:[e.jsx(f,{icon:"solar:pen-bold"}),"Edit"]})}),e.jsx(v,{permission:R.DELETE_PRODUCT,children:e.jsxs(q,{onClick:()=>{p.onTrue(),n.onClose()},sx:{color:"error.main"},children:[e.jsx(f,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})})]})}),e.jsx(ye,{open:p.value,onClose:p.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(U,{variant:"contained",color:"error",onClick:h,children:"Delete"})})]})};function Ie({filters:t,onResetPage:l,options:s}){const u=P.useCallback(h=>{l(),t.setState({name:h.target.value})},[t,l]);return e.jsx(k,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(Te,{sx:{width:420},value:t.state.name,onChange:u,placeholder:"Search by Product Name or Ref",InputProps:{startAdornment:e.jsx(De,{position:"start",children:e.jsx(f,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}const Se=[{id:"productId",label:"No.",width:80},{id:"productName",label:"Product Name"},{id:"productPrice",label:"Product Price",width:200},{id:"stock",label:"Stock",align:"center"},{id:"status",label:"Status",width:100},{id:"",width:88}];function Ae({products:t,taxPercentage:l}){const s=pe({defaultOrderBy:"planId"}),u=E(),h=w(),[c,x]=P.useState(t),i=J({name:"",status:"all",startDate:null,endDate:null});P.useEffect(()=>{x(t)},[t]);const p=X(i.state.startDate,i.state.endDate),r=Ee({inputData:c,comparator:me(s.order,s.orderBy),filters:i.state,dateError:p}),n=ue(r,s.page,s.rowsPerPage),g=!!i.state.name||i.state.status!=="all"||!!i.state.startDate&&!!i.state.endDate,I=!r.length&&g||!r.length,T=P.useCallback(a=>{D(a)},[n.length,s,c]),o=P.useCallback(a=>{h.push(y.dashboard.product.edit(a))},[h]),d=Y(),{mutate:D}=de({mutationFn:a=>B.delete(F.products.delete+a),onSuccess:async a=>{const m=c.filter(b=>b.id!==a);ae.success("Delete success!"),x(m),s.onUpdatePageDeleteRow(n.length)},onSettled:async()=>{await d.invalidateQueries({queryKey:["products"]})},onError:()=>{}});return e.jsx(Z,{maxWidth:"xl",children:e.jsxs(S,{container:!0,spacing:3,children:[e.jsx(S,{xs:12,md:12,children:e.jsx(ce,{links:[{name:"Dashboard",href:y.dashboard.root},{name:"Product",href:y.dashboard.plan.root},{name:"List"}],action:e.jsx(v,{permission:R.ADD_PRODUCT,children:e.jsx(U,{component:ee,href:y.dashboard.product.new,variant:"contained",startIcon:e.jsx(f,{icon:"mingcute:add-line"}),children:"Add New Product"})})})}),e.jsx(v,{permission:R.LIST_PRODUCT,children:e.jsx(S,{xs:12,md:12,children:e.jsxs(te,{children:[e.jsx(Ie,{filters:i,onResetPage:s.onResetPage,dateError:p}),g&&e.jsx(Re,{filters:i,totalResults:r.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(C,{sx:{position:"relative"},children:[e.jsx(he,{dense:s.dense,numSelected:s.selected.length,rowCount:r.length,onSelectAllRows:a=>s.onSelectAllRows(a,r.map(m=>m.id)),action:e.jsx(se,{title:"Delete",children:e.jsx(O,{color:"primary",onClick:u.onTrue,children:e.jsx(f,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(re,{sx:{minHeight:444},children:e.jsxs(fe,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Pe,{order:s.order,orderBy:s.orderBy,headLabel:Se,rowCount:r.length,numSelected:s.selected.length,onSort:s.onSort}),e.jsxs(be,{children:[r.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map((a,m)=>e.jsx(ve,{row:a,index:s.page*s.rowsPerPage+m+1,selected:s.selected.includes(a.id),onEditRow:()=>o(a.id),onDeleteRow:()=>T(a.id),taxPercentage:l},a.id)),e.jsx(xe,{height:s.dense?56:76,emptyRows:ge(s.page,s.rowsPerPage,r.length)}),e.jsx(je,{notFound:I})]})]})})]}),e.jsx(Ce,{page:s.page,dense:s.dense,count:r.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})})]})})}function Ee({inputData:t,comparator:l,filters:s,dateError:u}){const{status:h,name:c,startDate:x,endDate:i}=s,p=t.map((r,n)=>[r,n]);return p.sort((r,n)=>{const g=l(r[0],n[0]);return g!==0?g:r[1]-n[1]}),t=p.map(r=>r[0]),c&&(t=t.filter(r=>r.id.toString().toLowerCase().indexOf(c.toLowerCase())!==-1||r.name.toLowerCase().indexOf(c.toLowerCase())!==-1)),u||x&&i&&(t=t.filter(r=>oe(r.createdAt,x,i))),t}const ke={title:`Product list | Dashboard - ${L.site.name}`};function Mt(){const t=H({queryKey:["products"],queryFn:async()=>{const{data:s}=await B.get(F.products.list);return s}}),l=H({queryKey:["account-application"],queryFn:async()=>{const{data:s}=await B.get(F.auth.application);return s}});return l.isLoading||t.isLoading?e.jsx(ne,{}):l.isError||t.isError?e.jsx(le,{route:y.dashboard.products.root}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:e.jsxs("title",{children:[" ",ke.title]})}),e.jsx(Ae,{products:t.data,taxPercentage:l.data.taxPercentage})]})}export{Mt as default};

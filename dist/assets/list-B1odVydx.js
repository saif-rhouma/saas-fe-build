import{Y as L,dn as w,a3 as N,r as h,j as e,aa as $,$ as H,I as b,db as q,a6 as K,e4 as j,a7 as F,e as A,S as D,W as Q,de as M,e3 as O,dp as _,p as g,dQ as U,R as W,cY as z,B as Y,dd as G,ed as J,dq as y,dm as R,dr as E,dU as X,H as Z,C as ee}from"./index-88qAwG8P.js";import{u as te,E as se}from"./error-block-BTff90qR.js";import{u as v}from"./useMutation-Bjm4Nnvr.js";import{C as ae}from"./custom-breadcrumbs-x7W5GMPl.js";import{P as C}from"./permission-access-controller-BVvbpBzt.js";import{g as ne,r as oe,e as re}from"./utils-MBUcMVfY.js";import{u as ie}from"./use-table-BYPgfP9k.js";import{T as le}from"./table-no-data-wFoKraSE.js";import{T as de}from"./table-empty-rows-6krMqYw2.js";import{T as ce,a as me,b as he,c as ue}from"./table-head-custom-g2OgtrHv.js";import{T as pe}from"./table-selected-action-DnALz1xy.js";import{T as fe}from"./table-pagination-custom-Ds9-Dw8y.js";import{C as xe}from"./confirm-dialog-BdxUyq-O.js";import{T as f}from"./TableCell-Cl8UZGxf.js";import{T as ge}from"./TextField-CQpihH7F.js";import{I as be}from"./InputAdornment-Bg-m_z4_.js";import{F as je,a as Ce,c as Pe}from"./filters-result-B0DfRGbW.js";import{C as Se}from"./Chip-yDeOg34u.js";import"./utils-km2FGkQ4.js";import"./bounce-BSK3KHpz.js";import"./transition-BJzcwH5q.js";import"./empty-content-vgDCQT8r.js";import"./Checkbox-Cpc8f1GH.js";import"./TablePagination-CrnuwEMO.js";import"./KeyboardArrowRight-fE7_2VJ7.js";import"./LastPage-B6xWbdc0.js";import"./Select-DFC-Q2QB.js";import"./Menu-BDUaDfAf.js";import"./utils-DoM3o7-Q.js";import"./formControlState-Dq1zat_P.js";import"./InputBase-DD8qHu7J.js";import"./FormControlLabel-ts_MkIWE.js";import"./DialogContent-F9o-_CVT.js";import"./DialogTitle-CvyYkdF0.js";import"./FormControl-BXGEHd-f.js";import"./InputLabel-B0kOUcWA.js";import"./FormLabel-Ck5_RgM9.js";import"./FormHelperText-DA7jizKd.js";const Te=({row:t,index:s,selected:o,onEditRow:c,onDeleteRow:i,handler:l})=>{const u=L(),{t:r}=w("staff"),d=N(),[a,m]=h.useState(t==null?void 0:t.isActive);h.useEffect(()=>{m(t==null?void 0:t.isActive)},[t]);const p=S=>()=>{m(!a),l({id:S,payload:{isActive:!a}})},P=e.jsxs(ce,{hover:!0,selected:o,children:[e.jsx(f,{children:s||(t==null?void 0:t.id)}),e.jsx(f,{children:`${t==null?void 0:t.firstName} ${(t==null?void 0:t.lastName)||""}`}),e.jsx(f,{children:(t==null?void 0:t.phoneNumber)||"-"}),e.jsx(f,{children:t==null?void 0:t.email}),e.jsx(f,{children:e.jsx($,{checked:a,onChange:p(t.id),color:"primary"})}),e.jsx(f,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:e.jsx(H,{color:d.open?"inherit":"default",onClick:d.onOpen,children:e.jsx(b,{icon:"eva:more-vertical-fill"})})})]});return e.jsxs(e.Fragment,{children:[P,e.jsx(q,{open:d.open,anchorEl:d.anchorEl,onClose:d.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(K,{children:[e.jsx(C,{permission:j.EDIT_STAFF,children:e.jsxs(F,{onClick:()=>{c()},children:[e.jsx(b,{icon:"solar:pen-bold"}),r("listView.table.tableActions.edit")]})}),e.jsx(C,{permission:j.DELETE_STAFF,children:e.jsxs(F,{onClick:()=>{u.onTrue(),d.onClose()},sx:{color:"error.main"},children:[e.jsx(b,{icon:"solar:trash-bin-trash-bold"}),r("listView.table.tableActions.delete")]})})]})}),e.jsx(xe,{open:u.value,onClose:u.onFalse,title:r("listView.messages.dialogDelete.title"),content:r("listView.messages.dialogDelete.text"),action:e.jsx(A,{variant:"contained",color:"error",onClick:i,children:r("listView.table.tableActions.delete")})})]})};function ye({filters:t,onResetPage:s,options:o}){const{t:c}=w("staff"),i=h.useCallback(l=>{s(),t.setState({name:l.target.value})},[t,s]);return e.jsx(D,{spacing:2,justifyContent:{xs:"space-between"},alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5},children:e.jsx(ge,{sx:{width:420},value:t.state.name,onChange:i,placeholder:c("listView.table.tableToolbar.searchPlaceholder"),InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(b,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})}function Re({filters:t,totalResults:s,onResetPage:o,sx:c}){const i=h.useCallback(()=>{o(),t.setState({name:""})},[t,o]),l=h.useCallback(()=>{o(),t.onResetState()},[t,o]);return e.jsx(je,{totalResults:s,onReset:l,sx:c,children:e.jsx(Ce,{label:"Keyword:",isShow:!!t.state.name,children:e.jsx(Se,{...Pe,label:t.state.name,onDelete:i})})})}const we=({staffs:t})=>{const s=ie({defaultOrderBy:"orderNumber"}),{t:o}=w("staff"),c=Q(),[i,l]=h.useState(t),u=[{id:"reminderId",label:"#",width:140},{id:"staffName",label:`${o("listView.table.tableHeader.userName")}`,width:280},{id:"phoneNumber",label:`${o("listView.table.tableHeader.phone")}`},{id:"emailAddress",label:`${o("listView.table.tableHeader.email")}`},{id:"status",label:`${o("listView.table.tableHeader.status")}`},{id:"",width:88}],r=M({name:"",status:"all",startDate:null,endDate:null});h.useEffect(()=>{l(t)},[t]);const d=O(r.state.startDate,r.state.endDate),a=Fe({inputData:i,comparator:ne(s.order,s.orderBy),filters:r.state,dateError:d}),m=oe(a,s.page,s.rowsPerPage),p=!!r.state.name||r.state.status!=="all"||!!r.state.startDate&&!!r.state.endDate,P=!a.length&&p||!a.length,S=h.useCallback(n=>{k(n)},[m.length,s,i]),T=_(),{mutate:I}=v({mutationFn:async({id:n,payload:x})=>(await y.patch(R.staff.edit+n,x),n),onSuccess:async n=>{E.success(o("listView.messages.toastMessages.editSuccess")),await T.invalidateQueries({queryKey:["staff",n]})},onSettled:async()=>{await T.invalidateQueries({queryKey:["staffs"]})},onError:n=>{console.log(n)}}),{mutate:k}=v({mutationFn:n=>y.delete(R.staff.delete+n),onSuccess:async n=>{const x=i.filter(B=>B.id!==n);E.success(o("listView.messages.toastMessages.deleteSuccess")),l(x),s.onUpdatePageDeleteRow(m.length)},onSettled:async()=>{await T.invalidateQueries({queryKey:["staffs"]})},onError:()=>{}}),V=h.useCallback(n=>{c.push(g.dashboard.staff.edit(n))},[c]);return e.jsx(U,{maxWidth:"xl",children:e.jsxs(D,{spacing:3,children:[e.jsx(ae,{links:[{name:`${o("listView.breadCrumbsPageRootTitle")}`,href:g.dashboard.root},{name:`${o("listView.breadCrumbsParentPageTitle")}`,href:g.dashboard.staff.root}],action:e.jsx(C,{permission:j.ADD_STAFF,children:e.jsx(A,{component:W,href:g.dashboard.staff.new,variant:"contained",startIcon:e.jsx(b,{icon:"mingcute:add-line"}),children:o("listView.addNewUser")})})}),e.jsx(C,{permission:j.STAFF_LIST,children:e.jsxs(z,{children:[e.jsx(ye,{filters:r,onResetPage:s.onResetPage,dateError:d}),p&&e.jsx(Re,{filters:r,totalResults:a.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(Y,{sx:{position:"relative"},children:[e.jsx(pe,{dense:s.dense,numSelected:s.selected.length,rowCount:a.length}),e.jsx(G,{sx:{minHeight:444},children:e.jsxs(me,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(he,{order:s.order,orderBy:s.orderBy,headLabel:u,rowCount:a.length}),e.jsxs(ue,{children:[a.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map((n,x)=>e.jsx(Te,{row:n,index:s.page*s.rowsPerPage+x+1,selected:s.selected.includes(n.id),onSelectRow:()=>s.onSelectRow(n.id),onDeleteRow:()=>S(n.id),onEditRow:()=>V(n.id),handler:I},n.id)),e.jsx(de,{height:s.dense?56:76,emptyRows:re(s.page,s.rowsPerPage,a.length)}),e.jsx(le,{notFound:P})]})]})})]}),e.jsx(fe,{page:s.page,dense:s.dense,count:a.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})})]})})};function Fe({inputData:t,comparator:s,filters:o,dateError:c}){const{status:i,name:l,startDate:u,endDate:r}=o,d=t.map((a,m)=>[a,m]);return d.sort((a,m)=>{const p=s(a[0],m[0]);return p!==0?p:a[1]-m[1]}),t=d.map(a=>a[0]),l&&(t=t.filter(a=>a.id.toString().toLowerCase().indexOf(l.toLowerCase())!==-1||a.staffName.toLowerCase().indexOf(l.toLowerCase())!==-1)),i!=="all"&&(t=t.filter(a=>a.status===i)),c||u&&r&&(t=t.filter(a=>J(a.createdAt,u,r))),t}const Ee={title:`User list | Dashboard - ${ee.site.name}`};function ut(){const t=te({queryKey:["staffs"],queryFn:async()=>{const{data:s}=await y.get(R.staff.list);return s}});return t.isPending||t.isLoading?e.jsx(X,{}):t.isError?e.jsx(se,{route:g.dashboard.staff.root}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{children:e.jsxs("title",{children:[" ",Ee.title]})}),e.jsx(we,{staffs:t.data})]})}export{ut as default};
